<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Go] Go Convention | Ding's Coding Forge</title>
<meta name=keywords content="go,convention"><meta name=description content="There aren’t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, I’d like to suggest some key conventions that I believe are useful for maintaining services in the long run."><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/en/posts/go-convention/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/go-convention/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/go-convention/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/en/posts/go-convention/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Go] Go Convention"><meta property="og:description" content="There aren’t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, I’d like to suggest some key conventions that I believe are useful for maintaining services in the long run."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-12T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Convention"><meta property="og:image" content="https://dingyu.dev/en/posts/go-convention/img/go-thumbnail.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/en/posts/go-convention/img/go-thumbnail.png"><meta name=twitter:title content="[Go] Go Convention"><meta name=twitter:description content="There aren’t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, I’d like to suggest some key conventions that I believe are useful for maintaining services in the long run."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/en/posts/"},{"@type":"ListItem","position":2,"name":"[Go] Go Convention","item":"https://dingyu.dev/en/posts/go-convention/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Go] Go Convention","name":"[Go] Go Convention","description":"There aren’t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, I’d like to suggest some key conventions that I believe are useful for maintaining services in the long run.","keywords":["go","convention"],"articleBody":"Background Inconsistent project structures per service made code hard to follow. No shared conventions made common module/CI reuse difficult, reducing productivity. Onboarding was challenging, especially for Go newcomers. Our team has now matured in using Go and has built internal best practices. We want to establish conventions for better maintainability and clarity across services. Proposed Project Structure Sections marked with * are mandatory. This structure assumes MSA-style projects rather than large monoliths.\nExample Structure (Domain: match sampling) . ├── *docs │ ├── *swagger.yaml │ ├── sequence.md │ └── architecture.md ├── *cmd │ └── *main.go ├── pkg │ ├── file_parser.go │ └── time_convertor.go └── *internal ├── *handler │ ├── *v1/sampling_handler.go │ ├── v2/sampling_handler.go │ ├── server.go │ ├── health_handler.go │ ├── swagger_handler.go │ └── auth_middleware.go ├── data │ ├── mysqldb.go │ ├── redis.go │ ├── feature_event_producer.go │ ├── match_repository.go │ └── nass_api.go ├── *service │ ├── kda_sampler.go │ ├── match_sampling_usecase.go │ └── kda_sampler_test.go ├── logger.go ├── constants.go └── *config.go ├── *gitlab-ci.yml ├── *go.mod ├── *go.sum └── *README.md Section Required Description docs ✔ Project-level diagrams and specs cmd ✔ Entry point for DI \u0026 execution pkg optional Utility modules safe for external reuse internal ✔ Core domain logic, hidden from outside handler ✔ HTTP/gRPC/Kafka handlers (versioned) data optional Database, external API, Kafka interactions service ✔ Business logic per SRP, unit tested root files ✔ CI, readme, mod/sum files Constant Convention Use PascalCase for constants shared across packages. Use camelCase for internal/private constants. If a private constant must be exposed, wrap it via a public method. Data Model Convention Define models close to their use (not in shared folders). Use DTOs between layers, and convert as needed. For 2+ arguments, use structs. Keep validation logic in methods for readability and testability. // AS-IS if strings.HasPrefix(match.Version, \"rc\") \u0026\u0026 match.detail == \"test\" { ... } // TO-BE if match.IsTest() { ... } Test Conventions Testing business logic is mandatory, not optional. You should write test cases for already-defined errors in a concise yet detailed manner.\nDeterministic Asynchronous Unit Testing Avoid relying on time.Sleep or blindly logging after async execution without assertions.\nPrevent flaky tests by leveraging Dependency Injection (DI) and assert.Eventually.\n1. Injecting a Logger // NewQueue creates a Queue instance responsible for business logic func NewQueue( config Config, httpClient *http.Client, logger *zerolog.Logger, ) (queue Queue, err error) { // The queue will execute the thread executor when Start() is called. queue = Queue{ config: config, client: httpClient, logger: logger, quitChan: make(chan struct{}), } return } 2. Testing Output Test case for queue failure logging t.Run(\"Logs failure correctly when queue processing fails\", func(t *testing.T) { // given var buffer bytes.Buffer ... inject logger with buffer as output // when ... execute async task event1, err := queue.Push([]byte(validJSON1)) assert.NoError(t, err) event2, err := queue.Push([]byte(validJSON2)) assert.NoError(t, err) // then assert.Eventually(t, func() bool { output := buffer.String() return strings.Contains(output, event1.TraceID().String()) \u0026\u0026 strings.Contains(output, event2.TraceID().String()) \u0026\u0026 strings.Contains(output, `\"success\":false`) }, 1*time.Second, 10*time.Millisecond) }) Test case for queue success logging t.Run(\"Logs success correctly when queue processes successfully\", func(t *testing.T) { // given var buffer bytes.Buffer ... inject logger with buffer as output // when ... execute async task event1, err := queue.Push([]byte(validJSON1)) assert.NoError(t, err) event2, err := queue.Push([]byte(validJSON2)) assert.NoError(t, err) // then assert.Eventually(t, func() bool { output := buffer.String() return strings.Contains(output, event1.TraceID().String()) \u0026\u0026 strings.Contains(output, event2.TraceID().String()) \u0026\u0026 strings.Contains(output, `\"success\":true`) }, 1*time.Second, 10*time.Millisecond) }) ","wordCount":"550","inLanguage":"en","image":"https://dingyu.dev/en/posts/go-convention/img/go-thumbnail.png","datePublished":"2025-01-12T00:00:00Z","dateModified":"2025-01-12T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/en/posts/go-convention/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/en/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=Translations type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=ko href=https://dingyu.dev/ title=한국어 aria-label=한국어>한국어</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/en/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/en/>Home</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Go] Go Convention</h1><div class=post-description>There aren’t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, I’d like to suggest some key conventions that I believe are useful for maintaining services in the long run.</div><div class=post-meta><span title='2025-01-12 00:00:00 +0000 UTC'>January 12, 2025</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;550 words&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://dingyu.dev/posts/go-convention/>Ko</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/go-convention/index.en.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/go-thumbnail.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#proposed-project-structure aria-label="Proposed Project Structure">Proposed Project Structure</a><ul><li><a href=#example-structure-domain-match-sampling aria-label="Example Structure (Domain: match sampling)">Example Structure (Domain: match sampling)</a></li></ul></li><li><a href=#constant-convention aria-label="Constant Convention">Constant Convention</a></li><li><a href=#data-model-convention aria-label="Data Model Convention">Data Model Convention</a><ul><li><a href=#test-conventions aria-label="Test Conventions">Test Conventions</a><ul><li><a href=#deterministic-asynchronous-unit-testing aria-label="Deterministic Asynchronous Unit Testing">Deterministic Asynchronous Unit Testing</a><ul><li><a href=#1-injecting-a-logger aria-label="1. Injecting a Logger">1. Injecting a Logger</a></li><li><a href=#2-testing-output aria-label="2. Testing Output">2. Testing Output</a></li></ul></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><ul><li>Inconsistent project structures per service made code hard to follow.</li><li>No shared conventions made common module/CI reuse difficult, reducing productivity.</li><li>Onboarding was challenging, especially for Go newcomers.</li><li>Our team has now matured in using Go and has built internal best practices.</li><li>We want to establish conventions for better maintainability and clarity across services.</li></ul><h1 id=proposed-project-structure>Proposed Project Structure<a hidden class=anchor aria-hidden=true href=#proposed-project-structure>#</a></h1><blockquote><p>Sections marked with * are mandatory.
This structure assumes MSA-style projects rather than large monoliths.</p></blockquote><h2 id=example-structure-domain-match-sampling>Example Structure (Domain: match sampling)<a hidden class=anchor aria-hidden=true href=#example-structure-domain-match-sampling>#</a></h2><pre tabindex=0><code>.
├── *docs
│   ├── *swagger.yaml
│   ├── sequence.md
│   └── architecture.md
├── *cmd
│   └── *main.go
├── pkg
│   ├── file_parser.go
│   └── time_convertor.go
└── *internal
    ├── *handler
    │   ├── *v1/sampling_handler.go
    │   ├── v2/sampling_handler.go
    │   ├── server.go
    │   ├── health_handler.go
    │   ├── swagger_handler.go
    │   └── auth_middleware.go
    ├── data
    │   ├── mysqldb.go
    │   ├── redis.go
    │   ├── feature_event_producer.go
    │   ├── match_repository.go
    │   └── nass_api.go
    ├── *service
    │   ├── kda_sampler.go
    │   ├── match_sampling_usecase.go
    │   └── kda_sampler_test.go
    ├── logger.go
    ├── constants.go
    └── *config.go
├── *gitlab-ci.yml
├── *go.mod
├── *go.sum
└── *README.md
</code></pre><p><img loading=lazy src=/posts/go-convention/layered-architecture.png></p><table><thead><tr><th>Section</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><strong>docs</strong></td><td>✔</td><td>Project-level diagrams and specs</td></tr><tr><td><strong>cmd</strong></td><td>✔</td><td>Entry point for DI & execution</td></tr><tr><td><strong>pkg</strong></td><td>optional</td><td>Utility modules safe for external reuse</td></tr><tr><td><strong>internal</strong></td><td>✔</td><td>Core domain logic, hidden from outside</td></tr><tr><td><strong>handler</strong></td><td>✔</td><td>HTTP/gRPC/Kafka handlers (versioned)</td></tr><tr><td><strong>data</strong></td><td>optional</td><td>Database, external API, Kafka interactions</td></tr><tr><td><strong>service</strong></td><td>✔</td><td>Business logic per SRP, unit tested</td></tr><tr><td><strong>root files</strong></td><td>✔</td><td>CI, readme, mod/sum files</td></tr></tbody></table><h1 id=constant-convention>Constant Convention<a hidden class=anchor aria-hidden=true href=#constant-convention>#</a></h1><ul><li>Use <code>PascalCase</code> for constants shared across packages.</li><li>Use <code>camelCase</code> for internal/private constants.</li><li>If a private constant must be exposed, wrap it via a public method.</li></ul><h1 id=data-model-convention>Data Model Convention<a hidden class=anchor aria-hidden=true href=#data-model-convention>#</a></h1><ul><li>Define models close to their use (not in shared folders).</li><li>Use DTOs between layers, and convert as needed.</li><li>For 2+ arguments, use structs.</li><li>Keep validation logic in methods for readability and testability.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// AS-IS</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>HasPrefix</span><span class=p>(</span><span class=nx>match</span><span class=p>.</span><span class=nx>Version</span><span class=p>,</span> <span class=s>&#34;rc&#34;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>match</span><span class=p>.</span><span class=nx>detail</span> <span class=o>==</span> <span class=s>&#34;test&#34;</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// TO-BE</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>match</span><span class=p>.</span><span class=nf>IsTest</span><span class=p>()</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span></code></pre></div><h2 id=test-conventions>Test Conventions<a hidden class=anchor aria-hidden=true href=#test-conventions>#</a></h2><p>Testing business logic is <strong>mandatory</strong>, not optional.
You should write test cases for already-defined errors in a <strong>concise yet detailed</strong> manner.</p><h3 id=deterministic-asynchronous-unit-testing>Deterministic Asynchronous Unit Testing<a hidden class=anchor aria-hidden=true href=#deterministic-asynchronous-unit-testing>#</a></h3><p>Avoid relying on <code>time.Sleep</code> or blindly logging after async execution without assertions.</p><p>Prevent <strong>flaky tests</strong> by leveraging <strong>Dependency Injection (DI)</strong> and <code>assert.Eventually</code>.</p><h4 id=1-injecting-a-logger>1. Injecting a Logger<a hidden class=anchor aria-hidden=true href=#1-injecting-a-logger>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// NewQueue creates a Queue instance responsible for business logic</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewQueue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>config</span> <span class=nx>Config</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>httpClient</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>logger</span> <span class=o>*</span><span class=nx>zerolog</span><span class=p>.</span><span class=nx>Logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>(</span><span class=nx>queue</span> <span class=nx>Queue</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// The queue will execute the thread executor when Start() is called.</span>
</span></span><span class=line><span class=cl>	<span class=nx>queue</span> <span class=p>=</span> <span class=nx>Queue</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>config</span><span class=p>:</span>   <span class=nx>config</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>client</span><span class=p>:</span>   <span class=nx>httpClient</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>logger</span><span class=p>:</span>   <span class=nx>logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>quitChan</span><span class=p>:</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>struct</span><span class=p>{}),</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=2-testing-output>2. Testing Output<a hidden class=anchor aria-hidden=true href=#2-testing-output>#</a></h4><ul><li><strong>Test case for queue failure logging</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;Logs failure correctly when queue processing fails&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// given</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>buffer</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>inject</span> <span class=nx>logger</span> <span class=nx>with</span> <span class=nx>buffer</span> <span class=nx>as</span> <span class=nx>output</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// when</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>execute</span> <span class=nx>async</span> <span class=nx>task</span>
</span></span><span class=line><span class=cl>	<span class=nx>event1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>event2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// then</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>Eventually</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>output</span> <span class=o>:=</span> <span class=nx>buffer</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event1</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event2</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=s>`&#34;success&#34;:false`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=mi>1</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=mi>10</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><ul><li><strong>Test case for queue success logging</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;Logs success correctly when queue processes successfully&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// given</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>buffer</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>inject</span> <span class=nx>logger</span> <span class=nx>with</span> <span class=nx>buffer</span> <span class=nx>as</span> <span class=nx>output</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// when</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>execute</span> <span class=nx>async</span> <span class=nx>task</span>
</span></span><span class=line><span class=cl>	<span class=nx>event1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>event2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// then</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>Eventually</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>output</span> <span class=o>:=</span> <span class=nx>buffer</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event1</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event2</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=s>`&#34;success&#34;:true`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=mi>1</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=mi>10</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/en/tags/go/>Go</a></li><li><a href=https://dingyu.dev/en/tags/convention/>Convention</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/en/posts/grpc/><span class=title>« Prev</span><br><span>[Protocol] Exploring RPC... and GRPC in Depth</span>
</a><a class=next href=https://dingyu.dev/en/posts/es-to-loki/><span class=title>Next »</span><br><span>[LGTM] Elasticsearch to Loki Migration Story</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/en/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
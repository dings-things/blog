<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Go] Gophercon 2024 - Kubernetes Platform Programming | Ding's Coding Forge</title>
<meta name=keywords content="go,kubernetes,good practice"><meta name=description content="How to use the Kubernetes API with Go… and deploy applications using Operators"><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Go] Gophercon 2024 - Kubernetes Platform Programming"><meta property="og:description" content="How to use the Kubernetes API with Go… and deploy applications using Operators"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-05T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Good Practice"><meta property="og:image" content="https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/img/go-thumbnail.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/img/go-thumbnail.png"><meta name=twitter:title content="[Go] Gophercon 2024 - Kubernetes Platform Programming"><meta name=twitter:description content="How to use the Kubernetes API with Go… and deploy applications using Operators"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/en/posts/"},{"@type":"ListItem","position":2,"name":"[Go] Gophercon 2024 - Kubernetes Platform Programming","item":"https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Go] Gophercon 2024 - Kubernetes Platform Programming","name":"[Go] Gophercon 2024 - Kubernetes Platform Programming","description":"How to use the Kubernetes API with Go… and deploy applications using Operators","keywords":["go","kubernetes","good practice"],"articleBody":"Kubernetes API An interface to interact with the Kubernetes platform. Used by users, administrators, and applications to manage clusters and resources. Enables a series of operations such as listing or creating resources. Supports application deployment and status monitoring. Provided as an HTTP API, compatible with various languages and tools. https://////\nAPI SERVER: The address of the API server GROUP: /api: Core API group (e.g., Pod, Service) /apis/*: Extended API group for deployment and management features VERSION: e.g., v1 (stable), v1beta, v1alpha1 RESOURCE: The type of resource (e.g., /pods, /services) /: Namespace-specific queries NAME: The specific name of the target resource client-go Library Abstracts Kubernetes API calls into convenient Go functions.\nAccess both core and extended resource groups.\nSupports initialization inside/outside the cluster.\nProvides Informers to cache resource changes.\nQuerying Pods(\"\") allows access to all namespaces (within permission scope).\nWhen Updating a Deployment Concurrently The first request that reaches the server is accepted, others fail. Similar to MVCC: version conflict detection prevents lost updates. Simultaneous Image Change from Different Servers One request will succeed; the rest will fail with a Conflict error. Optimistic Concurrency Step 1 Step 2 Step 3 Submit update with resource version Apply if version matches stored version Fail on version mismatch Use retry.RetryOnConflict() to automatically retry on version conflicts.\nControllers and Operators in Kubernetes Controller:\nManages native Kubernetes resources (Pods, Deployments, Services). Operator:\nManages complex state via custom resources. Automates application deployment and management. kubebuilder Framework Go-based framework to develop Kubernetes controllers/operators. Generates boilerplate for CRD management and reconciliation. Helps focus only on core business logic. Alternative to client-go (which is more complex). Component Overview:\nProcess: Application configuration/init\nManager: API server communication, event caching, metrics\nWebhook: Initialization and validation logic\nController: Filters resource events and triggers Reconciler\nReconciler: Implements logic for managing custom resources\nSPEC: Desired state definition\nSTATUS: Current state reporting\nController Option Configuration Settings for the Reconcile() function triggered on resource changes.\nIncludes filters, performance settings, resource scopes.\nGeneration field can be used to only trigger reconciliation on spec changes.\nConfigure max concurrent reconciliations via controller options.\nWhen is Reconcile() Triggered? On operator startup (traverses all resources) On resource updates Default: any field change Customizable to spec-only changes Takeaways While CPU and memory-based autoscaling is standard, customizing based on application nature can improve performance. e.g., for queue-based workers, scale via queue length. Conflict errors during concurrent deployment can be mitigated using custom controllers. Instead of manually triggering deployment via Rundeck, a DaemonSet-based operator could handle automation (with caution). ","wordCount":"413","inLanguage":"en","image":"https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/img/go-thumbnail.png","datePublished":"2024-11-05T00:00:00Z","dateModified":"2024-11-05T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/en/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=Translations type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=ko href=https://dingyu.dev/ title=한국어 aria-label=한국어>한국어</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/en/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/en/>Home</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Go] Gophercon 2024 - Kubernetes Platform Programming</h1><div class=post-meta><span title='2024-11-05 00:00:00 +0000 UTC'>November 5, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;413 words&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/>Ko</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/gopher-con-2024-kubernetes-programing/index.en.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/go-thumbnail.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#kubernetes-api aria-label="Kubernetes API">Kubernetes API</a></li><li><a href=#client-go-library aria-label="client-go Library">client-go Library</a><ul><li><a href=#when-updating-a-deployment-concurrently aria-label="When Updating a Deployment Concurrently">When Updating a Deployment Concurrently</a></li><li><a href=#simultaneous-image-change-from-different-servers aria-label="Simultaneous Image Change from Different Servers">Simultaneous Image Change from Different Servers</a></li><li><a href=#optimistic-concurrency aria-label="Optimistic Concurrency">Optimistic Concurrency</a></li></ul></li><li><a href=#controllers-and-operators-in-kubernetes aria-label="Controllers and Operators in Kubernetes">Controllers and Operators in Kubernetes</a></li><li><a href=#kubebuilder-framework aria-label="kubebuilder Framework">kubebuilder Framework</a></li><li><a href=#controller-option-configuration aria-label="Controller Option Configuration">Controller Option Configuration</a><ul><li><a href=#when-is-reconcile-triggered aria-label="When is Reconcile() Triggered?">When is Reconcile() Triggered?</a></li></ul></li><li><a href=#takeaways aria-label=Takeaways>Takeaways</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=kubernetes-api>Kubernetes API<a hidden class=anchor aria-hidden=true href=#kubernetes-api>#</a></h2><ul><li>An interface to interact with the Kubernetes platform.</li><li>Used by users, administrators, and applications to manage clusters and resources.</li><li>Enables a series of operations such as listing or creating resources.</li><li>Supports application deployment and status monitoring.</li><li>Provided as an HTTP API, compatible with various languages and tools.</li></ul><blockquote><p><code>https://&lt;APISERVER>/&lt;GROUP>/&lt;VERSION>/&lt;RESOURCE>/&lt;NAME></code></p></blockquote><ul><li><strong>API SERVER</strong>: The address of the API server</li><li><strong>GROUP</strong>:<ul><li><code>/api</code>: Core API group (e.g., Pod, Service)</li><li><code>/apis/*</code>: Extended API group for deployment and management features</li></ul></li><li><strong>VERSION</strong>: e.g., v1 (stable), v1beta, v1alpha1</li><li><strong>RESOURCE</strong>: The type of resource (e.g., /pods, /services)<ul><li><code>&lt;NAMESPACE>/&lt;RESOURCE></code>: Namespace-specific queries</li></ul></li><li><strong>NAME</strong>: The specific name of the target resource</li></ul><h2 id=client-go-library>client-go Library<a hidden class=anchor aria-hidden=true href=#client-go-library>#</a></h2><ul><li><p>Abstracts Kubernetes API calls into convenient Go functions.</p></li><li><p>Access both core and extended resource groups.</p></li><li><p>Supports initialization inside/outside the cluster.</p></li><li><p>Provides Informers to cache resource changes.</p></li><li><p>Querying <code>Pods("")</code> allows access to all namespaces (within permission scope).</p></li></ul><h3 id=when-updating-a-deployment-concurrently>When Updating a Deployment Concurrently<a hidden class=anchor aria-hidden=true href=#when-updating-a-deployment-concurrently>#</a></h3><ul><li>The first request that reaches the server is accepted, others fail.<ul><li>Similar to MVCC: version conflict detection prevents lost updates.</li></ul></li></ul><h3 id=simultaneous-image-change-from-different-servers>Simultaneous Image Change from Different Servers<a hidden class=anchor aria-hidden=true href=#simultaneous-image-change-from-different-servers>#</a></h3><ul><li>One request will succeed; the rest will fail with a <code>Conflict</code> error.</li></ul><h3 id=optimistic-concurrency>Optimistic Concurrency<a hidden class=anchor aria-hidden=true href=#optimistic-concurrency>#</a></h3><table><thead><tr><th>Step 1</th><th>Step 2</th><th>Step 3</th></tr></thead><tbody><tr><td>Submit update with resource version</td><td>Apply if version matches stored version</td><td>Fail on version mismatch</td></tr></tbody></table><p>Use <code>retry.RetryOnConflict()</code> to automatically retry on version conflicts.</p><h2 id=controllers-and-operators-in-kubernetes>Controllers and Operators in Kubernetes<a hidden class=anchor aria-hidden=true href=#controllers-and-operators-in-kubernetes>#</a></h2><p><strong>Controller</strong>:</p><ul><li>Manages native Kubernetes resources (Pods, Deployments, Services).</li></ul><p><strong>Operator</strong>:</p><ul><li>Manages complex state via custom resources.</li><li>Automates application deployment and management.</li></ul><h2 id=kubebuilder-framework>kubebuilder Framework<a hidden class=anchor aria-hidden=true href=#kubebuilder-framework>#</a></h2><ul><li>Go-based framework to develop Kubernetes controllers/operators.</li><li>Generates boilerplate for CRD management and reconciliation.</li><li>Helps focus only on core business logic.</li><li>Alternative to client-go (which is more complex).</li></ul><p><strong>Component Overview:</strong></p><ul><li><p><strong>Process</strong>: Application configuration/init</p></li><li><p><strong>Manager</strong>: API server communication, event caching, metrics</p></li><li><p><strong>Webhook</strong>: Initialization and validation logic</p></li><li><p><strong>Controller</strong>: Filters resource events and triggers Reconciler</p></li><li><p><strong>Reconciler</strong>: Implements logic for managing custom resources</p></li><li><p><strong>SPEC</strong>: Desired state definition</p></li><li><p><strong>STATUS</strong>: Current state reporting</p></li></ul><h2 id=controller-option-configuration>Controller Option Configuration<a hidden class=anchor aria-hidden=true href=#controller-option-configuration>#</a></h2><ul><li><p>Settings for the <code>Reconcile()</code> function triggered on resource changes.</p></li><li><p>Includes filters, performance settings, resource scopes.</p></li><li><p>Generation field can be used to only trigger reconciliation on spec changes.</p></li><li><p>Configure max concurrent reconciliations via controller options.</p></li></ul><h3 id=when-is-reconcile-triggered>When is Reconcile() Triggered?<a hidden class=anchor aria-hidden=true href=#when-is-reconcile-triggered>#</a></h3><ul><li>On operator startup (traverses all resources)</li><li>On resource updates<ul><li>Default: any field change</li><li>Customizable to spec-only changes</li></ul></li></ul><h2 id=takeaways>Takeaways<a hidden class=anchor aria-hidden=true href=#takeaways>#</a></h2><ul><li>While CPU and memory-based autoscaling is standard, customizing based on application nature can improve performance.<ul><li>e.g., for queue-based workers, scale via queue length.</li></ul></li><li>Conflict errors during concurrent deployment can be mitigated using custom controllers.</li><li>Instead of manually triggering deployment via Rundeck, a DaemonSet-based operator could handle automation (with caution).</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/en/tags/go/>Go</a></li><li><a href=https://dingyu.dev/en/tags/kubernetes/>Kubernetes</a></li><li><a href=https://dingyu.dev/en/tags/good-practice/>Good Practice</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/en/posts/gopher-con-2024-go-project-guide/><span class=title>« Prev</span><br><span>[Go] Gophercon 2024 - Go Project Guide from A to Z</span>
</a><a class=next href=https://dingyu.dev/en/posts/worker-pool-async/><span class=title>Next »</span><br><span>[Go] Profiling Worker Pool vs. Async Processing</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/en/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
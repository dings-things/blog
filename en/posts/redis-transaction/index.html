<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[DB] Redis Transaction | Ding's Coding Forge</title>
<meta name=keywords content="redis,transaction,txpipeline"><meta name=description content="Unlike RDBMS, Redis doesn‚Äôt have a traditional transaction mechanism. It primarily operates as a single-threaded cache, but transactions can still be made atomic using TX pipelines or Lua scripts. This post focuses on comparing the pros and cons of Lua scripts vs. TX pipelines."><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/en/posts/redis-transaction/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.ba0de23ad40e17ca82720b577f8ae6ec11a26fb07407316cff70888e344ad129.css integrity="sha256-ug3iOtQOF8qCcgtXf4rm7BGib7B0BzFs/3CIjjRK0Sk=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/redis-transaction/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/redis-transaction/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/en/posts/redis-transaction/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[DB] Redis Transaction"><meta property="og:description" content="Unlike RDBMS, Redis doesn‚Äôt have a traditional transaction mechanism. It primarily operates as a single-threaded cache, but transactions can still be made atomic using TX pipelines or Lua scripts. This post focuses on comparing the pros and cons of Lua scripts vs. TX pipelines."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-31T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-31T00:00:00+00:00"><meta property="article:tag" content="Redis"><meta property="article:tag" content="Transaction"><meta property="article:tag" content="Txpipeline"><meta property="og:image" content="https://dingyu.dev/en/posts/redis-transaction/img/redis.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/en/posts/redis-transaction/img/redis.png"><meta name=twitter:title content="[DB] Redis Transaction"><meta name=twitter:description content="Unlike RDBMS, Redis doesn‚Äôt have a traditional transaction mechanism. It primarily operates as a single-threaded cache, but transactions can still be made atomic using TX pipelines or Lua scripts. This post focuses on comparing the pros and cons of Lua scripts vs. TX pipelines."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/en/posts/"},{"@type":"ListItem","position":2,"name":"[DB] Redis Transaction","item":"https://dingyu.dev/en/posts/redis-transaction/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[DB] Redis Transaction","name":"[DB] Redis Transaction","description":"Unlike RDBMS, Redis doesn‚Äôt have a traditional transaction mechanism. It primarily operates as a single-threaded cache, but transactions can still be made atomic using TX pipelines or Lua scripts. This post focuses on comparing the pros and cons of Lua scripts vs. TX pipelines.","keywords":["redis","transaction","txpipeline"],"articleBody":"Purpose Unlike traditional RDBMS, which implement transactions through isolation levels and mechanisms like rollback and commit, Redis has no native transactional locking system. This post discusses how to isolate a transaction and preserve all-or-nothing atomicity in Redis using available tools.\nOptions Redis TxPipeline Lua Script Redis TxPipeline A natural first approach is to use Pipelines, which send multiple commands in batch. However, Pipelines alone don‚Äôt ensure atomicity‚Äîcommands can still be interleaved with others from different clients.\nEdge Cases Network Delay: Commands and responses may arrive out of sync. Multithreaded Clients: Multiple clients using pipelines simultaneously can cause inconsistent ordering. Replica Configuration: Data consistency may not be guaranteed when replication settings like slaveof are active. This is where TxPipeline shines.\nPros Atomic batch execution via MULTI/EXEC. Improved performance by reducing round trips. Transactional consistency when used with WATCH. Cons Memory overhead: All commands and responses are buffered. Complexity: Mixed usage with normal pipelines may cause unintended behavior. Testing Example MULTI SET key1 value1 SET key2 value2 SET key3 value3 EXEC If SET key2 value2 fails:\nOOM: Out of memory WRONGTYPE: Type mismatch on key Even with WATCH, if the connection drops mid-transaction, rollback is not guaranteed. TxPipeline ensures consistency, but not full rollback support.\nLua Script Use Lua to execute multiple Redis commands atomically.\nEdge Cases Script transmission failure due to network issues. Post-execution result fetch failures on the client side. Pros Lightweight and fast Atomic: Entire script runs as one unit Embedded scripting for customization Cons Smaller ecosystem Fewer data types Tougher concurrency and threading Testing Scripts cannot be rolled back either. Worst case? Network cut-off during the process.\nluaScript := ` for i = 1, #KEYS do if KEYS[i] == 'key3' then error('error on key3') else redis.call('SET', KEYS[i], ARGV[i]) end end ` Keys: key1 to key5 ‚Üí key3 triggers error.\nSummary TxPipeline Lua Script Overview Redis-like syntax, optimistic locking via WATCH, consistent Full atomic block via Lua, less intuitive for some users Rollback ‚ùå No rollback ‚ùå No rollback Drawbacks Slightly slower than Lua, potential complexity Extra script management, steeper learning curve Both methods ensure data consistency, not rollback. Client-side validation is crucial. Network errors remain the weakest link. Benchmark Setting 1,000 keys:\nMethod Runs Avg Time (ms) Lua Script 1424 0.83 TxPipeline 460 2.56 Basic Pipeline 506 2.34 While not dramatic, Lua is slightly faster‚Äîbut choose based on structure and consistency needs.\n","wordCount":"394","inLanguage":"en","image":"https://dingyu.dev/en/posts/redis-transaction/img/redis.png","datePublished":"2024-01-31T00:00:00Z","dateModified":"2024-01-31T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/en/posts/redis-transaction/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/en/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://dingyu.dev/ title=ÌïúÍµ≠Ïñ¥ aria-label=ÌïúÍµ≠Ïñ¥>Ko</a></li></ul></div></div><ul id=menu><li><a href=https://dingyu.dev/en/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/en/search/ title=üîç><span>üîç</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/en/>Home</a>&nbsp;¬ª&nbsp;<a href=https://dingyu.dev/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[DB] Redis Transaction</h1><div class=post-description>Unlike RDBMS, Redis doesn‚Äôt have a traditional transaction mechanism. It primarily operates as a single-threaded cache, but transactions can still be made atomic using TX pipelines or Lua scripts. This post focuses on comparing the pros and cons of Lua scripts vs. TX pipelines.</div><div class=post-meta><span title='2024-01-31 00:00:00 +0000 UTC'>January 31, 2024</span>&nbsp;¬∑&nbsp;2 min&nbsp;¬∑&nbsp;394 words&nbsp;¬∑&nbsp;dingyu&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://dingyu.dev/posts/redis-transaction/>Ko</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/redis-transaction/index.en.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/redis.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#purpose aria-label=Purpose>Purpose</a></li><li><a href=#options aria-label=Options>Options</a></li><li><a href=#redis-txpipeline aria-label="Redis TxPipeline">Redis TxPipeline</a><ul><li><a href=#edge-cases aria-label="Edge Cases">Edge Cases</a></li><li><a href=#pros aria-label=Pros>Pros</a></li><li><a href=#cons aria-label=Cons>Cons</a></li><li><a href=#testing-example aria-label="Testing Example">Testing Example</a></li></ul></li><li><a href=#lua-script aria-label="Lua Script">Lua Script</a><ul><li><a href=#edge-cases-1 aria-label="Edge Cases">Edge Cases</a></li><li><a href=#pros-1 aria-label=Pros>Pros</a></li><li><a href=#cons-1 aria-label=Cons>Cons</a></li><li><a href=#testing aria-label=Testing>Testing</a></li></ul></li><li><a href=#summary aria-label=Summary>Summary</a></li><li><a href=#benchmark aria-label=Benchmark>Benchmark</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=purpose>Purpose<a hidden class=anchor aria-hidden=true href=#purpose>#</a></h2><p>Unlike traditional RDBMS, which implement transactions through isolation levels and mechanisms like rollback and commit, Redis has no native transactional locking system. This post discusses how to isolate a transaction and preserve <strong>all-or-nothing atomicity</strong> in Redis using available tools.</p><h2 id=options>Options<a hidden class=anchor aria-hidden=true href=#options>#</a></h2><ol><li>Redis TxPipeline</li><li>Lua Script</li></ol><h2 id=redis-txpipeline>Redis TxPipeline<a hidden class=anchor aria-hidden=true href=#redis-txpipeline>#</a></h2><p>A natural first approach is to use <strong>Pipelines</strong>, which send multiple commands in batch. However, Pipelines alone don‚Äôt ensure atomicity‚Äîcommands can still be interleaved with others from different clients.</p><h3 id=edge-cases>Edge Cases<a hidden class=anchor aria-hidden=true href=#edge-cases>#</a></h3><ol><li><strong>Network Delay</strong>: Commands and responses may arrive out of sync.</li><li><strong>Multithreaded Clients</strong>: Multiple clients using pipelines simultaneously can cause inconsistent ordering.</li><li><strong>Replica Configuration</strong>: Data consistency may not be guaranteed when replication settings like <code>slaveof</code> are active.</li></ol><p>This is where <strong>TxPipeline</strong> shines.</p><h3 id=pros>Pros<a hidden class=anchor aria-hidden=true href=#pros>#</a></h3><ul><li><strong>Atomic batch execution</strong> via <code>MULTI</code>/<code>EXEC</code>.</li><li><strong>Improved performance</strong> by reducing round trips.</li><li><strong>Transactional consistency</strong> when used with <code>WATCH</code>.</li></ul><h3 id=cons>Cons<a hidden class=anchor aria-hidden=true href=#cons>#</a></h3><ul><li><strong>Memory overhead</strong>: All commands and responses are buffered.</li><li><strong>Complexity</strong>: Mixed usage with normal pipelines may cause unintended behavior.</li></ul><h3 id=testing-example>Testing Example<a hidden class=anchor aria-hidden=true href=#testing-example>#</a></h3><p><img loading=lazy src=img/2.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>MULTI
</span></span><span class=line><span class=cl>SET key1 value1
</span></span><span class=line><span class=cl>SET key2 value2
</span></span><span class=line><span class=cl>SET key3 value3
</span></span><span class=line><span class=cl>EXEC
</span></span></code></pre></div><p>If <code>SET key2 value2</code> fails:</p><ul><li><code>OOM</code>: Out of memory</li><li><code>WRONGTYPE</code>: Type mismatch on key</li></ul><p>Even with <code>WATCH</code>, if the connection drops mid-transaction, rollback is not guaranteed. TxPipeline <strong>ensures consistency</strong>, but not full rollback support.</p><hr><h2 id=lua-script>Lua Script<a hidden class=anchor aria-hidden=true href=#lua-script>#</a></h2><p>Use Lua to execute multiple Redis commands <strong>atomically</strong>.</p><h3 id=edge-cases-1>Edge Cases<a hidden class=anchor aria-hidden=true href=#edge-cases-1>#</a></h3><ol><li>Script transmission failure due to network issues.</li><li>Post-execution result fetch failures on the client side.</li></ol><h3 id=pros-1>Pros<a hidden class=anchor aria-hidden=true href=#pros-1>#</a></h3><ul><li><strong>Lightweight and fast</strong></li><li><strong>Atomic</strong>: Entire script runs as one unit</li><li><strong>Embedded scripting</strong> for customization</li></ul><h3 id=cons-1>Cons<a hidden class=anchor aria-hidden=true href=#cons-1>#</a></h3><ul><li>Smaller ecosystem</li><li>Fewer data types</li><li>Tougher concurrency and threading</li></ul><h3 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h3><p>Scripts cannot be rolled back either. Worst case? Network cut-off during the process.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>luaScript</span> <span class=o>:=</span> <span class=s>`
</span></span></span><span class=line><span class=cl><span class=s>  for i = 1, #KEYS do
</span></span></span><span class=line><span class=cl><span class=s>    if KEYS[i] == &#39;key3&#39; then
</span></span></span><span class=line><span class=cl><span class=s>      error(&#39;error on key3&#39;)
</span></span></span><span class=line><span class=cl><span class=s>    else
</span></span></span><span class=line><span class=cl><span class=s>      redis.call(&#39;SET&#39;, KEYS[i], ARGV[i])
</span></span></span><span class=line><span class=cl><span class=s>    end
</span></span></span><span class=line><span class=cl><span class=s>  end
</span></span></span><span class=line><span class=cl><span class=s>`</span>
</span></span></code></pre></div><p>Keys: key1 to key5 ‚Üí <code>key3</code> triggers error.</p><p><img loading=lazy src=img/1.png></p><hr><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><table><thead><tr><th></th><th>TxPipeline</th><th>Lua Script</th></tr></thead><tbody><tr><td><strong>Overview</strong></td><td>Redis-like syntax, optimistic locking via <code>WATCH</code>, consistent</td><td>Full atomic block via Lua, less intuitive for some users</td></tr><tr><td><strong>Rollback</strong></td><td>‚ùå No rollback</td><td>‚ùå No rollback</td></tr><tr><td><strong>Drawbacks</strong></td><td>Slightly slower than Lua, potential complexity</td><td>Extra script management, steeper learning curve</td></tr></tbody></table><ul><li>Both methods ensure <strong>data consistency</strong>, not rollback.</li><li>Client-side validation is crucial.</li><li>Network errors remain the weakest link.</li></ul><h2 id=benchmark>Benchmark<a hidden class=anchor aria-hidden=true href=#benchmark>#</a></h2><p>Setting 1,000 keys:</p><table><thead><tr><th>Method</th><th>Runs</th><th>Avg Time (ms)</th></tr></thead><tbody><tr><td>Lua Script</td><td>1424</td><td>0.83</td></tr><tr><td>TxPipeline</td><td>460</td><td>2.56</td></tr><tr><td>Basic Pipeline</td><td>506</td><td>2.34</td></tr></tbody></table><p>While not dramatic, Lua is slightly faster‚Äî<strong>but choose based on structure and consistency needs</strong>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/en/tags/redis/>Redis</a></li><li><a href=https://dingyu.dev/en/tags/transaction/>Transaction</a></li><li><a href=https://dingyu.dev/en/tags/txpipeline/>Txpipeline</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/en/posts/aws-well-architected/><span class=title>¬´ Prev</span><br><span>[Infra] AWS Well Architected</span>
</a><a class=next href=https://dingyu.dev/en/posts/fastapi-convention/><span class=title>Next ¬ª</span><br><span>[Python] FastAPI Convention</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/en/>Ding's Coding Forge</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
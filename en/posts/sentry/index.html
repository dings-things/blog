<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Third-Party] Integrating Sentry in Go | Ding's Coding Forge</title>
<meta name=keywords content="go,sentry"><meta name=description content="This post explores how to effectively integrate Sentry into Go projects to enhance error tracking, performance monitoring, and issue management. It covers the importance of structured logging, setting up Sentry alerts, and implementing error capturing using Go's pkg/errors for better stack trace visibility. Additionally, it introduces best practices such as singleton-based initialization, contextual error handling, and panic recovery middleware, ensuring stable and efficient service operations."><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/en/posts/sentry/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/sentry/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/sentry/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/en/posts/sentry/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Third-Party] Integrating Sentry in Go"><meta property="og:description" content="This post explores how to effectively integrate Sentry into Go projects to enhance error tracking, performance monitoring, and issue management. It covers the importance of structured logging, setting up Sentry alerts, and implementing error capturing using Go's pkg/errors for better stack trace visibility. Additionally, it introduces best practices such as singleton-based initialization, contextual error handling, and panic recovery middleware, ensuring stable and efficient service operations."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-11T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Sentry"><meta property="og:image" content="https://dingyu.dev/en/posts/sentry/img/sentry.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/en/posts/sentry/img/sentry.png"><meta name=twitter:title content="[Third-Party] Integrating Sentry in Go"><meta name=twitter:description content="This post explores how to effectively integrate Sentry into Go projects to enhance error tracking, performance monitoring, and issue management. It covers the importance of structured logging, setting up Sentry alerts, and implementing error capturing using Go's pkg/errors for better stack trace visibility. Additionally, it introduces best practices such as singleton-based initialization, contextual error handling, and panic recovery middleware, ensuring stable and efficient service operations."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/en/posts/"},{"@type":"ListItem","position":2,"name":"[Third-Party] Integrating Sentry in Go","item":"https://dingyu.dev/en/posts/sentry/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Third-Party] Integrating Sentry in Go","name":"[Third-Party] Integrating Sentry in Go","description":"This post explores how to effectively integrate Sentry into Go projects to enhance error tracking, performance monitoring, and issue management. It covers the importance of structured logging, setting up Sentry alerts, and implementing error capturing using Go's pkg/errors for better stack trace visibility. Additionally, it introduces best practices such as singleton-based initialization, contextual error handling, and panic recovery middleware, ensuring stable and efficient service operations.","keywords":["go","sentry"],"articleBody":"Background Developers were manually monitoring logs for incident response. However, there were limitations with log monitoring: Elasticsearch field mapping errors due to field type mismatches causing log event drops. If system logs were required (e.g., for stack traces), developers had to request them separately from the system engineers (SE), resulting in operational overhead. Goal Establish a common Sentry integration standard for Go-based projects. Provide feature specifications and guidelines for Sentry usage. Build a stable service foundation through faster incident response after Sentry adoption. This document assumes that a Sentry account and a Sentry project are already set up.\nAbout Sentry Capture Exception Automatically detects and records exceptions and errors in applications. Sentry provides stack traces and environment information at the time of error occurrence, making it easier to identify root causes.\nTransaction Monitoring Monitors application performance by tracking transactions such as web requests or API calls, providing response times, success rates, and error rates.\nTracing Tracks transactions in detail, analyzing service-to-service calls and database queries to identify bottlenecks.\nAlerts Manages issues and notifies via email, Slack, etc., when problems arise. Developers can be assigned to issues and collaborate on resolutions.\nRelease Tracking Tracks application versions and analyzes the impact of new releases on error rates, helping detect problems introduced by recent deployments.\nSentry Alerts Set up Sentry alerts integrated with collaboration tools for easy developer response.\nSetup Step-by-Step Dashboard \u003e Alerts \u003e Create Alert\nTrigger Setup\nIssues: Trigger alerts based on stacktrace patterns (e.g., API HTTP status code-based, service category-based). Number of Errors: Trigger alerts based on error occurrence counts. Users Experiencing Errors: Trigger alerts when a threshold number of users experience errors (e.g., 100 users failing to log in). Detailed Conditions\nWHEN: Define when the alert should trigger (any vs. all conditions). IF: Specify detailed conditions like tags, frequency, or categories. Action Selection\nSend notifications to Email, Slack, Teams, etc. Development Client Options DSN: Unique string identifying the Sentry project. Environment: Specify the runtime environment (e.g., production, staging, development). Release: Track the application version where the error occurred. SampleRate: Control the proportion of reported events (e.g., 0.1 means 10% sampling). TracesSampleRate: Similar to SampleRate but for performance data. BeforeSend: Callback to modify/filter events before reporting. AttachStacktrace: Include stack traces in logs. ServerName: Specify server name for better error grouping. Integrations: Set additional integrations with frameworks and libraries. Transport: Customize event transport, including timeout settings. Initialize Best practice is to call sentry.Init() at the application’s entry point (main.go).\nerr := sentry.Init( sentry.ClientOptions{ Dsn: config.Sentry.DSN, SampleRate: config.Sentry.SampleRate, EnableTracing: config.Sentry.EnableTrace, Debug: config.Sentry.Debug, TracesSampleRate: config.Sentry.TracesSampleRate, Environment: config.Sentry.Environment, AttachStacktrace: true, Transport: \u0026sentry.HTTPSyncTransport{ Timeout: config.Sentry.Timeout, }, }, ) Capture Exception Capture and track exceptions automatically:\nhub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() ctx = sentry.SetHubOnContext(ctx, hub) } hub.CaptureException(err) Stack Trace Differences: Go errors vs pkg/errors errors package: Does not capture stack traces. github.com/pkg/errors: Includes stack traces automatically. Test example:\nreturn pkgErr.Wrap(PkgErr1, PkgErr2.Error()) Scope() Scope allows attaching contextual metadata (e.g., request parameters) to events.\nhub := sentry.GetHubFromContext(r.Context()) if hub == nil { hub = sentry.CurrentHub().Clone() r = r.WithContext(sentry.SetHubOnContext(r.Context(), hub)) } hub.Scope().SetRequest(r) Sentry Advancement SentryInitializer Manages singleton initialization of the Sentry client:\ntype SentryInitializer struct { conf *Config enabled bool mutex sync.RWMutex } func (si *SentryInitializer) Init() error { ... } func (si *SentryInitializer) Enabled() bool { ... } Manages concurrent access safely with mutex.\nErrorCapturer Captures exceptions through the Sentry Hub:\ntype ErrorCapturer interface { CaptureError(ctx context.Context, err error) } Handles Hub setup and error capture internally.\nRecoverMiddleware Handles panics and automatically logs to Sentry:\ndefer func() { if err := recover(); err != nil { hub.RecoverWithContext(r.Context(), err) // Log stack trace } }() Even in panic scenarios, proper logging and Sentry reporting is ensured.\nDespite its cost, Sentry offers great convenience for both APM and error capture management!\n","wordCount":"627","inLanguage":"en","image":"https://dingyu.dev/en/posts/sentry/img/sentry.png","datePublished":"2024-09-11T00:00:00Z","dateModified":"2024-09-11T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/en/posts/sentry/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/en/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=Translations type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=ko href=https://dingyu.dev/ title=한국어 aria-label=한국어>한국어</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/en/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/en/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/en/>Home</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Third-Party] Integrating Sentry in Go</h1><div class=post-description>This post explores how to effectively integrate Sentry into Go projects to enhance error tracking, performance monitoring, and issue management. It covers the importance of structured logging, setting up Sentry alerts, and implementing error capturing using Go's pkg/errors for better stack trace visibility. Additionally, it introduces best practices such as singleton-based initialization, contextual error handling, and panic recovery middleware, ensuring stable and efficient service operations.</div><div class=post-meta><span title='2024-09-11 00:00:00 +0000 UTC'>September 11, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;627 words&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://dingyu.dev/posts/sentry/>Ko</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/sentry/index.en.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/sentry.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#goal aria-label=Goal>Goal</a></li><li><a href=#about-sentry aria-label="About Sentry">About Sentry</a><ul><ul><li><a href=#sentry-alerts aria-label="Sentry Alerts">Sentry Alerts</a><ul><li><a href=#setup-step-by-step aria-label="Setup Step-by-Step">Setup Step-by-Step</a></li></ul></li></ul></ul></li><li><a href=#development aria-label=Development>Development</a><ul><ul><li><a href=#client-options aria-label="Client Options">Client Options</a></li><li><a href=#initialize aria-label=Initialize>Initialize</a></li><li><a href=#capture-exception aria-label="Capture Exception">Capture Exception</a><ul><li><a href=#stack-trace-differences-go-errors-vs-pkgerrors aria-label="Stack Trace Differences: Go errors vs pkg/errors">Stack Trace Differences: Go <code>errors</code> vs <code>pkg/errors</code></a></li></ul></li></ul></ul></li><li><a href=#scope aria-label=Scope()>Scope()</a></li><li><a href=#sentry-advancement aria-label="Sentry Advancement">Sentry Advancement</a><ul><ul><li><a href=#sentryinitializer aria-label=SentryInitializer>SentryInitializer</a></li><li><a href=#errorcapturer aria-label=ErrorCapturer>ErrorCapturer</a></li><li><a href=#recovermiddleware aria-label=RecoverMiddleware>RecoverMiddleware</a></li></ul></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h1><ul><li>Developers were manually monitoring logs for incident response.</li><li>However, there were limitations with log monitoring:<ul><li><strong>Elasticsearch field mapping errors</strong> due to <strong>field type mismatches</strong> causing <strong>log event drops</strong>.</li><li>If system logs were required (e.g., for stack traces), developers had to request them separately from the system engineers (SE), resulting in operational overhead.</li></ul></li></ul><h1 id=goal>Goal<a hidden class=anchor aria-hidden=true href=#goal>#</a></h1><ul><li>Establish a common Sentry integration standard for Go-based projects.</li><li>Provide feature specifications and guidelines for Sentry usage.</li><li>Build a stable service foundation through faster incident response after Sentry adoption.</li></ul><blockquote><p>This document assumes that a Sentry account and a Sentry project are already set up.</p></blockquote><h1 id=about-sentry>About Sentry<a hidden class=anchor aria-hidden=true href=#about-sentry>#</a></h1><ol><li><strong>Capture Exception</strong></li></ol><p>Automatically detects and records exceptions and errors in applications. Sentry provides stack traces and environment information at the time of error occurrence, making it easier to identify root causes.</p><ol start=2><li><strong>Transaction Monitoring</strong></li></ol><p>Monitors application performance by tracking transactions such as web requests or API calls, providing response times, success rates, and error rates.</p><ol start=3><li><strong>Tracing</strong></li></ol><p>Tracks transactions in detail, analyzing service-to-service calls and database queries to identify bottlenecks.</p><ol start=4><li><strong>Alerts</strong></li></ol><p>Manages issues and notifies via email, Slack, etc., when problems arise. Developers can be assigned to issues and collaborate on resolutions.</p><ol start=5><li><strong>Release Tracking</strong></li></ol><p>Tracks application versions and analyzes the impact of new releases on error rates, helping detect problems introduced by recent deployments.</p><h3 id=sentry-alerts>Sentry Alerts<a hidden class=anchor aria-hidden=true href=#sentry-alerts>#</a></h3><p>Set up Sentry alerts integrated with collaboration tools for easy developer response.</p><h4 id=setup-step-by-step>Setup Step-by-Step<a hidden class=anchor aria-hidden=true href=#setup-step-by-step>#</a></h4><p>Dashboard > Alerts > Create Alert</p><p><img loading=lazy src=/posts/sentry/1.png></p><p><strong>Trigger Setup</strong></p><ul><li><strong>Issues</strong>: Trigger alerts based on stacktrace patterns (e.g., API HTTP status code-based, service category-based).</li><li><strong>Number of Errors</strong>: Trigger alerts based on error occurrence counts.</li><li><strong>Users Experiencing Errors</strong>: Trigger alerts when a threshold number of users experience errors (e.g., 100 users failing to log in).</li></ul><p><img loading=lazy src=/posts/sentry/2.png></p><p><strong>Detailed Conditions</strong></p><ul><li>WHEN: Define when the alert should trigger (any vs. all conditions).</li><li>IF: Specify detailed conditions like tags, frequency, or categories.</li></ul><p><img loading=lazy src=/posts/sentry/3.png>
<img loading=lazy src=/posts/sentry/4.png></p><p><strong>Action Selection</strong></p><ul><li>Send notifications to Email, Slack, Teams, etc.</li></ul><p><img loading=lazy src=/posts/sentry/5.png></p><h1 id=development>Development<a hidden class=anchor aria-hidden=true href=#development>#</a></h1><h3 id=client-options>Client Options<a hidden class=anchor aria-hidden=true href=#client-options>#</a></h3><ul><li><strong>DSN</strong>: Unique string identifying the Sentry project.</li><li><strong>Environment</strong>: Specify the runtime environment (e.g., production, staging, development).</li><li><strong>Release</strong>: Track the application version where the error occurred.</li><li><strong>SampleRate</strong>: Control the proportion of reported events (e.g., 0.1 means 10% sampling).</li><li><strong>TracesSampleRate</strong>: Similar to SampleRate but for performance data.</li><li><strong>BeforeSend</strong>: Callback to modify/filter events before reporting.</li><li><strong>AttachStacktrace</strong>: Include stack traces in logs.</li><li><strong>ServerName</strong>: Specify server name for better error grouping.</li><li><strong>Integrations</strong>: Set additional integrations with frameworks and libraries.</li><li><strong>Transport</strong>: Customize event transport, including timeout settings.</li></ul><p><img loading=lazy src=/posts/sentry/6.png></p><h3 id=initialize>Initialize<a hidden class=anchor aria-hidden=true href=#initialize>#</a></h3><p>Best practice is to call <code>sentry.Init()</code> at the application&rsquo;s entry point (<code>main.go</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>err</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>Init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>sentry</span><span class=p>.</span><span class=nx>ClientOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Dsn</span><span class=p>:</span>              <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>DSN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>SampleRate</span><span class=p>:</span>       <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>SampleRate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>EnableTracing</span><span class=p>:</span>    <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>EnableTrace</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Debug</span><span class=p>:</span>            <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>TracesSampleRate</span><span class=p>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>TracesSampleRate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Environment</span><span class=p>:</span>      <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Environment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>AttachStacktrace</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Transport</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>sentry</span><span class=p>.</span><span class=nx>HTTPSyncTransport</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Timeout</span><span class=p>:</span> <span class=nx>config</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h3 id=capture-exception>Capture Exception<a hidden class=anchor aria-hidden=true href=#capture-exception>#</a></h3><p>Capture and track exceptions automatically:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>hub</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>hub</span><span class=p>.</span><span class=nf>CaptureException</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=stack-trace-differences-go-errors-vs-pkgerrors>Stack Trace Differences: Go <code>errors</code> vs <code>pkg/errors</code><a hidden class=anchor aria-hidden=true href=#stack-trace-differences-go-errors-vs-pkgerrors>#</a></h4><ul><li><strong>errors package</strong>: Does <strong>not</strong> capture stack traces.</li><li><strong>github.com/pkg/errors</strong>: <strong>Includes stack traces</strong> automatically.</li></ul><p>Test example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>return</span> <span class=nx>pkgErr</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>PkgErr1</span><span class=p>,</span> <span class=nx>PkgErr2</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span></code></pre></div><hr><h1 id=scope>Scope()<a hidden class=anchor aria-hidden=true href=#scope>#</a></h1><p>Scope allows attaching contextual metadata (e.g., request parameters) to events.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>r</span> <span class=p>=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>WithContext</span><span class=p>(</span><span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>hub</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>hub</span><span class=p>.</span><span class=nf>Scope</span><span class=p>().</span><span class=nf>SetRequest</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span></code></pre></div><hr><h1 id=sentry-advancement>Sentry Advancement<a hidden class=anchor aria-hidden=true href=#sentry-advancement>#</a></h1><h3 id=sentryinitializer>SentryInitializer<a hidden class=anchor aria-hidden=true href=#sentryinitializer>#</a></h3><p>Manages singleton initialization of the Sentry client:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SentryInitializer</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>conf</span>    <span class=o>*</span><span class=nx>Config</span>
</span></span><span class=line><span class=cl>    <span class=nx>enabled</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>    <span class=nx>mutex</span>   <span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>si</span> <span class=o>*</span><span class=nx>SentryInitializer</span><span class=p>)</span> <span class=nf>Init</span><span class=p>()</span> <span class=kt>error</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>si</span> <span class=o>*</span><span class=nx>SentryInitializer</span><span class=p>)</span> <span class=nf>Enabled</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span> <span class=o>...</span> <span class=p>}</span>
</span></span></code></pre></div><p>Manages concurrent access safely with mutex.</p><h3 id=errorcapturer>ErrorCapturer<a hidden class=anchor aria-hidden=true href=#errorcapturer>#</a></h3><p>Captures exceptions through the Sentry Hub:</p><p><img loading=lazy src=/posts/sentry/7.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ErrorCapturer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CaptureError</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Handles Hub setup and error capture internally.</p><h3 id=recovermiddleware>RecoverMiddleware<a hidden class=anchor aria-hidden=true href=#recovermiddleware>#</a></h3><p>Handles panics and automatically logs to Sentry:</p><p><img loading=lazy src=/posts/sentry/8.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nb>recover</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span><span class=p>.</span><span class=nf>RecoverWithContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Log stack trace</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}()</span>
</span></span></code></pre></div><p>Even in panic scenarios, proper logging and Sentry reporting is ensured.</p><hr><blockquote><p>Despite its cost, <strong>Sentry</strong> offers great convenience for both APM and error capture management!</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/en/tags/go/>Go</a></li><li><a href=https://dingyu.dev/en/tags/sentry/>Sentry</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/en/posts/go-pprof-gc/><span class=title>« Prev</span><br><span>[Go] Tuning GC with pprof</span>
</a><a class=next href=https://dingyu.dev/en/posts/k8s-zero-downtime/><span class=title>Next »</span><br><span>[Infra] Zero-Downtime Kubernetes Deployment Guide</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/en/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
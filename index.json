[{"content":"ë°°ê²½ ì„œë¹„ìŠ¤ ë³„ë¡œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ êµ¬ì¡° í”„ë¡œì íŠ¸ ë§ˆë‹¤ ì½”ë“œ íŒŒì•…ì´ í˜ë“¦ e.g.\nSomeAPI â”œâ”€â”€ .vscode â”œâ”€â”€ api â”œâ”€â”€ build â”œâ”€â”€ config â”œâ”€â”€ data â”œâ”€â”€ db â”œâ”€â”€ externalservice â”œâ”€â”€ httpsrv â”œâ”€â”€ httptest â”œâ”€â”€ mocks â”œâ”€â”€ log â”œâ”€â”€ cli â”œâ”€â”€ repository â”œâ”€â”€ util â”œâ”€â”€ .gitignore â”œâ”€â”€ .gitlab-ci.yml â”œâ”€â”€ changelog â”œâ”€â”€ data.go â”œâ”€â”€ diag_debug.go â”œâ”€â”€ diag.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â”œâ”€â”€ main.go â”œâ”€â”€ Makefile â”œâ”€â”€ release.conf â”œâ”€â”€ README.md ê³µí†µ ì»¨ë²¤ì…˜ì´ ì—†ì–´ ê³µí†µ ëª¨ë“ˆ/CIë¥¼ ì‚¬ìš©í•˜ê¸° í˜ë“¦ ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ ê³ ë ¤í•  ì‚¬í•­ì´ ë§ì•„ì§ â†’ ê°œë°œ ìƒì‚°ì„± â†“ ì˜¨ë³´ë”© ê³¼ì •ì´ í˜ë“¦ ì‹ ê·œ í•©ë¥˜ëœ íŒ€ì›ì´ Goì–¸ì–´ì—ë„ ìµìˆ™ì¹˜ ì•Šì€ ìƒíƒœì—ì„œÂ ë„ˆë¬´ ì œê°ê°ì¸ ìŠ¤íƒ€ì¼ìœ¼ë¡œ ì¸í•´ í˜¼ë€ì´ ì˜´ íŒ€ì´ Go ì–¸ì–´ ìƒíƒœê³„ë¡œ ì „í™˜ì„ ì™„ë£Œí–ˆê³ , ì´ì œëŠ” ë…¸í•˜ìš°ê°€ ìƒê²¼ë‹¤ ìƒê°í•¨ ì¥ê¸°ì ì¸ ìš´ì˜ì—ì„œÂ ì»¨ë²¤ì…˜ ì‚¬ìš©ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ì„± â†‘Â ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ëŒ€í•œ ê³ ë¯¼ì„ í•˜ëŠ” ì¼, ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ë¦¬íŒ©í† ë§ì˜ ë°©í–¥ì„±ì„ ì¡ê¸° í˜ë“¦ ê°œë°œ ìƒì‚°ì„± â†“ í”„ë¡œì íŠ¸ êµ¬ì¡° ì œì•ˆ ì ìš©ì´ Mustì¸ ë¶€ë¶„ì€ * prefixë¥¼ ê°€ì§‘ë‹ˆë‹¤ (ê·¸ ì™¸, Optional)\nì—”í„°í”„ë¼ì´ì¦ˆ ë ˆë²¨ì˜ í”„ë¡œì íŠ¸ê°€ ì•„ë‹Œ MSAë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë©ë‹ˆë‹¤ ì¶”í›„ ë¦¬íŒ©í† ë§ì„ í•˜ë”ë¼ë„ ë„ë©”ì¸ ë‹¨ìœ„ì˜ MSAë¡œ ë¬¼ë¦¬ì ì¸ ê²©ë¦¬ê°€ ì§„í–‰ë˜ê¸° ë•Œë¬¸\u0026hellip;\ní”„ë¡œì íŠ¸ êµ¬ì¡° ìƒ˜í”Œ ë„ë©”ì¸ì„ \u0026ldquo;ë§¤ì¹˜ ìƒ˜í”Œë§\u0026quot;ì´ë¼ í•˜ì˜€ì„ ë•Œ\n. â”œâ”€â”€ *docs // í”„ë¡œì íŠ¸ ë³„ ë¬¸ì„œë“¤ â”‚ â”œâ”€â”€ *swagger.yaml // API ìŠ¤ì›¨ê±° ë¬¸ì„œ â”‚ â”œâ”€â”€ sequence.md // ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ â”‚ â””â”€â”€ architecture.md // ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ â”œâ”€â”€ *cmd â”‚ â””â”€â”€ *main.go // í”„ë¡œì íŠ¸ ì§„ì…ì , DI ì£¼ì… â”œâ”€â”€ pkg // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì¢…ì†ì ì´ì§€ ì•Šì€ íŒ¨í‚¤ì§€ (ì™¸ë¶€ì—ì„œ import í•˜ì—¬ë„ ìƒê´€ì—†ëŠ” ëª¨ë“ˆ) â”‚ â”œâ”€â”€ file_parser.go â”‚ â””â”€â”€ time_convertor.go â””â”€â”€ *internal // ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ì—­ (ë„ë©”ì¸ ì˜ì—­) â”œâ”€â”€ *handler â”‚ â”œâ”€â”€ *v1 â”‚ â”‚ â””â”€â”€ sampling_handler.go // ë„ë©”ì¸ í•¸ë“¤ëŸ¬ v1 â”‚ â”œâ”€â”€ v2 â”‚ â”‚ â””â”€â”€ sampling_handler.go // ë„ë©”ì¸ í•¸ë“¤ëŸ¬ v2 â”‚ â”œâ”€â”€ server.go // handlerê°€ ë§ì„ ê²½ìš°, handlerë¥¼ ë“±ë¡í•  serverë¥¼ ë‘¡ë‹ˆë‹¤ â”‚ â”œâ”€â”€ health_handler.go // v1, v2 ê³µí†µ í•¸ë“¤ëŸ¬ â”‚ â”œâ”€â”€ swagger_handler.go // í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ìš© openapi í•¸ë“¤ëŸ¬ (CORS í—ˆìš©) â”‚ â””â”€â”€ auth_middleware.go // ë¯¸ë“¤ì›¨ì–´ë“¤ â”œâ”€â”€ data â”‚ â”œâ”€â”€ mysqldb.go // DB client ì»¤ë„¥í„° â”‚ â”œâ”€â”€ redis.go // DB client ì»¤ë„¥í„° â”‚ â”œâ”€â”€ feature_event_producer.go // Kafka event producer - xxx_producer â”‚ â”œâ”€â”€ match_repository.go // ORM ìˆ˜í–‰ repository (DB client ì£¼ì…) - xxx_repository â”‚ â””â”€â”€ nass_api.go // ì™¸ë¶€ API Data Layer - xxx_api â”œâ”€â”€ *service â”‚ â”œâ”€â”€ kda_sampler.go // Data layer í˜¹ì€ ë‹¤ë¥¸ serviceë¥¼ ì£¼ì… ë°›ì•„ êµ¬í˜„ â”‚ â”œâ”€â”€ match_sampling_usecase.go // service ê°€ ë§ì„ ê²½ìš°, ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•´ì£¼ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤ êµ¬í˜„ â”‚ â””â”€â”€ kda_sampler_test.go // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ìœ ë‹›í…ŒìŠ¤íŠ¸ â”œâ”€â”€ logger.go // ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ì‚¬ìš©ë  ê¸°ëŠ¥ â”œâ”€â”€ constants.go // ì™¸ë¶€ì—ì„œ ì°¸ì¡° ë˜ì–´ì•¼ í•˜ëŠ” ìƒìˆ˜ ê°’ ì •ì˜ â””â”€â”€ *config.go // application ì„¤ì • íŒŒì¼ â”œâ”€â”€ *gitlab-ci.yml â”œâ”€â”€ *go.mod â”œâ”€â”€ *go.sum â””â”€â”€ *README.md // í”„ë¡œì íŠ¸ì— ëŒ€í•œ ë°°ê²½, ìœ ì¦ˆì¼€ì´ìŠ¤, ì„¤ì¹˜ ë°©ë²• ê¸°ìˆ  êµ¬ë¶„ í•„ìˆ˜ ì—¬ë¶€ ì„¤ëª… ì˜ˆì‹œ docs âœ” í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜, ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨, ìŠ¤ì›¨ê±° ë¬¸ì„œë¥¼ ê´€ë¦¬ - swagger.yaml- sequence.md cmd âœ” í”„ë¡œì íŠ¸ ì§„ì…ì , ì‹¤í–‰ ê°€ëŠ¥í•œ íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸ ê´€ë¦¬ - main.go- start.sh pkg ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¢…ì†ì ì´ì§€ ì•Šì€ ìœ í‹¸ë¦¬í‹° ê¸°ëŠ¥ ê´€ë¦¬ - time_convertor.go- file_parser.go internal âœ” ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ë„ë©”ì¸) ì˜ì—­ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ì‚¬ìš©ë  ê¸°ëŠ¥ ë‹´ë‹¹ - config.go- logger.go- constants.go internal/handler âœ” APIë¼ë©´ API Handlerì¼ ê²ƒì´ê³  Consumerë¼ë©´ Consumer Handler ë‹´ë‹¹- ë²„ì €ë‹ì€ *í•„ìˆ˜, HTTP/gRPC/MQ/Kafka ì™€ì˜ í†µì‹ ì„ ë‹´ë‹¹- ë¯¸ë“¤ì›¨ì–´ëŠ” Optional- handlerê°€ ì—¬ëŸ¬ê°œì¼ ê²½ìš°, server ì—ì„œ handlerë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤ - blacklist_handler.go- alive_handler.go- log_middleware.go- server.go internal/data 3 Tier Architecture ì¤‘, Data Layer ì˜ì—­ì˜ì†ì„±ì„ ê°€ì§„ ë°ì´í„° CRUD ë‹´ë‹¹(ì™¸ë¶€ API ë˜í•œ í•´ë‹¹ë¨, Kafka ë˜í•œ streamì— ì €ì¥í•˜ëŠ” í–‰ìœ„ë¡œ ê°„ì£¼) - event_producer.go- blacklist_repository.go- member_api.go internal/service âœ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì—­- ê°ê°ì˜ ì„œë¹„ìŠ¤ëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ì— ë”°ë¼ í•˜ë‚˜ì˜ ì±…ì„ë§Œ ìˆ˜í–‰- ì„œë¹„ìŠ¤ê°€ ë‹¤ìˆ˜ì¼ ê²½ìš°, ì´ë¥¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•´ì£¼ëŠ” xxx_usecaseë¡œ êµ¬í˜„- ì„œë¹„ìŠ¤ ì½”ë“œì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” í•„ìˆ˜ (ì¼ë¶€ ì˜ì¡´ì„±ì— ë”°ë¥¸ í…ŒìŠ¤íŠ¸ ë¶ˆê°€ ì‹œ íŒ¨ìŠ¤) - fraud_detect_usecase.go- fraud_retriever.go- rule_analyzer.go ./ (root) âœ” í”„ë¡œì íŠ¸ ì‹¤í–‰ ë° ìš´ì˜ì„ ìœ„í•œ íŒŒì¼ ì˜ì—­- ë¦¬ë“œë¯¸ëŠ” í•„ìˆ˜ë¡œ ì‘ì„± (ìœ ì¦ˆì¼€ì´ìŠ¤ì™€ ì„¤ì¹˜ ë°©ë²•ì€ í•­ìƒ ê¸°ìˆ ) - gitlab-ci.yml- README.md ìƒìˆ˜ ì»¨ë²¤ì…˜ ê¸°ë³¸ì ìœ¼ë¡œ ì¹´ë©œì¼€ì´ìŠ¤ì™€ íŒŒìŠ¤ì¹¼ì¼€ì´ìŠ¤ë¥¼ ì›ì¹™ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤\nâ†’ í•˜ë‚˜ì˜ ë„ë©”ì¸ íŒŒì¼ì—ì„œ ë„ë©”ì¸ê³¼ ê´€ë ¨ëœ ìƒìˆ˜ê°€ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì— ì†í•´ ìˆëŠ” ê²½ìš°, ìˆ˜ì •ì—ë„ ì–´ë µê³  ì¶”ì ì—ë„ ê·€ì°®ìŒì´ ë™ë°˜ ë¨ì„ ëŠê¼ˆìŠµë‹ˆë‹¤\nâ†’ í•˜ë‚˜ì˜ ì±…ì„ì„ ì§€ëŠ” íŒŒì¼ ë‚´ì—ì„œ private ìƒìˆ˜ë¡œì„œ ê´€ë¦¬ ëœë‹¤ë©´ ìœ ì§€ë³´ìˆ˜ì—ë„ ìš©ì´í•  ê²ƒì´ê³  ì½”ë“œ íŒŒì•…ì—ë„ ìš©ì´í•  ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤\në³µìˆ˜ íŒ¨í‚¤ì§€ì—ì„œ ë‹¤ìˆ˜ ì˜ì¡´ë  ì—¬ì§€ê°€ ìˆëŠ” ê²½ìš° (Pascal) internal layerì˜ constants.go íŒŒì¼ì— ìƒìˆ˜ ê°’ë“¤ì„ ì •ì˜ í•©ë‹ˆë‹¤\npackage internal const ( LanguageCodeKorean = \u0026#34;ko\u0026#34; LanguageCodeEnglish = \u0026#34;en\u0026#34; LanguageCodeChinese = \u0026#34;zh_CN\u0026#34; LanguageCodeJapanese = \u0026#34;ja\u0026#34; ) í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë‚´ í˜¹ì€ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ê²½ìš° (Camel) ë™ì¼ íŒ¨í‚¤ì§€ ë‚´ì—ì„œëŠ” private ë³€ìˆ˜ì— ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\npackage handler const ( // resultSuccess : ì„±ê³µ ì‘ë‹µ resultSuccess = \u0026#34;true\u0026#34; // resultFailure : ì‹¤íŒ¨ ì‘ë‹µ resultFailure = \u0026#34;false\u0026#34; ) ë¶ˆê°€í”¼í•˜ê²Œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¡œë¶€í„° ì°¸ì¡°ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš° ìƒìˆ˜ëŠ” privateìœ¼ë¡œ, structì˜ Public í•¨ìˆ˜ë¡œ ì°¸ì¡° ë  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤\npackage handler const ( // samplerEndpoint : ë§¤ì¹˜ ìƒ˜í”Œë§ ì—”ë“œí¬ì¸ë“œ samplerEndpoint = \u0026#34;/v1/:match_id\u0026#34; ) // Endpoint : í•¸ë“¤ëŸ¬ì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë°˜í™˜ func (h *SamplerHandler) Endpoint() string { return samplerEndpoint } ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ ë°ì´í„° ëª¨ë¸ì€ ê°€ê¸‰ì  ë³„ë„ íŒŒì¼ì´ ì•„ë‹Œ, ìˆ˜í–‰ë˜ëŠ” íŒŒì¼ì—ì„œ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤\nâ†’ modelì„ ë³„ë„ë¡œ ì§€ì •í•´ ë‘˜ ê²½ìš°, íŠ¹ì • ë„ë©”ì¸ì— ëŒ€í•œ ìˆ˜ì •ì´ ìˆì„ ë•Œ ì°¸ì¡°ëœ ì—¬ëŸ¬ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ì¡´ì¬í•©ë‹ˆë‹¤\nâ†’ ê°™ì€ ê³„ì¸µ ê°„ì˜ ë°ì´í„° ì´ë™ì— ëŒ€í•´ì„œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì£¼ê³  ë°›ê³  ë‹¤ë¥¸ ë ˆì´ì–´ ê°„ í†µì‹ ì€ *ë ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ì— ë”°ë¼ ë°ì´í„° ëª¨ë¸ì„ ì£¼ê³  ë°›ìŠµë‹ˆë‹¤\nâ†’ parameterê°€ ë‘ ê°œ ì´ìƒì¼ ê²½ìš°, ë°ì´í„° ëª¨ë¸ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•©ë‹ˆë‹¤\në ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ handler â†’ service\nrequest â†’ serviceDTO\nfunc (h *Handler) CreateMatch(c *gin.Context) { var req matchRequest if err := c.ShouldBindJSON(\u0026amp;req); err != nil { c.JSON(http.StatusBadRequest, gin.H{\u0026#34;error\u0026#34;: err.Error()}) return } // Service í˜¸ì¶œ err := h.service.Create(req.ToServiceDTO()) // so on } service â†’ data\nserviceDTO â†’ entity\nfunc (b *MatchCreater) Create(match MatchDTO) (int, error) { ... // repository ê³„ì¸µì— MatchEntity ì‚½ì… ìš”ì²­ id, err := b.repository.Insert(match.ToEntity()) if err != nil { return 0, err } return id, nil } data â†’ service\nentity â†’ serviceDTO\nfunc (r *MatchRepository) Insert(entity MatchEntity) (int, error) { // ë°ì´í„° ë ˆì´ì–´ì—ì„œ UserEntity ê°€ì ¸ì˜¤ê¸° result, err := s.db.Create(\u0026amp;entity) ... return result.ID, nil } ë°ì´í„° ëª¨ë¸ì—ì„œì˜ ì¡°ê±´ ê²€ì‚¬ ëª¨ë¸ì„ ì£¼ê³  ë°›ëŠ” ê²½ìš°, ê°€ë…ì„±ì„ ìœ„í•´ ì¡°ê±´ ê²€ì‚¬ëŠ” í•¨ìˆ˜ë¡œ ì‹¤ì‹œ í•©ë‹ˆë‹¤\në‹¨ìœ„ í…ŒìŠ¤íŠ¸ì— ìš©ì´ í•˜ë©°, í•œëˆˆì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ íŒŒì•…í•˜ê¸° ì‰¬ì›Œ ì§‘ë‹ˆë‹¤\n[AS-IS]\nfunc (b *MatchCreater) Create(match MatchDTO) (int, error) { if strings.HasPrefix(match.Version, \u0026#34;rc\u0026#34;) \u0026amp;\u0026amp; match.detail == \u0026#34;test\u0026#34; { return } // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ } [TO-BE]\nfunc (b *MatchCreater) Create(match MatchDTO) (int, error) { if match.IsTest() { return } // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ } í…ŒìŠ¤íŠ¸ ì»¨ë²¤ì…˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í…ŒìŠ¤íŠ¸ëŠ” ì„ íƒì‚¬í•­ì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤. ì´ë¯¸ ì •ì˜ëœ ì—ëŸ¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ëŠ” ìµœëŒ€í•œ ìƒì„¸í•˜ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•©ë‹ˆë‹¤.\nDeterministic ë¹„ë™ê¸° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ ê°’ì„ í™•ì¸í•˜ì§€ ì•Šê±°ë‚˜ time sleep ì´í›„ì˜ ë¡œê¹…ì„ ë©ˆì¶”ì„¸ìš”\nDI + Eventuallyë¥¼ í†µí•œ flaky testë¥¼ ë°©ì§€í•©ë‹ˆë‹¤\në¡œê±° ì£¼ì… // NewQueue ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•  Queue ìƒì„±ì func NewQueue( config Config, httpClient *http.Client, logger *zerolog.Logger, ) (queue Queue, err error) { // queueëŠ” Start()ë¥¼ í†µí•´ thread executorê°€ ì‹¤í–‰ë ë•Œì— ìƒì„±ë©ë‹ˆë‹¤. queue = Queue{ config: config, client: httpClient, logger: logger, quitChan: make(chan struct{}), } return } ì‘ë‹µ ê°’ í…ŒìŠ¤íŠ¸ í ë¡œì§ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ t.Run(\u0026#34;í ì²˜ë¦¬ ì‹¤íŒ¨ì‹œ, ì‹¤íŒ¨ ë¡œê¹… í…ŒìŠ¤íŠ¸\u0026#34;, func(t *testing.T) { // given var buffer bytes.Buffer ... ë¡œê±° ì˜ì¡´ì„± ì£¼ì… // when ... ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰ event1, err := queue.Push([]byte(validJSON1)) assert.NoError(t, err) event2, err := queue.Push([]byte(validJSON2)) assert.NoError(t, err) // then assert.Eventually(t, func() bool { output := buffer.String() return strings.Contains(output, event1.TraceID().String()) \u0026amp;\u0026amp; strings.Contains(output, event2.TraceID().String()) \u0026amp;\u0026amp; strings.Contains(output, `\u0026#34;success\u0026#34;:false`) }, 1*time.Second, 10*time.Millisecond) }) í ë¡œì§ ì„±ê³µ í…ŒìŠ¤íŠ¸ t.Run(\u0026#34;í ì²˜ë¦¬ ì„±ê³µì‹œ, ì„±ê³µ ë¡œê¹… í…ŒìŠ¤íŠ¸\u0026#34;, func(t *testing.T) { // given var buffer bytes.Buffer ... ë¡œê±° ì˜ì¡´ì„± ì£¼ì… // when ... ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰ event1, err := queue.Push([]byte(validJSON1)) assert.NoError(t, err) event2, err := queue.Push([]byte(validJSON2)) assert.NoError(t, err) // then assert.Eventually(t, func() bool { output := buffer.String() return strings.Contains(output, event1.TraceID().String()) \u0026amp;\u0026amp; strings.Contains(output, event2.TraceID().String()) \u0026amp;\u0026amp; strings.Contains(output, `\u0026#34;success\u0026#34;:true`) }, 1*time.Second, 10*time.Millisecond) }) ","permalink":"https://dings-things.github.io/blog/posts/go-convention/","summary":"íš¨ìœ¨ì ì¸ Go Project Structure Guide","title":"[Go] Go Convention"},{"content":"class Me: def __init__(self): self.name = \u0026#34;Jung Woo Lee\u0026#34; self.born_year = 1996 self.MBTI = \u0026#34;ENTP\u0026#34; self.location = \u0026#34;Seoul, Korea\u0026#34; self.school = \u0026#34;Tsinghua University\u0026#34; self.interests = [\u0026#34;BE\u0026#34;, \u0026#34;DevOps\u0026#34;, \u0026#34;MLOps\u0026#34;, \u0026#34;Go\u0026#34;, \u0026#34;Kafka\u0026#34;, \u0026#34;TDD\u0026#34;, \u0026#34;Automation\u0026#34;] ","permalink":"https://dings-things.github.io/blog/about/","summary":"\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Jung Woo Lee\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborn_year\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1996\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eMBTI\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;ENTP\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elocation\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Seoul, Korea\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eschool\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Tsinghua University\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterests\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;BE\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;DevOps\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;MLOps\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Go\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Kafka\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;TDD\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Automation\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"About"},{"content":" ì†ŒìŠ¤ ì½”ë“œ : https://github.com/dings-things/coffee_pal\nëª©ì  ì¼ì„ í•˜ëŠ” ê²ƒì—ì„œ ê·¸ì¹˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì¼ì„ ì˜ í•˜ê³  ì‹¶ì€ ì¡°ì§ì—ì„œ ì¢‹ì€ ë¬¸í™”ë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì€ ì¼ì˜ ìƒì‚°ì„±ì´ë‚˜ í’ˆì§ˆì—ë„ ì—¬ëŸ¬ ì´ì ì„ ê°€ì ¸ì˜¨ë‹¤\ní•„ìê°€ ê°œë°œí•˜ê³ ì í•˜ëŠ” \u0026ldquo;CoffeePal\u0026quot;ì€ ë¬¸ì œì— ë§‰í˜€ ê¸¸ì„ ìƒì–´ë²„ë¦° ì‚¬ëŒì´ë‚˜ ì†Œì†Œí•œ ìŠ¤ëª° í† í¬ë¡œ ì¼ì—ë„ ëŠ¥ë¥ ì„ í‚¤ìš¸ ìˆ˜ ìˆëŠ” ê·¸ëŸ¬í•œ ì•±ì„ ë§Œë“¤ ê³ ì ì»¤í”¼ ì¹œêµ¬ë¼ëŠ” ì˜ë¯¸ì—ì„œ ì»¤í”¼íŒ”ì„ ê¸°íší•˜ê²Œ ë˜ì—ˆë‹¤\nê°œë°œì— ì•ì„œ\u0026hellip; ë¨¼ì € ì‚¬ë‚´ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ íˆ´ì¸ Slackì—ì„œ ìƒí˜¸ì‘ìš©ì„ í†µí•´, ì‰½ê³  ë¹ ë¥´ê²Œ ì»¤í”¼ ì¹œêµ¬ë¥¼ ë§¤ì¹­í•´ì¤˜ì•¼ í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤\nì´ì— ì•ì„œ ê°„ë‹¨í•˜ê²Œ Slack Workflowë¥¼ í†µí•˜ì—¬, ì „ë°˜ì ì¸ íë¦„ì„ íŒŒì•…í•´ ë³¸ë‹¤\nTrigger Point ìƒì„± í…ŒìŠ¤íŠ¸ ìš©ì´ê¸° ë•Œë¬¸ì—, TriggerëŠ” :ì»¤í”¼: ì´ëª¨ì§€ë¡œ ë°˜ì‘í•˜ì˜€ì„ ë•Œ ì›Œí¬í”Œë¡œê°€ ì‹¤í–‰ ë˜ë„ë¡ í•œë‹¤\ní™œì„±í™” í•˜ê¸° ë°˜ì‘í•œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•œ ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì–´, ì»¤í”¼íŒ” ë§¤ì¹­ì„ ì‹œì‘í•  ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤\nì–‘ì‹ì—ì„œ ì •ë³´ ìˆ˜ì§‘ ê°œì¸í™”ëœ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ MBTI, ìƒë…„ì›”ì¼ì„ ì…ë ¥ ë°›ëŠ”ë‹¤. í•´ë‹¹ ë°ì´í„°ì˜ ê¸°ì…ì€ Optional í•˜ê²Œ ë§Œë“ ë‹¤\nëŒ€ìƒ, ì¼ì‹œ, ì£¼ì œë¥¼ ì§€ì •í•œë‹¤ ì»¤í”¼íŒ” ëŒ€ìƒê³¼ ì»¤í”¼ ì¼ì •, ê·¸ë¦¬ê³  ì „ë°˜ì ì¸ ì£¼ì œë¥¼ ì‚¬ì „ì— ì •ì˜í•œë‹¤.\nì»¤í”¼íŒ” ëŒ€ìƒì—ê²Œ ì´ˆëŒ€ ë©”ì‹œì§€ ë³´ë‚´ê¸° ì•ì„œ ì§€ì •í•œ ë°ì´í„°ë¥¼ í†µí•´ ì»¤í”¼íŒ”ì—ê²Œ ê°„ëµí•˜ê²Œ ì´ˆëŒ€ ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ë‹¤\nê°œì¸ì ìœ¼ë¡œ Slack ì›Œí¬í”Œë¡œë¥¼ ì²˜ìŒ ì‚¬ìš©í•´ ë³´ì•˜ëŠ”ë°, UIê°€ ê¹”ë”í•˜ê³  ì‚¬ìš©ì„±ì´ ê´œì°®ìŒì„ ëŠê¼ˆë‹¤\në‹¤ë§Œ, ì‚¬ìš©ìì™€ \u0026ldquo;ìƒí˜¸ì‘ìš©\u0026quot;ì´ë¼ê¸° ë³´ë‹¤ëŠ”, ì¼ë°©ì ì¸ ì†Œí†µì— ê°€ê¹ê¸° ë•Œë¬¸ì— slack appìœ¼ë¡œ í™•ì¥ í•´ë³´ë„ë¡ í•œë‹¤\në¨¹ê³  ì‹¶ì§€ ì•Šì€ ìŒì‹ì„ ì–µì§€ë¡œ ë¨¹ì—¬ì£¼ëŠ” ëŠë‚Œ\u0026hellip; ì´ë„ê¹Œìš”?\nìš”êµ¬ì‚¬í•­ ë¯¸ë¦¬ ì €ì¥ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ì ê¸°ë°˜ì˜ ë§¤ì¹­ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤\nê°œì¸ì •ë³´ ì…ë ¥ ì‹œ, ë§¤ì¹­ ì‹œìŠ¤í…œ Trigger Appì„ ì‚¬ìš©í•œ ìƒí˜¸ì‘ìš©ì„ ìœ„í•´ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ë¥¼ í™•ë³´í•œë‹¤\nì‚¬ë‚´ ì„œë²„ ë°©í™”ë²½ ê´€ë¦¬ ì–´ë ¤ì›€ ì†Œì¼“ í†µì‹ ì„ í†µí•œ ë¹ ë¥¸ ì‘ë‹µ AWS Lambda í”„ë¦¬í‹°ì–´ ê¸°ì¤€ ë¬´ë£Œ ì„œë²„ë¦¬ìŠ¤ AWS API GWì™€ ì—°ê³„ ê°€ëŠ¥ í”„ë¦¬í‹°ì–´ ì¢…ë£Œ í›„, ìœ ì§€ ë¹„ìš© ê³ ë ¤ ì‚¬ìš©ìì—ê²Œ í•œëˆˆì— ë´ë„ ì•Œ ìˆ˜ ìˆëŠ” UI ì œê³µ\nSlack Block kit í™œìš© êµ¬ì¶•í•˜ê¸° Lambdaë¡œ êµ¬ì¶•í•˜ê¸° Slack APP ìƒì„± Lambda ì„¤ì • Socket Mode ì„¤ì • Slack APP ìƒì„± 1. App ìƒì„±í•˜ê¸° slack APIì—ì„œ App ìƒì„±í•˜ê¸° Slack APP ìƒì„± 2. From scratchë¥¼ í´ë¦­ Slack APP ìƒì„± 3. ì•± workspaceì™€ ì´ë¦„ ì§€ì •í•˜ê¸° Slack APP ìƒì„± 4. ìœ ì € ìƒí˜¸ì‘ìš©ì„ ìœ„í•œ ë´‡ ì„¤ì • Slack APP ìƒì„± 5. ì´ë²¤íŠ¸ í™œì„±í™” Lambda ì„¤ì • 1. Lambda í˜ì´ì§€ì—ì„œ í•¨ìˆ˜ ìƒì„±í•˜ê¸° Lambda ì„¤ì • 2. í•¨ìˆ˜ ì„¤ì •, ëŸ°íƒ€ì„ ë° ì•„í‚¤í…ì²˜ ì„¤ì • Lambda ì„¤ì • 3. API Gateway ì„¤ì • API GatewayëŠ” HTTP ìš”ì²­ì„ Lambda í•¨ìˆ˜ë¡œ ë¼ìš°íŒ… í•  ìˆ˜ ìˆëŠ” ë§¤ìš° ìœ ìš©í•œ íŠ¸ë¦¬ê±°ì…ë‹ˆë‹¤. Slack Events APIì™€ Lambdaë¥¼ ì—°ë™í•˜ê¸° ìœ„í•´ì„œëŠ” API Gatewayë¥¼ í†µí•œ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¼ê³  ìƒê°í•˜ë˜ ì™€ì¤‘\u0026hellip; ì„œë²„ê°€ ì´ë¯¸ ìˆë‹¤ë©´ êµ³ì´ ëŒë‹¤ë¡œ êµ¬í˜„ì„ í•´ì•¼í•˜ëŠ”ê°€? ì´ë¯¸ ìˆëŠ” ì„œë²„ë¥¼ ì•ˆì“°ëŠ” ê²ƒì´ ë” ë‚­ë¹„ê°€ ì•„ë‹Œê°€? ğŸ¤” ê³ ë¯¼ì— ë¹ ì¡ŒìŠµë‹ˆë‹¤\nì„œë²„ëŠ” ë‚¨ëŠ” ê°œë°œ ì„œë²„ë¥¼ í™œìš©í•˜ì—¬ ì²˜ë¦¬ë¥¼ í•˜ê³  ì†Œì¼“ ëª¨ë“œë¡œ ì¼ê´„ ì²˜ë¦¬í•˜ëŠ” ë°©ì•ˆì„ ìƒê°í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤\nSocket Mode ì„¤ì • ì†Œì¼“ ëª¨ë“œë€? ì†Œì¼“ ëª¨ë“œë¥¼ ì¼œë©´ ì´ëŸ¬í•œ í˜ì´ë¡œë“œë¥¼ ê³µê°œ HTTP ì•¤ë“œí¬ì¸íŠ¸ì¸ ìš”ì²­ URLë¡œ ë³´ë‚´ëŠ” ëŒ€ì‹  WebSocket ì—°ê²°ì„ í†µí•´ ì•±ì˜ ìƒí˜¸ ì‘ìš©ê³¼ ì´ë²¤íŠ¸ë¥¼ ë¼ìš°íŒ…í•©ë‹ˆë‹¤. ì•¤ë“œ í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒìœ¼ë¡œì„œ ì—¬ëŸ¬ ìš”ì²­ì— ëŒ€í•œ ë³´ì•ˆì ì¸ ìœ„í˜‘ì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì—¬ëŸ¬ Eventì— ëŒ€í•´ ì¼ì¼ì´ êµ¬ë…ì„ í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤\n1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ í† í° ìƒì„± ì „ì—­ í† í°ì— ê¶Œí•œì„ ë¶€ì—¬ â†’ ì„œë²„ ë‚´ì—ì„œ ê¶Œí•œì„ ì‚¬ìš©í•˜ì—¬ ìŠ¬ë™ ì œì–´ 2. í† í°ì˜ Scope ì§€ì • channels:read : ì±„ë„ì˜ ì‚¬ìš©ì ì •ë³´ ì·¨ë“ chat:write : ì±„ë„ì—ì„œ ì“°ê¸° ê¶Œí•œ chat:write.public : ì±„ë„ì— invite ë˜ì–´ ìˆì§€ ì•Šì•„ë„ ì“°ê¸° ê¶Œí•œ groups:read : private ì±„ë„ ì •ë³´ ì·¨ë“ groups:write : private ì±„ë„ì— ì“°ê¸° ê¶Œí•œ im:write : DM ë°œì†¡ ê¶Œí•œ mpim:write : group DM ë°œì†¡ ê¶Œí•œ reminders:write : ë¦¬ë§ˆì¸ë” ì„¤ì • ê¶Œí•œ ê°œë°œ Slack Bolt Slack ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ ì£¼ë¡œ Node.js, Python, JavaScriptì™€ ê°™ì€ ì–¸ì–´ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, Slack í”Œë«í¼ê³¼ í†µí•©ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.\nêµ³ì´\u0026hellip;? ì‹¶ì§€ë§Œ\u0026hellip;\nì•ˆì“°ë©´ ë¶ˆí•„ìš”í•œ ì‘ì—…ì´ ë„ˆë¬´ ë§ì•„ì§‘ë‹ˆë‹¤. ì´ëŠ” ê³§ ë‚®ì€ ìƒì‚° ì†ë„, ìœ ì§€ ë³´ìˆ˜ë„ í˜ë“¤ì–´ì§€ì£ \nì“°ì§€ ì•Šì„ ë•Œ from slack_sdk import WebClient from slack_sdk.errors import SlackApiError import os import json import base64 import urllib.parse def lambda_handler(event, context): bot_token = os.getenv(\u0026#39;BOT_KEY\u0026#39;) # í† í°ìœ¼ë¡œ ì¸ì¦ client = WebClient(token=bot_token) # Base64 ì¸ì½”ë”© ì—¬ë¶€ í™•ì¸ ë° ë””ì½”ë”© if event.get(\u0026#39;isBase64Encoded\u0026#39;, False): try: # Base64 ì¸ì½”ë”©ëœ ë³¸ë¬¸ì„ ë””ì½”ë”©í•˜ì—¬ ë¬¸ìì—´ë¡œ ë³€í™˜ decoded_body = base64.b64decode(event[\u0026#39;body\u0026#39;]).decode(\u0026#39;utf-8\u0026#39;) event_body = urllib.parse.unquote_plus(decoded_body)[8:] except Exception as e: print(f\u0026#34;Error decoding base64 body: {e}\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 400, \u0026#39;body\u0026#39;: json.dumps({\u0026#39;message\u0026#39;: \u0026#39;Invalid base64 encoded body\u0026#39;}) } ele: event_body = event[\u0026#39;body\u0026#39;] print(event_body) # ë””ì½”ë”©ëœ ë³¸ë¬¸ì„ JSONìœ¼ë¡œ íŒŒì‹± try: event_data = json.loads(event_body) except json.JSONDecodeError: print(\u0026#34;JSONDecodeError occurred. The body may not be in valid JSON format.\u0026#34;) return { \u0026#39;statusCode\u0026#39;: 400, \u0026#39;body\u0026#39;: json.dumps({\u0026#39;message\u0026#39;: \u0026#39;Invalid request body\u0026#39;}) } # Event íƒ€ì… í™•ì¸ event_type = event_data.get(\u0026#39;event\u0026#39;, {}).get(\u0026#39;type\u0026#39;) # Event íƒ€ì…ì— ë”°ë¼ ë¶„ê¸°ë¡œ ì²˜ë¦¬ ì“¸ ë•Œ app = App(token=settings.SLACK_BOT_TOKEN) logger = logging.getLogger(__name__) # app_home_opened ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡ @app.event(\u0026#34;app_home_opened\u0026#34;) def handle_app_home_opened( event: Union[ str, Pattern, Dict[str, Optional[Union[str, Sequence[Optional[Union[str, Pattern]]]]]], ], client: WebClient = None, ) -\u0026gt; SlackResponse: ... # ë²„íŠ¼ ì•¡ì…˜ í•¸ë“¤ëŸ¬ ë“±ë¡ @app.action(\u0026#34;suggest_coffee_chat_button\u0026#34;) def handle_random_coffee_chat_button( ack, body, client: WebClient = None ) -\u0026gt; SlackResponse: ... íŠ¹ì • ì´ë²¤íŠ¸ / ì•¡ì…˜ / ë·° ë¥¼ ë””ë²„ê¹… í•  ë•Œì— Boltë¥¼ í™œìš©í•˜ë©´ ì¸ì¦, event, actionì— ë”°ë¥¸ ë¶„ê¸° ì²˜ë¦¬, ë¯¸ë“¤ì›¨ì–´ ì„¤ì • ë“±ë“±\u0026hellip;\nì„œë¹„ìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ê¸°ì „ ê±°ì³ì•¼ í–ˆë˜ ì¤‘ë³µë˜ëŠ” ê³¼ì •ë“¤ì„ ìƒëµí•˜ê³  ì„œë¹„ìŠ¤ ë¡œì§ì— ì§‘ì¤‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìœ ì§€ë³´ìˆ˜ â†‘ ê°€ë…ì„± â†‘ Boltì—ì„œ ì œê³µë˜ëŠ” ê¸°ëŠ¥ ì¤‘ í¬ê²Œ 5ê°€ì§€ë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.\nmiddleware ì•± ì „ë°˜ì˜ ë¡œê¹… ë° ì¸ì¦ ê´€ë¦¬ action ë²„íŠ¼ í´ë¦­, Select ë©”ë‰´ ë“±ì˜ ìƒí˜¸ì‘ìš© ì‹œ ë°œìƒ view ëª¨ë‹¬ê³¼ ê°™ì€ ë³µì¡í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„± ë° ê´€ë¦¬ event Slack ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œ ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ ì´ë²¤íŠ¸. ê°€ë ¹ ì±„ë„ì— ì°¸ê°€ / ì‚¬ìš©ìì˜ ë©”ì‹œì§€ ì „ì†¡ ë“±ë“± Block Kit ìŠ¬ë™ ì•± ê°œë°œì˜ ê½ƒì€ ì—­ì‹œ Block Kitì´ë¼ ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° í™”ì‚´í‘œëŠ” Blockì„ ë‚˜íƒ€ë‚´ë©° typeì— ë”°ë¼ êµ¬ë¶„ë˜ëŠ”ë° ì´ë¥¼ Stacking í•˜ì—¬ í•˜ë‚˜ì˜ Viewë¥¼ í˜•ì„±í•©ë‹ˆë‹¤.\nex.\nHOME_OPENED = { \u0026#34;type\u0026#34;: \u0026#34;home\u0026#34;, \u0026#34;blocks\u0026#34;: [ ... ], } HOME êµ¬ì„± ìš”ì†Œ Section ì„¹ì…˜ì„ í™œìš©í•˜ì—¬ ì§ê´€ì ì¸ UIë¡œ ì‚¬ìš©ì ê²½í—˜ì„ ìµœì í™” í•©ë‹ˆë‹¤\nê°€ë¡œ ì„¹ì…˜ ì„¸ë¡œ ì„¹ì…˜ Input Slack APIëŠ” Restful API ë‹µê²Œ Stateless (ë¬´ìƒíƒœì„±)ì„ ë•ë‹ˆë‹¤. ê° ìš”ì²­ì´ ë…ë¦½ì ì´ë©°, ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì´ì „ ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ ìœ ì§€í•˜ì§€ ì•ŠëŠ”ê²ƒì´ì£ \nInput ì—†ì´ëŠ” ìœ ì €ì˜ ì´ì „ Viewì—ì„œì˜ ìƒíƒœë¥¼ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ìƒí˜¸ì‘ìš©ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ëœë¤ ì»¤í”¼ì±—ì„ ì˜ˆë¡œ ë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤ ì„œë²„ê°€ ë§Œì•½ ìˆœê°„ì ì¸ ë‹¨ì ˆì´ ìƒê²¼ì„ ë•Œì—ë„ ë‹¤ì‹œ ìš”ì²­ ì‹œ, ì´ì „ Input ê°’ì„ í† ëŒ€ë¡œ ë¬´ìƒíƒœì„± ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆì–´\nì•ˆì •ì„±ì´ ë³´ì¥ë©ë‹ˆë‹¤\nê°œì„  ì‚¬í•­ Slack DataStoreë¥¼ ì´ìš©í•œ ìœ ì €ì˜ ìƒíƒœ ê°’ ì €ì¥ TTLì„ ì§€ì •í•˜ì—¬ ì˜ˆì•½ëœ ì»¤í”¼ì±— ì¼ì •ì˜ ì¡°íšŒ / ìˆ˜ì • / ì‚­ì œ ê¸°ëŠ¥ ì¸ì‚¬ì •ë³´ë¥¼ ì¡°íšŒí•˜ì—¬ ë‚˜ë§Œì˜ ë§ì¶¤í˜• ì»¤í”¼íŒ” ì„ ì • ì¸ì‚¬ API ê¶Œí•œì„ ì–»ì–´ ì§ê¸‰ / ë‚˜ì´ / ì§êµ° ë³„ ë§ì¶¤í˜• ì»¤í”¼íŒ”ì„ ì¶”ì²¨í•˜ëŠ” ê¸°ëŠ¥ UI ê°œì„  ë”± ë´ë„ ì´ê±°ë„¤~ ëˆ„êµ¬ë‚˜ ì•Œê¸° ì‰½ê²Œ ì‚¬ìš©ì í¸ì˜ì„±ì„ ê³ ë ¤í•œ View êµ¬ì„± CI/CD ë° ì¸í”„ë¼ êµ¬ì„± í—ˆë½ì„ êµ¬í•œë‹¤ë©´.. ë³„ë„ ì¸í”„ë¼ë¡œ full time ì‚¬ìš©ê°€ëŠ¥í•œ ì•± êµ¬ì„± CI CD íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ëˆ„êµ¬ë‚˜ ê¸°ì—¬í•˜ì—¬ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë„ë¡ ì˜¤í”ˆì†ŒìŠ¤í™”!! ë§ˆì¹˜ë©° ê°œë°œìë¡œ ì‚´ì•„ì˜¤ë©° â€œìš°ë¶„íˆ¬\u0026rdquo; ì •ì‹ ì— ê¹Šê²Œ ê³µê°í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤\n\u0026lsquo;ìš°ë¦¬ê°€ í•¨ê»˜ ìˆê¸°ì— ë‚´ê°€ ìˆë‹¤(I am because you are)\u0026rsquo;\nìš°ë¦¬ê°€ í•¨ê»˜í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ êµ¬ì„±í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•˜ë‹¤ ìƒê°ë©ë‹ˆë‹¤. ëª¨ë“  ì´ê°€ ì†Œí†µì— ë‘ë ¤ì›€ì„ ëŠë¼ì§€ ì•Šê³  \u0026ldquo;í•¨ê»˜\u0026quot;ê°€ ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ë§ˆìŒì—\nì»¤í”¼íŒ” ì„ ë§Œë“¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤ ê¸°ìˆ ì ì¸ ì–´ë ¤ì›€ì— ë¶€ë”ªíˆê±°ë‚˜, ë³´ë‹¤ ê¸´ë°€í•œ í˜‘ì—…ì„ ìœ„í•´ ì•„ì´ìŠ¤ ë¸Œë ˆì´í‚¹ì´ í•„ìš”í•˜ì‹œë‹¤ë©´ ì—¬ëŸ¬ë¶„ë„ ìŠ¬ë™ë´‡ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš” :)\n","permalink":"https://dings-things.github.io/blog/posts/coffee-pal/","summary":"ë‚˜ ê°œë°œì”ë° ì˜†ì— ì‚¬ëŒì´ë‘ ìŠ¬ë™ìœ¼ë¡œ ëŒ€í™”í•œë‹¤.. ìš°ë¦¬ ì´ì œ ì¹œí•´ì ¸ìš”","title":"[DX] ì‚¬ë‚´ ì»¤í”¼ ì±— ìŠ¬ë™ ë´‡ ê°œë°œê¸°"},{"content":"ë°°ê²½ ê°œë°œìê°€ ì§ì ‘ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì„ í†µí•˜ì—¬ ì¥ì•  ëŒ€ì‘ ì•„ë˜ì™€ ê°™ì€ ì´ìœ ë¡œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì—ë„ ì œì•½ ì‚¬í•­ì´ ì¡´ì¬ Field Typeì˜ ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ Elasticsearch field mapping Error ë°œìƒ â†’ ë¡œê·¸ ì´ë²¤íŠ¸ì˜ DROP ì‹œìŠ¤í…œ ë¡œê·¸ë¡œ ê¸°ë¡ë˜ëŠ” ê²½ìš°, ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìœ„í•˜ì—¬ ë³„ë„ë¡œ SEì—ê²Œ ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ ìš”êµ¬í•˜ëŠ” ê³µìˆ˜ê°€ í•„ìš” ëª©í‘œ Goë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ê³µí†µì ìœ¼ë¡œ í‘œì¤€ì´ ë  ìˆ˜ ìˆëŠ” ì„¼íŠ¸ë¦¬ êµ¬ì¡° í™•ë¦½ ì„¼íŠ¸ë¦¬ì— ëŒ€í•œ ê¸°ëŠ¥ ëª…ì„¸ / ê°€ì´ë“œë¼ì¸ ì œê³µ ì„¼íŠ¸ë¦¬ ì ìš© ì´í›„, ë¹ ë¥¸ ì¥ì•  ëŒ€ì‘ì„ í†µí•œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ êµ¬ì¶• ë³¸ ê¸€ì€ ì„¼íŠ¸ë¦¬ ê³„ì •ì´ ìˆìœ¼ë©°, ì„¼íŠ¸ë¦¬ í”„ë¡œì íŠ¸ë¥¼ ì´ë¯¸ ìƒì„±í•˜ì˜€ë‹¤ ê°€ì •í•˜ê³  ì§„í–‰ë©ë‹ˆë‹¤.\nSentryì— ëŒ€í•˜ì—¬ Capture Exception ì—ëŸ¬ ì¶”ì (Capture Exception): ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì™€ ì—ëŸ¬ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  ê¸°ë¡í•©ë‹ˆë‹¤. ì„¼íŠ¸ë¦¬ëŠ” ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤(stack trace)ì™€ í•¨ê»˜ ì—ëŸ¬ ë°œìƒ ì‹œì ì˜ í™˜ê²½ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬, ì—ëŸ¬ì˜ ì›ì¸ì„ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.\nTransaction ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§(Transactions): ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ë©°, ì›¹ ìš”ì²­ì´ë‚˜ API í˜¸ì¶œ ë“±ì˜ íŠ¸ëœì­ì…˜ì„ ì¶”ì í•©ë‹ˆë‹¤. ê° íŠ¸ëœì­ì…˜ì˜ ì‘ë‹µ ì‹œê°„, ì„±ê³µ ë° ì‹¤íŒ¨ ë¹„ìœ¨ê³¼ ê°™ì€ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ì„±ëŠ¥ ë³‘ëª© í˜„ìƒì„ ì‹ë³„í•˜ê³  ê°œì„ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.\nTrace íŠ¸ë ˆì´ì‹±(Trace): ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¸ëœì­ì…˜ì„ ì„¸ë¶€ì ìœ¼ë¡œ ì¶”ì í•˜ì—¬, ì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ, ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë“±ì˜ ì‘ì—…ì— ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì˜ ì„±ëŠ¥ì„ ì´í•´í•˜ê³ , ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nAlert ì´ìŠˆ ê´€ë¦¬ ë° ì•Œë¦¼: ì„¼íŠ¸ë¦¬ëŠ” ì—ëŸ¬ì™€ ì„±ëŠ¥ ë¬¸ì œë¥¼ ì´ìŠˆë¡œ ê´€ë¦¬í•˜ë©°, ë°œìƒ ì‹œ ì§€ì •ëœ ì´ë©”ì¼ì´ë‚˜ ìŠ¬ë™(Slack) ë“±ì˜ í†µì§€ ì±„ë„ì„ í†µí•´ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤. ê°œë°œìëŠ” ì´ìŠˆë¥¼ í• ë‹¹ë°›ê³ , ì²˜ë¦¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ë©°, ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ í˜‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nRelease Tracking ë¦´ë¦¬ì¦ˆ ì¶”ì (Release Tracking): ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë²„ì „ì„ ì¶”ì í•˜ì—¬, ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆê°€ ì—ëŸ¬ ë¹„ìœ¨ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìµœê·¼ ë°°í¬ëœ ë³€ê²½ì‚¬í•­ì´ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ê³  ìˆëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nSentry Alerts ì„¼íŠ¸ë¦¬ ì•ŒëŒì„ í†µí•´ í˜‘ì—… íˆ´ê³¼ ì—°ë™í•˜ì—¬ ê°œë°œìê°€ ì‰½ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.\nì„¤ì • STEP BY STEP ëŒ€ì‹œë³´ë“œ - Alert - Create Alert íŠ¸ë¦¬ê±° ì„¤ì •\nIssues : ì—ëŸ¬ì˜ stacktraceë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ìŠˆê°€ ìƒì„±ë˜ëŠ”ë°, ì—ëŸ¬ì˜ ìœ í˜• ë³„ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±° ì—ëŸ¬ ìœ í˜• ë³„ë¡œ ì²˜ë¦¬ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš© ex. APIë¥¼ ê¸°ì¤€ìœ¼ë¡œ HTTP status ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • ex. Serviceì˜ ìœ í˜• ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • Number of Errors : ì—ëŸ¬ì˜ íšŸìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±° ë™ì¼í•œ ìœ í˜•ì˜ ì—ëŸ¬ì´ë©°, íšŸìˆ˜ ê¸°ë°˜ ì²˜ë¦¬ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš© Users Experiencing Errors : ì •ì˜ëœ User ê¸°ë°˜ ì„ê³„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±° íŠ¹ì • Page ë‚´ì—ì„œ ì‚¬ìš©ì ê²½í—˜ ìµœì í™” ë˜ëŠ” ì´ìŠˆ ë°œìƒì„ í™•ì¸ì´ í•„ìš”í•  ë•Œ ì‚¬ìš© ex. 100 ëª…ì˜ ìœ ì €ê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒ ì„¸ë¶€ ì¡°ê±´ ì„¤ì •\nWHEN : ì•ŒëŒì´ íŠ¸ë¦¬ê±° ë˜ëŠ” ì‹œì  ì •ì˜\nany (ì•„ë˜ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•  ê²½ìš°) / all (ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²½ìš°) ì„ íƒ ì´ìŠˆì˜ ìƒíƒœ / ì´ìŠˆì˜ íšŸìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„ ì • IF : ì´ë²¤íŠ¸ì˜ ì„¸ë¶€ ì¡°ê±´\níƒœê·¸ ê¸°ë°˜ / ë°œìƒ ë¹ˆë„ ê¸°ë°˜ / ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ THEN : ì•¡ì…˜ ì„ ì •\në©”ì¼ / ìŠ¬ë™ / íŒ€ì¦ˆ ë“±ìœ¼ë¡œ ì•¡ì…˜ ì§€ì • ê°œë°œí•˜ê¸° Client Options Dsn: _Data Source Name_ì˜ ì•½ìë¡œ, Sentry í”„ë¡œì íŠ¸ë¥¼ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ ë¬¸ìì—´ì…ë‹ˆë‹¤. ì´ ê°’ì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ì—ëŸ¬ì™€ ì´ë²¤íŠ¸ê°€ ë³´ê³ ë  ì •í™•í•œ Sentry í”„ë¡œì íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [Projects - Settings - Client Keys] Environment: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤í–‰ í™˜ê²½(ì˜ˆ: production, staging, development)ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì—ëŸ¬ í•„í„°ë§ê³¼ ë¶„ì„ ì‹œ ì¤‘ìš”í•œ ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ê° ì‹¤í–‰ í™˜ê²½ ë³„ë¡œ í•„í„°ë§í•˜ì—¬ ì•Œë¦¼ ì„¤ì •ì„ í•˜ê±°ë‚˜, ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥ Issue Filtering Release: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ ê°’ì„ í†µí•´ ì—ëŸ¬ê°€ ë°œìƒí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì²´ì ì¸ ë²„ì „ì„ ì¶”ì í•˜ê³ , ë¦´ë¦¬ì¦ˆ ê°„ ì—ëŸ¬ ë¹„ìœ¨ì„ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. SampleRate: 0ì—ì„œ 1 ì‚¬ì´ì˜ ê°’ì„ ì„¤ì •í•˜ì—¬, ë³´ê³ ë  ì´ë²¤íŠ¸ì˜ ìƒ˜í”Œë§ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, 0.1ë¡œ ì„¤ì •í•˜ë©´ 10%ì˜ ì´ë²¤íŠ¸ë§Œì´ ì‹¤ì œë¡œ ë³´ê³ ë©ë‹ˆë‹¤. ì´ëŠ” ëŒ€ëŸ‰ì˜ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API íŠ¸ë˜í”½ ëŸ‰ì´ ë§ì„ ìˆ˜ë¡ 0ì— ê°€ê¹ê²Œ ì§€ì • ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ / ì„±ëŠ¥ ìµœì í™” / ë¹„ìš© ì ˆê°ì„ ìœ„í•´ ì ì ˆíˆ ì§€ì • TracesSampleRate: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì— ì‚¬ìš©ë˜ë©°, SampleRateì™€ ë¹„ìŠ·í•˜ê²Œ íŠ¸ëœì­ì…˜ ë°ì´í„°ì˜ ìƒ˜í”Œë§ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„±ëŠ¥ ë°ì´í„°ì˜ ì–‘ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. BeforeSend: ë³´ê³ ë˜ê¸° ì „ì— ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ í•„í„°ë§í•  ìˆ˜ ìˆëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì´ë²¤íŠ¸ë§Œì„ ë³´ê³ í•˜ê±°ë‚˜, ë¯¼ê°í•œ ì •ë³´ë¥¼ ì œê±°í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AttachStacktrace: ìë™ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ì´ë²¤íŠ¸ì— ì²¨ë¶€í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ í™œì„±í™”í•˜ë©´ ì—ëŸ¬ê°€ ì•„ë‹Œ ë¡œê·¸ ë©”ì‹œì§€ì—ë„ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì •ë³´ê°€ í¬í•¨ë©ë‹ˆë‹¤. ServerName: ì´ë²¤íŠ¸ê°€ ë³´ê³ ë  ë•Œ ì„œë²„ ì´ë¦„ì„ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì—ëŸ¬ ë¶„ì„ ì‹œ ì„œë²„ êµ¬ë¶„ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Integrations: Sentryì™€ í•¨ê»˜ ì‚¬ìš©í•  ì¶”ê°€ì ì¸ í†µí•© ê¸°ëŠ¥ë“¤ì„ ì„¤ì •í•©ë‹ˆë‹¤. SentryëŠ” ë‹¤ì–‘í•œ í”Œë«í¼ê³¼ í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ í†µí•©ì„ ì œê³µí•˜ì—¬, ë³´ë‹¤ ì‰½ê²Œ ì—ëŸ¬ ì¶”ì  ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì„ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤. TransportëŠ” Sentry ì„œë²„ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì •ì˜í•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œìëŠ” ê¸°ë³¸ HTTP ì „ì†¡ ë°©ì‹ ëŒ€ì‹  ì»¤ìŠ¤í…€ ì „ì†¡ ë°©ì‹ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ timeout ê°’ì€ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ë‚˜ ì„œë²„ ì‘ë‹µ ì‹œê°„ì˜ ë³€ë™ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ Initialize Go-Sentry SDK ì‚¬ìš© ì‹œ, ìµœì´ˆ ì´ˆê¸°í™” ë‹¹ì‹œì— HTTP Clientì˜ TCP ì»¤ë„¥ì…˜ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬ í•©ë‹ˆë‹¤.\nApplicaiton ì˜ main.go ì—ì„œ ìµœì´ˆë¡œ Init() ì„¤ì •í•˜ëŠ” ê²ƒì´ Best Practiceë¡œ ì†Œê°œë©ë‹ˆë‹¤.\nerr := sentry.Init( sentry.ClientOptions{ Dsn: si.conf.Sentry.DSN, SampleRate: si.conf.Sentry.SampleRate, EnableTracing: si.conf.Sentry.EnableTrace, Debug: si.conf.Sentry.Debug, TracesSampleRate: si.conf.Sentry.TracesSampleRate, Environment: si.conf.Sentry.Environment, AttachStacktrace: true, Transport: \u0026amp;sentry.HTTPSyncTransport{ Timeout: si.conf.Sentry.Timeout, }, }, ) Capture Exception ë°œìƒí•œ ì˜ˆì™¸(ì—ëŸ¬)ì™€ ê´€ë ¨ëœ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìº¡ì²˜í•˜ê³  ì¶”ì í•©ë‹ˆë‹¤.\n// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì™€ ì—°ê´€ëœ Hub ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸° hub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì • ctx = sentry.SetHubOnContext(ctx, hub) } // ì—ëŸ¬ ìº¡ì²˜ hub.CaptureException(err) Go Error ì‚¬ìš©ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì°¨ì´ì  ì •í™•í•œ ì—ëŸ¬ì˜ ë°œìƒì²˜ë¥¼ ì•Œê¸° ìœ„í•´ì„œëŠ” pkg/errors ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì!\nerrors íŒ¨í‚¤ì§€: ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—ëŸ¬ëŠ” ë‹¨ìˆœíˆ ë©”ì‹œì§€ë¥¼ í¬í•¨í•˜ëŠ” ê°’ì´ë©°, ë””ë²„ê¹…ì„ ìœ„í•œ ì¶”ê°€ì ì¸ ì»¨í…ìŠ¤íŠ¸ë‚˜ ìœ„ì¹˜ ì •ë³´ëŠ” í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.\ngithub.com/pkg/errors íŒ¨í‚¤ì§€: ì—ëŸ¬ì— ìë™ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—ëŸ¬ê°€ ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€, ì—ëŸ¬ì˜ ì›ì¸ì„ ì¶”ì í•˜ëŠ” ë° í•„ìš”í•œ ìƒì„¸í•œ í˜¸ì¶œ ìŠ¤íƒ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ntest. errors íŒ¨í‚¤ì§€ì™€ pkg/errors ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤\npackage main import ( \u0026#34;context\u0026#34; stdErr \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;time\u0026#34; sentry \u0026#34;github.com/getsentry/sentry-go\u0026#34; pkgErr \u0026#34;github.com/pkg/errors\u0026#34; ) var ( PkgErr1 = pkgErr.New(\u0026#34;pkg error 1\u0026#34;) PkgErr2 = pkgErr.New(\u0026#34;pkg error 2\u0026#34;) StdErr1 = stdErr.New(\u0026#34;standard error1\u0026#34;) StdErr2 = stdErr.New(\u0026#34;standard error2\u0026#34;) ) func main() { err := sentry.Init( sentry.ClientOptions{ Dsn: \u0026#34;\u0026#34;, Debug: true, AttachStacktrace: true, }, ) if err != nil { // sentry ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ, panic ì‹œìŠ¤í…œ os exit panic(err) } ctx := context.Background() hub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì • ctx = sentry.SetHubOnContext(ctx, hub) } err = errPkgNested() go hub.CaptureException(err) fmt.Println(\u0026#34;Standard error nested\u0026#34;) time.Sleep(5 * time.Second) } func errStdNested() error { return stdErr.Join(PkgErr1, PkgErr2) } func errPkgNested() error { return pkgErr.Wrap(PkgErr1, PkgErr2.Error()) } Scope() Sentryì—ì„œ ScopeëŠ” íŠ¹ì • ì—ëŸ¬ ë˜ëŠ” ì´ë²¤íŠ¸ì— ì¶”ê°€ì ì¸ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì—ëŸ¬ì˜ ì¬í˜„ì„ ìœ„í•´ì„œ ìš”ì²­ íŒŒë¼ë¯¸í„° ë“±ì„ Scopeì— ì €ì¥í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê³ ë„í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nSentry í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” í—ˆë¸ŒëŠ” Context ë‹¨ìœ„ë¡œ ì‹±ê¸€í„´ íŒ¨í„´ì„ ìœ ì§€í•˜ë©°, go context.Context ì™€ í•¨ê»˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ì—¬, ì¶”ì ì— ìš©ì´í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤.\nfunc (rm *sentryScopeMiddleware) Register(originalHandler http.Handler) http.Handler { if !rm.initializer.Enabled() { // sentryê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ê²½ìš°, ì„¼íŠ¸ë¦¬ í™œì„±í™” rm.initializer.Init() } return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { hub := sentry.GetHubFromContext(r.Context()) if hub == nil { hub = sentry.CurrentHub().Clone() r = r.WithContext(sentry.SetHubOnContext(r.Context(), hub)) } hub.Scope().SetRequest(r) }) } Sentry Advancement SentryInitializer í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‹±ê¸€í„´ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì„¤ì •ì„ í†µí•œ ì´ˆê¸°í™” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” í´ë˜ìŠ¤\npackage core import ( \u0026#34;sync\u0026#34; \u0026#34;github.com/getsentry/sentry-go\u0026#34; ) type ( // SentryInitializer : Sentry ì„¤ì • ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹í•˜ëŠ” êµ¬í˜„ì²´ SentryInitializer struct { conf *Config enabled bool mutex sync.RWMutex // enabled í•„ë“œì— ëŒ€í•œ ì½ê¸°/ì“°ê¸° ë™ê¸°í™”ë¥¼ ìœ„í•œ RWMutex } ) // NewSentryInitializer : SentryInitializer ìƒì„±ì func NewSentryInitializer(conf *Config) SentryInitializer { return SentryInitializer{ conf: conf, } } // Init : SentryInitializer ì´ˆê¸°í™” // // - sentry íŒ¨í‚¤ì§€ ë³€ìˆ˜ë¥¼ í†µí•´ ì‹±ê¸€í„´ ì²˜ë¦¬í•˜ë¯€ë¡œ ìµœì´ˆ ì„¤ì •ë§Œ ìš”êµ¬ë¨ func (si *SentryInitializer) Init() error { si.mutex.Lock() // enabled lock for writing defer si.mutex.Unlock() err := sentry.Init( sentry.ClientOptions{ Dsn: si.conf.Sentry.DSN, SampleRate: si.conf.Sentry.SampleRate, EnableTracing: si.conf.Sentry.EnableTrace, Debug: si.conf.Sentry.Debug, TracesSampleRate: si.conf.Sentry.TracesSampleRate, Environment: si.conf.Sentry.Environment, AttachStacktrace: true, Transport: \u0026amp;sentry.HTTPSyncTransport{ Timeout: si.conf.Sentry.Timeout, }, }, ) if err != nil { // sentry ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ, panic ì‹œìŠ¤í…œ os exit panic(err) } // í™œì„±í™” ìƒíƒœë¡œ ë³€ê²½ si.enabled = true return nil } // Enabled : Sentry í™œì„±í™” ì—¬ë¶€ // // - Init()ì´ í˜¸ì¶œëœ ê²½ìš°, í™œì„±í™” ìƒíƒœë¡œ ë³€ê²½ func (si *SentryInitializer) Enabled() bool { si.mutex.RLock() // read lock defer si.mutex.RUnlock() return si.enabled } ë™ì‹œì„± ë¬¸ì œë¡œ **Enabled()**ì˜ ë™ê¸°í™”ë¥¼ ìœ„í•´ ë½ìœ¼ë¡œ ê´€ë¦¬\nErrorCapturer SentryInitializerë¥¼ ì„ë² ë”©í•˜ì—¬, ì„¼íŠ¸ë¦¬ë¥¼ í†µí•œ ì„¼íŠ¸ë¦¬ í—ˆë¸Œì—ì„œ ì—ëŸ¬ë¥¼ ìº¡ì³ë§í•˜ëŠ” í´ë˜ìŠ¤ package core import ( \u0026#34;context\u0026#34; \u0026#34;github.com/getsentry/sentry-go\u0026#34; ) type ( // ErrorCapturer : ì—ëŸ¬ ìº¡ì²˜ ì¸í„°í˜ì´ìŠ¤ ErrorCapturer interface { CaptureError(ctx context.Context, err error) } sentryErrorCapturer struct { SentryInitializer } ) // NewSentryErrorCapturer : SentryErrorCapturer ìƒì„±ì func NewSentryErrorCapturer(initializer SentryInitializer) ErrorCapturer { return \u0026amp;sentryErrorCapturer{ initializer: initializer, } } // CaptureError : Sentryë¡œ ì—ëŸ¬ ìº¡ì²˜ func (sec *sentryErrorCapturer) CaptureError(ctx context.Context, err error) { // ì—ëŸ¬ê°€ ì—†ëŠ” ê²½ìš°, ë¬´ì‹œ if err == nil { return } if !sec.SentryInitializer.Enabled() { // sentry ì´ˆê¸°í™”ë¥¼ í†µí•´ í™œì„±í™” sec.SentryInitializer.Init() } // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì™€ ì—°ê´€ëœ Hub ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸° hub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì • ctx = sentry.SetHubOnContext(ctx, hub) } // ì—ëŸ¬ ìº¡ì²˜ hub.CaptureException(err) } RecoverMiddleware í•¸ë“¤ëŸ¬ì—ì„œ Panic ë°œìƒ ì‹œ, Recover(), ìš”ì²­ì„ í—ˆë¸Œì˜ ë©”íƒ€ë°ì´í„°ë¡œ ì €ì¥í•˜ëŠ” í´ë˜ìŠ¤ // Register panic() ë°œìƒ ì‹œ ìŠ¤íƒ ìŠ¤ë ˆì´ìŠ¤ë¥¼ ë¡œê¹…í•˜ë©° ì„¼íŠ¸ë¦¬ë¥¼ í†µí•´ ë‚¨ê¸°ëŠ” ë©”ì„œë“œ // // - http handlerì— ë‚´ë¶€ì ìœ¼ë¡œ ë“±ë¡ // - API ê³ ë£¨í‹´ ë‚´ë¶€ì ìœ¼ë¡œ defer()ë¥¼ í†µí•˜ì—¬ panic ìƒí™©ì—ì„œë„ ë¡œê¹…ì´ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤ // // Parameters: // - originalHandler: ì›ë˜ì˜ http handler func (rm *sentryRecoverMiddleware) Register(originalHandler http.Handler) http.Handler { if !rm.initializer.Enabled() { // sentryê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ê²½ìš°, ì„¼íŠ¸ë¦¬ í™œì„±í™” rm.initializer.Init() } return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { hub := sentry.GetHubFromContext(r.Context()) if hub == nil { hub = sentry.CurrentHub().Clone() r = r.WithContext(sentry.SetHubOnContext(r.Context(), hub)) } hub.Scope().SetRequest(r) defer func() { if err := recover(); err != nil { hub.RecoverWithContext(r.Context(), err) stackList := strings.Split(string(debug.Stack()), \u0026#34;\\n\u0026#34;) rm.Logger.Error(). Any(\u0026#34;error\u0026#34;, err). Any(\u0026#34;stack_list\u0026#34;, stackList).Send() resp := dto.ACSErrorResponse{ Code: http.StatusInternalServerError, ErrMessage: \u0026#34;ì„œë²„ì—ì„œ ì˜ˆê¸°ì¹˜ ëª»í•œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤\u0026#34;, Success: false, } jsonResp := resp.ToJSON() w.Header().Set(\u0026#34;Content-Type\u0026#34;, \u0026#34;application/json\u0026#34;) w.WriteHeader(http.StatusInternalServerError) _, err = w.Write(jsonResp) if err != nil { rm.Logger.Error(). Any(\u0026#34;error\u0026#34;, err).Send() } return } }() originalHandler.ServeHTTP(w, r) }) } ë¹„ìš©ì ì¸ ë¬¸ì œê°€ ìˆì§€ë§Œ APMê³¼ Error Captureì¸¡ë©´ì—ì„œëŠ” ê´€ë¦¬ì ì¸ í¸ì˜ì„±ì„ ì œê³µí•´ì£¼ëŠ” Sentry!\n","permalink":"https://dings-things.github.io/blog/posts/sentry/","summary":"APMê³¼ ì—ëŸ¬ ìŠ¤í…Œì´ìŠ¤ê°€ ê°€ëŠ¥í•œ íˆ´ì´ ìˆë‹¤?","title":"[Third-Party] Sentry ì—°ë™"},{"content":"ë°°ê²½ k8s í™˜ê²½ Deploy í›„, ë¶€í•˜í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ê°„í—ì ìœ¼ë¡œ 502 / 504 ì—ëŸ¬ ë°œìƒ í™•ì¸ Podë“¤ì´ êµì²´ ë˜ë©´ì„œ ê¸°ì¡´ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë°˜í™˜í•˜ì§€ ëª»í•œ ì±„ ì¢…ë£Œ ë¨ â†’ 504 Gateway Timeout ì‹ ê·œ Podì´ ì˜¬ë¼ê°€ê³  ëŒ€ì²´ë˜ëŠ” Podì´ Terminate ë¨ â†’ 502 Bad Gateway ë¡¤ë§ì—…ë°ì´íŠ¸ê°€ ì§„í–‰ë˜ì§€ë§Œ Readiness Probe ì„¤ì • ì—†ì´ëŠ” ìˆœë‹¨ì´ ë°œìƒí•  ì—¬ì§€ê°€ ìˆìŒì„ í™•ì¸\nì„¤ì • ë¶€í•˜í…ŒìŠ¤íŠ¸ íˆ´ ì„¤ì¹˜ bombardier : ì‰½ê³  ê°„í¸í•œ go cli ë¶€í•˜í…ŒìŠ¤íŠ¸ íˆ´ vegeta : ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ìœ¼ë¡œ ë³´ë‹¤ ìœ ì—°í•œ ìš”ì²­ ê°€ëŠ¥, status code ë¥¼ ìƒì„¸íˆ ì‘ë‹µí•˜ëŠ” íˆ´\nê° íˆ´ì˜ ìì„¸í•œ ì„¤ì¹˜ ê³¼ì •ì€ ìƒëµ í•©ë‹ˆë‹¤.\nReadniess Probe Podì´ ì„œë¹„ìŠ¤ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ë¥¼ íŒë‹¨í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜\níŠ¹ì • ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ëœ í›„ì—ë„ ì¼ë¶€ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì™¸ë¶€ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ë¥¼ í™•ì¸í•˜ëŠ” ì—­í• ì„ í•¨\níŠ¸ë˜í”½ ë¼ìš°íŒ… ì œì–´: Readiness Probeê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë  ë•Œê¹Œì§€ KubernetesëŠ” í•´ë‹¹ Podìœ¼ë¡œ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” Podì´ ì¤€ë¹„ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì¤€ë¹„ê°€ ì™„ë£Œëœ í›„ì—ë§Œ íŠ¸ë˜í”½ì´ Podìœ¼ë¡œ ë¼ìš°íŒ…ë˜ê¸° ë•Œë¬¸ì—, Podì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ê³  í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í™•ë³´í•œ ìƒíƒœì—ì„œë§Œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤. Podì˜ ìƒíƒœ í™•ì¸: Readiness ProbeëŠ” íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œê¹Œì§€ Kubernetesì— Podì´ íŠ¸ë˜í”½ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì§€ ì•Šì•˜ë‹¤ê³  ì•Œë¦¬ë©°, ì¤€ë¹„ê°€ ì™„ë£Œëœ í›„ì—ëŠ” íŠ¸ë˜í”½ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆìŒì„ ì•Œë¦½ë‹ˆë‹¤. Podì´ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš°, KubernetesëŠ” Podì„ ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì œê±°í•©ë‹ˆë‹¤. 502ê°€ ë°œìƒí•˜ëŠ” ì›ì¸ ì¤‘ í•˜ë‚˜ì´ë‹¤\nReadiness Probeë¥¼ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°, ì»¨í…Œì´ë„ˆê°€ ì˜¬ë¼ê°€ëŠ” ì‹œì ì—ì„œ íŠ¸ë˜í”½ì´ ë“¤ì–´ì˜¤ê²Œ ëœë‹¤.\nì´ë•Œì—, Pod ë‚´ë¶€ì˜ ì„œë²„ ì´ˆê¸°í™”ê°€ ì™„ì „íˆ ë˜ì§€ ì•Šì€ ì‹œì ì—ì„œ ìš”ì²­ì´ ì˜¨ ê²½ìš° â†’ 502 Bad Gatewayë¥¼ ì‘ë‹µí•œë‹¤\ndeployment.yml ìˆ˜ì • ì‚¬í•­ ... readinessProbe: httpGet: port: 8080 path: /alive scheme: HTTP initialDelaySeconds: 30 periodSeconds: 30 ... Healthcheck ì‘ë‹µìš© Endpointë¥¼ ìƒì„±í•´ë‘ê³  ì‘ë‹µ ìƒíƒœì½”ë“œê°€ 200ìœ¼ë¡œ ëŒì•„ì˜¤ë©´ ìš”ì²­ì„ ë°›ëŠ” í˜•ì‹ìœ¼ë¡œ ì„¤ì •\ní…ŒìŠ¤íŠ¸ bombardier -c 200 -d 3m -l https://{endpoint} [================================================================================================================] 3m0s Done! Statistics Avg Stdev Max Reqs/sec 4205.76 1250.10 16927.12 Latency 47.81ms 10.16ms 2.07s Latency Distribution 50% 45.08ms 75% 49.77ms 90% 57.60ms 95% 64.29ms 99% 81.95ms HTTP codes: 1xx - 0, 2xx - 0, 3xx - 0, 4xx - 753060, 5xx - 12 others - 0 Throughput: 3.24MB/s ì—¬ì „íˆ 5XX ì—ëŸ¬ëŠ” ì¡´ì¬í•œë‹¤.\nlifecycle \u0026amp; preStop lifecycle ì„¤ì •ì´ë€? ì»¨í…Œì´ë„ˆì˜ ìƒëª…ì£¼ê¸° ë™ì•ˆ íŠ¹ì • ì‹œì ì— ì‹¤í–‰ë  ì‘ì—…ì„ ì •ì˜í•  ìˆ˜ ìˆëŠ” Kubernetesì˜ êµ¬ì„± ì˜µì…˜ (AOPì™€ ìœ ì‚¬\u0026hellip;í•˜ë‹¤ëŠ” ìƒê°)\npostStart: ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ëœ ì§í›„ì— ì‹¤í–‰ë©ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ëœ í›„ ì¶”ê°€ì ì¸ ì´ˆê¸°í™” ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° ì‚¬ìš© preStop: ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ê¸° ì§ì „ì— ì‹¤í–‰ë©ë‹ˆë‹¤. ì¢…ë£Œ ì „ì— í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ ì„¤ì • ê°€ëŠ¥ preStop preStop í›…ì€ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë‚˜ ëª…ë ¹ì–´ë¥¼ ì§€ì •. ì´ í›…ì€ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ê¸° ì „ì— ë°˜ë“œì‹œ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…ì´ ìˆì„ ë•Œ ë§¤ìš° ìœ ìš©\níŠ¸ë˜í”½ ë¶„ë¦¬: Podì´ ì¢…ë£Œë˜ê¸° ì „ì— í•´ë‹¹ Podì„ ì„œë¹„ìŠ¤ íŠ¸ë˜í”½ì—ì„œ ì•ˆì „í•˜ê²Œ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì •ë¦¬ ì‘ì—…: ì¢…ë£Œ ì „ì— ë¦¬ì†ŒìŠ¤ ì •ë¦¬, ì—°ê²° ì¢…ë£Œ, íŒŒì¼ ì €ì¥ ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ê¸° ì‹œê°„ ì„¤ì •: ì»¨í…Œì´ë„ˆê°€ ì‹¤ì œë¡œ ì¢…ë£Œë˜ê¸° ì „ì— ì¼ì • ì‹œê°„ ë™ì•ˆ ëŒ€ê¸°í•˜ë„ë¡ ì„¤ì •í•˜ì—¬, í´ë¼ì´ì–¸íŠ¸ì™€ì˜ ì—°ê²°ì´ ì™„ì „íˆ ì¢…ë£Œë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•ì„œ ì„¤ì •í•œ Readiness Probe ì„¤ì • ì´í›„ì—ë„, lifecycle ì„¤ì •ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê°„í—ì ì¸ 502 ì—ëŸ¬ê°€ ë°œìƒë  ìˆ˜ ìˆë‹¤\níŒŒë“œëŠ” ì¢…ë£Œë  ë•Œ SIGTERM, SIGKILL ì²˜ë¦¬ì™€ ì„œë¹„ìŠ¤ ì œì™¸ ì²˜ë¦¬ê°€ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ë¨\nì„œë¹„ìŠ¤ê°€ ë¶„ë¦¬ë˜ê¸° ì „ì— Podì´ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•  ìˆ˜ ì—†ì„ ìˆ˜ ìˆë‹¤.\nì¦‰, ì„œë¹„ìŠ¤ ë¶„ë¦¬ â†’ ì”ë¥˜í•˜ëŠ” ìš”ì²­ ì²˜ë¦¬ â†’ pod ì¢…ë£Œ ë¥¼ í†µí•´ Graceful Shutdownì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•œë‹¤\ndeployment.yml ìˆ˜ì • ì‚¬í•­ ... lifecycle: preStop: exec: command: - /bin/sh - -c - sleep 40 # ì„œë¹„ìŠ¤ ë¶„ë¦¬ê°€ ë°œìƒí•œ í›„ 40ì´ˆ ë™ì•ˆ ëŒ€ê¸° ... ì»¨í…Œì´ë„ˆ ì¢…ë£Œ ìš”ì²­: Kubernetesê°€ Podì„ ì¢…ë£Œí•˜ê¸°ë¡œ ê²°ì •í•˜ë©´, ì»¨í…Œì´ë„ˆì— SIGTERM ì‹ í˜¸ preStop í›… ì‹¤í–‰: SIGTERM ì‹ í˜¸ê°€ ì „ì†¡ëœ í›„, sleep 40 ì‹¤í–‰, ì»¨í…Œì´ë„ˆê°€ 40ì´ˆ ë™ì•ˆ ëŒ€ê¸° ìœ ì˜ˆ ê¸°ê°„ ì‹œì‘ (terminationGracePeriodSeconds): preStop í›…ì´ ì‹¤í–‰ë˜ë©´ì„œ, ë™ì‹œì— terminationGracePeriodSecondsì— ì •ì˜ëœ ìœ ì˜ˆ ê¸°ê°„ì´ ì‹œì‘ ì´ ê¸°ê°„ ë™ì•ˆ KubernetesëŠ” ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ê¸°ë¥¼ ëŒ€ê¸° ì»¨í…Œì´ë„ˆ ì¢…ë£Œ: preStop í›…ì´ ì™„ë£Œë˜ê³ , ìœ ì˜ˆ ê¸°ê°„ì´ ëë‚˜ë©´ KubernetesëŠ” ì»¨í…Œì´ë„ˆë¥¼ ì¢…ë£Œ í…ŒìŠ¤íŠ¸ bombardier -c 200 -d 3m -l https://{endpoint} [================================================================================================================] 3m0s Done! Statistics Avg Stdev Max Reqs/sec 4205.05 1355.65 20756.97 Latency 47.92ms 8.71ms 2.07s Latency Distribution 50% 45.47ms 75% 49.26ms 90% 57.32ms 95% 64.39ms 99% 80.67ms HTTP codes: 1xx - 0, 2xx - 751239, 3xx - 0, 4xx - 0, 5xx - 3 others - 0 Throughput: 2.82MB/s ì—¬ì „íˆ 5XX ì—ëŸ¬ëŠ” ì¡´ì¬í•œë‹¤.\nterminationGracePeriodSeconds Pod ì¢…ë£Œ ì‹œë‚˜ë¦¬ì˜¤:\nKubernetesê°€ Podì„ ì¢…ë£Œí•˜ê¸°ë¡œ ê²°ì •í•˜ë©´, ë¨¼ì € Pod ë‚´ì˜ ì»¨í…Œì´ë„ˆì— SIGTERM ì‹ í˜¸ë¥¼ ë³´ëƒ„ SIGTERM ì‹ í˜¸ë¥¼ ë°›ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ìš”ì²­ì„ ì™„ë£Œí•˜ê³ , í•„ìš”í•œ ì •ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰ ê°€ëŠ¥ ìœ ì˜ˆ ê¸°ê°„ ì„¤ì •:\nterminationGracePeriodSecondsëŠ” ì´ ìœ ì˜ˆ ê¸°ê°„ì„ ì •ì˜. ì´ ê¸°ê°„ ë™ì•ˆ KubernetesëŠ” ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë  ì‹œê°„ì„ ëŒ€ê¸° ê¸°ë³¸ê°’ì€ 30ì´ˆì…ë‹ˆë‹¤. ì´ ì‹œê°„ì´ ì§€ë‚˜ë©´ KubernetesëŠ” ì»¨í…Œì´ë„ˆê°€ ì—¬ì „íˆ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° ê°•ì œë¡œ ì¢…ë£Œ(SIGKILL) SIGKILL ì‹ í˜¸:\nterminationGracePeriodSeconds ê¸°ê°„ì´ ë§Œë£Œë˜ì—ˆì„ ë•Œë„ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´, KubernetesëŠ” SIGKILL ì‹ í˜¸ë¥¼ ì¤Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê°•ì œ ì¢…ë£Œë¨ ì¼ì • lifecycle.preStop ì„¤ì •ì„ í†µí•´, 40ì´ˆì˜ ìœ ì˜ˆì‹œê°„ì„ ë‘ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì”ë¥˜í•˜ëŠ” ìš”ì²­ì„ ì‘ë‹µí•  ì‹œê°„ì„ ì£¼ì—ˆìŒ.\ní•˜ì§€ë§Œ terminationGracePeriodSeconds ëŠ” ê¸°ë³¸ 30ì´ˆë¡œ ì„¤ì •ë˜ê¸°ì— 30ì´ˆê°€ ì§€ë‚˜ë„ë¡ Podì´ ì‹¤í–‰ì¤‘ì¸ ê²½ìš° SIGKILLì„ ì „ì†¡í•˜ì—¬ íŒŒë“œë¥¼ ê°•ì œ ì¢…ë£Œì‹œí‚´\ndeployment.yml ìˆ˜ì • ì‚¬í•­ ... terminationGracePeriodSeconds: 50 ... INGRESSì™€ ì—°ê²°ëœ ALB ì†ì„±ì„ ê¼­ í™•ì¸í•˜ì! terminationGracePeriodSecondsê°€ ALB íƒ€ì„ì•„ì›ƒë³´ë‹¤ ê¸´ ê²½ìš°, íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ 504 Gateway Timeout ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ\nì˜ˆìƒ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤ : ìš”ì²­ ì¤‘ê°„ì— ì¢…ë£Œ ë°œìƒ â†’ ALB íƒ€ì„ì•„ì›ƒ ë„ë‹¬ â†’ ì‘ë‹µ ì „ Pod ì¢…ë£Œ\nì´ë¥¼ ì˜ˆë°©í•˜ê¸° ìœ„í•´, lifecycle.preStop (40s) \u0026lt; terminationGracePeriodSeconds (50s) \u0026lt; ALB Timeout (60s) ë¡œ ì§€ì •\ní…ŒìŠ¤íŠ¸ bombardier -c 200 -d 3m -l https://{endpoint} [================================================================================================================] 3m0s Done! Statistics Avg Stdev Max Reqs/sec 4293.51 1286.80 12924.64 Latency 46.74ms 8.94ms 547.25ms Latency Distribution 50% 44.48ms 75% 46.87ms 90% 54.16ms 95% 66.82ms 99% 81.69ms HTTP codes: 1xx - 0, 2xx - 770240, 3xx - 0, 4xx - 0, 5xx - 0 others - 0 Throughput: 2.89MB/s REF ì¹´ì¹´ì˜¤ í…Œí¬ k8s ë¬´ì¤‘ë‹¨ ë°°í¬ Pod ë¼ì´í”„ì‚¬ì´í´ ","permalink":"https://dings-things.github.io/blog/posts/k8s-zero-downtime/","summary":"ê°„í—ì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” 502ì™€ 504.. ì™œ ë°œìƒí•˜ê³  ì–´ë–»ê²Œ ì˜ˆë°©í• ê¹Œ","title":"[Infra] ì¿ ë²„ë„¤í‹±ìŠ¤ ë¬´ì¤‘ë‹¨ ë°°í¬ ì„¤ì •í•˜ê¸°"},{"content":"ëª©ì  ì¼ë°˜ì ì¸ Transactionì´ í•„ìš”í•œ RDBì˜ ê²½ìš°, ìì²´ì ìœ¼ë¡œ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì„¤ì •í•˜ê±°ë‚˜ Rollbackê³¼ Commitì„ í†µí•´ íŠ¸ëœì­ì…˜ì„ êµ¬í˜„í•œë‹¤.\ní•˜ì§€ë§Œ RedisëŠ” ì–´ë– í•œê°€? Redisì—ì„œ ë°ì´í„°ì˜ ì¼ê´€ì„±ê³¼ ì›ìì„±ì„ ë³´ì¥ë°›ê¸° ìœ„í•´ ì£¼ì–´ì§„ ì˜µì…˜ì€ ê·¸ë ‡ê²Œ ëª…í™•í•˜ì§€ ì•Šë‹¤.\ní•˜ë‚˜ì˜ Transactionì„ ê²©ë¦¬ ì‹œì¼œì•¼ í•˜ë©°, All or Nothing ì›ìì„±ì„ Redisì—ì„œ ì§€ì¼œì•¼ í•  ë•Œì— ë„ì›€ì´ ë˜ê³ ì ê¸°ë¡í•©ë‹ˆë‹¤.\nì„ íƒì§€ Redis TxPipeline Lua Script Redis TxPipeline Redisì—ì„œ ì—¬ëŸ¬ Commandë¥¼ ì¼ê´„ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë– ì˜¬ë¦¬ê²Œ ë˜ëŠ” ê²ƒì€ Pipelineì¼ ê²ƒì´ë‹¤\nPipelineì€ ì—°ê²°ëœ Redis Clientë¡œ ì—¬ëŸ¬ ê°œì˜ ì»¤ë§¨ë“œë¥¼ í•œë²ˆì— ë³´ë‚´ê³  ì—¬ëŸ¬ê°œì˜ ì‘ë‹µì„ í•œë²ˆì— ë°›ëŠ” ê²ƒì„ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤\në‹¤ë§Œ ì¼ë°˜ì ì¸ íŒŒì´í”„ë¼ì¸ì´ íŠ¸ëœì­ì…˜ì´ ë³´ì¥ëœë‹¤ê³  í•  ìˆ˜ ì—†ë‹¤. ì¦‰, íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ë„ì¤‘ í•´ë‹¹ ë°ì´í„°ì— ëŒ€í•˜ì—¬ ë‹¤ë¥¸ ì»¤ë§¨ë“œë¡œ ì¸í•´ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë©° ë°ì´í„°ì˜ ì¼ê´€ì„±ì— ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤\nEdge Case ë„¤íŠ¸ì›Œí¬ ì§€ì—°: Redis Pipelineì„ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ê°œì˜ ì»¤ë§¨ë“œë¥¼ í•œ ë²ˆì— ë³´ë‚´ê³ , í•œ ë²ˆì— ì—¬ëŸ¬ ê°œì˜ ì‘ë‹µì„ ë°›ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ìœ¼ë¡œ ì¸í•´ ì»¤ë§¨ë“œê°€ ì„œë²„ì— ë„ì°©í•˜ëŠ” ìˆœì„œì™€ ì‘ë‹µì´ ë„ì°©í•˜ëŠ” ìˆœì„œê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‘ë‹µì´ ë¨¼ì € ë„ì°©í•˜ëŠ” ê²½ìš°ì—ë„, ì‹¤ì œë¡œëŠ” ë‚˜ì¤‘ì— ì‹¤í–‰í•œ ì»¤ë§¨ë“œì˜ ê²°ê³¼ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì¤‘ ìŠ¤ë ˆë“œ í™˜ê²½: Redis ì„œë²„ëŠ” ë‹¤ì¤‘ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ë©°, ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì‹œì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì‹œì— Pipelineì„ ì‚¬ìš©í•  ê²½ìš°, ì»¤ë§¨ë“œì˜ ì‹¤í–‰ ìˆœì„œê°€ ë³´ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Redis ì„œë²„ ì„¤ì •: Redis ì„œë²„ì˜ ì„¤ì •ì— ë”°ë¼ ì¼ê´€ì„±ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Redis ì„œë²„ê°€ \u0026ldquo;slaveof\u0026rdquo; ì„¤ì •ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë ˆí”Œë¦¬ì¼€ì´ì…˜í•˜ëŠ” ê²½ìš°, ì¼ê´€ì„±ì´ ë³´ì¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ TxPipelineì´ë‹¤\nPros íŠ¸ëœì­ì…˜ ë³´ì¥: TxPipelineì„ ì‚¬ìš©í•˜ë©´ ì¼ê´„ ì²˜ë¦¬ëœ ì»¤ë§¨ë“œëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ê°„ì£¼ë˜ì–´, ì‹¤í–‰ ì¤‘ ë‹¤ë¥¸ ì»¤ë§¨ë“œê°€ ì¤‘ê°„ì— ë¼ì–´ë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¡œì¨ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. ì„±ëŠ¥ í–¥ìƒ: ì—¬ëŸ¬ ê°œì˜ ì»¤ë§¨ë“œë¥¼ í•œ ë²ˆì— ë³´ë‚´ë¯€ë¡œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œë¥¼ ì¤„ì¼ ìˆ˜ ìˆì–´ ì„±ëŠ¥ì´ í–¥ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›ìì„± ë³´ì¥: TxPipeline ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  ì»¤ë§¨ë“œëŠ” ì„±ê³µí•˜ê±°ë‚˜ ì‹¤íŒ¨ë˜ë©°, ë¡¤ë°±ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Cons ë©”ëª¨ë¦¬ ì‚¬ìš©: ëª¨ë“  ì»¤ë§¨ë“œì™€ ê²°ê³¼ê°€ ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ë¯€ë¡œ, í° íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•  ë•Œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³µì¡ì„±: TxPipelineì€ ë‹¤ë¥¸ íŒŒì´í”„ë¼ì¸ê³¼ í˜¼í•©í•´ì„œ ì‚¬ìš©í•  ë•Œ ì£¼ì˜ê°€ í•„ìš”í•˜ë©°, íŠ¸ëœì­ì…˜ì˜ ë²”ìœ„ë¥¼ ì‹ ì¤‘í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ WATCHë¥¼ í†µí•´ íŠ¹ì • í‚¤ì˜ ë³€ê²½ì„ ê°ì‹œí•˜ê³ , ì´ë¥¼ í†µí•´ íŠ¸ëœì­ì…˜ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ WATCH ì¤‘ì— ê°ì‹œëœ í‚¤ê°€ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì— ì˜í•´ ë³€ê²½ë˜ë©´, í•´ë‹¹ íŠ¸ëœì­ì…˜ì€ ì‹¤íŒ¨\nex. TxPipeline ë„ì¤‘ ì—ëŸ¬ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤\nMULTI SET key1 value1 SET key2 value2 SET key3 value3 EXEC ì‹œë‚˜ë¦¬ì˜¤ : SET key2 value2 ì»¤ë§¨ë“œê°€ ì‹¤íŒ¨\nCASE 1 : ë©”ëª¨ë¦¬ ë¶€ì¡± \u0026#34;OOM command not allowed when used memory \u0026gt; \u0026#39;maxmemory\u0026#39;\u0026#34; CASE 2 : ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ \u0026#34;WRONGTYPE Operation against a key holding the wrong kind of value\u0026#34; ì¼ë°˜ì ìœ¼ë¡œ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ ë“œë¬´ë©°, ê°€ì¥ ì˜ˆìƒ ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ëŠ” Redis Client Connectionì´ ëŠì–´ì§„ ì¼€ì´ìŠ¤ê°€ ë ê²ƒì´ë‹¤. ë§Œì•½ Client Connectionì´ ëŠì–´ì§„ ê²½ìš°, ì‹¤íŒ¨í•œ í‚¤ì— ëŒ€í•˜ì—¬ ë¡¤ë°±ì„ ìˆ˜ë™ìœ¼ë¡œ ì§„í–‰í•œë‹¤ í•˜ì—¬ë„ ë¡¤ë°± ìì²´ê°€ ìˆ˜í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì™„ë²½í•œ í•´ë‹µì€ ë˜ì§€ ì•ŠëŠ”ë‹¤\nì¦‰, TxPipelineì€ ì¼ê´€ì„±ì€ ë³´ì¥ ë˜ì§€ë§Œ ì™„ë²½í•œ ì›ìì„±ì€ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤\nLua Script Lua ìŠ¤í¬ë¦½íŠ¸ ë‚´ì—ì„œ ì—¬ëŸ¬ Redis ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ê³ , ì´ë¥¼ ì›ìì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤\nEdge Case ìŠ¤í¬ë¦½íŠ¸ ì „ì†¡ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ë‚˜ ì¤‘ë‹¨: í´ë¼ì´ì–¸íŠ¸ê°€ Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ Redis ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ê³¼ì •ì—ì„œ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ë‚˜ ì¤‘ë‹¨ì´ ë°œìƒí•˜ë©´, ìŠ¤í¬ë¦½íŠ¸ëŠ” ì„œë²„ì— ì œëŒ€ë¡œ ë„ë‹¬í•˜ì§€ ëª»í•˜ê³  ì‹¤í–‰ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤í–‰ ê²°ê³¼ ìˆ˜ì‹  ì¤‘ ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ: ìŠ¤í¬ë¦½íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ëœ í›„, ê·¸ ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ê°€ ìˆ˜ì‹ í•˜ëŠ” ê³¼ì •ì—ì„œ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ë‚˜ ì¤‘ë‹¨ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš°, ìŠ¤í¬ë¦½íŠ¸ëŠ” Redis ì„œë²„ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ëŠ” ì‹¤í–‰ ê²°ê³¼ë¥¼ ë°›ì§€ ëª»í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Pros: ê²½ëŸ‰ ë° ë¹ ë¥¸ ì‹¤í–‰: LuaëŠ” ê²½ëŸ‰ ìŠ¤í¬ë¦½íŒ… ì–¸ì–´ë¡œ, ì‹¤í–‰ ì‹œìŠ¤í…œ ìì›ì„ ì ê²Œ ì†Œëª¨í•˜ë©° ë¹ ë¥´ê²Œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ íŠ¹ì§•ì€ ì„ë² ë””ë“œ ì‹œìŠ¤í…œì´ë‚˜ ê²Œì„ ì—”ì§„ ë“± ë¦¬ì†ŒìŠ¤ê°€ ì œí•œëœ í™˜ê²½ì—ì„œ ìœ ìš©í•©ë‹ˆë‹¤. ë‚´ì¥ ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´: LuaëŠ” ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ê²Œì„ ì—”ì§„ì—ì„œ ë‚´ì¥ ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í™•ì¥ì„±ì„ ë†’ì´ê³  ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ê¸°ëŠ¥ì„ í™•ì¥í•˜ê¸°ì— ìš©ì´í•©ë‹ˆë‹¤. í”íˆ ì´ì „ì— Statementë¡œ ê´€ë¦¬ ë˜ë˜ DB ëª…ë ¹ ë°©ì‹ ORMì´ ë“±ì¥í•œ ë°°ê²½ì„ ìƒê°í•´ë³´ì•˜ì„ ë•Œ, ì»¤ë§¨ë“œ(query)ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— Luaë¥¼ ì‚¬ìš©í•¨ì— íšŒì˜ì ì¸ ê°œì¸ì  ìƒê° ê°€ë…ì„±ê³¼ ê°„ê²°ì„±: LuaëŠ” ê°„ê²°í•˜ê³  ê°€ë…ì„±ì´ ë†’ì€ ë¬¸ë²•ì„ ê°€ì§€ê³  ìˆì–´ ì‰½ê²Œ ì´í•´í•˜ê³  ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. lua Scriptë¥¼ ìœ„í•´ ë¬¸ë²•ì„ ìˆ˜ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ëŸ¬ë‹ ì»¤ë¸Œê°€ ë™ë°˜ë  ìˆ˜ ìˆìŒ Cons: ì‘ì€ ìƒíƒœê³„: ë‹¤ë¥¸ ì–¸ì–´ì— ë¹„í•´ Luaì˜ ìƒíƒœê³„ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ì‘ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ì–‘í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ëª¨ë“ˆì„ ì°¾ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œí•œëœ ìë£Œí˜•: LuaëŠ” ëª‡ ê°€ì§€ ê¸°ë³¸ ìë£Œí˜•ë§Œì„ ì§€ì›í•˜ë©°, ì •ìˆ˜ì™€ ë¶€ë™ ì†Œìˆ˜ì  ìˆ˜ì˜ êµ¬ë¶„ì´ ì—†ì–´ì„œ ì •í™•í•œ ìˆ«ì ì²˜ë¦¬ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—„ê²©í•œ ë¬¸ë²•: LuaëŠ” ë¬¸ë²• ê²€ì‚¬ê°€ ì—„ê²©í•˜ë©°, ì´ˆë³´ìì—ê²ŒëŠ” ì´ˆê¸° í•™ìŠµ ê³¡ì„ ì´ ë†’ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì“°ë ˆë“œ ì²˜ë¦¬ ì–´ë ¤ì›€: LuaëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì‹±ê¸€ ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë™ì‘í•˜ë©°, ë©€í‹° ìŠ¤ë ˆë“œ ì²˜ë¦¬ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ê²°êµ­ Lua ë˜í•œ íŠ¸ëœì­ì…˜ì— ëŒ€í•œ ë¡¤ë°±ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê¸°ë³¸ì ìœ¼ë¡œ ì‚½ì… ìš”ì²­ ì‹œ, Validationì„ ì²´í¬í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•  ë•Œì— ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ìµœì•…ì˜ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ë‹¨ì ˆì´ë©° í•´ë‹¹ ë°©ë²•ì€ ì–´ë– í•œ ë°©ë²•ìœ¼ë¡œë„ ë³µêµ¬ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nRedis Pipelineì— ì €ì¥ëœ ì»¤ë§¨ë“œê°€ ì›ìì ìœ¼ë¡œ í•œë²ˆì— ì‹¤í–‰ ë  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤\ní…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤\nkey1 ~ key5 ê¹Œì§€ ì„¸íŒ…í•˜ëŠ” ë„ì¤‘ ì—ëŸ¬ ë°œìƒ ì‹œ, ë¡¤ë°± í…ŒìŠ¤íŠ¸\nì‹¤í–‰ ì½”ë“œ (go)\npackage main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/go-redis/redis/v8\u0026#34; ) var ctx = context.Background() func main() { rdb := redis.NewClient(\u0026amp;redis.Options{ Addr: \u0026#34;localhost:6379\u0026#34;, // Redis ì„œë²„ ì£¼ì†Œ }) luaScript := ` for i = 1, #KEYS do if KEYS[i] == \u0026#39;key3\u0026#39; then error(\u0026#39;key3 ì„¤ì • ì‹œ ì—ëŸ¬ ë°œìƒ\u0026#39;) else redis.call(\u0026#39;SET\u0026#39;, KEYS[i], ARGV[i]) end end ` keys := []string{\u0026#34;key1\u0026#34;, \u0026#34;key2\u0026#34;, \u0026#34;key3\u0026#34;, \u0026#34;key4\u0026#34;, \u0026#34;key5\u0026#34;} values := []interface{}{\u0026#34;value1\u0026#34;, \u0026#34;value2\u0026#34;, \u0026#34;value3\u0026#34;, \u0026#34;value4\u0026#34;, \u0026#34;value5\u0026#34;} err := rdb.Eval(ctx, luaScript, keys, values...).Err() if err != nil { fmt.Printf(\u0026#34;Lua ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: %v\\n\u0026#34;, err) return } fmt.Println(\u0026#34;Lua ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì™„ë£Œ\u0026#34;) } [ê²°ê³¼] ì¢…í•© Pros \u0026amp; Cons TxPipeline Lua Script íŠ¹ì§• - Redis Pipelineê³¼ ë™ì¼í•œ ì½”ë“œë¡œ ìˆ˜í–‰ ê°€ëŠ¥ - ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥ - ë‚™ê´€ì  ë½ (Watch ì¤‘ì¸ í‚¤ì— ë³€ê²½ì´ ì¼ì–´ë‚˜ë©´ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨) - Lua ì–¸ì–´ë¥¼ í†µí•´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•¨ - ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥ - ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ê°€ í•˜ë‚˜ì˜ ë‹¨ìœ„ë¡œ ì‹¤í–‰ íŠ¸ëœì­ì…˜ ë¡¤ë°± ì—¬ë¶€ ë¶ˆê°€ëŠ¥ ë¶ˆê°€ëŠ¥ ë‹¨ì  - Luaì— ë¹„í•´ ì„±ëŠ¥ì´ ì•ˆ ì¢‹ìŒ (Pipelineê³¼ëŠ” ë¹„ìŠ·) - ìŠ¤í¬ë¦½íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒ ë˜í•œ ë¦¬ì†ŒìŠ¤ê°€ ì†Œëª¨ë¨ - ëŸ¬ë‹ ì»¤ë¸Œ ë‘ ê°€ì§€ ì„ íƒì§€ ëª¨ë‘, íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ì‹œ ë¡¤ë°±ì„ ì œê³µí•˜ì§€ ì•Šì§€ë§Œ ë°ì´í„°ì˜ ë¬´ê²°ì„±ì€ ë³´ì¥ë¨. Value ì‚½ì… ì „ì— ìœ íš¨ì„± ê²€ì¦ì„ í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„° ì‚½ì…ìœ¼ë¡œ ì¸í•œ ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥ì„±ì€ ì ìŒ. ìµœì•…ì˜ ê²½ìš°: Redis Connectionì´ ëŠì–´ì§„ ê²½ìš°, Redis íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ì‹œ ì‚­ì œí•˜ì—¬ ë¡¤ë°±ì„ êµ¬í˜„í•´ì•¼ í•¨. ê·¸ëŸ¬ë‚˜ ì»¤ë„¥ì…˜ì´ ëŠì–´ì§„ ìƒíƒœë¼ë©´ ì‚­ì œ ìš”ì²­ ë˜í•œ ì‹¤íŒ¨í•  ê°€ëŠ¥ì„±ì´ ë†’ìŒ. Redis Sentinelì„ ì‚¬ìš©í•  ê²½ìš°, ê°€ìš©ì„±ì— ëŒ€í•œ ì—£ì§€ ì¼€ì´ìŠ¤ë¥¼ ê³ ë ¤í•´ì•¼ í•˜ëŠ”ê°€? ë²¤ì¹˜ë§ˆí¬ Redisì— 1,000ê°œ Key ì„¸íŒ… ê¸°ì¤€\ní•­ëª© í…ŒìŠ¤íŠ¸ íšŸìˆ˜ í‰ê·  ì‹¤í–‰ ì‹œê°„ (ms) Lua ìŠ¤í¬ë¦½íŠ¸ 1424 0.83 TxPipeline 460 2.56 Pipeline 506 2.34 ì„±ëŠ¥ì°¨ì´ê°€ í¬ë¦¬í‹°ì»¬ í•˜ì§€ ì•Šìœ¼ë©°, ë¬´ê²°ì„±ì€ ë³´ì¥ë˜ëŠ” ê²ƒì´ ì¢‹ê¸° ë•Œë¬¸ì— TxPipeline ë˜ëŠ” Lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê¶Œì¥ ","permalink":"https://dings-things.github.io/blog/posts/redis-transaction/","summary":"RedisëŠ” ë½ì´ ì—†ëŠ”ë° ì–´ë–»ê²Œ íŠ¸ëœì­ì…˜ì„ ë³´ì¥í•˜ì£ ?","title":"[DB] Redis Transaction"},{"content":"FastAPI Conventionì— ê´€í•˜ì—¬ FastAPIë€? FastAPIì˜ ì¥ì  ì˜ì¡´ì„± ì£¼ì… ìë™ ë¬¸ì„œí™” ë¹„ë™ê¸° ë™ì‘ Pydantic Model í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ê°€ ë“¤ì–´ì˜¤ë©´ì„œ ìì—°ìŠ¤ëŸ½ê²Œ MSA ë¼ëŠ” ì•„í‚¤í…ì²˜ êµ¬ì¡°ê°€ ê°ê´‘ ë°›ì•˜ê³ , ê·¸ë¡œ ì¸í•´ ì„œë²„ì˜ ìƒíƒœê³„ì— ë³€ë™ì´ ì¼ì–´ë‚˜ê³  ìˆë‹¤. ì´ì œëŠ” Serverless (ë¬´ìƒíƒœì„±)ì„ ëˆ Restful API ë¥¼ í†µí•˜ì—¬ ê°€ë²¼ìš´ í†µì‹  ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ì•„í‚¤í…ì²˜ê°€ ëŒ€ì„¸ë¥¼ ì´ë£¨ê²Œ ë˜ì—ˆëŠ”ë° ì´ë ‡ê²Œ ì‘ê²Œ ë‚˜ë‰˜ì–´ì§„ ì„œë¹„ìŠ¤ì— íŠ¹í™”ëœ ê²ƒì´ FastAPI ì´ë‹¤.\nì˜ì¡´ì„± (AëŠ” ë°˜ë“œì‹œ Bê°€ ì‹¤í–‰ë˜ì–´ì•¼ ë˜ëŠ” íë¦„? A \u0026amp; B ëŠ” ì˜ì¡´ê´€ê³„ ) ì£¼ì…ì— í•µì‹¬ì ì¸ Depends í•¨ìˆ˜ë¡œ ì¸í•˜ì—¬ ì¸ì¦/ DB ì—°ê²° ë“±ì—ì„œ ê²°í•©ë„ë¥¼ ë‚®ì¶”ì–´ ìœ ì—°ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆê²Œ ëœë‹¤ ìë™ ë¬¸ì„œí™” ë¬¸ì„œí™”ëŠ” ê°œë°œìì—ê²Œ ìˆì–´ í•˜ê¸° ì‹«ì€ ë°©í•™ ìˆ™ì œì™€ ê°™ë‹¤. ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ë“¤ê³¼ ë‹¬ë¦¬ dependency ë¥¼ ì¶”ê°€ í•˜ì§€ ì•Šì•„ë„ ë¦¬ë…ê³¼ openAPI ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤. ê°œë°œìì—ê²Œ ìƒì‚°ì„± ì¦ëŒ€ì˜ ì´ì ì„ ê°€ì ¸ì˜¨ë‹¤. ë¹„ë™ê¸° ë™ì‘ Node ì²˜ëŸ¼ ë¹„ë™ê¸°ê°€ ê¸°ë³¸ì´ ì•„ë‹Œ íŒŒì´ì¬ì€ ë™ê¸°ë¡œ ë™ì‘í•˜ì§€ë§Œ GIL(Global Interpreter Lock)ìœ¼ë¡œ ì¸í•´ ì“°ë ˆë“œì˜ ì‚¬ìš©ë„ ê¶Œì¥ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë™ì‹œì„± ì²˜ë¦¬ë¥¼ ìœ„í•œ ëª¨ë“ˆì´ ì—†ëŠ” ê²½ìš°ê°€ ë§ë‹¤. í•˜ì§€ë§Œ ì¤‘ìš”í•œê²ƒì€ FastAPI ëŠ” ì´ë¥¼ ì§€ì›í•œë‹¤ëŠ” ì  Pydantic FastAPI ëŠ” Pydantic ì„ ë§¤ìš° ì‚¬ë‘í•œë‹¤. ê°„ë‹¨í•˜ê²Œ ì§ë ¬í™”, íƒ€ì…ê²€ì‚¬ ê²½ë¡œ ë³€ìˆ˜ ì½ê¸° ë“±ë“± ì¥ì ì´ ìˆ˜ë‘ë£© í•œë° ì´ëŠ” ë‚˜ì¤‘ì— ë” ìì„¸íˆ ë‹¤ë£¨ê² ë‹¤. íŠ¹ì§• ê°€ì¥ í° ê²ƒì´ ì‚¬ì‹¤ìƒì˜ í‘œì¤€(de facto standard) ê°€ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤. ì—¬íƒ€ í”„ë ˆì„ì›Œí¬ë“¤ê³¼ ë‹¤ë¥´ê²Œ ì—­ì‚¬ë„ ê¸¸ì§€ ì•Šê³  FastAPIì˜ ëª¨í† ê°€ ììœ ë¡­ê³  ê²½ëŸ‰ì˜ í”„ë ˆì„ì›Œí¬ë¥¼ ì§€í–¥í•˜ê¸°ì— ì–´ì©”ìˆ˜ ì—†ê²Œë„ ì½”ë”© ìŠ¤íƒ ë‹¤ë“œê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. ì¢‹ê²Œ ë§í•˜ë©´ ììœ ë„ ë†’ì¸ í”„ë ˆì„ì›Œí¬ì´ì§€ë§Œ ì–´ë–»ê²Œ ë³´ë©´ ê·¼ë³¸ì´ ì—†ë‹¤ ë³´ì¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.\nëª©ì  ê¸°ì¡´ í´ë˜ìŠ¤í™” ë˜ì§€ ì•Šê³  ì •í•´ì§„ êµ¬ì¡°ì—†ì´ ì§œì—¬ì§„ ì½”ë“œë¡œ ì¸í•˜ì—¬ í˜‘ì—…í•˜ëŠ” ë°ì— ìˆì–´ ê°ìì˜ ì½”ë”© ìƒ‰ì´ ë„ˆë¬´ ì§„í•˜ì—¬ ê°™ì€ íŒ€ì´ì§€ë§Œ êµ¬ì¡°í™” ë˜ì§€ ì•Šì€ í”„ë¡œì íŠ¸ë¼ê³  ëŠê»´ì¡Œë‹¤.\nì´ì— ìš°ë¦¬ë§Œì˜ Conventionì„ ì§€ì •í•˜ì—¬ ì§ê´€ì ì´ê³  ìœ ì§€ë³´ìˆ˜ì— ìš©ì´í•œ êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤.\nClass Based Convention í˜„ì¬ ë¬¸ì œì  Utilityì— ì˜ì¡´í•œ ì¡ë‹¤í•œ Feature methods ë„ˆë¬´ ë§ì€ ì±…ì„ì„ ì§Šì–´ì§„ í´ë˜ìŠ¤ (ë‚®ì€ ì‘ì§‘ë„) ì§ê´€ì ì´ì§€ ì•Šì€ êµ¬ì¡° í•˜ë‚˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆì´ì–´ê°€ ë¶„ì‚°ë˜ì–´ ìˆì–´ ì½”ë“œ ê°€ë…ì„±ì´ ë–¨ì–´ì§ Dataclass, Pydantic Model ë“± ëª¨ë¸ì— ì‚¬ìš©ë˜ëŠ” Conventionì´ ì§€ì •ë˜ì–´ ìˆì§€ ì•ŠìŒ ìš”êµ¬ ì‚¬í•­ í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì¼ê´€ì , ì§ê´€ì  í´ë˜ìŠ¤ëŠ” ë‹¨ í•œê°œì˜ ì±…ì„ì„ ê°€ì§„ë‹¤ ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆì´ì–´ ë³„ë¡œ íŒ¨í‚¤ì§€ë¥¼ êµ¬ì„±í•œë‹¤ ìš”êµ¬ ì‚¬í•­ì— ë”°ë¥¸ Convention 1. í”„ë¡œì íŠ¸ êµ¬ì¡°ëŠ” ì¼ê´€ì , ì§ê´€ì  [FastAPIì—ì„œ ì œì‹œí•˜ëŠ” project structure]\n. â”œâ”€â”€ app # \u0026#34;app\u0026#34; is a Python package â”‚ â”œâ”€â”€ __init__.py # this file makes \u0026#34;app\u0026#34; a â”‚ â”œâ”€â”€ main.py # \u0026#34;main\u0026#34; module, e.g. import app.main â”‚ â”œâ”€â”€ dependencies.py # \u0026#34;dependencies\u0026#34; module â”‚ â””â”€â”€ routers # \u0026#34;routers\u0026#34; is a \u0026#34;Python subpackage\u0026#34; â”‚ â”‚ â”œâ”€â”€ __init__.py # makes \u0026#34;routers\u0026#34; a \u0026#34;Python subpackage\u0026#34; â”‚ â”‚ â”œâ”€â”€ items.py # \u0026#34;items\u0026#34; submodule â”‚ â”‚ â””â”€â”€ users.py # \u0026#34;users\u0026#34; submodule â”‚ â””â”€â”€ internal # \u0026#34;internal\u0026#34; is a \u0026#34;Python subpackage\u0026#34; â”‚ â”œâ”€â”€ __init__.py # makes \u0026#34;internal\u0026#34; a \u0026#34;Python subpackage\u0026#34; â”‚ â””â”€â”€ admin.py # \u0026#34;admin\u0026#34; submodule [ì œì•ˆ í•˜ê³ ì í•˜ëŠ” project structure]\nfastapi-project â”œâ”€â”€ app â”‚ â”œâ”€â”€ worker (ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆì´ì–´) â”‚ â”‚ â”œâ”€â”€ enums.py # enums â”‚ â”‚ â”œâ”€â”€ models.py # pydantic models â”‚ â”‚ â”œâ”€â”€ dependencies.py â”‚ â”‚ â”œâ”€â”€ constants.py â”‚ â”‚ â”œâ”€â”€ exceptions.py â”‚ â”‚ â””â”€â”€ utils.py â”‚ â”œâ”€â”€ configs â”‚ â”‚ â”œâ”€â”€ config.py # global config (including .env) â”‚ â”‚ â””â”€â”€ log_config.py â”‚ â”œâ”€â”€ models.py # global models â”‚ â”œâ”€â”€ utils.py # global utils â”‚ â”œâ”€â”€ exceptions.py # global exceptions â”‚ â”œâ”€â”€ database.py # db connection related stuff â”‚ â””â”€â”€ main.py â”œâ”€â”€ aws â”‚ â”œâ”€â”€ client.py # client model for external service â”‚ â”œâ”€â”€ models.p â”‚ â”œâ”€â”€ constants.py â”‚ â”œâ”€â”€ exceptions.py â”‚ â””â”€â”€ utils.py â”œâ”€â”€ tests/ â”‚ â”œâ”€â”€ domain â”‚ â””â”€â”€ aws â”œâ”€â”€ templates/ â”‚ â””â”€â”€ index.html â”œâ”€â”€ requirements â”‚ â”œâ”€â”€ dev.txt â”‚ â”œâ”€â”€ stg.txt â”‚ â””â”€â”€ prod.txt â”œâ”€â”€ .env â””â”€â”€ .gitignore ëª¨ë“  ë„ë©”ì¸ ë””ë ‰í† ë¦¬ì˜ rootëŠ” appì´ë‹¤\nmain.pyì—ì„œëŠ” ê·¸ëŒ€ë¡œ FastAPI appì„ ì´ˆê¸°í™”í•˜ê³  í”„ë¡œì íŠ¸ì˜ root ì—­í• ì„ í•œë‹¤ (ë³´í¸ì ìœ¼ë¡œ src/ ëŠë‚Œ) controller : ê° ëª¨ë“ˆì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê°€ì§„ë‹¤ enums : Enum ëª¨ë¸ë“¤ models : pydantic ëª¨ë¸ë“¤ entities : ì—”í‹°í‹° ëª¨ë¸ë“¤ service : ëª¨ë“ˆ ë³„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹´ë‹¹ dependencies : ìœ íš¨ì„± ê²€ì‚¬ constant : ëª¨ë“ˆ ë‚´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìƒìˆ˜ê°’ config : ëª¨ë“ˆ ë‚´ì˜ ì„¤ì •ì‚¬í•­ exceptions: ì»¤ìŠ¤í…€ ì˜ˆì™¸ë“¤! ê°™ì€ ê´€ì‹¬ì„ ê°–ëŠ” ë©”ì„œë“œê°€ ë‘ê°œ ì´ìƒì¼ ê²½ìš° ë”°ë¡œ íŒ¨í‚¤ì§€ë¡œ ë¶„ë¥˜í•œë‹¤\nì™¸ë¶€ íŒ¨í‚¤ì§€ì˜ ê²½ìš° appì— ì¢…ì†ì ì´ì§€ ì•Šê¸° ë•Œë¬¸ì— app ì™¸ë¶€ì—ì„œ ê´€ë¦¬í•œë‹¤.\n2. í´ë˜ìŠ¤ëŠ” ë‹¨ í•œê°œì˜ ì±…ì„ì„ ê°€ì§„ë‹¤ ì €ìëŠ” ì‘ì§‘ë„ë¥¼ ì˜ëª» ì´í•´í•˜ê³  ìˆì—ˆë‹¤. ì—¬ëŸ¬ê°œì˜ ì—°ê´€ëœ ê´€ì‹¬ì„ ê°€ì§„ ë©”ì„œë“œë“¤ì„ ë¬¶ì–´ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ê³  ì´ê²Œ ë†’ì€ ì‘ì§‘ë„ì§€ ã…‹ã…‹ í•˜ëŠ” ì–´ë¦¬ì„ìŒì„ ë°˜ë³µí•˜ê³  ìˆì—ˆë‹¤.\nê°ì²´ì§€í–¥ ì„¤ê³„ì›ì¹™ì¸ SOLIDì¤‘ ì´ëŠ” SRP (Single Responsibility) ë‹¨ì¼ ì±…ì„ ì›ì¹™ì— í•´ë‹¹ëœë‹¤.\ní”íˆ ë§í•˜ëŠ” GOD í´ë˜ìŠ¤ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. XXXService, XXXClient, XXXHandler, XXXWorker\ní•„ì ë˜í•œ ê·¸ëŸ¬í•˜ì˜€ê³  ì„œë¹„ìŠ¤ì•ˆì— ì¡°ê¸ˆì´ë¼ë„ ê´€ì‹¬ì´ ê°™ë‹¤ê³  íŒë‹¨í•˜ë©´ ë¬´ìˆ˜íˆ ë§ì€ í”¼ì³ë“¤ì„ ë‚¨ë°œí•˜ì—¬ ì¶”ê°€í•˜ì˜€ë‹¤. ì´ëŠ” ì½”ë“œ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì˜ ì´ì ì„ ë²„ë¦¬ëŠ” ì§€ë¦„ê¸¸ì´ë¼ ìƒê°í•œë‹¤.\nê°€ë ¹ ì•„ë˜ì™€ ê°™ì€ í”¼ì³ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.\nex. íšŒì› ë¡œê·¸ë¥¼ txt íŒŒì¼ë¡œ ì‘ì„±í•˜ëŠ” í”¼ì³ë¥¼ ë§Œë“œì‹œì˜¤\n[Service]\nclass UserService: def write_log_file(self, user_id:str) -\u0026gt; None [ë‹¨ì¼ì±…ì„]\nclass UserLogWriter: def __init__(self, user:User) self.user = user def write(self) -\u0026gt; None í•˜ë‚˜ì˜ ì˜ˆì‹œì— ë¶ˆê³¼í•˜ì§€ë§Œ ì„œë¹„ìŠ¤ë“¤ë¡œ êµ¬ì„±í•œ í”¼ì³ë“¤ì´ ìŒ“ì´ë©´ ê°€ë…ì„±ì ì´ë‚˜ íŠ¹íˆ ìœ ë‹›í…ŒìŠ¤íŠ¸ì—ì„œ í° ê³¨ì¹˜ë¥¼ ê²ªì„ ê²ƒì´ë‹¤.\në˜í•œ ë¶„ì‚°ëœ ë©”ì„œë“œë“¤ì„ ì¡°í•©í•˜ëŠ” ë°©ì‹ì—ì„œ ìµœëŒ€í•œ Pythonicí•˜ê³  OOPë¥¼ ë”°ë¥´ê¸° ìœ„í•´ FastAPIì˜ ë¼ìš°í„° ë˜í•œ ì†ì„ ë³´ê²Œ ë˜ì—ˆë‹¤.\nêµ³ì´ ì‹¶ê¸´ í•˜ê² ì§€ë§Œ ì‹œê°„ì´ ëœë‹¤ë©´ í´ë˜ìŠ¤í™”í•˜ì—¬ ì»¨í…Œì´ë„ˆë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ì—ˆê³  ìƒì†ì„ í†µí•´ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ì½”ë“œë¥¼ ìµœì†Œí™”í•˜ê³ ì ëª¨ë‘ í´ë˜ìŠ¤ë¡œ!! ë°”ê¾¸ê²Œ ë˜ì—ˆë‹¤\nex. [BaseController] [HelloController] 3. ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆì´ì–´ ë³„ë¡œ íŒ¨í‚¤ì§€ë¥¼ êµ¬ì„±í•œë‹¤ ê°„ë‹¨íˆ ë§í•˜ìë©´ Userë¥¼ ë„ë©”ì¸ìœ¼ë¡œ ê°€ì§€ë©´ì„œ ì´ì— ëŒ€í•œ ê°„ë‹¨í•œ CRUDë¥¼ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•œë‹¤ê³  í•˜ì˜€ì„ ê²½ìš°. ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.\nfastapi-project â”œâ”€â”€ app â”‚ â”œâ”€â”€ user_manager (ë¹„ì¦ˆë‹ˆìŠ¤ ë ˆì´ì–´) â”‚ â”‚ â”œâ”€â”€ user_getter.py â”‚ â”‚ â”œâ”€â”€ user_updater.py â”‚ â”‚ â”œâ”€â”€ user_creator.py â”‚ â”‚ â”œâ”€â”€ enums.py # enums â”‚ â”‚ â”œâ”€â”€ models.py # pydantic models â”‚ â”‚ â”œâ”€â”€ entities.py # pydantic models â”‚ â”‚ â”œâ”€â”€ user_database.py â”‚ â”‚ â”œâ”€â”€ dependencies.py â”‚ â”‚ â”œâ”€â”€ constants.py â”‚ â”‚ â”œâ”€â”€ exceptions.py â”‚ â”‚ â””â”€â”€ utils.py ê°€ë ¹ DBë¡œ ë¶€í„° User ì—”í‹°í‹°ë¥¼ ì–»ê³ ì í•œë‹¤ë©´ UserGetter.get() ê³¼ ê°™ì´ ì§ê´€ì ì´ê²Œ í•´ë‹¹ ë©”ì„œë“œê°€ ë¬´ì—‡ì„ ë¦¬í„´í•˜ëŠ”ì§€ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤.\nFacade Patternì„ ì ìš©í•˜ì—¬ ì´ë“¤ì„ ì¡°í•©í•˜ëŠ” í•˜ë‚˜ì˜ Manager ë ˆë²¨ì´ ì¦ê°€í•œë‹¤ê³  í•˜ë”ë¼ë„ ì´ëŠ” ë™ì¼í•˜ê²Œ ì ìš© ë  ìˆ˜ ìˆë‹¤.\nmodelsì˜ í´ë˜ìŠ¤ ì´ë¦„ì´ ê°™ì„ ìˆ˜ ìˆì§€ ì•Šì†Œ? ë„¤, ë¬¼ë¡ ì…ë‹ˆë‹¤. íŠ¹íˆë‚˜ ì—”í‹°í‹°ì™€ DTOì˜ ë„¤ì´ë°ì€ ê²¹ì¹  ìˆ˜ ë°–ì— ì—†ì£  ê·¸ë ‡ê¸°ì— naming spaceë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ë¶„ í•©ë‹ˆë‹¤ ex.\nimport app.user_manager.entities as entity import app.user_manager.models as dto user_dto = dto.User user_entity = entity.User êµ¬í˜„ë³´ë‹¤ ì¤‘ìš”í•œ ê²ƒì´ ì„¤ê³„ì´ë‹¤. êµ¬í˜„ ë ˆë²¨ì˜ ì„¤ê³„ë„ ì¤‘ìš”í•˜ë©° ì´ëŸ¬í•œ ëª…í™•í•œ Conventionì´ ìˆì–´ì•¼ í†µì¼ëœ Class Diagramê³¼ Sequence Diagram, Module Diagramì„ ì ë¦½ í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤\ní•´ë‹¹ ì»¨ë²¤ì…˜ì´ ì •ë‹µì´ë¼ê³  ê²°ì½” ë§í•  ìˆ˜ ì—†ë‹¤. ê·¸ëƒ¥ ì´ëŸ¬í•œ ì»¨ë²¤ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆê² êµ¬ë‚˜~ ë¼ê³  ìƒê°í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤\n","permalink":"https://dings-things.github.io/blog/posts/fastapi-convention/","summary":"í´ë˜ìŠ¤ ê¸°ë°˜ì˜ FastAPI Structure Guide","title":"[Python] FastAPI Convention"}]
<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Python] FastAPI Convention | Ding's Coding Forge</title>
<meta name=keywords content="python,convention"><meta name=description content="People tend to say fastapi has no best practice.. As a Software Developer, main in Object Oriented Language i'll suggest class based fastapi best practice"><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/ko/posts/fastapi-convention/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/ko/posts/fastapi-convention/><link rel=alternate hreflang=en href=https://dingyu.dev/posts/fastapi-convention/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/ko/posts/fastapi-convention/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Python] FastAPI Convention"><meta property="og:description" content="People tend to say fastapi has no best practice.. As a Software Developer, main in Object Oriented Language i'll suggest class based fastapi best practice"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-22T00:00:00+00:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Convention"><meta property="og:image" content="https://dingyu.dev/ko/posts/fastapi-convention/img/fastapi.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/ko/posts/fastapi-convention/img/fastapi.png"><meta name=twitter:title content="[Python] FastAPI Convention"><meta name=twitter:description content="People tend to say fastapi has no best practice.. As a Software Developer, main in Object Oriented Language i'll suggest class based fastapi best practice"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/ko/posts/"},{"@type":"ListItem","position":2,"name":"[Python] FastAPI Convention","item":"https://dingyu.dev/ko/posts/fastapi-convention/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Python] FastAPI Convention","name":"[Python] FastAPI Convention","description":"People tend to say fastapi has no best practice.. As a Software Developer, main in Object Oriented Language i'll suggest class based fastapi best practice","keywords":["python","convention"],"articleBody":"FastAPI Convention에 관하여 FastAPI란? FastAPI의 장점 의존성 주입 자동 문서화 비동기 동작 Pydantic Model 클라우드 서비스가 들어오면서 자연스럽게 MSA 라는 아키텍처 구조가 각광 받았고, 그로 인해 서버의 생태계에 변동이 일어나고 있다. 이제는 Serverless (무상태성)을 띈 Restful API 를 통하여 가벼운 통신 방식을 사용하는 아키텍처가 대세를 이루게 되었는데 이렇게 작게 나뉘어진 서비스에 특화된 것이 FastAPI 이다.\n의존성 (A는 반드시 B가 실행되어야 되는 흐름? A \u0026 B 는 의존관계 ) 주입에 핵심적인 Depends 함수로 인하여 인증/ DB 연결 등에서 결합도를 낮추어 유연성을 확보할 수 있게 된다 자동 문서화 문서화는 개발자에게 있어 하기 싫은 방학 숙제와 같다. 다른 프레임워크들과 달리 dependency 를 추가 하지 않아도 리독과 openAPI 자동으로 생성된다. 개발자에게 생산성 증대의 이점을 가져온다. 비동기 동작 Node 처럼 비동기가 기본이 아닌 파이썬은 동기로 동작하지만 GIL(Global Interpreter Lock)으로 인해 쓰레드의 사용도 권장되지 않았기 때문에 동시성 처리를 위한 모듈이 없는 경우가 많다. 하지만 중요한것은 FastAPI 는 이를 지원한다는 점 Pydantic FastAPI 는 Pydantic 을 매우 사랑한다. 간단하게 직렬화, 타입검사 경로 변수 읽기 등등 장점이 수두룩 한데 이는 나중에 더 자세히 다루겠다. 특징 가장 큰 것이 사실상의 표준(de facto standard) 가 없다는 것이다. 여타 프레임워크들과 다르게 역사도 길지 않고 FastAPI의 모토가 자유롭고 경량의 프레임워크를 지향하기에 어쩔수 없게도 코딩 스탠다드가 존재하지 않는다. 좋게 말하면 자유도 높인 프레임워크이지만 어떻게 보면 근본이 없다 보일 수 있을 것이다.\n목적 기존 클래스화 되지 않고 정해진 구조없이 짜여진 코드로 인하여 협업하는 데에 있어 각자의 코딩 색이 너무 진하여 같은 팀이지만 구조화 되지 않은 프로젝트라고 느껴졌다.\n이에 우리만의 Convention을 지정하여 직관적이고 유지보수에 용이한 구조를 만드는 것을 목표로 한다.\nClass Based Convention 현재 문제점 Utility에 의존한 잡다한 Feature methods 너무 많은 책임을 짊어진 클래스 (낮은 응집도) 직관적이지 않은 구조 하나의 비즈니스 레이어가 분산되어 있어 코드 가독성이 떨어짐 Dataclass, Pydantic Model 등 모델에 사용되는 Convention이 지정되어 있지 않음 요구 사항 프로젝트 구조는 일관적, 직관적 클래스는 단 한개의 책임을 가진다 비즈니스 레이어 별로 패키지를 구성한다 요구 사항에 따른 Convention 1. 프로젝트 구조는 일관적, 직관적 [FastAPI에서 제시하는 project structure]\n. ├── app # \"app\" is a Python package │ ├── __init__.py # this file makes \"app\" a │ ├── main.py # \"main\" module, e.g. import app.main │ ├── dependencies.py # \"dependencies\" module │ └── routers # \"routers\" is a \"Python subpackage\" │ │ ├── __init__.py # makes \"routers\" a \"Python subpackage\" │ │ ├── items.py # \"items\" submodule │ │ └── users.py # \"users\" submodule │ └── internal # \"internal\" is a \"Python subpackage\" │ ├── __init__.py # makes \"internal\" a \"Python subpackage\" │ └── admin.py # \"admin\" submodule [제안 하고자 하는 project structure]\nfastapi-project ├── app │ ├── worker (비즈니스 레이어) │ │ ├── enums.py # enums │ │ ├── models.py # pydantic models │ │ ├── dependencies.py │ │ ├── constants.py │ │ ├── exceptions.py │ │ └── utils.py │ ├── configs │ │ ├── config.py # global config (including .env) │ │ └── log_config.py │ ├── models.py # global models │ ├── utils.py # global utils │ ├── exceptions.py # global exceptions │ ├── database.py # db connection related stuff │ └── main.py ├── aws │ ├── client.py # client model for external service │ ├── models.p │ ├── constants.py │ ├── exceptions.py │ └── utils.py ├── tests/ │ ├── domain │ └── aws ├── templates/ │ └── index.html ├── requirements │ ├── dev.txt │ ├── stg.txt │ └── prod.txt ├── .env └── .gitignore 모든 도메인 디렉토리의 root는 app이다\nmain.py에서는 그대로 FastAPI app을 초기화하고 프로젝트의 root 역할을 한다 (보편적으로 src/ 느낌) controller : 각 모듈의 엔드포인트를 가진다 enums : Enum 모델들 models : pydantic 모델들 entities : 엔티티 모델들 service : 모듈 별 비즈니스 로직 담당 dependencies : 유효성 검사 constant : 모듈 내에서 사용되는 상수값 config : 모듈 내의 설정사항 exceptions: 커스텀 예외들! 같은 관심을 갖는 메서드가 두개 이상일 경우 따로 패키지로 분류한다\n외부 패키지의 경우 app에 종속적이지 않기 때문에 app 외부에서 관리한다.\n2. 클래스는 단 한개의 책임을 가진다 저자는 응집도를 잘못 이해하고 있었다. 여러개의 연관된 관심을 가진 메서드들을 묶어 하나의 클래스로 만들고 이게 높은 응집도지 ㅋㅋ 하는 어리석음을 반복하고 있었다.\n객체지향 설계원칙인 SOLID중 이는 SRP (Single Responsibility) 단일 책임 원칙에 해당된다.\n흔히 말하는 GOD 클래스들은 다음과 같다. XXXService, XXXClient, XXXHandler, XXXWorker\n필자 또한 그러하였고 서비스안에 조금이라도 관심이 같다고 판단하면 무수히 많은 피쳐들을 남발하여 추가하였다. 이는 코드 가독성과 유지보수의 이점을 버리는 지름길이라 생각한다.\n가령 아래와 같은 피쳐를 만들어야 한다.\nex. 회원 로그를 txt 파일로 작성하는 피쳐를 만드시오\n[Service]\nclass UserService: def write_log_file(self, user_id:str) -\u003e None [단일책임]\nclass UserLogWriter: def __init__(self, user:User) self.user = user def write(self) -\u003e None 하나의 예시에 불과하지만 서비스들로 구성한 피쳐들이 쌓이면 가독성적이나 특히 유닛테스트에서 큰 골치를 겪을 것이다.\n또한 분산된 메서드들을 조합하는 방식에서 최대한 Pythonic하고 OOP를 따르기 위해 FastAPI의 라우터 또한 손을 보게 되었다.\n굳이 싶긴 하겠지만 시간이 된다면 클래스화하여 컨테이너로 관리하고 싶었고 상속을 통해 보일러플레이트 코드를 최소화하고자 모두 클래스로!! 바꾸게 되었다\nex. [BaseController] [HelloController] 3. 비즈니스 레이어 별로 패키지를 구성한다 간단히 말하자면 User를 도메인으로 가지면서 이에 대한 간단한 CRUD를 가진 애플리케이션을 구성한다고 하였을 경우. 아래와 같이 구성할 수 있다.\nfastapi-project ├── app │ ├── user_manager (비즈니스 레이어) │ │ ├── user_getter.py │ │ ├── user_updater.py │ │ ├── user_creator.py │ │ ├── enums.py # enums │ │ ├── models.py # pydantic models │ │ ├── entities.py # pydantic models │ │ ├── user_database.py │ │ ├── dependencies.py │ │ ├── constants.py │ │ ├── exceptions.py │ │ └── utils.py 가령 DB로 부터 User 엔티티를 얻고자 한다면 UserGetter.get() 과 같이 직관적이게 해당 메서드가 무엇을 리턴하는지 유추할 수 있다.\nFacade Pattern을 적용하여 이들을 조합하는 하나의 Manager 레벨이 증가한다고 하더라도 이는 동일하게 적용 될 수 있다.\nmodels의 클래스 이름이 같을 수 있지 않소? 네, 물론입니다. 특히나 엔티티와 DTO의 네이밍은 겹칠 수 밖에 없죠 그렇기에 naming space를 사용하여 구분 합니다 ex.\nimport app.user_manager.entities as entity import app.user_manager.models as dto user_dto = dto.User user_entity = entity.User 구현보다 중요한 것이 설계이다. 구현 레벨의 설계도 중요하며 이러한 명확한 Convention이 있어야 통일된 Class Diagram과 Sequence Diagram, Module Diagram을 적립 할 수 있을 것이다\n해당 컨벤션이 정답이라고 결코 말할 수 없다. 그냥 이러한 컨벤션을 사용할 수도 있겠구나~ 라고 생각하면 좋을 것 같다\n","wordCount":"975","inLanguage":"ko","image":"https://dingyu.dev/ko/posts/fastapi-convention/img/fastapi.png","datePublished":"2023-06-22T00:00:00Z","dateModified":"2023-06-22T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/ko/posts/fastapi-convention/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ko/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=번역 type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=en href=https://dingyu.dev/ title=English aria-label=English>English</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/ko/about/ title=소개><span>소개</span></a></li><li><a href=https://dingyu.dev/ko/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://dingyu.dev/ko/tags/ title=태그><span>태그</span></a></li><li><a href=https://dingyu.dev/ko/archives/ title=아카이브><span>아카이브</span></a></li><li><a href=https://dingyu.dev/ko/search/ title="검색 (Alt + /)" accesskey=/><span>검색</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/ko/>홈</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/ko/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Python] FastAPI Convention</h1><div class=post-description>People tend to say fastapi has no best practice.. As a Software Developer, main in Object Oriented Language i'll suggest class based fastapi best practice</div><div class=post-meta><span title='2023-06-22 00:00:00 +0000 UTC'>6월 22, 2023</span>&nbsp;·&nbsp;5 분&nbsp;·&nbsp;975 단어&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;번역:<ul class=i18n_list><li><a href=https://dingyu.dev/posts/fastapi-convention/>En</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/fastapi-convention/index.ko.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/fastapi.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><li><a href=#fastapi-convention%ec%97%90-%ea%b4%80%ed%95%98%ec%97%ac aria-label="FastAPI Convention에 관하여">FastAPI Convention에 관하여</a><ul><li><a href=#fastapi%eb%9e%80 aria-label=FastAPI란?>FastAPI란?</a></li><li><a href=#fastapi%ec%9d%98-%ec%9e%a5%ec%a0%90 aria-label="FastAPI의 장점">FastAPI의 장점</a></li><li><a href=#%ed%8a%b9%ec%a7%95 aria-label=특징>특징</a></li><li><a href=#%eb%aa%a9%ec%a0%81 aria-label=목적>목적</a></li></ul></li><li><a href=#class-based-convention aria-label="Class Based Convention">Class Based Convention</a><ul><li><a href=#%ed%98%84%ec%9e%ac-%eb%ac%b8%ec%a0%9c%ec%a0%90 aria-label="현재 문제점">현재 문제점</a></li><li><a href=#%ec%9a%94%ea%b5%ac-%ec%82%ac%ed%95%ad aria-label="요구 사항">요구 사항</a></li><li><a href=#%ec%9a%94%ea%b5%ac-%ec%82%ac%ed%95%ad%ec%97%90-%eb%94%b0%eb%a5%b8-convention aria-label="요구 사항에 따른 Convention">요구 사항에 따른 Convention</a><ul><li><a href=#1-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ea%b5%ac%ec%a1%b0%eb%8a%94-%ec%9d%bc%ea%b4%80%ec%a0%81-%ec%a7%81%ea%b4%80%ec%a0%81 aria-label="1. 프로젝트 구조는 일관적, 직관적">1. 프로젝트 구조는 일관적, 직관적</a></li><li><a href=#2-%ed%81%b4%eb%9e%98%ec%8a%a4%eb%8a%94-%eb%8b%a8-%ed%95%9c%ea%b0%9c%ec%9d%98-%ec%b1%85%ec%9e%84%ec%9d%84-%ea%b0%80%ec%a7%84%eb%8b%a4 aria-label="2. 클래스는 단 한개의 책임을 가진다">2. 클래스는 단 한개의 책임을 가진다</a></li><li><a href=#3-%eb%b9%84%ec%a6%88%eb%8b%88%ec%8a%a4-%eb%a0%88%ec%9d%b4%ec%96%b4-%eb%b3%84%eb%a1%9c-%ed%8c%a8%ed%82%a4%ec%a7%80%eb%a5%bc-%ea%b5%ac%ec%84%b1%ed%95%9c%eb%8b%a4 aria-label="3. 비즈니스 레이어 별로 패키지를 구성한다">3. 비즈니스 레이어 별로 패키지를 구성한다</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=fastapi-convention에-관하여>FastAPI Convention에 관하여<a hidden class=anchor aria-hidden=true href=#fastapi-convention에-관하여>#</a></h1><h2 id=fastapi란>FastAPI란?<a hidden class=anchor aria-hidden=true href=#fastapi란>#</a></h2><p><img loading=lazy src=/posts/fastapi-convention/fastapi-graph.png></p><h2 id=fastapi의-장점>FastAPI의 장점<a hidden class=anchor aria-hidden=true href=#fastapi의-장점>#</a></h2><ul><li>의존성 주입</li><li>자동 문서화</li><li>비동기 동작</li><li>Pydantic Model</li></ul><p>클라우드 서비스가 들어오면서 자연스럽게 <code>MSA</code> 라는 아키텍처 구조가 각광 받았고, 그로 인해 서버의 생태계에 변동이 일어나고 있다.
이제는 <code>Serverless (무상태성)</code>을 띈 <code>Restful API</code> 를 통하여 가벼운 통신 방식을 사용하는 아키텍처가 대세를 이루게 되었는데
이렇게 작게 나뉘어진 서비스에 특화된 것이 FastAPI 이다.</p><ul><li><strong>의존성</strong> (A는 반드시 B가 실행되어야 되는 흐름? A & B 는 의존관계 )<ul><li>주입에 핵심적인 <code>Depends</code> 함수로 인하여 인증/ DB 연결 등에서 결합도를 낮추어 유연성을 확보할 수 있게 된다</li></ul></li><li><strong>자동 문서화</strong><ul><li>문서화는 개발자에게 있어 하기 싫은 방학 숙제와 같다. 다른 프레임워크들과 달리 dependency 를 추가 하지 않아도 리독과 openAPI 자동으로 생성된다. 개발자에게 생산성 증대의 이점을 가져온다.</li></ul></li><li><strong>비동기 동작</strong><ul><li>Node 처럼 비동기가 기본이 아닌 파이썬은 동기로 동작하지만 <code>GIL(Global Interpreter Lock)</code>으로 인해 쓰레드의 사용도 권장되지 않았기 때문에 동시성 처리를 위한 모듈이 없는 경우가 많다. 하지만 중요한것은 FastAPI 는 이를 지원한다는 점</li></ul></li><li><strong>Pydantic</strong><ul><li>FastAPI 는 <code>Pydantic</code> 을 매우 사랑한다. 간단하게 직렬화, 타입검사 경로 변수 읽기 등등 장점이 수두룩 한데 이는 나중에 더 자세히 다루겠다.</li></ul></li></ul><h2 id=특징>특징<a hidden class=anchor aria-hidden=true href=#특징>#</a></h2><p><img loading=lazy src=/posts/fastapi-convention/image.png></p><p>가장 큰 것이 사실상의 표준(de facto standard) 가 없다는 것이다. 여타 프레임워크들과 다르게 역사도 길지 않고 FastAPI의 모토가 자유롭고 경량의 프레임워크를 지향하기에 어쩔수 없게도 코딩 스탠다드가 존재하지 않는다. 좋게 말하면 자유도 높인 프레임워크이지만 어떻게 보면 근본이 없다 보일 수 있을 것이다.</p><hr><h2 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h2><p>기존 클래스화 되지 않고 정해진 구조없이 짜여진 코드로 인하여 협업하는 데에 있어 각자의 코딩 색이 너무 진하여 같은 팀이지만 구조화 되지 않은 프로젝트라고 느껴졌다.</p><p>이에 우리만의 Convention을 지정하여 직관적이고 유지보수에 용이한 구조를 만드는 것을 목표로 한다.</p><hr><h1 id=class-based-convention>Class Based Convention<a hidden class=anchor aria-hidden=true href=#class-based-convention>#</a></h1><h2 id=현재-문제점>현재 문제점<a hidden class=anchor aria-hidden=true href=#현재-문제점>#</a></h2><ol><li>Utility에 의존한 잡다한 Feature methods<ul><li>너무 많은 책임을 짊어진 클래스 (<strong>낮은 응집도</strong>)</li></ul></li><li>직관적이지 않은 구조<ul><li>하나의 <code>비즈니스 레이어</code>가 분산되어 있어 코드 가독성이 떨어짐</li></ul></li><li>Dataclass, Pydantic Model 등 모델에 사용되는 Convention이 지정되어 있지 않음</li></ol><hr><h2 id=요구-사항>요구 사항<a hidden class=anchor aria-hidden=true href=#요구-사항>#</a></h2><ol><li>프로젝트 구조는 일관적, 직관적</li><li>클래스는 단 한개의 책임을 가진다</li><li>비즈니스 레이어 별로 패키지를 구성한다</li></ol><hr><h2 id=요구-사항에-따른-convention>요구 사항에 따른 Convention<a hidden class=anchor aria-hidden=true href=#요구-사항에-따른-convention>#</a></h2><h3 id=1-프로젝트-구조는-일관적-직관적>1. 프로젝트 구조는 일관적, 직관적<a hidden class=anchor aria-hidden=true href=#1-프로젝트-구조는-일관적-직관적>#</a></h3><p>[FastAPI에서 제시하는 project structure]</p><pre tabindex=0><code>.
├── app                  # &#34;app&#34; is a Python package
│   ├── __init__.py  	# this file makes &#34;app&#34; a 
│   ├── main.py      	# &#34;main&#34; module, e.g. import app.main
│   ├── dependencies.py  # &#34;dependencies&#34; module
│   └── routers      	# &#34;routers&#34; is a &#34;Python subpackage&#34;
│   │   ├── __init__.py  # makes &#34;routers&#34; a &#34;Python subpackage&#34;
│   │   ├── items.py 	# &#34;items&#34; submodule
│   │   └── users.py 	# &#34;users&#34; submodule
│   └── internal     	# &#34;internal&#34; is a &#34;Python subpackage&#34;
│   	├── __init__.py  # makes &#34;internal&#34; a &#34;Python subpackage&#34;
│   	└── admin.py 	# &#34;admin&#34; submodule
</code></pre><p>[제안 하고자 하는 project structure]</p><pre tabindex=0><code>fastapi-project
├── app
│   ├── worker (비즈니스 레이어)
│   │   ├── enums.py  # enums
│   │   ├── models.py  # pydantic models
│   │   ├── dependencies.py
│   │   ├── constants.py
│   │   ├── exceptions.py
│   │   └── utils.py
│   ├── configs
│   │   ├── config.py  # global config (including .env) 
│   │   └── log_config.py
│   ├── models.py  # global models
│   ├── utils.py  # global utils
│   ├── exceptions.py  # global exceptions
│   ├── database.py  # db connection related stuff
│   └── main.py
├── aws
│   ├── client.py  # client model for external service 
│   ├── models.p
│   ├── constants.py
│   ├── exceptions.py
│   └── utils.py
├── tests/
│   ├── domain
│   └── aws
├── templates/
│   └── index.html
├── requirements
│   ├── dev.txt
│   ├── stg.txt
│   └── prod.txt
├── .env
└── .gitignore
</code></pre><ul><li><p>모든 도메인 디렉토리의 root는 app이다</p><ul><li>main.py에서는 그대로 FastAPI app을 초기화하고 프로젝트의 root 역할을 한다 (보편적으로 <code>src/</code> 느낌)</li><li>controller : 각 모듈의 엔드포인트를 가진다</li><li>enums : Enum 모델들</li><li>models : pydantic 모델들</li><li>entities : 엔티티 모델들</li><li>service : 모듈 별 비즈니스 로직 담당</li><li>dependencies : 유효성 검사</li><li>constant : 모듈 내에서 사용되는 상수값</li><li>config : 모듈 내의 설정사항</li><li>exceptions: 커스텀 예외들!</li></ul></li><li><p>같은 관심을 갖는 메서드가 두개 이상일 경우 따로 패키지로 분류한다</p></li><li><p>외부 패키지의 경우 app에 종속적이지 않기 때문에 app 외부에서 관리한다.</p></li></ul><hr><h3 id=2-클래스는-단-한개의-책임을-가진다>2. 클래스는 단 한개의 책임을 가진다<a hidden class=anchor aria-hidden=true href=#2-클래스는-단-한개의-책임을-가진다>#</a></h3><p>저자는 응집도를 잘못 이해하고 있었다.
<strong>여러개의 연관된 관심을 가진 메서드들을 묶어</strong> 하나의 클래스로 만들고 이게 높은 응집도지 ㅋㅋ 하는 어리석음을 반복하고 있었다.</p><p>객체지향 설계원칙인 SOLID중 이는 SRP (Single Responsibility) 단일 책임 원칙에 해당된다.</p><p>흔히 말하는 <code>GOD</code> 클래스들은 다음과 같다.
<code>XXXService, XXXClient, XXXHandler, XXXWorker</code></p><p>필자 또한 그러하였고 서비스안에 조금이라도 관심이 같다고 판단하면 무수히 많은 피쳐들을 남발하여 추가하였다. 이는 코드 가독성과 유지보수의 이점을 버리는 지름길이라 생각한다.</p><p>가령 아래와 같은 피쳐를 만들어야 한다.</p><blockquote><p>ex. 회원 로그를 txt 파일로 작성하는 피쳐를 만드시오</p></blockquote><p>[Service]</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserService</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>write_log_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user_id</span><span class=p>:</span><span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></span></code></pre></div><p>[단일책임]</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserLogWriter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>:</span><span class=n>User</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    	<span class=bp>self</span><span class=o>.</span><span class=n>user</span> <span class=o>=</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>	<span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></span></code></pre></div><p>하나의 예시에 불과하지만 서비스들로 구성한 피쳐들이 쌓이면 <strong>가독성</strong>적이나 특히 <strong>유닛테스트</strong>에서 큰 골치를 겪을 것이다.</p><p>또한 분산된 메서드들을 조합하는 방식에서 최대한 <code>Pythonic</code>하고 <code>OOP</code>를 따르기 위해 FastAPI의 라우터 또한 손을 보게 되었다.</p><p>굳이 싶긴 하겠지만 시간이 된다면 클래스화하여 컨테이너로 관리하고 싶었고 상속을 통해 보일러플레이트 코드를 최소화하고자 모두 클래스로!! 바꾸게 되었다</p><blockquote><p>ex.
[BaseController]
<img loading=lazy src=https://velog.velcdn.com/images/wjddn3711/post/4d9c36e2-df6e-4a05-907f-560c32867a79/image.png>
[HelloController]
<img loading=lazy src=https://velog.velcdn.com/images/wjddn3711/post/b145dc9d-cd1d-4738-a37d-d49b4eb96282/image.png></p></blockquote><hr><h3 id=3-비즈니스-레이어-별로-패키지를-구성한다>3. 비즈니스 레이어 별로 패키지를 구성한다<a hidden class=anchor aria-hidden=true href=#3-비즈니스-레이어-별로-패키지를-구성한다>#</a></h3><p>간단히 말하자면 <code>User</code>를 도메인으로 가지면서 이에 대한 간단한 CRUD를 가진 애플리케이션을 구성한다고 하였을 경우. 아래와 같이 구성할 수 있다.</p><pre tabindex=0><code>fastapi-project
├── app
│   ├── user_manager (비즈니스 레이어)
│   │   ├── user_getter.py
│   │   ├── user_updater.py
│   │   ├── user_creator.py
│   │   ├── enums.py  # enums
│   │   ├── models.py  # pydantic models
│   │   ├── entities.py  # pydantic models
│   │   ├── user_database.py 
│   │   ├── dependencies.py
│   │   ├── constants.py
│   │   ├── exceptions.py
│   │   └── utils.py
</code></pre><p>가령 DB로 부터 User 엔티티를 얻고자 한다면 <code>UserGetter.get()</code> 과 같이 직관적이게 해당 메서드가 무엇을 리턴하는지 유추할 수 있다.</p><p><code>Facade Pattern</code>을 적용하여 이들을 조합하는 하나의 <code>Manager</code> 레벨이 증가한다고 하더라도 이는 동일하게 적용 될 수 있다.</p><blockquote><p><em><strong>models의 클래스 이름이 같을 수 있지 않소?</strong></em>
네, 물론입니다.
특히나 엔티티와 DTO의 네이밍은 겹칠 수 밖에 없죠
그렇기에 naming space를 사용하여 구분 합니다
ex.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>app.user_manager.entities</span> <span class=k>as</span> <span class=nn>entity</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>app.user_manager.models</span> <span class=k>as</span> <span class=nn>dto</span>
</span></span><span class=line><span class=cl><span class=n>user_dto</span> <span class=o>=</span> <span class=n>dto</span><span class=o>.</span><span class=n>User</span>
</span></span><span class=line><span class=cl><span class=n>user_entity</span> <span class=o>=</span> <span class=n>entity</span><span class=o>.</span><span class=n>User</span>
</span></span></code></pre></div><hr><p>구현보다 중요한 것이 <strong>설계</strong>이다.
구현 레벨의 설계도 중요하며 이러한 명확한 Convention이 있어야 통일된 Class Diagram과 Sequence Diagram, Module Diagram을 적립 할 수 있을 것이다</p><p>해당 컨벤션이 정답이라고 결코 말할 수 없다.
그냥 이러한 컨벤션을 사용할 수도 있겠구나~ 라고 생각하면 좋을 것 같다</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/ko/tags/python/>Python</a></li><li><a href=https://dingyu.dev/ko/tags/convention/>Convention</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/ko/posts/redis-transaction/><span class=title>« 이전 페이지</span><br><span>[DB] Redis Transaction</span>
</a><a class=next href=https://dingyu.dev/ko/posts/crawling-selenium-solver/><span class=title>다음 페이지 »</span><br><span>[Crawler] Recaptcha Solver</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/ko/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[DX] 사내 커피 챗 슬랙 봇 개발기 | Ding's Coding Forge</title>
<meta name=keywords content="slack-bot,coffee-chat"><meta name=description content="Developers often work alone, deeply diving into specific techniques. However, as members of a company, we need a space to discuss and brainstorm together. Inspired by the spirit of Ubuntu, I created my own Slack app Slack Bolt Coffee Chat, Coffee Pal"><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/posts/coffee-pal/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/coffee-pal/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/coffee-pal/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/posts/coffee-pal/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[DX] 사내 커피 챗 슬랙 봇 개발기"><meta property="og:description" content="Developers often work alone, deeply diving into specific techniques. However, as members of a company, we need a space to discuss and brainstorm together. Inspired by the spirit of Ubuntu, I created my own Slack app Slack Bolt Coffee Chat, Coffee Pal"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-26T00:00:00+00:00"><meta property="article:tag" content="Slack-Bot"><meta property="article:tag" content="Coffee-Chat"><meta property="og:image" content="https://dingyu.dev/posts/coffee-pal/img/slack.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/posts/coffee-pal/img/slack.png"><meta name=twitter:title content="[DX] 사내 커피 챗 슬랙 봇 개발기"><meta name=twitter:description content="Developers often work alone, deeply diving into specific techniques. However, as members of a company, we need a space to discuss and brainstorm together. Inspired by the spirit of Ubuntu, I created my own Slack app Slack Bolt Coffee Chat, Coffee Pal"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/posts/"},{"@type":"ListItem","position":2,"name":"[DX] 사내 커피 챗 슬랙 봇 개발기","item":"https://dingyu.dev/posts/coffee-pal/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[DX] 사내 커피 챗 슬랙 봇 개발기","name":"[DX] 사내 커피 챗 슬랙 봇 개발기","description":"Developers often work alone, deeply diving into specific techniques. However, as members of a company, we need a space to discuss and brainstorm together. Inspired by the spirit of Ubuntu, I created my own Slack app Slack Bolt Coffee Chat, Coffee Pal","keywords":["slack-bot","coffee-chat"],"articleBody":" 소스 코드 : https://github.com/dings-things/coffee_pal\n목적 일을 하는 것에서 그치는 것이 아닌, 일을 잘 하고 싶은 조직에서 좋은 문화를 구성하는 것은 일의 생산성이나 품질에도 여러 이점을 가져온다\n필자가 개발하고자 하는 “CoffeePal\"은 문제에 막혀 길을 잃어버린 사람이나 소소한 스몰 토크로 일에도 능률을 키울 수 있는 그러한 앱을 만들 고자 커피 친구라는 의미에서 커피팔을 기획하게 되었다\n개발에 앞서… 먼저 사내 커뮤니케이션 툴인 Slack에서 상호작용을 통해, 쉽고 빠르게 커피 친구를 매칭해줘야 하는 요구사항이 있다\n이에 앞서 간단하게 Slack Workflow를 통하여, 전반적인 흐름을 파악해 본다\nTrigger Point 생성 테스트 용이기 때문에, Trigger는 :커피: 이모지로 반응하였을 때 워크플로가 실행 되도록 한다\n활성화 하기 반응한 메시지를 전송한 사용자에게 메시지를 보내어, 커피팔 매칭을 시작할 지 여부를 확인한다\n양식에서 정보 수집 개인화된 서비스를 위해 MBTI, 생년월일을 입력 받는다. 해당 데이터의 기입은 Optional 하게 만든다\n대상, 일시, 주제를 지정한다 커피팔 대상과 커피 일정, 그리고 전반적인 주제를 사전에 정의한다.\n커피팔 대상에게 초대 메시지 보내기 앞서 지정한 데이터를 통해 커피팔에게 간략하게 초대 메시지를 보낸다\n개인적으로 Slack 워크플로를 처음 사용해 보았는데, UI가 깔끔하고 사용성이 괜찮음을 느꼈다\n다만, 사용자와 “상호작용\"이라기 보다는, 일방적인 소통에 가깝기 때문에 slack app으로 확장 해보도록 한다\n먹고 싶지 않은 음식을 억지로 먹여주는 느낌… 이랄까요?\n요구사항 미리 저장된 데이터를 기반으로 사용자 기반의 매칭을 할 수 있어야 한다\n개인정보 입력 시, 매칭 시스템 Trigger App을 사용한 상호작용을 위해 컴퓨팅 리소스를 확보한다\n사내 서버 방화벽 관리 어려움 소켓 통신을 통한 빠른 응답 AWS Lambda 프리티어 기준 무료 서버리스 AWS API GW와 연계 가능 프리티어 종료 후, 유지 비용 고려 사용자에게 한눈에 봐도 알 수 있는 UI 제공\nSlack Block kit 활용 구축하기 Lambda로 구축하기 Slack APP 생성 Lambda 설정 Socket Mode 설정 Slack APP 생성 1. App 생성하기 slack API에서 App 생성하기 Slack APP 생성 2. From scratch를 클릭 Slack APP 생성 3. 앱 workspace와 이름 지정하기 Slack APP 생성 4. 유저 상호작용을 위한 봇 설정 Slack APP 생성 5. 이벤트 활성화 Lambda 설정 1. Lambda 페이지에서 함수 생성하기 Lambda 설정 2. 함수 설정, 런타임 및 아키텍처 설정 Lambda 설정 3. API Gateway 설정 API Gateway는 HTTP 요청을 Lambda 함수로 라우팅 할 수 있는 매우 유용한 트리거입니다. Slack Events API와 Lambda를 연동하기 위해서는 API Gateway를 통한 설정이 필요합니다.\n라고 생각하던 와중… 서버가 이미 있다면 굳이 람다로 구현을 해야하는가? 이미 있는 서버를 안쓰는 것이 더 낭비가 아닌가? 🤔 고민에 빠졌습니다\n서버는 남는 개발 서버를 활용하여 처리를 하고 소켓 모드로 일괄 처리하는 방안을 생각하게 되었습니다\nSocket Mode 설정 소켓 모드란? 소켓 모드를 켜면 이러한 페이로드를 공개 HTTP 앤드포인트인 요청 URL로 보내는 대신 WebSocket 연결을 통해 앱의 상호 작용과 이벤트를 라우팅합니다. 앤드 포인트를 사용하지 않음으로서 여러 요청에 대한 보안적인 위협을 피할 수 있습니다. 또한 여러 Event에 대해 일일이 구독을 하지 않아도 됩니다\n1. 애플리케이션 전역 토큰 생성 전역 토큰에 권한을 부여 → 서버 내에서 권한을 사용하여 슬랙 제어 2. 토큰의 Scope 지정 channels:read : 채널의 사용자 정보 취득 chat:write : 채널에서 쓰기 권한 chat:write.public : 채널에 invite 되어 있지 않아도 쓰기 권한 groups:read : private 채널 정보 취득 groups:write : private 채널에 쓰기 권한 im:write : DM 발송 권한 mpim:write : group DM 발송 권한 reminders:write : 리마인더 설정 권한 개발 Slack Bolt Slack 애플리케이션을 개발하기 위한 프레임워크 주로 Node.js, Python, JavaScript와 같은 언어로 작성되었으며, Slack 플랫폼과 통합된 애플리케이션을 쉽게 만들 수 있도록 도와줍니다.\n굳이…? 싶지만…\n안쓰면 불필요한 작업이 너무 많아집니다. 이는 곧 낮은 생산 속도, 유지 보수도 힘들어지죠\n쓰지 않을 때 from slack_sdk import WebClient from slack_sdk.errors import SlackApiError import os import json import base64 import urllib.parse def lambda_handler(event, context): bot_token = os.getenv('BOT_KEY') # 토큰으로 인증 client = WebClient(token=bot_token) # Base64 인코딩 여부 확인 및 디코딩 if event.get('isBase64Encoded', False): try: # Base64 인코딩된 본문을 디코딩하여 문자열로 변환 decoded_body = base64.b64decode(event['body']).decode('utf-8') event_body = urllib.parse.unquote_plus(decoded_body)[8:] except Exception as e: print(f\"Error decoding base64 body: {e}\") return { 'statusCode': 400, 'body': json.dumps({'message': 'Invalid base64 encoded body'}) } ele: event_body = event['body'] print(event_body) # 디코딩된 본문을 JSON으로 파싱 try: event_data = json.loads(event_body) except json.JSONDecodeError: print(\"JSONDecodeError occurred. The body may not be in valid JSON format.\") return { 'statusCode': 400, 'body': json.dumps({'message': 'Invalid request body'}) } # Event 타입 확인 event_type = event_data.get('event', {}).get('type') # Event 타입에 따라 분기로 처리 쓸 때 app = App(token=settings.SLACK_BOT_TOKEN) logger = logging.getLogger(__name__) # app_home_opened 이벤트 핸들러 등록 @app.event(\"app_home_opened\") def handle_app_home_opened( event: Union[ str, Pattern, Dict[str, Optional[Union[str, Sequence[Optional[Union[str, Pattern]]]]]], ], client: WebClient = None, ) -\u003e SlackResponse: ... # 버튼 액션 핸들러 등록 @app.action(\"suggest_coffee_chat_button\") def handle_random_coffee_chat_button( ack, body, client: WebClient = None ) -\u003e SlackResponse: ... 특정 이벤트 / 액션 / 뷰 를 디버깅 할 때에 Bolt를 활용하면 인증, event, action에 따른 분기 처리, 미들웨어 설정 등등…\n서비스 로직을 수행하기전 거쳐야 했던 중복되는 과정들을 생략하고 서비스 로직에 집중할 수 있습니다.\n유지보수 ↑ 가독성 ↑ Bolt에서 제공되는 기능 중 크게 5가지를 사용하게 됩니다.\nmiddleware 앱 전반의 로깅 및 인증 관리 action 버튼 클릭, Select 메뉴 등의 상호작용 시 발생 view 모달과 같은 복잡한 인터페이스를 생성 및 관리 event Slack 워크스페이스 내에서 발생하는 다양한 이벤트. 가령 채널에 참가 / 사용자의 메시지 전송 등등 Block Kit 슬랙 앱 개발의 꽃은 역시 Block Kit이라 말할 수 있습니다. 각 화살표는 Block을 나타내며 type에 따라 구분되는데 이를 Stacking 하여 하나의 View를 형성합니다.\nex.\nHOME_OPENED = { \"type\": \"home\", \"blocks\": [ ... ], } HOME 구성 요소 Section 섹션을 활용하여 직관적인 UI로 사용자 경험을 최적화 합니다\n가로 섹션 세로 섹션 Input Slack API는 Restful API 답게 Stateless (무상태성)을 띕니다. 각 요청이 독립적이며, 서버가 클라이언트의 이전 요청에 대한 정보를 유지하지 않는것이죠\nInput 없이는 유저의 이전 View에서의 상태를 알 수 없기 때문에 상호작용이 불가합니다. 랜덤 커피챗을 예로 들어 보겠습니다 서버가 만약 순간적인 단절이 생겼을 때에도 다시 요청 시, 이전 Input 값을 토대로 무상태성 요청을 보낼 수 있어\n안정성이 보장됩니다\n개선 사항 Slack DataStore를 이용한 유저의 상태 값 저장 TTL을 지정하여 예약된 커피챗 일정의 조회 / 수정 / 삭제 기능 인사정보를 조회하여 나만의 맞춤형 커피팔 선정 인사 API 권한을 얻어 직급 / 나이 / 직군 별 맞춤형 커피팔을 추첨하는 기능 UI 개선 딱 봐도 이거네~ 누구나 알기 쉽게 사용자 편의성을 고려한 View 구성 CI/CD 및 인프라 구성 허락을 구한다면.. 별도 인프라로 full time 사용가능한 앱 구성 CI CD 파이프라인으로 누구나 기여하여 새로운 기능을 추가하도록 오픈소스화!! 마치며 개발자로 살아오며 “우분투” 정신에 깊게 공감하고 있었습니다\n‘우리가 함께 있기에 내가 있다(I am because you are)’\n우리가 함께할 수 있는 환경을 구성하는 것도 중요하다 생각됩니다. 모든 이가 소통에 두려움을 느끼지 않고 “함께\"가 되었으면 하는 마음에\n커피팔 을 만들게 되었습니다 기술적인 어려움에 부딪히거나, 보다 긴밀한 협업을 위해 아이스 브레이킹이 필요하시다면 여러분도 슬랙봇을 만들어 보세요 :)\n","wordCount":"1034","inLanguage":"ko","image":"https://dingyu.dev/posts/coffee-pal/img/slack.png","datePublished":"2024-10-26T00:00:00Z","dateModified":"2024-10-26T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/posts/coffee-pal/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=번역 type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=en href=https://dingyu.dev/en/ title=English aria-label=English>English</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/about/ title=소개><span>소개</span></a></li><li><a href=https://dingyu.dev/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://dingyu.dev/tags/ title=태그><span>태그</span></a></li><li><a href=https://dingyu.dev/archives/ title=아카이브><span>아카이브</span></a></li><li><a href=https://dingyu.dev/search/ title="검색 (Alt + /)" accesskey=/><span>검색</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/>홈</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[DX] 사내 커피 챗 슬랙 봇 개발기</h1><div class=post-description>Developers often work alone, deeply diving into specific techniques. However, as members of a company, we need a space to discuss and brainstorm together. Inspired by the spirit of Ubuntu, I created my own Slack app Slack Bolt Coffee Chat, Coffee Pal</div><div class=post-meta><span title='2024-10-26 00:00:00 +0000 UTC'>10월 26, 2024</span>&nbsp;·&nbsp;5 분&nbsp;·&nbsp;1034 단어&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;번역:<ul class=i18n_list><li><a href=https://dingyu.dev/en/posts/coffee-pal/>En</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/coffee-pal/index.ko.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/slack.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><li><a href=#%eb%aa%a9%ec%a0%81 aria-label=목적>목적</a></li><li><a href=#%ea%b0%9c%eb%b0%9c%ec%97%90-%ec%95%9e%ec%84%9c aria-label="개발에 앞서&mldr;">개발에 앞서&mldr;</a></li><li><a href=#%ec%9a%94%ea%b5%ac%ec%82%ac%ed%95%ad aria-label=요구사항>요구사항</a></li><li><a href=#%ea%b5%ac%ec%b6%95%ed%95%98%ea%b8%b0 aria-label=구축하기>구축하기</a><ul><li><a href=#lambda%eb%a1%9c-%ea%b5%ac%ec%b6%95%ed%95%98%ea%b8%b0 aria-label="Lambda로 구축하기">Lambda로 구축하기</a><ul><li><a href=#slack-app-%ec%83%9d%ec%84%b1-1-app-%ec%83%9d%ec%84%b1%ed%95%98%ea%b8%b0 aria-label="Slack APP 생성 1. App 생성하기">Slack APP 생성 1. App 생성하기</a></li><li><a href=#slack-app-%ec%83%9d%ec%84%b1-2-from-scratch%eb%a5%bc-%ed%81%b4%eb%a6%ad aria-label="Slack APP 생성 2. From scratch를 클릭">Slack APP 생성 2. <code>From scratch</code>를 클릭</a></li><li><a href=#slack-app-%ec%83%9d%ec%84%b1-3-%ec%95%b1-workspace%ec%99%80-%ec%9d%b4%eb%a6%84-%ec%a7%80%ec%a0%95%ed%95%98%ea%b8%b0 aria-label="Slack APP 생성 3. 앱 workspace와 이름 지정하기">Slack APP 생성 3. 앱 workspace와 이름 지정하기</a></li><li><a href=#slack-app-%ec%83%9d%ec%84%b1-4-%ec%9c%a0%ec%a0%80-%ec%83%81%ed%98%b8%ec%9e%91%ec%9a%a9%ec%9d%84-%ec%9c%84%ed%95%9c-%eb%b4%87-%ec%84%a4%ec%a0%95 aria-label="Slack APP 생성 4. 유저 상호작용을 위한 봇 설정">Slack APP 생성 4. 유저 상호작용을 위한 봇 설정</a></li><li><a href=#slack-app-%ec%83%9d%ec%84%b1-5-%ec%9d%b4%eb%b2%a4%ed%8a%b8-%ed%99%9c%ec%84%b1%ed%99%94 aria-label="Slack APP 생성 5. 이벤트 활성화">Slack APP 생성 5. 이벤트 활성화</a></li><li><a href=#lambda-%ec%84%a4%ec%a0%95-1-lambda-%ed%8e%98%ec%9d%b4%ec%a7%80%ec%97%90%ec%84%9c-%ed%95%a8%ec%88%98-%ec%83%9d%ec%84%b1%ed%95%98%ea%b8%b0 aria-label="Lambda 설정 1. Lambda 페이지에서 함수 생성하기">Lambda 설정 1. <a href="https://ap-northeast-2.console.aws.amazon.com/lambda/home?region=ap-northeast-2#/begin">Lambda 페이지</a>에서 함수 생성하기</a></li><li><a href=#lambda-%ec%84%a4%ec%a0%95-2-%ed%95%a8%ec%88%98-%ec%84%a4%ec%a0%95-%eb%9f%b0%ed%83%80%ec%9e%84-%eb%b0%8f-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98-%ec%84%a4%ec%a0%95 aria-label="Lambda 설정 2. 함수 설정, 런타임 및 아키텍처 설정">Lambda 설정 2. 함수 설정, 런타임 및 아키텍처 설정</a></li><li><a href=#lambda-%ec%84%a4%ec%a0%95-3-api-gateway-%ec%84%a4%ec%a0%95 aria-label="Lambda 설정 3. API Gateway 설정">Lambda 설정 3. API Gateway 설정</a></li></ul></li><li><a href=#socket-mode-%ec%84%a4%ec%a0%95 aria-label="Socket Mode 설정">Socket Mode 설정</a><ul><li><a href=#1-%ec%95%a0%ed%94%8c%eb%a6%ac%ec%bc%80%ec%9d%b4%ec%85%98-%ec%a0%84%ec%97%ad-%ed%86%a0%ed%81%b0-%ec%83%9d%ec%84%b1 aria-label="1. 애플리케이션 전역 토큰 생성">1. 애플리케이션 전역 토큰 생성</a></li><li><a href=#2-%ed%86%a0%ed%81%b0%ec%9d%98-scope-%ec%a7%80%ec%a0%95 aria-label="2. 토큰의 Scope 지정">2. 토큰의 Scope 지정</a></li></ul></li><li><a href=#%ea%b0%9c%eb%b0%9c aria-label=개발>개발</a><ul><li><a href=#slack-bolt aria-label="Slack Bolt">Slack Bolt</a><ul><li><a href=#%ec%93%b0%ec%a7%80-%ec%95%8a%ec%9d%84-%eb%95%8c aria-label="쓰지 않을 때">쓰지 않을 때</a></li><li><a href=#%ec%93%b8-%eb%95%8c aria-label="쓸 때">쓸 때</a></li></ul></li><li><a href=#block-kit aria-label="Block Kit">Block Kit</a></li><li><a href=#home-%ea%b5%ac%ec%84%b1-%ec%9a%94%ec%86%8c aria-label="HOME 구성 요소">HOME 구성 요소</a></li><li><a href=#section aria-label=Section>Section</a></li><li><a href=#input aria-label=Input>Input</a></li></ul></li><li><a href=#%ea%b0%9c%ec%84%a0-%ec%82%ac%ed%95%ad aria-label="개선 사항">개선 사항</a></li></ul></li><li><a href=#%eb%a7%88%ec%b9%98%eb%a9%b0 aria-label=마치며>마치며</a><ul><ul><ul><li><a href=#%ec%bb%a4%ed%94%bc%ed%8c%94-%ec%9d%84-%eb%a7%8c%eb%93%a4%ea%b2%8c-%eb%90%98%ec%97%88%ec%8a%b5%eb%8b%88%eb%8b%a4 aria-label="커피팔 을 만들게 되었습니다">커피팔 을 만들게 되었습니다</a></li></ul></ul></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><blockquote><p>소스 코드 : <a href=https://github.com/dings-things/coffee_pal>https://github.com/dings-things/coffee_pal</a></p></blockquote><h1 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h1><hr><p>일을 하는 것에서 그치는 것이 아닌, 일을 잘 하고 싶은 조직에서 좋은 문화를 구성하는 것은 일의 생산성이나 품질에도 여러 이점을 가져온다</p><p>필자가 개발하고자 하는 &ldquo;CoffeePal"은 문제에 막혀 길을 잃어버린 사람이나 소소한 스몰 토크로 일에도 능률을 키울 수 있는 그러한 앱을 만들 고자 <code>커피 친구</code>라는 의미에서 커피팔을 기획하게 되었다</p><h1 id=개발에-앞서>개발에 앞서&mldr;<a hidden class=anchor aria-hidden=true href=#개발에-앞서>#</a></h1><hr><p>먼저 사내 커뮤니케이션 툴인 <code>Slack</code>에서 상호작용을 통해, <strong>쉽고 빠르게</strong> 커피 친구를 매칭해줘야 하는 요구사항이 있다</p><p>이에 앞서 간단하게 <a href=https://slack.com/intl/ko-kr/features/workflow-automation>Slack Workflow</a>를 통하여, 전반적인 흐름을 파악해 본다</p><hr><ol><li><p><strong>Trigger Point 생성</strong>
테스트 용이기 때문에, Trigger는 <code>:커피:</code> 이모지로 반응하였을 때 워크플로가 실행 되도록 한다</p></li><li><p><strong>활성화 하기</strong>
반응한 메시지를 전송한 사용자에게 메시지를 보내어, 커피팔 매칭을 시작할 지 여부를 확인한다</p></li><li><p><strong>양식에서 정보 수집</strong>
개인화된 서비스를 위해 MBTI, 생년월일을 입력 받는다.
해당 데이터의 기입은 Optional 하게 만든다</p></li><li><p><strong>대상, 일시, 주제를 지정한다</strong>
커피팔 대상과 커피 일정, 그리고 전반적인 주제를 사전에 정의한다.</p></li><li><p><strong>커피팔 대상에게 초대 메시지 보내기</strong>
앞서 지정한 데이터를 통해 커피팔에게 간략하게 초대 메시지를 보낸다</p></li></ol><hr><p><img loading=lazy src=/posts/coffee-pal/image.png></p><hr><p><img loading=lazy src=/posts/coffee-pal/image-1.png></p><p>개인적으로 <code>Slack 워크플로</code>를 처음 사용해 보았는데, UI가 깔끔하고 사용성이 괜찮음을 느꼈다</p><p>다만, 사용자와 &ldquo;상호작용"이라기 보다는, 일방적인 소통에 가깝기 때문에 slack app으로 확장 해보도록 한다</p><p>먹고 싶지 않은 음식을 억지로 먹여주는 느낌&mldr; 이랄까요?</p><p><img loading=lazy src=/posts/coffee-pal/image-2.png></p><h1 id=요구사항>요구사항<a hidden class=anchor aria-hidden=true href=#요구사항>#</a></h1><hr><ol><li><p>미리 저장된 데이터를 기반으로 사용자 기반의 매칭을 할 수 있어야 한다</p><ul><li>개인정보 입력 시, 매칭 시스템 Trigger</li></ul></li><li><p>App을 사용한 상호작용을 위해 컴퓨팅 리소스를 확보한다</p><ul><li><input checked disabled type=checkbox> 사내 서버<ul><li>방화벽 관리 어려움</li><li>소켓 통신을 통한 빠른 응답</li></ul></li><li><input disabled type=checkbox> AWS Lambda<ul><li>프리티어 기준 무료</li><li>서버리스</li><li>AWS API GW와 연계 가능</li><li>프리티어 종료 후, 유지 비용 고려</li></ul></li></ul></li><li><p>사용자에게 한눈에 봐도 알 수 있는 UI 제공</p><ul><li><a href=https://app.slack.com/block-kit-builder>Slack Block kit</a> 활용</li></ul></li></ol><h1 id=구축하기>구축하기<a hidden class=anchor aria-hidden=true href=#구축하기>#</a></h1><hr><h2 id=lambda로-구축하기>Lambda로 구축하기<a hidden class=anchor aria-hidden=true href=#lambda로-구축하기>#</a></h2><ul><li>Slack APP 생성</li><li>Lambda 설정</li><li>Socket Mode 설정</li></ul><h3 id=slack-app-생성-1-app-생성하기>Slack APP 생성 1. App 생성하기<a hidden class=anchor aria-hidden=true href=#slack-app-생성-1-app-생성하기>#</a></h3><p><a href=https://api.slack.com/apps>slack API</a>에서 App 생성하기
<img loading=lazy src=/posts/coffee-pal/image-3.png></p><h3 id=slack-app-생성-2-from-scratch를-클릭>Slack APP 생성 2. <code>From scratch</code>를 클릭<a hidden class=anchor aria-hidden=true href=#slack-app-생성-2-from-scratch를-클릭>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-4.png></p><h3 id=slack-app-생성-3-앱-workspace와-이름-지정하기>Slack APP 생성 3. 앱 workspace와 이름 지정하기<a hidden class=anchor aria-hidden=true href=#slack-app-생성-3-앱-workspace와-이름-지정하기>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-5.png></p><h3 id=slack-app-생성-4-유저-상호작용을-위한-봇-설정>Slack APP 생성 4. 유저 상호작용을 위한 봇 설정<a hidden class=anchor aria-hidden=true href=#slack-app-생성-4-유저-상호작용을-위한-봇-설정>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-6.png></p><h3 id=slack-app-생성-5-이벤트-활성화>Slack APP 생성 5. 이벤트 활성화<a hidden class=anchor aria-hidden=true href=#slack-app-생성-5-이벤트-활성화>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-7.png></p><h3 id=lambda-설정-1-lambda-페이지에서-함수-생성하기>Lambda 설정 1. <a href="https://ap-northeast-2.console.aws.amazon.com/lambda/home?region=ap-northeast-2#/begin">Lambda 페이지</a>에서 함수 생성하기<a hidden class=anchor aria-hidden=true href=#lambda-설정-1-lambda-페이지에서-함수-생성하기>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-8.png></p><h3 id=lambda-설정-2-함수-설정-런타임-및-아키텍처-설정>Lambda 설정 2. 함수 설정, 런타임 및 아키텍처 설정<a hidden class=anchor aria-hidden=true href=#lambda-설정-2-함수-설정-런타임-및-아키텍처-설정>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-9.png></p><h3 id=lambda-설정-3-api-gateway-설정>Lambda 설정 3. API Gateway 설정<a hidden class=anchor aria-hidden=true href=#lambda-설정-3-api-gateway-설정>#</a></h3><p>API Gateway는 HTTP 요청을 Lambda 함수로 라우팅 할 수 있는 매우 유용한 트리거입니다. Slack Events API와 Lambda를 연동하기 위해서는 API Gateway를 통한 설정이 필요합니다.</p><p><img loading=lazy src=/posts/coffee-pal/image-10.png></p><p>라고 생각하던 와중&mldr; 서버가 이미 있다면 굳이 람다로 구현을 해야하는가?
이미 있는 서버를 안쓰는 것이 더 낭비가 아닌가? 🤔 고민에 빠졌습니다</p><p>서버는 남는 개발 서버를 활용하여 처리를 하고 소켓 모드로 일괄 처리하는 방안을 생각하게 되었습니다</p><h2 id=socket-mode-설정>Socket Mode 설정<a hidden class=anchor aria-hidden=true href=#socket-mode-설정>#</a></h2><blockquote><p><strong>소켓 모드란?</strong>
소켓 모드를 켜면 이러한 페이로드를 공개 HTTP 앤드포인트인 요청 URL로 보내는 대신 WebSocket 연결을 통해 앱의 상호 작용과 이벤트를 라우팅합니다.
<img loading=lazy src=https://velog.velcdn.com/images/wjddn3711/post/642277c3-713d-427d-9bad-79010dff6847/image.png></p></blockquote><p>앤드 포인트를 사용하지 않음으로서 여러 요청에 대한 보안적인 위협을 피할 수 있습니다.
또한 여러 Event에 대해 일일이 구독을 하지 않아도 됩니다</p><h3 id=1-애플리케이션-전역-토큰-생성>1. 애플리케이션 전역 토큰 생성<a hidden class=anchor aria-hidden=true href=#1-애플리케이션-전역-토큰-생성>#</a></h3><p>전역 토큰에 권한을 부여 → 서버 내에서 권한을 사용하여 슬랙 제어
<img alt=width:500px loading=lazy src=https://velog.velcdn.com/images/wjddn3711/post/bf79d0d7-806b-4b11-8b9c-76c3f5874c98/image.png></p><h3 id=2-토큰의-scope-지정>2. 토큰의 Scope 지정<a hidden class=anchor aria-hidden=true href=#2-토큰의-scope-지정>#</a></h3><p><img alt="bg right 90%" loading=lazy src=https://velog.velcdn.com/images/wjddn3711/post/a561cd66-446b-4f3b-8f8b-e189e9cedbd0/image.png></p><ul><li><code>channels:read</code> : 채널의 사용자 정보 취득</li><li><code>chat:write</code> : 채널에서 쓰기 권한</li><li><code>chat:write.public</code> : 채널에 invite 되어 있지 않아도 쓰기 권한</li><li><code>groups:read</code> : private 채널 정보 취득</li><li><code>groups:write</code> : private 채널에 쓰기 권한</li><li><code>im:write</code> : DM 발송 권한</li><li><code>mpim:write</code> : group DM 발송 권한</li><li><code>reminders:write</code> : 리마인더 설정 권한</li></ul><h2 id=개발>개발<a hidden class=anchor aria-hidden=true href=#개발>#</a></h2><h3 id=slack-bolt>Slack Bolt<a hidden class=anchor aria-hidden=true href=#slack-bolt>#</a></h3><blockquote><p>Slack 애플리케이션을 개발하기 위한 프레임워크
주로 Node.js, Python, JavaScript와 같은 언어로 작성되었으며, Slack 플랫폼과 통합된 애플리케이션을 쉽게 만들 수 있도록 도와줍니다.</p></blockquote><p>굳이&mldr;? 싶지만&mldr;</p><p>안쓰면 불필요한 작업이 너무 많아집니다. 이는 곧 낮은 생산 속도, 유지 보수도 힘들어지죠</p><h4 id=쓰지-않을-때>쓰지 않을 때<a hidden class=anchor aria-hidden=true href=#쓰지-않을-때>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>slack_sdk</span> <span class=kn>import</span> <span class=n>WebClient</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>slack_sdk.errors</span> <span class=kn>import</span> <span class=n>SlackApiError</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>bot_token</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;BOT_KEY&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 토큰으로 인증</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span> <span class=o>=</span> <span class=n>WebClient</span><span class=p>(</span><span class=n>token</span><span class=o>=</span><span class=n>bot_token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># Base64 인코딩 여부 확인 및 디코딩</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;isBase64Encoded&#39;</span><span class=p>,</span> <span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Base64 인코딩된 본문을 디코딩하여 문자열로 변환</span>
</span></span><span class=line><span class=cl>            <span class=n>decoded_body</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;body&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>event_body</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>unquote_plus</span><span class=p>(</span><span class=n>decoded_body</span><span class=p>)[</span><span class=mi>8</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error decoding base64 body: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;statusCode&#39;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid base64 encoded body&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ele</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event_body</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;body&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>event_body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 디코딩된 본문을 JSON으로 파싱</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>event_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>event_body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;JSONDecodeError occurred. The body may not be in valid JSON format.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;statusCode&#39;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;body&#39;</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid request body&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Event 타입 확인</span>
</span></span><span class=line><span class=cl>    <span class=n>event_type</span> <span class=o>=</span> <span class=n>event_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Event 타입에 따라 분기로 처리</span>
</span></span></code></pre></div><hr><h4 id=쓸-때>쓸 때<a hidden class=anchor aria-hidden=true href=#쓸-때>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>App</span><span class=p>(</span><span class=n>token</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>SLACK_BOT_TOKEN</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># app_home_opened 이벤트 핸들러 등록</span>
</span></span><span class=line><span class=cl><span class=nd>@app.event</span><span class=p>(</span><span class=s2>&#34;app_home_opened&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_app_home_opened</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>event</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>Pattern</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Sequence</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Pattern</span><span class=p>]]]]]],</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span><span class=p>:</span> <span class=n>WebClient</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SlackResponse</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 버튼 액션 핸들러 등록</span>
</span></span><span class=line><span class=cl><span class=nd>@app.action</span><span class=p>(</span><span class=s2>&#34;suggest_coffee_chat_button&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handle_random_coffee_chat_button</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ack</span><span class=p>,</span> <span class=n>body</span><span class=p>,</span> <span class=n>client</span><span class=p>:</span> <span class=n>WebClient</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SlackResponse</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span></code></pre></div><p>특정 이벤트 / 액션 / 뷰 를 디버깅 할 때에 Bolt를 활용하면 인증, event, action에 따른 분기 처리, 미들웨어 설정 등등&mldr;</p><p>서비스 로직을 수행하기전 거쳐야 했던 중복되는 과정들을 생략하고 서비스 로직에 집중할 수 있습니다.</p><ul><li>유지보수 ↑</li><li>가독성 ↑</li></ul><p>Bolt에서 제공되는 기능 중 크게 5가지를 사용하게 됩니다.</p><ul><li>middleware<ul><li>앱 전반의 로깅 및 인증 관리</li></ul></li><li>action<ul><li>버튼 클릭, Select 메뉴 등의 상호작용 시 발생</li></ul></li><li>view<ul><li>모달과 같은 복잡한 인터페이스를 생성 및 관리</li></ul></li><li>event<ul><li>Slack 워크스페이스 내에서 발생하는 다양한 이벤트. 가령 채널에 참가 / 사용자의 메시지 전송 등등</li></ul></li></ul><h3 id=block-kit>Block Kit<a hidden class=anchor aria-hidden=true href=#block-kit>#</a></h3><p>슬랙 앱 개발의 꽃은 역시 Block Kit이라 말할 수 있습니다.
<img loading=lazy src=/posts/coffee-pal/image-11.png></p><p>각 화살표는 Block을 나타내며 type에 따라 구분되는데 이를 Stacking 하여 하나의 View를 형성합니다.</p><p>ex.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>HOME_OPENED</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;home&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;blocks&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h3 id=home-구성-요소>HOME 구성 요소<a hidden class=anchor aria-hidden=true href=#home-구성-요소>#</a></h3><p><img loading=lazy src=/posts/coffee-pal/image-12.png></p><h3 id=section>Section<a hidden class=anchor aria-hidden=true href=#section>#</a></h3><p>섹션을 활용하여 직관적인 UI로 사용자 경험을 최적화 합니다</p><p>가로 섹션
<img loading=lazy src=/posts/coffee-pal/image-13.png></p><hr><p>세로 섹션
<img loading=lazy src=/posts/coffee-pal/image-14.png></p><hr><h3 id=input>Input<a hidden class=anchor aria-hidden=true href=#input>#</a></h3><p>Slack API는 Restful API 답게 Stateless (무상태성)을 띕니다.
각 요청이 독립적이며, 서버가 클라이언트의 이전 요청에 대한 정보를 유지하지 않는것이죠</p><p>Input 없이는 유저의 이전 View에서의 상태를 알 수 없기 때문에 상호작용이 불가합니다.
<img loading=lazy src=/posts/coffee-pal/image-15.png>
<img loading=lazy src=/posts/coffee-pal/image-16.png></p><hr><p>랜덤 커피챗을 예로 들어 보겠습니다
<img loading=lazy src=/posts/coffee-pal/image-17.png></p><hr><p>서버가 만약 순간적인 단절이 생겼을 때에도
다시 요청 시, 이전 Input 값을 토대로 무상태성 요청을 보낼 수 있어</p><p><strong>안정성</strong>이 보장됩니다</p><h2 id=개선-사항>개선 사항<a hidden class=anchor aria-hidden=true href=#개선-사항>#</a></h2><hr><ul><li>Slack DataStore를 이용한 유저의 상태 값 저장<ul><li>TTL을 지정하여 예약된 커피챗 일정의 조회 / 수정 / 삭제 기능</li></ul></li><li>인사정보를 조회하여 나만의 맞춤형 커피팔 선정<ul><li>인사 API 권한을 얻어 직급 / 나이 / 직군 별 맞춤형 커피팔을 추첨하는 기능</li></ul></li><li>UI 개선<ul><li>딱 봐도 이거네~ 누구나 알기 쉽게 사용자 편의성을 고려한 View 구성</li></ul></li><li>CI/CD 및 인프라 구성<ul><li>허락을 구한다면.. 별도 인프라로 full time 사용가능한 앱 구성</li><li>CI CD 파이프라인으로 누구나 기여하여 새로운 기능을 추가하도록 오픈소스화!!</li></ul></li></ul><h1 id=마치며>마치며<a hidden class=anchor aria-hidden=true href=#마치며>#</a></h1><hr><p>개발자로 살아오며 “우분투&rdquo; 정신에 깊게 공감하고 있었습니다</p><blockquote><p>&lsquo;우리가 함께 있기에 내가 있다(I am because you are)&rsquo;</p></blockquote><p>우리가 함께할 수 있는 환경을 구성하는 것도 중요하다 생각됩니다.
모든 이가 소통에 두려움을 느끼지 않고 &ldquo;함께"가 되었으면 하는 마음에</p><h4 id=커피팔-을-만들게-되었습니다>커피팔 을 만들게 되었습니다<a hidden class=anchor aria-hidden=true href=#커피팔-을-만들게-되었습니다>#</a></h4><p><img loading=lazy src=/posts/coffee-pal/image-18.png></p><p>기술적인 어려움에 부딪히거나, 보다 긴밀한 협업을 위해 아이스 브레이킹이 필요하시다면 여러분도 슬랙봇을 만들어 보세요 :)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/tags/slack-bot/>Slack-Bot</a></li><li><a href=https://dingyu.dev/tags/coffee-chat/>Coffee-Chat</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/posts/worker-pool-async/><span class=title>« 이전 페이지</span><br><span>[Go] Worker Pool과 비동기 작업의 성능 프로파일링</span>
</a><a class=next href=https://dingyu.dev/posts/go-pprof-gc/><span class=title>다음 페이지 »</span><br><span>[Go] pprof로 GC 튜닝하기</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
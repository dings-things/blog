<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[DX] 컨플루언스 자동화로 반복 작업 취소화하기 | Ding's Coding Forge</title>
<meta name=keywords content="python,confluence,scrum,agile,sprint"><meta name=description content="조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다. 매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다. 누군가가 담당하는 작업이 아니었기에 자동화의 책임을 갖지 않았다. 비록 몇분의 시간이지만 우리의 시간은 소중하기에 팀을 위해 반복적인 배치로 수행되는 작업을 위한 스케쥴러 프로젝트를 사이드로 개발해보았다."><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/posts/confluence-automation/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/confluence-automation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/posts/confluence-automation/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[DX] 컨플루언스 자동화로 반복 작업 취소화하기"><meta property="og:description" content="조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다. 매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다. 누군가가 담당하는 작업이 아니었기에 자동화의 책임을 갖지 않았다. 비록 몇분의 시간이지만 우리의 시간은 소중하기에 팀을 위해 반복적인 배치로 수행되는 작업을 위한 스케쥴러 프로젝트를 사이드로 개발해보았다."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-11T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-11T00:00:00+00:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Confluence"><meta property="article:tag" content="Scrum"><meta property="article:tag" content="Agile"><meta property="article:tag" content="Sprint"><meta property="og:image" content="https://dingyu.dev/posts/confluence-automation/img/confluence.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/posts/confluence-automation/img/confluence.png"><meta name=twitter:title content="[DX] 컨플루언스 자동화로 반복 작업 취소화하기"><meta name=twitter:description content="조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다. 매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다. 누군가가 담당하는 작업이 아니었기에 자동화의 책임을 갖지 않았다. 비록 몇분의 시간이지만 우리의 시간은 소중하기에 팀을 위해 반복적인 배치로 수행되는 작업을 위한 스케쥴러 프로젝트를 사이드로 개발해보았다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/posts/"},{"@type":"ListItem","position":2,"name":"[DX] 컨플루언스 자동화로 반복 작업 취소화하기","item":"https://dingyu.dev/posts/confluence-automation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[DX] 컨플루언스 자동화로 반복 작업 취소화하기","name":"[DX] 컨플루언스 자동화로 반복 작업 취소화하기","description":"조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다. 매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다. 누군가가 담당하는 작업이 아니었기에 자동화의 책임을 갖지 않았다. 비록 몇분의 시간이지만 우리의 시간은 소중하기에 팀을 위해 반복적인 배치로 수행되는 작업을 위한 스케쥴러 프로젝트를 사이드로 개발해보았다.","keywords":["python","confluence","scrum","agile","sprint"],"articleBody":"배경 조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다. 매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다. 문제점은 다음과 같다\n자동화의 책임 소재 부재 개발자의 불필요한 업무 시간 낭비 누가 생성할 것이냐… 눈치게임 시작! 목마른 자가 우물을 판다.. 우리의 시간은 소중하니까 ⭐ 팀을 위해 자동화를 시작해보자\nUsecase 일정한 형식을 가진 문서를 동일한 공간에 주기적으로 생성 코드 기반으로 문서 작업을 수행하고 싶을 때 요구사항 같은 공간 내 하위에 매주 목요일 날짜로 주간 보고서를 생성한다 신규 보고서는 이전 보고서의 내용을 복사+붙여넣기 한다 신규 보고서가 완료되면 웹훅을 통해 슬랙으로 주간 보고서 작성을 알림한다 작업 시작 컨플루언스에서 회사마다 워크스페이스가 다를 수 있어 링크가 아닌 이미지로 설명합니다\n1. 컨플루언스 개인용 액세스 토큰 발급하기 컨플루언스 우측 상단의 프로필 클릭 → 프로파일 클릭 환경설정 → 개인용 액세스 토큰 → 토큰 만들기 클릭 토큰 이름 지정 → 영구 사용 시 자동 만료 체크 해제 → 만들기 클릭 생성된 액세스 토큰 확인 → 복사 버튼 클릭 → 별도 파일로 저장 ※ 한번 생성한 뒤에는 다시 확인이 불가하기 때문에 별도 파일로 저장합니다\n2. 컨플루언스 API 활용하기 소스코드를 참고해주세요. ContentAdder\n항목 설명 Endpoint /rest/api/content HTTP Method POST 기능 ContentDTO를 기반으로 새 페이지 생성 리턴 값 생성된 페이지의 ID (str) ContentGetter\n항목 설명 Endpoint /rest/api/content/{page_id}?expand=body.storage,space,ancestors HTTP Method GET 기능 특정 페이지 ID로 페이지 정보를 조회 리턴 값 ContentDTO 객체 또는 None PageGetter\n메서드명 Endpoint 설명 리턴 타입 get_latest() /rest/api/content/{parent_page_id}/child/page?expand=version 하위 페이지 중 가장 최신 페이지 1개 조회 Optional[PageDTO] get() 동일 하위 페이지 전체 목록 조회 List[PageDTO] PageDTO중 version.when 필드를 사용하여 업데이트 일자를 기준으로 가장 최신의 페이지를 반환한다 createdate, updatedate가 구분되지 않아 업데이트를 기준으로 정의된다 ConfluenceAPI 메서드명 설명 내부 사용 get() HTTP GET 요청 수행 ContentGetter, PageGetter post() HTTP POST 요청 수행 ContentAdder 각 클래스는 ConfluenceAPI에 의존하여 실제 HTTP 요청을 위임하며, DTO 객체(ContentDTO, PageDTO)를 사용하여 데이터 구조를 명확히 유지합니다.\nWebhookSender 항목 설명 주요 목적 외부 시스템으로 Webhook 이벤트 전송 의존 객체 WebhookClient, WebhookSenderInterface, logging.Logger 초기화 인자 webhook_url: str, logger: logging.Logger 내부 필드 self.client: WebhookClient, self.logger: 로깅 객체 메서드 send_webhook(dto: WebhookSenderInterface) -\u003e WebhookResponse 메서드 설명 전달된 DTO 객체를 JSON 변환 후 Webhook POST 요청 실행 예외 처리 전송 실패 시 로그에 예외 내용 기록 (logger.exception) 리턴 값 WebhookResponse (전송 성공 응답 객체, 실패 시 예외 기록) 스크립트 결과를 웹훅으로 전송하기 위한 Class Slack Webhook 의존성을 가지며 Slack 워크플로와 연동하여 추가 구현 가능 추상화된 DTO를 통해 스크립트 별로 느슨한 결과 반환 3. 스크립트 및 workflow 구성하기 지난 주에 작성했던 내용을 복사하여 이번 주 제목으로 새롭게 작성한다\nStep 1: Root 페이지로부터 가장 최신의 페이지 ID 가져오기 RootPage란? 디렉토리 구조 중, 생성되는 페이지의 부모 디렉토리를 뜻한다\nex.\n[보고] └── 주간 보고 ├── 주간보고 | 2024 ├── 주간보고 | 2025 1분기 ├── 20250403_MY팀 주간 보고 ├── 20250410_MY팀 주간 보고 ├── 20250417_MY팀 주간 보고 ├── 20250424_MY팀 주간 보고 ├── 20250508_MY팀 주간 보고 ├── 20250515_MY팀 주간 보고 ├── 20250522_MY팀 주간 보고 ├── 20250529_MY팀 주간 보고 └── 20250605_MY팀 주간 보고 부모 디렉토리 구조 중 ROOT_PAGE_ID를 .env로 따로 저장한다 https://{CONFLUENCE_BASE_URL}/pages/viewpage.action?pageId={ROOT_PAGE_ID} 조직별로 CONFLUENCE_BASE_URL이 달라질 수 있어 이 또한 .env로 관리한다 from pydantic_settings import BaseSettings from dotenv import load_dotenv load_dotenv() class Settings(BaseSettings): CONFLUENCE_API_TOKEN: str ROOT_PAGE_ID: str CONFLUENCE_BASE_URL: str WEBHOOK_URL: str = \"\" class Config: env_file = \".env\" env_file_encoding = \"utf-8\" settings = Settings() .env 파일을 기준으로 Settings 데이터 클래스를 정의한다\nconfig에 필요한 환경변수는 다음과 같다\nCONFLUENCE_API_TOKEN : 앞서 발급한 컨플루언스 토큰 ROOT_PAGE_ID : 타겟 부모 페이지 ID CONFLUENCE_BASE_URL : 조직의 컨플루언스 URL WEBHOOK_URL : 웹훅 사용 시, 웹훅 URL Step 2: 지난주 제목 불러오기 ※ Latest 기준이 업데이트 일자를 기준으로 정렬되기 때문에, 간헐적으로 이전 주가 아닌 다른 페이지가 생성되거나 수정될 경우 문제가 발생하였다\n이번 주 목요일 제목을 가진 페이지 여부를 확인 만약 이미 존재한다면 return 저번 주 목요일 제목을 가진 페이지 여부를 확인 만약 존재하지 않는다면 Exception def get_thursday_title(offset_weeks: int = 0) -\u003e str: today = datetime.now() monday = today - timedelta(days=today.weekday()) thursday = monday + timedelta(days=3, weeks=offset_weeks) return TITLE_FORMAT.format(timestr=thursday.strftime(TIMESTR_FORMAT)) def find_page_by_title(pages: List[PageDTO], title: str): return next((page for page in pages if page.title == title), None) def generate_report() -\u003e WeeklyReportDTO: pages = page_getter.get(settings.ROOT_PAGE_ID) if not pages: return Exception(\"루트 페이지 하위를 불러오기에 실패하였습니다.\") this_week_title = get_thursday_title(0) last_week_title = get_thursday_title(-1) this_week_page = find_page_by_title(pages, this_week_title) # 이미 이번주 주간 보고가 있는 경우, 웹훅만 전송 if this_week_page: report_link = CONFLUENCE_BASE_PAGE_URL.format( base_url=settings.CONFLUENCE_BASE_URL, page_id=this_week_page.id ) return WeeklyReportDTO(report_link=report_link) last_week_page = find_page_by_title(pages, last_week_title) # 지난주 주간 보고가 없는 경우, 에러 if not last_week_page: return Exception(\"지난 주 목요일 제목의 페이지가 존재하지 않습니다.\") Step 3: 지난 주 내용을 불러와 새롭게 페이지 생성 마지막 주 id를 기준으로 컨텐츠를 불러온다 컨텐츠 불러오기에 실패 시 Exception 저번주 내용으로 이번주 제목의 새로운 페이지 생성한다. 페이지 생성 실패 시 Exception def generate_report() -\u003e WeeklyReportDTO: ... # 지난 주 페이지 내용 가져오기 base_content = content_getter.get(last_week_page.id) if not base_content: return Exception(\"기준 페이지의 내용을 가져올 수 없습니다.\") # 이번 주 제목으로 새 페이지 생성하기 base_content.title = this_week_title new_page_id = content_adder.post(base_content) if new_page_id: report_link = CONFLUENCE_BASE_PAGE_URL.format( base_url=settings.CONFLUENCE_BASE_URL, page_id=new_page_id ) return WeeklyReportDTO(report_link=report_link) else: return Exception(\"새 페이지 생성에 실패했습니다.\") Step 4: 웹훅 연동하기 Slack에서 채널 생성하기 스크립트 결과값을 webhook으로 전송하기\nclass WebhookDTOInterface(ABC): @abstractmethod def to_json(self) -\u003e dict: \"\"\"JSON 형식으로 변환하는 메서드\"\"\" pass class WeeklyReportDTO(WebhookDTOInterface): def __init__(self, report_link: str): self.report_link = report_link def to_json(self) -\u003e dict: # JSON 문자열 반환 return {\"report_link\": self.report_link} ... if __name__ == \"__main__\": # DI 구성 ... result: WeeklyReportDTO = None try: result = generate_report() logger.info(f\"주간 보고 생성 완료 : {result.report_link}\") except Exception as e: logger.error(f\"스크립트 실행 중 예외가 발생했습니다: {e}\", exc_info=True) try: webhook_sender.send_webhook(dto=result) logger.info(\"웹훅 전송 성공\") except Exception as e: logger.error(f\"웹훅 전송 중 예외가 발생했습니다: {e}\", exc_info=True) 슬랙 채널에서 워크플로 만들기\n채널 좌측 상단의 “+” 클릭 후, 워크플로 클릭 워크플로 시작… 에서 웹후크로 시작 선택 데이터 변수에 report_link 추가 및 계속 채널에 메시지 보내기 → 채널 선택 → 메시지 포맷 지정하기 → 버튼 추가하여 링크 삽입하기 git workflow 구성하기 개략적인 CICD 마지막 TAG를 기준으로 버전 관리 main 브랜치 머지될 경우, 스크립트를 포함한 docker image 생성 후 container registry에 등록 gitlab cron job을 통해 지정한 시간대에 주기적으로 스크립트가 실행되도록 지정 사소하고 어렵지 않은 일이지만 팀에 기여하는 방법은 어디에서나 찾아볼 수 있습니다.\n엔지니어로서… 작은것에서 부터 모두가 편해질 수 있는 서비스를 만들어 보람을 찾아보는건 어떨가요?\nREFS github code ","wordCount":"988","inLanguage":"ko","image":"https://dingyu.dev/posts/confluence-automation/img/confluence.png","datePublished":"2025-06-11T00:00:00Z","dateModified":"2025-06-11T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/posts/confluence-automation/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=번역 type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=en href=https://dingyu.dev/en/ title=English aria-label=English>English</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/ko/about/ title=소개><span>소개</span></a></li><li><a href=https://dingyu.dev/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://dingyu.dev/tags/ title=태그><span>태그</span></a></li><li><a href=https://dingyu.dev/ko/archives/ title=아카이브><span>아카이브</span></a></li><li><a href=https://dingyu.dev/ko/search/ title="검색 (Alt + /)" accesskey=/><span>검색</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/>홈</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[DX] 컨플루언스 자동화로 반복 작업 취소화하기</h1><div class=post-description>조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다. 매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다. 누군가가 담당하는 작업이 아니었기에 자동화의 책임을 갖지 않았다. 비록 몇분의 시간이지만 우리의 시간은 소중하기에 팀을 위해 반복적인 배치로 수행되는 작업을 위한 스케쥴러 프로젝트를 사이드로 개발해보았다.</div><div class=post-meta><span title='2025-06-11 00:00:00 +0000 UTC'>6월 11, 2025</span>&nbsp;·&nbsp;5 분&nbsp;·&nbsp;988 단어&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/confluence-automation/index.ko.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/confluence.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><li><a href=#%eb%b0%b0%ea%b2%bd aria-label=배경>배경</a></li><li><a href=#usecase aria-label=Usecase>Usecase</a></li><li><a href=#%ec%9a%94%ea%b5%ac%ec%82%ac%ed%95%ad aria-label=요구사항>요구사항</a></li><li><a href=#%ec%9e%91%ec%97%85-%ec%8b%9c%ec%9e%91 aria-label="작업 시작">작업 시작</a><ul><li><a href=#1-%ec%bb%a8%ed%94%8c%eb%a3%a8%ec%96%b8%ec%8a%a4-%ea%b0%9c%ec%9d%b8%ec%9a%a9-%ec%95%a1%ec%84%b8%ec%8a%a4-%ed%86%a0%ed%81%b0-%eb%b0%9c%ea%b8%89%ed%95%98%ea%b8%b0 aria-label="1. 컨플루언스 개인용 액세스 토큰 발급하기">1. 컨플루언스 개인용 액세스 토큰 발급하기</a></li><li><a href=#2-%ec%bb%a8%ed%94%8c%eb%a3%a8%ec%96%b8%ec%8a%a4-api-%ed%99%9c%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="2. 컨플루언스 API 활용하기">2. 컨플루언스 API 활용하기</a></li><li><a href=#3-%ec%8a%a4%ed%81%ac%eb%a6%bd%ed%8a%b8-%eb%b0%8f-workflow-%ea%b5%ac%ec%84%b1%ed%95%98%ea%b8%b0 aria-label="3. 스크립트 및 workflow 구성하기">3. 스크립트 및 workflow 구성하기</a><ul><li><a href=#step-1-root-%ed%8e%98%ec%9d%b4%ec%a7%80%eb%a1%9c%eb%b6%80%ed%84%b0-%ea%b0%80%ec%9e%a5-%ec%b5%9c%ec%8b%a0%ec%9d%98-%ed%8e%98%ec%9d%b4%ec%a7%80-id-%ea%b0%80%ec%a0%b8%ec%98%a4%ea%b8%b0 aria-label="Step 1: Root 페이지로부터 가장 최신의 페이지 ID 가져오기">Step 1: Root 페이지로부터 가장 최신의 페이지 ID 가져오기</a></li><li><a href=#step-2-%ec%a7%80%eb%82%9c%ec%a3%bc-%ec%a0%9c%eb%aa%a9-%eb%b6%88%eb%9f%ac%ec%98%a4%ea%b8%b0 aria-label="Step 2: 지난주 제목 불러오기">Step 2: 지난주 제목 불러오기</a></li><li><a href=#step-3-%ec%a7%80%eb%82%9c-%ec%a3%bc-%eb%82%b4%ec%9a%a9%ec%9d%84-%eb%b6%88%eb%9f%ac%ec%99%80-%ec%83%88%eb%a1%ad%ea%b2%8c-%ed%8e%98%ec%9d%b4%ec%a7%80-%ec%83%9d%ec%84%b1 aria-label="Step 3: 지난 주 내용을 불러와 새롭게 페이지 생성">Step 3: 지난 주 내용을 불러와 새롭게 페이지 생성</a></li><li><a href=#step-4-%ec%9b%b9%ed%9b%85-%ec%97%b0%eb%8f%99%ed%95%98%ea%b8%b0 aria-label="Step 4: 웹훅 연동하기">Step 4: 웹훅 연동하기</a></li></ul></li></ul></li><li><a href=#refs aria-label=REFS>REFS</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=배경>배경<a hidden class=anchor aria-hidden=true href=#배경>#</a></h1><ol><li>조직에서 주간/월간 회의를 통해 성과를 정리하고 그 다음 스프린트에서 해야할 일을 정의하는 시간을 갖는다.</li><li>매번 눈치껏 누군가가 이전 주/달의 보고서를 복사하여 이번 주/달 제목으로 작성하여 본인의 테스크 진행상태를 정리한다.</li></ol><p>문제점은 다음과 같다</p><ul><li>자동화의 책임 소재 부재</li><li>개발자의 불필요한 업무 시간 낭비</li><li>누가 생성할 것이냐&mldr; 눈치게임 시작!</li></ul><p>목마른 자가 우물을 판다.. 우리의 시간은 소중하니까 ⭐ 팀을 위해 자동화를 시작해보자</p><h1 id=usecase>Usecase<a hidden class=anchor aria-hidden=true href=#usecase>#</a></h1><ul><li>일정한 형식을 가진 문서를 동일한 공간에 주기적으로 생성</li><li>코드 기반으로 문서 작업을 수행하고 싶을 때</li></ul><h1 id=요구사항>요구사항<a hidden class=anchor aria-hidden=true href=#요구사항>#</a></h1><ol><li>같은 공간 내 하위에 매주 목요일 날짜로 주간 보고서를 생성한다</li><li>신규 보고서는 이전 보고서의 내용을 복사+붙여넣기 한다</li><li>신규 보고서가 완료되면 웹훅을 통해 슬랙으로 주간 보고서 작성을 알림한다</li></ol><h1 id=작업-시작>작업 시작<a hidden class=anchor aria-hidden=true href=#작업-시작>#</a></h1><blockquote><p>컨플루언스에서 회사마다 워크스페이스가 다를 수 있어 링크가 아닌 이미지로 설명합니다</p></blockquote><h2 id=1-컨플루언스-개인용-액세스-토큰-발급하기>1. 컨플루언스 개인용 액세스 토큰 발급하기<a hidden class=anchor aria-hidden=true href=#1-컨플루언스-개인용-액세스-토큰-발급하기>#</a></h2><ol><li><p>컨플루언스 우측 상단의 프로필 클릭 → 프로파일 클릭
<img loading=lazy src=/posts/confluence-automation/image.png></p></li><li><p>환경설정 → 개인용 액세스 토큰 → 토큰 만들기 클릭
<img loading=lazy src=/posts/confluence-automation/image-1.png></p></li><li><p>토큰 이름 지정 → 영구 사용 시 자동 만료 체크 해제 → 만들기 클릭
<img loading=lazy src=/posts/confluence-automation/image-2.png></p></li><li><p>생성된 액세스 토큰 확인 → 복사 버튼 클릭 → 별도 파일로 저장
<img loading=lazy src=/posts/confluence-automation/image-3.png>
※ 한번 생성한 뒤에는 다시 확인이 불가하기 때문에 별도 파일로 저장합니다</p></li></ol><h2 id=2-컨플루언스-api-활용하기>2. 컨플루언스 API 활용하기<a hidden class=anchor aria-hidden=true href=#2-컨플루언스-api-활용하기>#</a></h2><blockquote><p><a href=https://github.com/dings-things/py-cofluence-automation>소스코드</a>를 참고해주세요.
<img loading=lazy src=/posts/confluence-automation/image-4.png></p></blockquote><ol><li><p>ContentAdder</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Endpoint</strong></td><td><code>/rest/api/content</code></td></tr><tr><td><strong>HTTP Method</strong></td><td><code>POST</code></td></tr><tr><td><strong>기능</strong></td><td><code>ContentDTO</code>를 기반으로 새 페이지 생성</td></tr><tr><td><strong>리턴 값</strong></td><td>생성된 페이지의 ID (<code>str</code>)</td></tr></tbody></table></li><li><p>ContentGetter</p><table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>Endpoint</strong></td><td><code>/rest/api/content/{page_id}?expand=body.storage,space,ancestors</code></td></tr><tr><td><strong>HTTP Method</strong></td><td><code>GET</code></td></tr><tr><td><strong>기능</strong></td><td>특정 페이지 ID로 페이지 정보를 조회</td></tr><tr><td><strong>리턴 값</strong></td><td><code>ContentDTO</code> 객체 또는 <code>None</code></td></tr></tbody></table></li><li><p>PageGetter</p><table><thead><tr><th>메서드명</th><th>Endpoint</th><th>설명</th><th>리턴 타입</th></tr></thead><tbody><tr><td><code>get_latest()</code></td><td><code>/rest/api/content/{parent_page_id}/child/page?expand=version</code></td><td>하위 페이지 중 가장 최신 페이지 1개 조회</td><td><code>Optional[PageDTO]</code></td></tr><tr><td><code>get()</code></td><td>동일</td><td>하위 페이지 전체 목록 조회</td><td><code>List[PageDTO]</code></td></tr></tbody></table></li></ol><ul><li><code>PageDTO</code>중 <code>version.when</code> 필드를 사용하여 업데이트 일자를 기준으로 가장 최신의 페이지를 반환한다<ul><li>createdate, updatedate가 구분되지 않아 업데이트를 기준으로 정의된다</li></ul></li></ul><ol start=4><li>ConfluenceAPI<table><thead><tr><th>메서드명</th><th>설명</th><th>내부 사용</th></tr></thead><tbody><tr><td><code>get()</code></td><td>HTTP GET 요청 수행</td><td><code>ContentGetter</code>, <code>PageGetter</code></td></tr><tr><td><code>post()</code></td><td>HTTP POST 요청 수행</td><td><code>ContentAdder</code></td></tr></tbody></table></li></ol><blockquote><p>각 클래스는 ConfluenceAPI에 의존하여 실제 HTTP 요청을 위임하며, DTO 객체(ContentDTO, PageDTO)를 사용하여 데이터 구조를 명확히 유지합니다.</p></blockquote><ol start=5><li>WebhookSender<table><thead><tr><th>항목</th><th>설명</th></tr></thead><tbody><tr><td><strong>주요 목적</strong></td><td>외부 시스템으로 Webhook 이벤트 전송</td></tr><tr><td><strong>의존 객체</strong></td><td><code>WebhookClient</code>, <code>WebhookSenderInterface</code>, <code>logging.Logger</code></td></tr><tr><td><strong>초기화 인자</strong></td><td><code>webhook_url: str</code>, <code>logger: logging.Logger</code></td></tr><tr><td><strong>내부 필드</strong></td><td><code>self.client</code>: <code>WebhookClient</code>, <code>self.logger</code>: 로깅 객체</td></tr><tr><td><strong>메서드</strong></td><td><code>send_webhook(dto: WebhookSenderInterface) -> WebhookResponse</code></td></tr><tr><td><strong>메서드 설명</strong></td><td>전달된 DTO 객체를 JSON 변환 후 Webhook POST 요청 실행</td></tr><tr><td><strong>예외 처리</strong></td><td>전송 실패 시 로그에 예외 내용 기록 (<code>logger.exception</code>)</td></tr><tr><td><strong>리턴 값</strong></td><td><code>WebhookResponse</code> (전송 성공 응답 객체, 실패 시 예외 기록)</td></tr></tbody></table></li></ol><ul><li>스크립트 결과를 웹훅으로 전송하기 위한 Class</li><li>Slack Webhook 의존성을 가지며 Slack 워크플로와 연동하여 추가 구현 가능</li><li>추상화된 DTO를 통해 스크립트 별로 느슨한 결과 반환</li></ul><h2 id=3-스크립트-및-workflow-구성하기>3. 스크립트 및 workflow 구성하기<a hidden class=anchor aria-hidden=true href=#3-스크립트-및-workflow-구성하기>#</a></h2><blockquote><p>지난 주에 작성했던 내용을 복사하여 이번 주 제목으로 새롭게 작성한다</p></blockquote><h3 id=step-1-root-페이지로부터-가장-최신의-페이지-id-가져오기>Step 1: Root 페이지로부터 가장 최신의 페이지 ID 가져오기<a hidden class=anchor aria-hidden=true href=#step-1-root-페이지로부터-가장-최신의-페이지-id-가져오기>#</a></h3><blockquote><p><strong>RootPage란?</strong> 디렉토리 구조 중, 생성되는 페이지의 부모 디렉토리를 뜻한다</p><p>ex.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[보고]
</span></span><span class=line><span class=cl>└── 주간 보고
</span></span><span class=line><span class=cl>    ├── 주간보고 | 2024
</span></span><span class=line><span class=cl>    ├── 주간보고 | 2025 1분기
</span></span><span class=line><span class=cl>    ├── 20250403_MY팀 주간 보고
</span></span><span class=line><span class=cl>    ├── 20250410_MY팀 주간 보고
</span></span><span class=line><span class=cl>    ├── 20250417_MY팀 주간 보고
</span></span><span class=line><span class=cl>    ├── 20250424_MY팀 주간 보고
</span></span><span class=line><span class=cl>    ├── 20250508_MY팀 주간 보고
</span></span><span class=line><span class=cl>    ├── 20250515_MY팀 주간 보고 
</span></span><span class=line><span class=cl>    ├── 20250522_MY팀 주간 보고
</span></span><span class=line><span class=cl>    ├── 20250529_MY팀 주간 보고
</span></span><span class=line><span class=cl>    └── 20250605_MY팀 주간 보고
</span></span></code></pre></div></blockquote><p><img loading=lazy src=/posts/confluence-automation/image-5.png></p><ul><li>부모 디렉토리 구조 중 <code>ROOT_PAGE_ID</code>를 <code>.env</code>로 따로 저장한다<ul><li><code>https://{CONFLUENCE_BASE_URL}/pages/viewpage.action?pageId={ROOT_PAGE_ID}</code></li></ul></li><li>조직별로 <code>CONFLUENCE_BASE_URL</code>이 달라질 수 있어 이 또한 <code>.env</code>로 관리한다</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pydantic_settings</span> <span class=kn>import</span> <span class=n>BaseSettings</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dotenv</span> <span class=kn>import</span> <span class=n>load_dotenv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>load_dotenv</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Settings</span><span class=p>(</span><span class=n>BaseSettings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>CONFLUENCE_API_TOKEN</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>ROOT_PAGE_ID</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>CONFLUENCE_BASE_URL</span><span class=p>:</span> <span class=nb>str</span>
</span></span><span class=line><span class=cl>    <span class=n>WEBHOOK_URL</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Config</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>env_file</span> <span class=o>=</span> <span class=s2>&#34;.env&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>env_file_encoding</span> <span class=o>=</span> <span class=s2>&#34;utf-8&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>settings</span> <span class=o>=</span> <span class=n>Settings</span><span class=p>()</span>
</span></span></code></pre></div><p><code>.env</code> 파일을 기준으로 <code>Settings</code> 데이터 클래스를 정의한다</p><p><code>config</code>에 필요한 환경변수는 다음과 같다</p><ul><li>CONFLUENCE_API_TOKEN : 앞서 발급한 컨플루언스 토큰</li><li>ROOT_PAGE_ID : 타겟 부모 페이지 ID</li><li>CONFLUENCE_BASE_URL : 조직의 컨플루언스 URL</li><li>WEBHOOK_URL : 웹훅 사용 시, 웹훅 URL</li></ul><h3 id=step-2-지난주-제목-불러오기>Step 2: 지난주 제목 불러오기<a hidden class=anchor aria-hidden=true href=#step-2-지난주-제목-불러오기>#</a></h3><p>※ Latest 기준이 업데이트 일자를 기준으로 정렬되기 때문에, 간헐적으로 이전 주가 아닌 다른 페이지가 생성되거나 수정될 경우 문제가 발생하였다</p><ol><li>이번 주 목요일 제목을 가진 페이지 여부를 확인<ul><li>만약 이미 존재한다면 <code>return</code></li></ul></li><li>저번 주 목요일 제목을 가진 페이지 여부를 확인<ul><li>만약 존재하지 않는다면 <code>Exception</code></li></ul></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_thursday_title</span><span class=p>(</span><span class=n>offset_weeks</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>today</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>monday</span> <span class=o>=</span> <span class=n>today</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=n>today</span><span class=o>.</span><span class=n>weekday</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>thursday</span> <span class=o>=</span> <span class=n>monday</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>weeks</span><span class=o>=</span><span class=n>offset_weeks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>TITLE_FORMAT</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>timestr</span><span class=o>=</span><span class=n>thursday</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=n>TIMESTR_FORMAT</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>find_page_by_title</span><span class=p>(</span><span class=n>pages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>PageDTO</span><span class=p>],</span> <span class=n>title</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>next</span><span class=p>((</span><span class=n>page</span> <span class=k>for</span> <span class=n>page</span> <span class=ow>in</span> <span class=n>pages</span> <span class=k>if</span> <span class=n>page</span><span class=o>.</span><span class=n>title</span> <span class=o>==</span> <span class=n>title</span><span class=p>),</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_report</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>WeeklyReportDTO</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>pages</span> <span class=o>=</span> <span class=n>page_getter</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>settings</span><span class=o>.</span><span class=n>ROOT_PAGE_ID</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>pages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;루트 페이지 하위를 불러오기에 실패하였습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>this_week_title</span> <span class=o>=</span> <span class=n>get_thursday_title</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>last_week_title</span> <span class=o>=</span> <span class=n>get_thursday_title</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>this_week_page</span> <span class=o>=</span> <span class=n>find_page_by_title</span><span class=p>(</span><span class=n>pages</span><span class=p>,</span> <span class=n>this_week_title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 이미 이번주 주간 보고가 있는 경우, 웹훅만 전송</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>this_week_page</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>report_link</span> <span class=o>=</span> <span class=n>CONFLUENCE_BASE_PAGE_URL</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>base_url</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>CONFLUENCE_BASE_URL</span><span class=p>,</span> <span class=n>page_id</span><span class=o>=</span><span class=n>this_week_page</span><span class=o>.</span><span class=n>id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>WeeklyReportDTO</span><span class=p>(</span><span class=n>report_link</span><span class=o>=</span><span class=n>report_link</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>last_week_page</span> <span class=o>=</span> <span class=n>find_page_by_title</span><span class=p>(</span><span class=n>pages</span><span class=p>,</span> <span class=n>last_week_title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 지난주 주간 보고가 없는 경우, 에러</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>last_week_page</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;지난 주 목요일 제목의 페이지가 존재하지 않습니다.&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=step-3-지난-주-내용을-불러와-새롭게-페이지-생성>Step 3: 지난 주 내용을 불러와 새롭게 페이지 생성<a hidden class=anchor aria-hidden=true href=#step-3-지난-주-내용을-불러와-새롭게-페이지-생성>#</a></h3><ol><li>마지막 주 id를 기준으로 컨텐츠를 불러온다<ul><li>컨텐츠 불러오기에 실패 시 <code>Exception</code></li></ul></li><li>저번주 내용으로 이번주 제목의 새로운 페이지 생성한다.<ul><li>페이지 생성 실패 시 <code>Exception</code></li></ul></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_report</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>WeeklyReportDTO</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=c1># 지난 주 페이지 내용 가져오기</span>
</span></span><span class=line><span class=cl>    <span class=n>base_content</span> <span class=o>=</span> <span class=n>content_getter</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>last_week_page</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>base_content</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;기준 페이지의 내용을 가져올 수 없습니다.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 이번 주 제목으로 새 페이지 생성하기</span>
</span></span><span class=line><span class=cl>    <span class=n>base_content</span><span class=o>.</span><span class=n>title</span> <span class=o>=</span> <span class=n>this_week_title</span>
</span></span><span class=line><span class=cl>    <span class=n>new_page_id</span> <span class=o>=</span> <span class=n>content_adder</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>base_content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>new_page_id</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>report_link</span> <span class=o>=</span> <span class=n>CONFLUENCE_BASE_PAGE_URL</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>base_url</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>CONFLUENCE_BASE_URL</span><span class=p>,</span> <span class=n>page_id</span><span class=o>=</span><span class=n>new_page_id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>WeeklyReportDTO</span><span class=p>(</span><span class=n>report_link</span><span class=o>=</span><span class=n>report_link</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;새 페이지 생성에 실패했습니다.&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=step-4-웹훅-연동하기>Step 4: 웹훅 연동하기<a hidden class=anchor aria-hidden=true href=#step-4-웹훅-연동하기>#</a></h3><ol><li><p>Slack에서 채널 생성하기
<img loading=lazy src=/posts/confluence-automation/image-6.png></p></li><li><p>스크립트 결과값을 webhook으로 전송하기</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=k>class</span> <span class=nc>WebhookDTOInterface</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_json</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;JSON 형식으로 변환하는 메서드&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WeeklyReportDTO</span><span class=p>(</span><span class=n>WebhookDTOInterface</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>report_link</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>report_link</span> <span class=o>=</span> <span class=n>report_link</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>to_json</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># JSON 문자열 반환</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;report_link&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>report_link</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># DI 구성</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=p>:</span> <span class=n>WeeklyReportDTO</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>generate_report</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;주간 보고 생성 완료 : </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>report_link</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;스크립트 실행 중 예외가 발생했습니다: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>webhook_sender</span><span class=o>.</span><span class=n>send_webhook</span><span class=p>(</span><span class=n>dto</span><span class=o>=</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;웹훅 전송 성공&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;웹훅 전송 중 예외가 발생했습니다: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><ol start=3><li><p>슬랙 채널에서 워크플로 만들기</p><ol><li>채널 좌측 상단의 &ldquo;+&rdquo; 클릭 후, 워크플로 클릭
<img loading=lazy src=/posts/confluence-automation/image-11.png></li><li>워크플로 시작&mldr; 에서 웹후크로 시작 선택</li><li>데이터 변수에 report_link 추가 및 계속
<img loading=lazy src=/posts/confluence-automation/image-12.png></li><li>채널에 메시지 보내기 → 채널 선택 → 메시지 포맷 지정하기 → 버튼 추가하여 링크 삽입하기
<img loading=lazy src=/posts/confluence-automation/image-13.png></li></ol></li><li><p>git workflow 구성하기
개략적인 CICD
<img loading=lazy src=/posts/confluence-automation/image-15.png></p></li></ol><ul><li>마지막 TAG를 기준으로 버전 관리</li><li>main 브랜치 머지될 경우, 스크립트를 포함한 docker image 생성 후 container registry에 등록</li><li>gitlab cron job을 통해 지정한 시간대에 주기적으로 스크립트가 실행되도록 지정</li></ul><hr><p><img loading=lazy src=/posts/confluence-automation/image-14.png>
사소하고 어렵지 않은 일이지만 팀에 기여하는 방법은 어디에서나 찾아볼 수 있습니다.</p><p>엔지니어로서&mldr; 작은것에서 부터 모두가 편해질 수 있는 서비스를 만들어 보람을 찾아보는건 어떨가요?</p><h1 id=refs>REFS<a hidden class=anchor aria-hidden=true href=#refs>#</a></h1><ul><li><a href=https://github.com/dings-things/py-cofluence-automation>github code</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/tags/python/>Python</a></li><li><a href=https://dingyu.dev/tags/confluence/>Confluence</a></li><li><a href=https://dingyu.dev/tags/scrum/>Scrum</a></li><li><a href=https://dingyu.dev/tags/agile/>Agile</a></li><li><a href=https://dingyu.dev/tags/sprint/>Sprint</a></li></ul><nav class=paginav><a class=next href=https://dingyu.dev/posts/gmp/><span class=title>다음 페이지 »</span><br><span>[Go] 고루틴 1억 개 돌려도 괜찮을까?</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
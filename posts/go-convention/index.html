<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Go] Go Convention | Ding's Coding Forge</title>
<meta name=keywords content="go,convention"><meta name=description content="There arenâ€™t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, Iâ€™d like to suggest some key conventions that I believe are useful for maintaining services in the long run."><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/posts/go-convention/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.ba0de23ad40e17ca82720b577f8ae6ec11a26fb07407316cff70888e344ad129.css integrity="sha256-ug3iOtQOF8qCcgtXf4rm7BGib7B0BzFs/3CIjjRK0Sk=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/go-convention/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/go-convention/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/posts/go-convention/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Go] Go Convention"><meta property="og:description" content="There arenâ€™t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, Iâ€™d like to suggest some key conventions that I believe are useful for maintaining services in the long run."><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-12T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Convention"><meta property="og:image" content="https://dingyu.dev/posts/go-convention/img/go-thumbnail.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/posts/go-convention/img/go-thumbnail.png"><meta name=twitter:title content="[Go] Go Convention"><meta name=twitter:description content="There arenâ€™t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, Iâ€™d like to suggest some key conventions that I believe are useful for maintaining services in the long run."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/posts/"},{"@type":"ListItem","position":2,"name":"[Go] Go Convention","item":"https://dingyu.dev/posts/go-convention/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Go] Go Convention","name":"[Go] Go Convention","description":"There arenâ€™t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, Iâ€™d like to suggest some key conventions that I believe are useful for maintaining services in the long run.","keywords":["go","convention"],"articleBody":"ë°°ê²½ ì„œë¹„ìŠ¤ ë³„ë¡œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ êµ¬ì¡° í”„ë¡œì íŠ¸ ë§ˆë‹¤ ì½”ë“œ íŒŒì•…ì´ í˜ë“¦ e.g.\nSomeAPI â”œâ”€â”€ .vscode â”œâ”€â”€ api â”œâ”€â”€ build â”œâ”€â”€ config â”œâ”€â”€ data â”œâ”€â”€ db â”œâ”€â”€ externalservice â”œâ”€â”€ httpsrv â”œâ”€â”€ httptest â”œâ”€â”€ mocks â”œâ”€â”€ log â”œâ”€â”€ cli â”œâ”€â”€ repository â”œâ”€â”€ util â”œâ”€â”€ .gitignore â”œâ”€â”€ .gitlab-ci.yml â”œâ”€â”€ changelog â”œâ”€â”€ data.go â”œâ”€â”€ diag_debug.go â”œâ”€â”€ diag.go â”œâ”€â”€ go.mod â”œâ”€â”€ go.sum â”œâ”€â”€ main.go â”œâ”€â”€ Makefile â”œâ”€â”€ release.conf â”œâ”€â”€ README.md ê³µí†µ ì»¨ë²¤ì…˜ì´ ì—†ì–´ ê³µí†µ ëª¨ë“ˆ/CIë¥¼ ì‚¬ìš©í•˜ê¸° í˜ë“¦ ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ ê³ ë ¤í•  ì‚¬í•­ì´ ë§ì•„ì§ â†’ ê°œë°œ ìƒì‚°ì„± â†“ ì˜¨ë³´ë”© ê³¼ì •ì´ í˜ë“¦ ì‹ ê·œ í•©ë¥˜ëœ íŒ€ì›ì´ Goì–¸ì–´ì—ë„ ìµìˆ™ì¹˜ ì•Šì€ ìƒíƒœì—ì„œÂ ë„ˆë¬´ ì œê°ê°ì¸ ìŠ¤íƒ€ì¼ìœ¼ë¡œ ì¸í•´ í˜¼ë€ì´ ì˜´ íŒ€ì´ Go ì–¸ì–´ ìƒíƒœê³„ë¡œ ì „í™˜ì„ ì™„ë£Œí–ˆê³ , ì´ì œëŠ” ë…¸í•˜ìš°ê°€ ìƒê²¼ë‹¤ ìƒê°í•¨ ì¥ê¸°ì ì¸ ìš´ì˜ì—ì„œÂ ì»¨ë²¤ì…˜ ì‚¬ìš©ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ì„± â†‘Â ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ëŒ€í•œ ê³ ë¯¼ì„ í•˜ëŠ” ì¼, ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ë¦¬íŒ©í† ë§ì˜ ë°©í–¥ì„±ì„ ì¡ê¸° í˜ë“¦ ê°œë°œ ìƒì‚°ì„± â†“ í”„ë¡œì íŠ¸ êµ¬ì¡° ì œì•ˆ ì ìš©ì´ Mustì¸ ë¶€ë¶„ì€ * prefixë¥¼ ê°€ì§‘ë‹ˆë‹¤ (ê·¸ ì™¸, Optional)\nì—”í„°í”„ë¼ì´ì¦ˆ ë ˆë²¨ì˜ í”„ë¡œì íŠ¸ê°€ ì•„ë‹Œ MSAë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë©ë‹ˆë‹¤ ì¶”í›„ ë¦¬íŒ©í† ë§ì„ í•˜ë”ë¼ë„ ë„ë©”ì¸ ë‹¨ìœ„ì˜ MSAë¡œ ë¬¼ë¦¬ì ì¸ ê²©ë¦¬ê°€ ì§„í–‰ë˜ê¸° ë•Œë¬¸â€¦\ní”„ë¡œì íŠ¸ êµ¬ì¡° ìƒ˜í”Œ ë„ë©”ì¸ì„ â€œë§¤ì¹˜ ìƒ˜í”Œë§\"ì´ë¼ í•˜ì˜€ì„ ë•Œ\n. â”œâ”€â”€ *docs // í”„ë¡œì íŠ¸ ë³„ ë¬¸ì„œë“¤ â”‚ â”œâ”€â”€ *swagger.yaml // API ìŠ¤ì›¨ê±° ë¬¸ì„œ â”‚ â”œâ”€â”€ sequence.md // ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ â”‚ â””â”€â”€ architecture.md // ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ â”œâ”€â”€ *cmd â”‚ â””â”€â”€ *main.go // í”„ë¡œì íŠ¸ ì§„ì…ì , DI ì£¼ì… â”œâ”€â”€ pkg // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì¢…ì†ì ì´ì§€ ì•Šì€ íŒ¨í‚¤ì§€ (ì™¸ë¶€ì—ì„œ import í•˜ì—¬ë„ ìƒê´€ì—†ëŠ” ëª¨ë“ˆ) â”‚ â”œâ”€â”€ file_parser.go â”‚ â””â”€â”€ time_convertor.go â””â”€â”€ *internal // ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ì—­ (ë„ë©”ì¸ ì˜ì—­) â”œâ”€â”€ *handler â”‚ â”œâ”€â”€ *v1 â”‚ â”‚ â””â”€â”€ sampling_handler.go // ë„ë©”ì¸ í•¸ë“¤ëŸ¬ v1 â”‚ â”œâ”€â”€ v2 â”‚ â”‚ â””â”€â”€ sampling_handler.go // ë„ë©”ì¸ í•¸ë“¤ëŸ¬ v2 â”‚ â”œâ”€â”€ server.go // handlerê°€ ë§ì„ ê²½ìš°, handlerë¥¼ ë“±ë¡í•  serverë¥¼ ë‘¡ë‹ˆë‹¤ â”‚ â”œâ”€â”€ health_handler.go // v1, v2 ê³µí†µ í•¸ë“¤ëŸ¬ â”‚ â”œâ”€â”€ swagger_handler.go // í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ìš© openapi í•¸ë“¤ëŸ¬ (CORS í—ˆìš©) â”‚ â””â”€â”€ auth_middleware.go // ë¯¸ë“¤ì›¨ì–´ë“¤ â”œâ”€â”€ data â”‚ â”œâ”€â”€ mysqldb.go // DB client ì»¤ë„¥í„° â”‚ â”œâ”€â”€ redis.go // DB client ì»¤ë„¥í„° â”‚ â”œâ”€â”€ feature_event_producer.go // Kafka event producer - xxx_producer â”‚ â”œâ”€â”€ match_repository.go // ORM ìˆ˜í–‰ repository (DB client ì£¼ì…) - xxx_repository â”‚ â””â”€â”€ nass_api.go // ì™¸ë¶€ API Data Layer - xxx_api â”œâ”€â”€ *service â”‚ â”œâ”€â”€ kda_sampler.go // Data layer í˜¹ì€ ë‹¤ë¥¸ serviceë¥¼ ì£¼ì… ë°›ì•„ êµ¬í˜„ â”‚ â”œâ”€â”€ match_sampling_usecase.go // service ê°€ ë§ì„ ê²½ìš°, ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•´ì£¼ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤ êµ¬í˜„ â”‚ â””â”€â”€ kda_sampler_test.go // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ìœ ë‹›í…ŒìŠ¤íŠ¸ â”œâ”€â”€ logger.go // ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ì‚¬ìš©ë  ê¸°ëŠ¥ â”œâ”€â”€ constants.go // ì™¸ë¶€ì—ì„œ ì°¸ì¡° ë˜ì–´ì•¼ í•˜ëŠ” ìƒìˆ˜ ê°’ ì •ì˜ â””â”€â”€ *config.go // application ì„¤ì • íŒŒì¼ â”œâ”€â”€ *gitlab-ci.yml â”œâ”€â”€ *go.mod â”œâ”€â”€ *go.sum â””â”€â”€ *README.md // í”„ë¡œì íŠ¸ì— ëŒ€í•œ ë°°ê²½, ìœ ì¦ˆì¼€ì´ìŠ¤, ì„¤ì¹˜ ë°©ë²• ê¸°ìˆ  êµ¬ë¶„ í•„ìˆ˜ ì—¬ë¶€ ì„¤ëª… ì˜ˆì‹œ docs âœ” í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜, ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨, ìŠ¤ì›¨ê±° ë¬¸ì„œë¥¼ ê´€ë¦¬ - swagger.yaml- sequence.md cmd âœ” í”„ë¡œì íŠ¸ ì§„ì…ì , ì‹¤í–‰ ê°€ëŠ¥í•œ íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸ ê´€ë¦¬ - main.go- start.sh pkg ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¢…ì†ì ì´ì§€ ì•Šì€ ìœ í‹¸ë¦¬í‹° ê¸°ëŠ¥ ê´€ë¦¬ - time_convertor.go- file_parser.go internal âœ” ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ë„ë©”ì¸) ì˜ì—­ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ì‚¬ìš©ë  ê¸°ëŠ¥ ë‹´ë‹¹ - config.go- logger.go- constants.go internal/handler âœ” APIë¼ë©´ API Handlerì¼ ê²ƒì´ê³  Consumerë¼ë©´ Consumer Handler ë‹´ë‹¹- ë²„ì €ë‹ì€ *í•„ìˆ˜, HTTP/gRPC/MQ/Kafka ì™€ì˜ í†µì‹ ì„ ë‹´ë‹¹- ë¯¸ë“¤ì›¨ì–´ëŠ” Optional- handlerê°€ ì—¬ëŸ¬ê°œì¼ ê²½ìš°, server ì—ì„œ handlerë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤ - blacklist_handler.go- alive_handler.go- log_middleware.go- server.go internal/data 3 Tier Architecture ì¤‘, Data Layer ì˜ì—­ì˜ì†ì„±ì„ ê°€ì§„ ë°ì´í„° CRUD ë‹´ë‹¹(ì™¸ë¶€ API ë˜í•œ í•´ë‹¹ë¨, Kafka ë˜í•œ streamì— ì €ì¥í•˜ëŠ” í–‰ìœ„ë¡œ ê°„ì£¼) - event_producer.go- blacklist_repository.go- member_api.go internal/service âœ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì—­- ê°ê°ì˜ ì„œë¹„ìŠ¤ëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ì— ë”°ë¼ í•˜ë‚˜ì˜ ì±…ì„ë§Œ ìˆ˜í–‰- ì„œë¹„ìŠ¤ê°€ ë‹¤ìˆ˜ì¼ ê²½ìš°, ì´ë¥¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•´ì£¼ëŠ” xxx_usecaseë¡œ êµ¬í˜„- ì„œë¹„ìŠ¤ ì½”ë“œì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” í•„ìˆ˜ (ì¼ë¶€ ì˜ì¡´ì„±ì— ë”°ë¥¸ í…ŒìŠ¤íŠ¸ ë¶ˆê°€ ì‹œ íŒ¨ìŠ¤) - fraud_detect_usecase.go- fraud_retriever.go- rule_analyzer.go ./ (root) âœ” í”„ë¡œì íŠ¸ ì‹¤í–‰ ë° ìš´ì˜ì„ ìœ„í•œ íŒŒì¼ ì˜ì—­- ë¦¬ë“œë¯¸ëŠ” í•„ìˆ˜ë¡œ ì‘ì„± (ìœ ì¦ˆì¼€ì´ìŠ¤ì™€ ì„¤ì¹˜ ë°©ë²•ì€ í•­ìƒ ê¸°ìˆ ) - gitlab-ci.yml- README.md ìƒìˆ˜ ì»¨ë²¤ì…˜ ê¸°ë³¸ì ìœ¼ë¡œ ì¹´ë©œì¼€ì´ìŠ¤ì™€ íŒŒìŠ¤ì¹¼ì¼€ì´ìŠ¤ë¥¼ ì›ì¹™ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤\nâ†’ í•˜ë‚˜ì˜ ë„ë©”ì¸ íŒŒì¼ì—ì„œ ë„ë©”ì¸ê³¼ ê´€ë ¨ëœ ìƒìˆ˜ê°€ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì— ì†í•´ ìˆëŠ” ê²½ìš°, ìˆ˜ì •ì—ë„ ì–´ë µê³  ì¶”ì ì—ë„ ê·€ì°®ìŒì´ ë™ë°˜ ë¨ì„ ëŠê¼ˆìŠµë‹ˆë‹¤\nâ†’ í•˜ë‚˜ì˜ ì±…ì„ì„ ì§€ëŠ” íŒŒì¼ ë‚´ì—ì„œ private ìƒìˆ˜ë¡œì„œ ê´€ë¦¬ ëœë‹¤ë©´ ìœ ì§€ë³´ìˆ˜ì—ë„ ìš©ì´í•  ê²ƒì´ê³  ì½”ë“œ íŒŒì•…ì—ë„ ìš©ì´í•  ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤\në³µìˆ˜ íŒ¨í‚¤ì§€ì—ì„œ ë‹¤ìˆ˜ ì˜ì¡´ë  ì—¬ì§€ê°€ ìˆëŠ” ê²½ìš° (Pascal) internal layerì˜ constants.go íŒŒì¼ì— ìƒìˆ˜ ê°’ë“¤ì„ ì •ì˜ í•©ë‹ˆë‹¤\npackage internal const ( LanguageCodeKorean = \"ko\" LanguageCodeEnglish = \"en\" LanguageCodeChinese = \"zh_CN\" LanguageCodeJapanese = \"ja\" ) í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë‚´ í˜¹ì€ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ê²½ìš° (Camel) ë™ì¼ íŒ¨í‚¤ì§€ ë‚´ì—ì„œëŠ” private ë³€ìˆ˜ì— ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\npackage handler const ( // resultSuccess : ì„±ê³µ ì‘ë‹µ resultSuccess = \"true\" // resultFailure : ì‹¤íŒ¨ ì‘ë‹µ resultFailure = \"false\" ) ë¶ˆê°€í”¼í•˜ê²Œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¡œë¶€í„° ì°¸ì¡°ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš° ìƒìˆ˜ëŠ” privateìœ¼ë¡œ, structì˜ Public í•¨ìˆ˜ë¡œ ì°¸ì¡° ë  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤\npackage handler const ( // samplerEndpoint : ë§¤ì¹˜ ìƒ˜í”Œë§ ì—”ë“œí¬ì¸ë“œ samplerEndpoint = \"/v1/:match_id\" ) // Endpoint : í•¸ë“¤ëŸ¬ì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë°˜í™˜ func (h *SamplerHandler) Endpoint() string { return samplerEndpoint } ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ ë°ì´í„° ëª¨ë¸ì€ ê°€ê¸‰ì  ë³„ë„ íŒŒì¼ì´ ì•„ë‹Œ, ìˆ˜í–‰ë˜ëŠ” íŒŒì¼ì—ì„œ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤\nâ†’ modelì„ ë³„ë„ë¡œ ì§€ì •í•´ ë‘˜ ê²½ìš°, íŠ¹ì • ë„ë©”ì¸ì— ëŒ€í•œ ìˆ˜ì •ì´ ìˆì„ ë•Œ ì°¸ì¡°ëœ ì—¬ëŸ¬ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ì¡´ì¬í•©ë‹ˆë‹¤\nâ†’ ê°™ì€ ê³„ì¸µ ê°„ì˜ ë°ì´í„° ì´ë™ì— ëŒ€í•´ì„œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì£¼ê³  ë°›ê³  ë‹¤ë¥¸ ë ˆì´ì–´ ê°„ í†µì‹ ì€ *ë ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ì— ë”°ë¼ ë°ì´í„° ëª¨ë¸ì„ ì£¼ê³  ë°›ìŠµë‹ˆë‹¤\nâ†’ parameterê°€ ë‘ ê°œ ì´ìƒì¼ ê²½ìš°, ë°ì´í„° ëª¨ë¸ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•©ë‹ˆë‹¤\në ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ handler â†’ service\nrequest â†’ serviceDTO\nfunc (h *Handler) CreateMatch(c *gin.Context) { var req matchRequest if err := c.ShouldBindJSON(\u0026req); err != nil { c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()}) return } // Service í˜¸ì¶œ err := h.service.Create(req.ToServiceDTO()) // so on } service â†’ data\nserviceDTO â†’ entity\nfunc (b *MatchCreater) Create(match MatchDTO) (int, error) { ... // repository ê³„ì¸µì— MatchEntity ì‚½ì… ìš”ì²­ id, err := b.repository.Insert(match.ToEntity()) if err != nil { return 0, err } return id, nil } data â†’ service\nentity â†’ serviceDTO\nfunc (r *MatchRepository) Insert(entity MatchEntity) (int, error) { // ë°ì´í„° ë ˆì´ì–´ì—ì„œ UserEntity ê°€ì ¸ì˜¤ê¸° result, err := s.db.Create(\u0026entity) ... return result.ID, nil } ë°ì´í„° ëª¨ë¸ì—ì„œì˜ ì¡°ê±´ ê²€ì‚¬ ëª¨ë¸ì„ ì£¼ê³  ë°›ëŠ” ê²½ìš°, ê°€ë…ì„±ì„ ìœ„í•´ ì¡°ê±´ ê²€ì‚¬ëŠ” í•¨ìˆ˜ë¡œ ì‹¤ì‹œ í•©ë‹ˆë‹¤\në‹¨ìœ„ í…ŒìŠ¤íŠ¸ì— ìš©ì´ í•˜ë©°, í•œëˆˆì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ íŒŒì•…í•˜ê¸° ì‰¬ì›Œ ì§‘ë‹ˆë‹¤\n[AS-IS]\nfunc (b *MatchCreater) Create(match MatchDTO) (int, error) { if strings.HasPrefix(match.Version, \"rc\") \u0026\u0026 match.detail == \"test\" { return } // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ } [TO-BE]\nfunc (b *MatchCreater) Create(match MatchDTO) (int, error) { if match.IsTest() { return } // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ } í…ŒìŠ¤íŠ¸ ì»¨ë²¤ì…˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í…ŒìŠ¤íŠ¸ëŠ” ì„ íƒì‚¬í•­ì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤. ì´ë¯¸ ì •ì˜ëœ ì—ëŸ¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ëŠ” ìµœëŒ€í•œ ìƒì„¸í•˜ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•©ë‹ˆë‹¤.\nDeterministic ë¹„ë™ê¸° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ ê°’ì„ í™•ì¸í•˜ì§€ ì•Šê±°ë‚˜ time sleep ì´í›„ì˜ ë¡œê¹…ì„ ë©ˆì¶”ì„¸ìš”\nDI + Eventuallyë¥¼ í†µí•œ flaky testë¥¼ ë°©ì§€í•©ë‹ˆë‹¤\në¡œê±° ì£¼ì… // NewQueue ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•  Queue ìƒì„±ì func NewQueue( config Config, httpClient *http.Client, logger *zerolog.Logger, ) (queue Queue, err error) { // queueëŠ” Start()ë¥¼ í†µí•´ thread executorê°€ ì‹¤í–‰ë ë•Œì— ìƒì„±ë©ë‹ˆë‹¤. queue = Queue{ config: config, client: httpClient, logger: logger, quitChan: make(chan struct{}), } return } ì‘ë‹µ ê°’ í…ŒìŠ¤íŠ¸ í ë¡œì§ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ t.Run(\"í ì²˜ë¦¬ ì‹¤íŒ¨ì‹œ, ì‹¤íŒ¨ ë¡œê¹… í…ŒìŠ¤íŠ¸\", func(t *testing.T) { // given var buffer bytes.Buffer ... ë¡œê±° ì˜ì¡´ì„± ì£¼ì… // when ... ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰ event1, err := queue.Push([]byte(validJSON1)) assert.NoError(t, err) event2, err := queue.Push([]byte(validJSON2)) assert.NoError(t, err) // then assert.Eventually(t, func() bool { output := buffer.String() return strings.Contains(output, event1.TraceID().String()) \u0026\u0026 strings.Contains(output, event2.TraceID().String()) \u0026\u0026 strings.Contains(output, `\"success\":false`) }, 1*time.Second, 10*time.Millisecond) }) í ë¡œì§ ì„±ê³µ í…ŒìŠ¤íŠ¸ t.Run(\"í ì²˜ë¦¬ ì„±ê³µì‹œ, ì„±ê³µ ë¡œê¹… í…ŒìŠ¤íŠ¸\", func(t *testing.T) { // given var buffer bytes.Buffer ... ë¡œê±° ì˜ì¡´ì„± ì£¼ì… // when ... ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰ event1, err := queue.Push([]byte(validJSON1)) assert.NoError(t, err) event2, err := queue.Push([]byte(validJSON2)) assert.NoError(t, err) // then assert.Eventually(t, func() bool { output := buffer.String() return strings.Contains(output, event1.TraceID().String()) \u0026\u0026 strings.Contains(output, event2.TraceID().String()) \u0026\u0026 strings.Contains(output, `\"success\":true`) }, 1*time.Second, 10*time.Millisecond) }) ","wordCount":"1205","inLanguage":"ko","image":"https://dingyu.dev/posts/go-convention/img/go-thumbnail.png","datePublished":"2025-01-12T00:00:00Z","dateModified":"2025-01-12T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/posts/go-convention/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://dingyu.dev/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://dingyu.dev/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/>í™ˆ</a>&nbsp;Â»&nbsp;<a href=https://dingyu.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Go] Go Convention</h1><div class=post-description>There arenâ€™t many Go developers in Korea, and major IT companies using Go are as rare as unicorns. At my company, we have accumulated our own know-how over the years while developing with Go. Here, Iâ€™d like to suggest some key conventions that I believe are useful for maintaining services in the long run.</div><div class=post-meta><span title='2025-01-12 00:00:00 +0000 UTC'>1ì›” 12, 2025</span>&nbsp;Â·&nbsp;6 ë¶„&nbsp;Â·&nbsp;1205 ë‹¨ì–´&nbsp;Â·&nbsp;dingyu&nbsp;|&nbsp;ë²ˆì—­:<ul class=i18n_list><li><a href=https://dingyu.dev/en/posts/go-convention/>En</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/go-convention/index.ko.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/go-thumbnail.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ëª©ì°¨</span></summary><div class=inner><ul><li><a href=#%eb%b0%b0%ea%b2%bd aria-label=ë°°ê²½>ë°°ê²½</a></li><li><a href=#%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ea%b5%ac%ec%a1%b0-%ec%a0%9c%ec%95%88 aria-label="í”„ë¡œì íŠ¸ êµ¬ì¡° ì œì•ˆ">í”„ë¡œì íŠ¸ êµ¬ì¡° ì œì•ˆ</a><ul><li><a href=#%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8-%ea%b5%ac%ec%a1%b0-%ec%83%98%ed%94%8c aria-label="í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒ˜í”Œ">í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒ˜í”Œ</a></li><li><a href=#%ec%83%81%ec%88%98-%ec%bb%a8%eb%b2%a4%ec%85%98 aria-label="ìƒìˆ˜ ì»¨ë²¤ì…˜">ìƒìˆ˜ ì»¨ë²¤ì…˜</a><ul><li><a href=#%eb%b3%b5%ec%88%98-%ed%8c%a8%ed%82%a4%ec%a7%80%ec%97%90%ec%84%9c-%eb%8b%a4%ec%88%98-%ec%9d%98%ec%a1%b4%eb%90%a0-%ec%97%ac%ec%a7%80%ea%b0%80-%ec%9e%88%eb%8a%94-%ea%b2%bd%ec%9a%b0-pascal aria-label="ë³µìˆ˜ íŒ¨í‚¤ì§€ì—ì„œ ë‹¤ìˆ˜ ì˜ì¡´ë  ì—¬ì§€ê°€ ìˆëŠ” ê²½ìš° (Pascal)">ë³µìˆ˜ íŒ¨í‚¤ì§€ì—ì„œ ë‹¤ìˆ˜ ì˜ì¡´ë  ì—¬ì§€ê°€ ìˆëŠ” ê²½ìš° (Pascal)</a></li><li><a href=#%ed%95%98%eb%82%98%ec%9d%98-%ed%8c%a8%ed%82%a4%ec%a7%80-%eb%82%b4-%ed%98%b9%ec%9d%80-%ed%95%98%eb%82%98%ec%9d%98-%ed%8c%8c%ec%9d%bc%ec%97%90%ec%84%9c-%ec%82%ac%ec%9a%a9%ed%95%a0-%ea%b2%bd%ec%9a%b0-camel aria-label="í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë‚´ í˜¹ì€ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ê²½ìš° (Camel)">í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë‚´ í˜¹ì€ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ê²½ìš° (Camel)</a></li><li><a href=#%eb%b6%88%ea%b0%80%ed%94%bc%ed%95%98%ea%b2%8c-%eb%8b%a4%eb%a5%b8-%ed%8c%a8%ed%82%a4%ec%a7%80%eb%a1%9c%eb%b6%80%ed%84%b0-%ec%b0%b8%ec%a1%b0%eb%90%98%ec%96%b4%ec%95%bc-%ed%95%98%eb%8a%94-%ea%b2%bd%ec%9a%b0 aria-label="ë¶ˆê°€í”¼í•˜ê²Œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¡œë¶€í„° ì°¸ì¡°ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°">ë¶ˆê°€í”¼í•˜ê²Œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¡œë¶€í„° ì°¸ì¡°ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°</a></li></ul></li><li><a href=#%eb%8d%b0%ec%9d%b4%ed%84%b0-%eb%aa%a8%eb%8d%b8-%ec%bb%a8%eb%b2%a4%ec%85%98 aria-label="ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜">ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜</a><ul><li><a href=#%eb%a0%88%ec%9d%b4%ec%96%b4-%ea%b0%84-%eb%8d%b0%ec%9d%b4%ed%84%b0-%eb%aa%a8%eb%8d%b8-%ec%bb%a8%eb%b2%a4%ec%85%98 aria-label="ë ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜">ë ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜</a></li><li><a href=#%eb%8d%b0%ec%9d%b4%ed%84%b0-%eb%aa%a8%eb%8d%b8%ec%97%90%ec%84%9c%ec%9d%98-%ec%a1%b0%ea%b1%b4-%ea%b2%80%ec%82%ac aria-label="ë°ì´í„° ëª¨ë¸ì—ì„œì˜ ì¡°ê±´ ê²€ì‚¬">ë°ì´í„° ëª¨ë¸ì—ì„œì˜ ì¡°ê±´ ê²€ì‚¬</a></li></ul></li><li><a href=#%ed%85%8c%ec%8a%a4%ed%8a%b8-%ec%bb%a8%eb%b2%a4%ec%85%98 aria-label="í…ŒìŠ¤íŠ¸ ì»¨ë²¤ì…˜">í…ŒìŠ¤íŠ¸ ì»¨ë²¤ì…˜</a><ul><li><a href=#deterministic-%eb%b9%84%eb%8f%99%ea%b8%b0-%eb%8b%a8%ec%9c%84-%ed%85%8c%ec%8a%a4%ed%8a%b8 aria-label="Deterministic ë¹„ë™ê¸° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸">Deterministic ë¹„ë™ê¸° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=ë°°ê²½>ë°°ê²½<a hidden class=anchor aria-hidden=true href=#ë°°ê²½>#</a></h1><hr><ul><li>ì„œë¹„ìŠ¤ ë³„ë¡œ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ êµ¬ì¡°<ul><li>í”„ë¡œì íŠ¸ ë§ˆë‹¤ ì½”ë“œ íŒŒì•…ì´ í˜ë“¦</li></ul></li></ul><p>e.g.</p><pre tabindex=0><code>SomeAPI
â”œâ”€â”€ .vscode
â”œâ”€â”€ api
â”œâ”€â”€ build
â”œâ”€â”€ config
â”œâ”€â”€ data
â”œâ”€â”€ db
â”œâ”€â”€ externalservice
â”œâ”€â”€ httpsrv
â”œâ”€â”€ httptest
â”œâ”€â”€ mocks
â”œâ”€â”€ log
â”œâ”€â”€ cli
â”œâ”€â”€ repository
â”œâ”€â”€ util
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .gitlab-ci.yml
â”œâ”€â”€ changelog
â”œâ”€â”€ data.go
â”œâ”€â”€ diag_debug.go
â”œâ”€â”€ diag.go
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ main.go
â”œâ”€â”€ Makefile
â”œâ”€â”€ release.conf
â”œâ”€â”€ README.md
</code></pre><ul><li>ê³µí†µ ì»¨ë²¤ì…˜ì´ ì—†ì–´ ê³µí†µ ëª¨ë“ˆ/CIë¥¼ ì‚¬ìš©í•˜ê¸° í˜ë“¦<ul><li>ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ë  ìˆ˜ ìˆë„ë¡ ê³ ë ¤í•  ì‚¬í•­ì´ ë§ì•„ì§ â†’ ê°œë°œ ìƒì‚°ì„± â†“</li></ul></li><li>ì˜¨ë³´ë”© ê³¼ì •ì´ í˜ë“¦<ul><li>ì‹ ê·œ í•©ë¥˜ëœ íŒ€ì›ì´ Goì–¸ì–´ì—ë„ ìµìˆ™ì¹˜ ì•Šì€ ìƒíƒœì—ì„œÂ ë„ˆë¬´ ì œê°ê°ì¸ ìŠ¤íƒ€ì¼ìœ¼ë¡œ ì¸í•´ í˜¼ë€ì´ ì˜´</li></ul></li><li>íŒ€ì´ Go ì–¸ì–´ ìƒíƒœê³„ë¡œ ì „í™˜ì„ ì™„ë£Œí–ˆê³ , ì´ì œëŠ” ë…¸í•˜ìš°ê°€ ìƒê²¼ë‹¤ ìƒê°í•¨<ul><li>ì¥ê¸°ì ì¸ ìš´ì˜ì—ì„œÂ ì»¨ë²¤ì…˜ ì‚¬ìš©ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ì„± â†‘Â </li></ul></li><li>ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ êµ¬ì¡°ì— ëŒ€í•œ ê³ ë¯¼ì„ í•˜ëŠ” ì¼, ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ë¦¬íŒ©í† ë§ì˜ ë°©í–¥ì„±ì„ ì¡ê¸° í˜ë“¦<ul><li>ê°œë°œ ìƒì‚°ì„± â†“</li></ul></li></ul><h1 id=í”„ë¡œì íŠ¸-êµ¬ì¡°-ì œì•ˆ>í”„ë¡œì íŠ¸ êµ¬ì¡° ì œì•ˆ<a hidden class=anchor aria-hidden=true href=#í”„ë¡œì íŠ¸-êµ¬ì¡°-ì œì•ˆ>#</a></h1><hr><p>ì ìš©ì´ <strong>Must</strong>ì¸ ë¶€ë¶„ì€ * prefixë¥¼ ê°€ì§‘ë‹ˆë‹¤ (ê·¸ ì™¸, Optional)</p><blockquote><p>ì—”í„°í”„ë¼ì´ì¦ˆ ë ˆë²¨ì˜ í”„ë¡œì íŠ¸ê°€ ì•„ë‹Œ MSAë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë©ë‹ˆë‹¤
ì¶”í›„ ë¦¬íŒ©í† ë§ì„ í•˜ë”ë¼ë„ ë„ë©”ì¸ ë‹¨ìœ„ì˜ MSAë¡œ ë¬¼ë¦¬ì ì¸ ê²©ë¦¬ê°€ ì§„í–‰ë˜ê¸° ë•Œë¬¸&mldr;</p></blockquote><h2 id=í”„ë¡œì íŠ¸-êµ¬ì¡°-ìƒ˜í”Œ>í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒ˜í”Œ<a hidden class=anchor aria-hidden=true href=#í”„ë¡œì íŠ¸-êµ¬ì¡°-ìƒ˜í”Œ>#</a></h2><p>ë„ë©”ì¸ì„ &ldquo;ë§¤ì¹˜ ìƒ˜í”Œë§"ì´ë¼ í•˜ì˜€ì„ ë•Œ</p><pre tabindex=0><code>.
â”œâ”€â”€ *docs                         // í”„ë¡œì íŠ¸ ë³„ ë¬¸ì„œë“¤
â”‚   â”œâ”€â”€ *swagger.yaml             // API ìŠ¤ì›¨ê±° ë¬¸ì„œ
â”‚   â”œâ”€â”€ sequence.md               // ë¹„ì¦ˆë‹ˆìŠ¤ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
â”‚   â””â”€â”€ architecture.md           // ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
â”œâ”€â”€ *cmd
â”‚   â””â”€â”€ *main.go                  // í”„ë¡œì íŠ¸ ì§„ì…ì , DI ì£¼ì…
â”œâ”€â”€ pkg                           // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì¢…ì†ì ì´ì§€ ì•Šì€ íŒ¨í‚¤ì§€ (ì™¸ë¶€ì—ì„œ import í•˜ì—¬ë„ ìƒê´€ì—†ëŠ” ëª¨ë“ˆ)
â”‚   â”œâ”€â”€ file_parser.go
â”‚   â””â”€â”€ time_convertor.go
â””â”€â”€ *internal                     // ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ì—­ (ë„ë©”ì¸ ì˜ì—­)
    â”œâ”€â”€ *handler
    â”‚   â”œâ”€â”€ *v1
    â”‚   â”‚   â””â”€â”€ sampling_handler.go         // ë„ë©”ì¸ í•¸ë“¤ëŸ¬ v1
    â”‚   â”œâ”€â”€ v2
    â”‚   â”‚   â””â”€â”€ sampling_handler.go         // ë„ë©”ì¸ í•¸ë“¤ëŸ¬ v2
    â”‚   â”œâ”€â”€ server.go                       // handlerê°€ ë§ì„ ê²½ìš°, handlerë¥¼ ë“±ë¡í•  serverë¥¼ ë‘¡ë‹ˆë‹¤
    â”‚   â”œâ”€â”€ health_handler.go               // v1, v2 ê³µí†µ í•¸ë“¤ëŸ¬
    â”‚   â”œâ”€â”€ swagger_handler.go              // í”„ë¡œì íŠ¸ í…ŒìŠ¤íŠ¸ ìš© openapi í•¸ë“¤ëŸ¬ (CORS í—ˆìš©)
    â”‚   â””â”€â”€ auth_middleware.go              // ë¯¸ë“¤ì›¨ì–´ë“¤
    â”œâ”€â”€ data
    â”‚   â”œâ”€â”€ mysqldb.go                      // DB client ì»¤ë„¥í„°
    â”‚   â”œâ”€â”€ redis.go                        // DB client ì»¤ë„¥í„°
    â”‚   â”œâ”€â”€ feature_event_producer.go       // Kafka event producer - xxx_producer
    â”‚   â”œâ”€â”€ match_repository.go             // ORM ìˆ˜í–‰ repository (DB client ì£¼ì…) - xxx_repository
    â”‚   â””â”€â”€ nass_api.go                     // ì™¸ë¶€ API Data Layer - xxx_api
    â”œâ”€â”€ *service
    â”‚   â”œâ”€â”€ kda_sampler.go                  // Data layer í˜¹ì€ ë‹¤ë¥¸ serviceë¥¼ ì£¼ì… ë°›ì•„ êµ¬í˜„
    â”‚   â”œâ”€â”€ match_sampling_usecase.go       // service ê°€ ë§ì„ ê²½ìš°, ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•´ì£¼ëŠ” ìœ ì¦ˆì¼€ì´ìŠ¤ êµ¬í˜„
    â”‚   â””â”€â”€ kda_sampler_test.go             // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ìœ ë‹›í…ŒìŠ¤íŠ¸
    â”œâ”€â”€ logger.go                           // ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ì‚¬ìš©ë  ê¸°ëŠ¥
    â”œâ”€â”€ constants.go                        // ì™¸ë¶€ì—ì„œ ì°¸ì¡° ë˜ì–´ì•¼ í•˜ëŠ” ìƒìˆ˜ ê°’ ì •ì˜
    â””â”€â”€ *config.go                          // application ì„¤ì • íŒŒì¼
â”œâ”€â”€ *gitlab-ci.yml
â”œâ”€â”€ *go.mod
â”œâ”€â”€ *go.sum
â””â”€â”€ *README.md                    // í”„ë¡œì íŠ¸ì— ëŒ€í•œ ë°°ê²½, ìœ ì¦ˆì¼€ì´ìŠ¤, ì„¤ì¹˜ ë°©ë²• ê¸°ìˆ 
</code></pre><p><img loading=lazy src=/posts/go-convention/layered-architecture.png></p><table><thead><tr><th>êµ¬ë¶„</th><th>í•„ìˆ˜ ì—¬ë¶€</th><th>ì„¤ëª…</th><th>ì˜ˆì‹œ</th></tr></thead><tbody><tr><td><strong>docs</strong></td><td>âœ”</td><td>í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜, ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨, ìŠ¤ì›¨ê±° ë¬¸ì„œë¥¼ ê´€ë¦¬</td><td>- swagger.yaml- sequence.md</td></tr><tr><td><strong>cmd</strong></td><td>âœ”</td><td>í”„ë¡œì íŠ¸ ì§„ì…ì , ì‹¤í–‰ ê°€ëŠ¥í•œ íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸ ê´€ë¦¬</td><td>- main.go- start.sh</td></tr><tr><td><strong>pkg</strong></td><td></td><td>ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¢…ì†ì ì´ì§€ ì•Šì€ ìœ í‹¸ë¦¬í‹° ê¸°ëŠ¥ ê´€ë¦¬</td><td>- time_convertor.go- file_parser.go</td></tr><tr><td><strong>internal</strong></td><td>âœ”</td><td>ì™¸ë¶€ì— ê³µê°œë˜ë©´ ì•ˆë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ë„ë©”ì¸) ì˜ì—­ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì—­ì—ì„œ ì‚¬ìš©ë  ê¸°ëŠ¥ ë‹´ë‹¹</td><td>- config.go- logger.go- constants.go</td></tr><tr><td><strong>internal/</strong><strong>handler</strong></td><td>âœ”</td><td>APIë¼ë©´ API Handlerì¼ ê²ƒì´ê³  Consumerë¼ë©´ Consumer Handler ë‹´ë‹¹- ë²„ì €ë‹ì€ *í•„ìˆ˜, HTTP/gRPC/MQ/Kafka ì™€ì˜ í†µì‹ ì„ ë‹´ë‹¹- ë¯¸ë“¤ì›¨ì–´ëŠ” Optional- handlerê°€ ì—¬ëŸ¬ê°œì¼ ê²½ìš°, server ì—ì„œ handlerë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤</td><td>- blacklist_handler.go- alive_handler.go- log_middleware.go- server.go</td></tr><tr><td><strong>internal/</strong><strong>data</strong></td><td></td><td>3 Tier Architecture ì¤‘, Data Layer ì˜ì—­ì˜ì†ì„±ì„ ê°€ì§„ ë°ì´í„° CRUD ë‹´ë‹¹(ì™¸ë¶€ API ë˜í•œ í•´ë‹¹ë¨, Kafka ë˜í•œ streamì— ì €ì¥í•˜ëŠ” í–‰ìœ„ë¡œ ê°„ì£¼)</td><td>- event_producer.go- blacklist_repository.go- member_api.go</td></tr><tr><td><strong>internal/</strong><strong>service</strong></td><td>âœ”</td><td>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì—­- ê°ê°ì˜ ì„œë¹„ìŠ¤ëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ì— ë”°ë¼ í•˜ë‚˜ì˜ ì±…ì„ë§Œ ìˆ˜í–‰- ì„œë¹„ìŠ¤ê°€ ë‹¤ìˆ˜ì¼ ê²½ìš°, ì´ë¥¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•´ì£¼ëŠ” xxx_usecaseë¡œ êµ¬í˜„- ì„œë¹„ìŠ¤ ì½”ë“œì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” í•„ìˆ˜ (ì¼ë¶€ ì˜ì¡´ì„±ì— ë”°ë¥¸ í…ŒìŠ¤íŠ¸ ë¶ˆê°€ ì‹œ íŒ¨ìŠ¤)</td><td>- fraud_detect_usecase.go- fraud_retriever.go- rule_analyzer.go</td></tr><tr><td><strong>./ (root)</strong></td><td>âœ”</td><td>í”„ë¡œì íŠ¸ ì‹¤í–‰ ë° ìš´ì˜ì„ ìœ„í•œ íŒŒì¼ ì˜ì—­- ë¦¬ë“œë¯¸ëŠ” í•„ìˆ˜ë¡œ ì‘ì„± (ìœ ì¦ˆì¼€ì´ìŠ¤ì™€ ì„¤ì¹˜ ë°©ë²•ì€ í•­ìƒ ê¸°ìˆ )</td><td>- gitlab-ci.yml- README.md</td></tr></tbody></table><h2 id=ìƒìˆ˜-ì»¨ë²¤ì…˜>ìƒìˆ˜ ì»¨ë²¤ì…˜<a hidden class=anchor aria-hidden=true href=#ìƒìˆ˜-ì»¨ë²¤ì…˜>#</a></h2><p>ê¸°ë³¸ì ìœ¼ë¡œ ì¹´ë©œì¼€ì´ìŠ¤ì™€ íŒŒìŠ¤ì¹¼ì¼€ì´ìŠ¤ë¥¼ ì›ì¹™ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤</p><p>â†’ í•˜ë‚˜ì˜ ë„ë©”ì¸ íŒŒì¼ì—ì„œ ë„ë©”ì¸ê³¼ ê´€ë ¨ëœ ìƒìˆ˜ê°€ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ì— ì†í•´ ìˆëŠ” ê²½ìš°, ìˆ˜ì •ì—ë„ ì–´ë µê³  ì¶”ì ì—ë„ ê·€ì°®ìŒì´ ë™ë°˜ ë¨ì„ ëŠê¼ˆìŠµë‹ˆë‹¤</p><p>â†’ í•˜ë‚˜ì˜ ì±…ì„ì„ ì§€ëŠ” íŒŒì¼ ë‚´ì—ì„œ private ìƒìˆ˜ë¡œì„œ ê´€ë¦¬ ëœë‹¤ë©´ ìœ ì§€ë³´ìˆ˜ì—ë„ ìš©ì´í•  ê²ƒì´ê³  ì½”ë“œ íŒŒì•…ì—ë„ ìš©ì´í•  ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤</p><h3 id=ë³µìˆ˜-íŒ¨í‚¤ì§€ì—ì„œ-ë‹¤ìˆ˜-ì˜ì¡´ë -ì—¬ì§€ê°€-ìˆëŠ”-ê²½ìš°-pascal>ë³µìˆ˜ íŒ¨í‚¤ì§€ì—ì„œ ë‹¤ìˆ˜ ì˜ì¡´ë  ì—¬ì§€ê°€ ìˆëŠ” ê²½ìš° (Pascal)<a hidden class=anchor aria-hidden=true href=#ë³µìˆ˜-íŒ¨í‚¤ì§€ì—ì„œ-ë‹¤ìˆ˜-ì˜ì¡´ë -ì—¬ì§€ê°€-ìˆëŠ”-ê²½ìš°-pascal>#</a></h3><p>internal layerì˜ constants.go íŒŒì¼ì— ìƒìˆ˜ ê°’ë“¤ì„ ì •ì˜ í•©ë‹ˆë‹¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>internal</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>LanguageCodeKorean</span>   <span class=p>=</span> <span class=s>&#34;ko&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>LanguageCodeEnglish</span>  <span class=p>=</span> <span class=s>&#34;en&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>LanguageCodeChinese</span>  <span class=p>=</span> <span class=s>&#34;zh_CN&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>LanguageCodeJapanese</span> <span class=p>=</span> <span class=s>&#34;ja&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h3 id=í•˜ë‚˜ì˜-íŒ¨í‚¤ì§€-ë‚´-í˜¹ì€-í•˜ë‚˜ì˜-íŒŒì¼ì—ì„œ-ì‚¬ìš©í• -ê²½ìš°-camel>í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë‚´ í˜¹ì€ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  ê²½ìš° (Camel)<a hidden class=anchor aria-hidden=true href=#í•˜ë‚˜ì˜-íŒ¨í‚¤ì§€-ë‚´-í˜¹ì€-í•˜ë‚˜ì˜-íŒŒì¼ì—ì„œ-ì‚¬ìš©í• -ê²½ìš°-camel>#</a></h3><p>ë™ì¼ íŒ¨í‚¤ì§€ ë‚´ì—ì„œëŠ” private ë³€ìˆ˜ì— ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>handler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=c1>// resultSuccess : ì„±ê³µ ì‘ë‹µ</span>
</span></span><span class=line><span class=cl>	<span class=nx>resultSuccess</span> <span class=p>=</span> <span class=s>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// resultFailure : ì‹¤íŒ¨ ì‘ë‹µ</span>
</span></span><span class=line><span class=cl>	<span class=nx>resultFailure</span> <span class=p>=</span> <span class=s>&#34;false&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h3 id=ë¶ˆê°€í”¼í•˜ê²Œ-ë‹¤ë¥¸-íŒ¨í‚¤ì§€ë¡œë¶€í„°-ì°¸ì¡°ë˜ì–´ì•¼-í•˜ëŠ”-ê²½ìš°>ë¶ˆê°€í”¼í•˜ê²Œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¡œë¶€í„° ì°¸ì¡°ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°<a hidden class=anchor aria-hidden=true href=#ë¶ˆê°€í”¼í•˜ê²Œ-ë‹¤ë¥¸-íŒ¨í‚¤ì§€ë¡œë¶€í„°-ì°¸ì¡°ë˜ì–´ì•¼-í•˜ëŠ”-ê²½ìš°>#</a></h3><p>ìƒìˆ˜ëŠ” privateìœ¼ë¡œ, structì˜ Public í•¨ìˆ˜ë¡œ ì°¸ì¡° ë  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>handler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=c1>// samplerEndpoint : ë§¤ì¹˜ ìƒ˜í”Œë§ ì—”ë“œí¬ì¸ë“œ</span>
</span></span><span class=line><span class=cl>	<span class=nx>samplerEndpoint</span> <span class=p>=</span> <span class=s>&#34;/v1/:match_id&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Endpoint : í•¸ë“¤ëŸ¬ì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë°˜í™˜</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>SamplerHandler</span><span class=p>)</span> <span class=nf>Endpoint</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>samplerEndpoint</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=ë°ì´í„°-ëª¨ë¸-ì»¨ë²¤ì…˜>ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜<a hidden class=anchor aria-hidden=true href=#ë°ì´í„°-ëª¨ë¸-ì»¨ë²¤ì…˜>#</a></h2><p>ë°ì´í„° ëª¨ë¸ì€ ê°€ê¸‰ì  ë³„ë„ íŒŒì¼ì´ ì•„ë‹Œ, ìˆ˜í–‰ë˜ëŠ” íŒŒì¼ì—ì„œ ì •ì˜í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤</p><p>â†’ modelì„ ë³„ë„ë¡œ ì§€ì •í•´ ë‘˜ ê²½ìš°, íŠ¹ì • ë„ë©”ì¸ì— ëŒ€í•œ ìˆ˜ì •ì´ ìˆì„ ë•Œ ì°¸ì¡°ëœ ì—¬ëŸ¬ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ì¡´ì¬í•©ë‹ˆë‹¤</p><p>â†’ ê°™ì€ ê³„ì¸µ ê°„ì˜ ë°ì´í„° ì´ë™ì— ëŒ€í•´ì„œëŠ” íŒŒë¼ë¯¸í„°ë¡œ ì£¼ê³  ë°›ê³  ë‹¤ë¥¸ ë ˆì´ì–´ ê°„ í†µì‹ ì€ *ë ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜ì— ë”°ë¼ ë°ì´í„° ëª¨ë¸ì„ ì£¼ê³  ë°›ìŠµë‹ˆë‹¤</p><p>â†’ parameterê°€ ë‘ ê°œ ì´ìƒì¼ ê²½ìš°, ë°ì´í„° ëª¨ë¸ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•©ë‹ˆë‹¤</p><h3 id=ë ˆì´ì–´-ê°„-ë°ì´í„°-ëª¨ë¸-ì»¨ë²¤ì…˜>ë ˆì´ì–´ ê°„ ë°ì´í„° ëª¨ë¸ ì»¨ë²¤ì…˜<a hidden class=anchor aria-hidden=true href=#ë ˆì´ì–´-ê°„-ë°ì´í„°-ëª¨ë¸-ì»¨ë²¤ì…˜>#</a></h3><p><strong>handler â†’ service</strong></p><p>request â†’ serviceDTO</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>Handler</span><span class=p>)</span> <span class=nf>CreateMatch</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>req</span> <span class=nx>matchRequest</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBindJSON</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>req</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Service í˜¸ì¶œ</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span> <span class=o>:=</span> <span class=nx>h</span><span class=p>.</span><span class=nx>service</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nf>ToServiceDTO</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=c1>// so on</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>service â†’ data</strong></p><p>serviceDTO â†’ entity</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>MatchCreater</span><span class=p>)</span> <span class=nf>Create</span><span class=p>(</span><span class=nx>match</span> <span class=nx>MatchDTO</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=c1>// repository ê³„ì¸µì— MatchEntity ì‚½ì… ìš”ì²­</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>b</span><span class=p>.</span><span class=nx>repository</span><span class=p>.</span><span class=nf>Insert</span><span class=p>(</span><span class=nx>match</span><span class=p>.</span><span class=nf>ToEntity</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>id</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>data â†’ service</strong></p><p>entity â†’ serviceDTO</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>MatchRepository</span><span class=p>)</span> <span class=nf>Insert</span><span class=p>(</span><span class=nx>entity</span> <span class=nx>MatchEntity</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ë°ì´í„° ë ˆì´ì–´ì—ì„œ UserEntity ê°€ì ¸ì˜¤ê¸°</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>entity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>result</span><span class=p>.</span><span class=nx>ID</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=ë°ì´í„°-ëª¨ë¸ì—ì„œì˜-ì¡°ê±´-ê²€ì‚¬>ë°ì´í„° ëª¨ë¸ì—ì„œì˜ ì¡°ê±´ ê²€ì‚¬<a hidden class=anchor aria-hidden=true href=#ë°ì´í„°-ëª¨ë¸ì—ì„œì˜-ì¡°ê±´-ê²€ì‚¬>#</a></h3><p>ëª¨ë¸ì„ ì£¼ê³  ë°›ëŠ” ê²½ìš°, ê°€ë…ì„±ì„ ìœ„í•´ ì¡°ê±´ ê²€ì‚¬ëŠ” í•¨ìˆ˜ë¡œ ì‹¤ì‹œ í•©ë‹ˆë‹¤</p><p>ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì— ìš©ì´ í•˜ë©°, í•œëˆˆì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ íŒŒì•…í•˜ê¸° ì‰¬ì›Œ ì§‘ë‹ˆë‹¤</p><p>[AS-IS]</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>MatchCreater</span><span class=p>)</span> <span class=nf>Create</span><span class=p>(</span><span class=nx>match</span> <span class=nx>MatchDTO</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>HasPrefix</span><span class=p>(</span><span class=nx>match</span><span class=p>.</span><span class=nx>Version</span><span class=p>,</span> <span class=s>&#34;rc&#34;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>match</span><span class=p>.</span><span class=nx>detail</span> <span class=o>==</span> <span class=s>&#34;test&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>[TO-BE]</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>b</span> <span class=o>*</span><span class=nx>MatchCreater</span><span class=p>)</span> <span class=nf>Create</span><span class=p>(</span><span class=nx>match</span> <span class=nx>MatchDTO</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>match</span><span class=p>.</span><span class=nf>IsTest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=í…ŒìŠ¤íŠ¸-ì»¨ë²¤ì…˜>í…ŒìŠ¤íŠ¸ ì»¨ë²¤ì…˜<a hidden class=anchor aria-hidden=true href=#í…ŒìŠ¤íŠ¸-ì»¨ë²¤ì…˜>#</a></h2><p>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í…ŒìŠ¤íŠ¸ëŠ” ì„ íƒì‚¬í•­ì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤.
ì´ë¯¸ ì •ì˜ëœ ì—ëŸ¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ëŠ” ìµœëŒ€í•œ ìƒì„¸í•˜ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•©ë‹ˆë‹¤.</p><h3 id=deterministic-ë¹„ë™ê¸°-ë‹¨ìœ„-í…ŒìŠ¤íŠ¸>Deterministic ë¹„ë™ê¸° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸<a hidden class=anchor aria-hidden=true href=#deterministic-ë¹„ë™ê¸°-ë‹¨ìœ„-í…ŒìŠ¤íŠ¸>#</a></h3><p>ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ ê°’ì„ í™•ì¸í•˜ì§€ ì•Šê±°ë‚˜ <code>time sleep</code> ì´í›„ì˜ ë¡œê¹…ì„ ë©ˆì¶”ì„¸ìš”</p><p><code>DI + Eventually</code>ë¥¼ í†µí•œ <strong>flaky testë¥¼ ë°©ì§€</strong>í•©ë‹ˆë‹¤</p><ol><li>ë¡œê±° ì£¼ì…</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// NewQueue ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•  Queue ìƒì„±ì</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewQueue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>config</span> <span class=nx>Config</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>httpClient</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>logger</span> <span class=o>*</span><span class=nx>zerolog</span><span class=p>.</span><span class=nx>Logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>(</span><span class=nx>queue</span> <span class=nx>Queue</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// queueëŠ” Start()ë¥¼ í†µí•´ thread executorê°€ ì‹¤í–‰ë ë•Œì— ìƒì„±ë©ë‹ˆë‹¤.</span>
</span></span><span class=line><span class=cl>	<span class=nx>queue</span> <span class=p>=</span> <span class=nx>Queue</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>config</span><span class=p>:</span>   <span class=nx>config</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>client</span><span class=p>:</span>   <span class=nx>httpClient</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>logger</span><span class=p>:</span>   <span class=nx>logger</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>quitChan</span><span class=p>:</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>struct</span><span class=p>{}),</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ol start=2><li>ì‘ë‹µ ê°’ í…ŒìŠ¤íŠ¸</li></ol><ul><li>í ë¡œì§ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;í ì²˜ë¦¬ ì‹¤íŒ¨ì‹œ, ì‹¤íŒ¨ ë¡œê¹… í…ŒìŠ¤íŠ¸&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// given</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>buffer</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>ë¡œê±°</span> <span class=nx>ì˜ì¡´ì„±</span> <span class=nx>ì£¼ì…</span> Â  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// when</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>ë¹„ë™ê¸°</span> <span class=nx>ì‘ì—…</span> <span class=nx>ìˆ˜í–‰</span>
</span></span><span class=line><span class=cl>    <span class=nx>event1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON1</span><span class=p>))</span>
</span></span><span class=line><span class=cl> 	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=nx>event2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON2</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>  	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// then</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>Eventually</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>output</span> <span class=o>:=</span> <span class=nx>buffer</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event1</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event2</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=s>`&#34;success&#34;:false`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=mi>1</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=mi>10</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><ul><li>í ë¡œì§ ì„±ê³µ í…ŒìŠ¤íŠ¸</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;í ì²˜ë¦¬ ì„±ê³µì‹œ, ì„±ê³µ ë¡œê¹… í…ŒìŠ¤íŠ¸&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// given</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>buffer</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>ë¡œê±°</span> <span class=nx>ì˜ì¡´ì„±</span> <span class=nx>ì£¼ì…</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// when</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span> <span class=nx>ë¹„ë™ê¸°</span> <span class=nx>ì‘ì—…</span> <span class=nx>ìˆ˜í–‰</span>
</span></span><span class=line><span class=cl>    <span class=nx>event1</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON1</span><span class=p>))</span>
</span></span><span class=line><span class=cl> 	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=nx>event2</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>queue</span><span class=p>.</span><span class=nf>Push</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>validJSON2</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>  	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// then</span>
</span></span><span class=line><span class=cl>	<span class=nx>assert</span><span class=p>.</span><span class=nf>Eventually</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>output</span> <span class=o>:=</span> <span class=nx>buffer</span><span class=p>.</span><span class=nf>String</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event1</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=nx>event2</span><span class=p>.</span><span class=nf>TraceID</span><span class=p>().</span><span class=nf>String</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>			<span class=nx>strings</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>output</span><span class=p>,</span> <span class=s>`&#34;success&#34;:true`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span> <span class=mi>1</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=mi>10</span><span class=o>*</span><span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/tags/go/>Go</a></li><li><a href=https://dingyu.dev/tags/convention/>Convention</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/posts/grpc/><span class=title>Â« ì´ì „ í˜ì´ì§€</span><br><span>[Protocol] RPC... ê·¸ë¦¬ê³  GRPC í†ºì•„ë³´ê¸°</span>
</a><a class=next href=https://dingyu.dev/posts/es-to-loki/><span class=title>ë‹¤ìŒ í˜ì´ì§€ Â»</span><br><span>[LGTM] Elasticsearch to Loki ì „í™˜ê¸°</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/>Ding's Coding Forge</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="ë³µì‚¬";function s(){t.innerHTML="ë³µì‚¬ ì™„ë£Œ!",setTimeout(()=>{t.innerHTML="ë³µì‚¬"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
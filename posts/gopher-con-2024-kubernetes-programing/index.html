<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍 | Ding's Coding Forge</title>
<meta name=keywords content="go,kubernetes,good practice"><meta name=description content="go 기반으로 k8s API를 사용하는 법&mldr; 오퍼레이터로 배포하는 애플리케이션"><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.678f9035c217c5346e0b3de5bdc9ebac02c53b0502219858f8653d8d181c97b3.css integrity="sha256-Z4+QNcIXxTRuCz3lvcnrrALFOwUCIZhY+GU9jRgcl7M=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=ko href=https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/><link rel=alternate hreflang=en href=https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍"><meta property="og:description" content="go 기반으로 k8s API를 사용하는 법… 오퍼레이터로 배포하는 애플리케이션"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-05T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Good Practice"><meta property="og:image" content="https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/img/go-thumbnail.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/img/go-thumbnail.png"><meta name=twitter:title content="[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍"><meta name=twitter:description content="go 기반으로 k8s API를 사용하는 법&mldr; 오퍼레이터로 배포하는 애플리케이션"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/posts/"},{"@type":"ListItem","position":2,"name":"[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍","item":"https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍","name":"[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍","description":"go 기반으로 k8s API를 사용하는 법\u0026hellip; 오퍼레이터로 배포하는 애플리케이션","keywords":["go","kubernetes","good practice"],"articleBody":"쿠버네티스 API 쿠버네티스 플랫폼과 상호작용할 수 있는 인터페이스 사용자, 관리자, 애플리케이션이 클러스터 및 리소스를 관리하는 목적으로 사용가능 리소스 목록을 얻거나 생성하는 일련의 작업 수행 가능 애플리케이션 배포 및 상태 모니터링 기능 제공 HTTP API 형태로 제공되어 다양한 언어 및 도구 지원 https://////\nAPI SERVER : API 서버 주소 GROUP : 리소스 그룹 /api : 쿠버네티스 코어 API 그룹 기본적이고 필수적인 리소스 : Pod, Service 등 /apis/* : 쿠버네티스 확장 API 그룹 애플리케이션 배포 및 확장 기능에 관계된 리소스 VERSION : v1 (안정 버전), v1beta, v1alpha1 RESOURCE : 접근하려는 리소스 종류 (/pods, /services) NAMESPACE : 리소스가 속한 네임스페이스 이름 네임스페이스 범위 리소스를 네임스페이스 조건을 빼고 조회하면 모든 네임스페이스 검색 NAME : 접근하려는 리소스 이름 지정 client-go 라이브러리 쿠버네티스 API 호출을 추상화해 사용하기 편하게 제공\n쿠버네티스 코어 그룹과 확장 그룹 모두 접근 가능\n기본 리소스 외 사용자 정의 리소스 접근 및 사용 가능 클러스터 내부/외부에서 초기화 기능 지원\n리소스 변경 사항을 캐싱하는 Informers등 다양한 기능 지원 Pods(\"\")로 조회할 경우, 모든 네임스페이스 조회 가능 (단, 접근 권한을 가진 네임스페이스 한정) Deployment 리소스를 동시에 변경하는 경우 가장 먼저 도착한 변경 사항은 적용되고 나머지는 실패 → First Updater Wins! MVCC와 유사하다고 생각됨. version 충돌을 검사하여 충돌 방지 (lost update 발생되지 않음) 서로 다른 서버에서 동시에 이미지 변경 시도 → 한 요청이 성공하면 다른 요청은 Conflict 에러와 함께 실패\n낙관적 동시성 Step 1 Step 2 Step 3 변경 요청을 전송하면 리소스 버전을 이용해 충돌 감지 저장된 리소스 버전과 동일한 버전을 가진 변경 사항을 적용 리소스 버전이 다른 수정 사항은 충돌 실패 MVCC와 유사하게 버전 충돌로 인한 에러의 경우 Retry 설정을 통해 해결\nretry.RetryOnConflict() 함수를 이용해 간단하게 사용 가능!\n쿠버네티스 컨트롤러와 오퍼레이터 컨트롤러\n쿠버네티스 기본 리소스를 주로 관리하는 목적 Pod, Deployment, Service 등의 리소스 관리 오퍼레이터\n사용자 정의 리소스를 통해 복잡한 상태 관리 가능 애플리케이션 배포 및 관리 자동화를 위해 사용 kubebuilder 프레임워크 쿠버네티스 컨트롤러 혹은 오퍼레이터를 개발하기 위한 Go 프레임워크 사용자 리소스 관리 스크립트 및 컨트롤러 기본 코드 제공 오퍼레이터를 통해 관리하려는 대상에 집중 가능 client-go 라이브러리를 이용해도 됨 → 하지만 매우 복잡한 작업이 필요 Process : 애플리케이션 설정 및 초기화 Manager : API 서버와 통신, 이벤트 캐시, 메트릭 노출, … Webhook : 리소스 초기화, 데이터 검증을 진행할 웹 훅 설정 Controller : 리소스 이벤트를 필터링해 Reconciler 호출 Reconciler : 사용자 리소스를 관리하는 실질적인 로직 구현 SPEC : 리소스 특징 및 원하는 상태 지정 Status : 리소스 현재 상태 표현 컨트롤러 옵션 설정 리소스가 변경될 때 호출되는 Reconcile() 함수 관련 설정\n변경 감지 리소스, 필터, 성능 옵션 등 다양한 설정 변경 가능 Spec 속성이 변경될 때만 Reconcile() 함수가 호출되도록 Generation 필드를 사용하는 이벤트 필터 설정\nReconcile() 함수가 동시에 몇 개까지 실행될 수 있는지 컨트롤러 옵션을 이용해 설정\nReconcile() 함수가 호출되는 상황 처음 오퍼레이터가 실행되는 경우 모든 리소스를 순회하면서 Reconcile() 함수 호출 리소스가 변경되는 경우 일반적으로 리소스 필드가 변경되면 호출 Spec 속성이 변경될 때만 호출되도록 설정 가능 후기 일반적인 케이스에서 CPU 와 메모리를 통한 오토스케일링이 기본적으로 설정되어 있다. 하지만 애플리케이션의 특성에 따라 이를 커스텀하게 변경하는 것도 고려해보면 좋을 것 같다. 예를 들어 큐에서 하나의 일을 순차적으로 처리하는 서버일 경우, Queue Size Limit을 검사하여 오토스케일링이 가능할 듯 하다 동시로 배포를 요구하는 상황은 없겠지만 Conflict로 인한 실패를 커스텀 컨트롤러에서는 방지할 수 있을 것이다. 런덱을 매번 생성해달라 할 필요 없이, daemon set으로 오퍼레이터를 띄워, 자동화를 거칠 수 있지 않을까? (위험 부담이 있긴 할 것같다) ","wordCount":"534","inLanguage":"ko","image":"https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/img/go-thumbnail.png","datePublished":"2024-11-05T00:00:00Z","dateModified":"2024-11-05T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/posts/gopher-con-2024-kubernetes-programing/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button><span class=nav-separator>|</span><div class=lang-select-dropdown><button class=lang-select-dropdown-trigger aria-label=번역 type=button><svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" width="24" height="18"><path d="M478.33 433.6l-90-218a22 22 0 00-40.67.0l-90 218a22 22 0 1040.67 16.79L316.66 406h102.67l18.33 44.39A22 22 0 00458 464a22 22 0 0020.32-30.4zM334.83 362 368 281.65 401.17 362z" fill="currentcolor"/><path d="M267.84 342.92a22 22 0 00-4.89-30.7c-.2-.15-15-11.13-36.49-34.73 39.65-53.68 62.11-114.75 71.27-143.49H330a22 22 0 000-44H214V70a22 22 0 00-44 0v20H54a22 22 0 000 44h197.25c-9.52 26.95-27.05 69.5-53.79 108.36-31.41-41.68-43.08-68.65-43.17-68.87a22 22 0 00-40.58 17c.58 1.38 14.55 34.23 52.86 83.93.92 1.19 1.83 2.35 2.74 3.51-39.24 44.35-77.74 71.86-93.85 80.74a22 22 0 1021.07 38.63c2.16-1.18 48.6-26.89 101.63-85.59 22.52 24.08 38 35.44 38.93 36.1a22 22 0 0030.75-4.9z" fill="currentcolor"/></svg></button><div class=lang-select-dropdown-content><a lang=en href=https://dingyu.dev/en/ title=English aria-label=English>English</a></div></div></div></div><ul id=menu><li><a href=https://dingyu.dev/ko/about/ title=소개><span>소개</span></a></li><li><a href=https://dingyu.dev/categories/ title=카테고리><span>카테고리</span></a></li><li><a href=https://dingyu.dev/tags/ title=태그><span>태그</span></a></li><li><a href=https://dingyu.dev/ko/archives/ title=아카이브><span>아카이브</span></a></li><li><a href=https://dingyu.dev/ko/search/ title="검색 (Alt + /)" accesskey=/><span>검색</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/>홈</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Go] Gophercon 2024 - 쿠버네티스 플랫폼 프로그래밍</h1><div class=post-meta><span title='2024-11-05 00:00:00 +0000 UTC'>11월 5, 2024</span>&nbsp;·&nbsp;3 분&nbsp;·&nbsp;534 단어&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;번역:<ul class=i18n_list><li><a href=https://dingyu.dev/en/posts/gopher-con-2024-kubernetes-programing/>En</a></li></ul>&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/gopher-con-2024-kubernetes-programing/index.ko.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/go-thumbnail.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><li><a href=#%ec%bf%a0%eb%b2%84%eb%84%a4%ed%8b%b0%ec%8a%a4-api aria-label="쿠버네티스 API">쿠버네티스 API</a></li><li><a href=#client-go-%eb%9d%bc%ec%9d%b4%eb%b8%8c%eb%9f%ac%eb%a6%ac aria-label="client-go 라이브러리">client-go 라이브러리</a><ul><li><a href=#deployment-%eb%a6%ac%ec%86%8c%ec%8a%a4%eb%a5%bc-%eb%8f%99%ec%8b%9c%ec%97%90-%eb%b3%80%ea%b2%bd%ed%95%98%eb%8a%94-%ea%b2%bd%ec%9a%b0 aria-label="Deployment 리소스를 동시에 변경하는 경우">Deployment 리소스를 동시에 변경하는 경우</a></li><li><a href=#%ec%84%9c%eb%a1%9c-%eb%8b%a4%eb%a5%b8-%ec%84%9c%eb%b2%84%ec%97%90%ec%84%9c-%eb%8f%99%ec%8b%9c%ec%97%90-%ec%9d%b4%eb%af%b8%ec%a7%80-%eb%b3%80%ea%b2%bd-%ec%8b%9c%eb%8f%84 aria-label="서로 다른 서버에서 동시에 이미지 변경 시도">서로 다른 서버에서 동시에 이미지 변경 시도</a></li><li><a href=#%eb%82%99%ea%b4%80%ec%a0%81-%eb%8f%99%ec%8b%9c%ec%84%b1 aria-label="낙관적 동시성">낙관적 동시성</a></li></ul></li><li><a href=#%ec%bf%a0%eb%b2%84%eb%84%a4%ed%8b%b0%ec%8a%a4-%ec%bb%a8%ed%8a%b8%eb%a1%a4%eb%9f%ac%ec%99%80-%ec%98%a4%ed%8d%bc%eb%a0%88%ec%9d%b4%ed%84%b0 aria-label="쿠버네티스 컨트롤러와 오퍼레이터">쿠버네티스 컨트롤러와 오퍼레이터</a></li><li><a href=#kubebuilder-%ed%94%84%eb%a0%88%ec%9e%84%ec%9b%8c%ed%81%ac aria-label="kubebuilder 프레임워크">kubebuilder 프레임워크</a></li><li><a href=#%ec%bb%a8%ed%8a%b8%eb%a1%a4%eb%9f%ac-%ec%98%b5%ec%85%98-%ec%84%a4%ec%a0%95 aria-label="컨트롤러 옵션 설정">컨트롤러 옵션 설정</a><ul><ul><li><a href=#reconcile-%ed%95%a8%ec%88%98%ea%b0%80-%ed%98%b8%ec%b6%9c%eb%90%98%eb%8a%94-%ec%83%81%ed%99%a9 aria-label="Reconcile() 함수가 호출되는 상황">Reconcile() 함수가 호출되는 상황</a></li></ul></ul></li><li><a href=#%ed%9b%84%ea%b8%b0 aria-label=후기>후기</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=쿠버네티스-api>쿠버네티스 API<a hidden class=anchor aria-hidden=true href=#쿠버네티스-api>#</a></h2><ul><li>쿠버네티스 플랫폼과 상호작용할 수 있는 인터페이스</li><li>사용자, 관리자, 애플리케이션이 클러스터 및 리소스를 관리하는 목적으로 사용가능</li><li>리소스 목록을 얻거나 생성하는 일련의 작업 수행 가능</li><li>애플리케이션 배포 및 상태 모니터링 기능 제공</li><li>HTTP API 형태로 제공되어 다양한 언어 및 도구 지원</li></ul><blockquote><p><code>https://&lt;APISERVER>/&lt;GROUP>/&lt;VERSION>/&lt;RESOURCE>/&lt;NAME></code></p></blockquote><ul><li>API SERVER : API 서버 주소</li><li>GROUP : 리소스 그룹<ul><li>/api : 쿠버네티스 코어 API 그룹<ul><li>기본적이고 필수적인 리소스 : Pod, Service 등</li></ul></li><li>/apis/* : 쿠버네티스 확장 API 그룹<ul><li>애플리케이션 배포 및 확장 기능에 관계된 리소스</li></ul></li></ul></li><li>VERSION : v1 (안정 버전), v1beta, v1alpha1</li><li>RESOURCE : 접근하려는 리소스 종류 (/pods, /services)<ul><li><ul><li>NAMESPACE : 리소스가 속한 네임스페이스 이름</li><li>네임스페이스 범위 리소스를 네임스페이스 조건을 빼고 조회하면 모든 네임스페이스 검색</li></ul></li></ul></li><li>NAME : 접근하려는 리소스 이름 지정</li></ul><h2 id=client-go-라이브러리>client-go 라이브러리<a hidden class=anchor aria-hidden=true href=#client-go-라이브러리>#</a></h2><ul><li><p>쿠버네티스 API 호출을 추상화해 사용하기 편하게 제공</p></li><li><p>쿠버네티스 코어 그룹과 확장 그룹 모두 접근 가능</p><ul><li>기본 리소스 외 사용자 정의 리소스 접근 및 사용 가능</li></ul></li><li><p>클러스터 내부/외부에서 초기화 기능 지원</p></li><li><p>리소스 변경 사항을 캐싱하는 Informers등 다양한 기능 지원
<img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image.png></p></li><li><p>Pods("")로 조회할 경우, 모든 네임스페이스 조회 가능 (단, 접근 권한을 가진 네임스페이스 한정)
<img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-1.png></p></li></ul><h3 id=deployment-리소스를-동시에-변경하는-경우>Deployment 리소스를 동시에 변경하는 경우<a hidden class=anchor aria-hidden=true href=#deployment-리소스를-동시에-변경하는-경우>#</a></h3><ul><li>가장 먼저 도착한 변경 사항은 적용되고 나머지는 실패 → First Updater Wins!<ul><li>MVCC와 유사하다고 생각됨. version 충돌을 검사하여 충돌 방지 (lost update 발생되지 않음)</li></ul></li></ul><h3 id=서로-다른-서버에서-동시에-이미지-변경-시도>서로 다른 서버에서 동시에 이미지 변경 시도<a hidden class=anchor aria-hidden=true href=#서로-다른-서버에서-동시에-이미지-변경-시도>#</a></h3><p><img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-2.png></p><p>→ 한 요청이 성공하면 다른 요청은 Conflict 에러와 함께 실패</p><h3 id=낙관적-동시성>낙관적 동시성<a hidden class=anchor aria-hidden=true href=#낙관적-동시성>#</a></h3><table><thead><tr><th>Step 1</th><th>Step 2</th><th>Step 3</th></tr></thead><tbody><tr><td><img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-3.png>변경 요청을 전송하면 리소스 버전을 이용해 충돌 감지</td><td><img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-4.png>저장된 리소스 버전과 동일한 버전을 가진 변경 사항을 적용</td><td><img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-5.png>리소스 버전이 다른 수정 사항은 충돌 실패</td></tr></tbody></table><p>MVCC와 유사하게 버전 충돌로 인한 에러의 경우 Retry 설정을 통해 해결</p><p><code>retry.RetryOnConflict()</code> 함수를 이용해 간단하게 사용 가능!</p><h2 id=쿠버네티스-컨트롤러와-오퍼레이터>쿠버네티스 컨트롤러와 오퍼레이터<a hidden class=anchor aria-hidden=true href=#쿠버네티스-컨트롤러와-오퍼레이터>#</a></h2><p><strong>컨트롤러</strong></p><ul><li>쿠버네티스 기본 리소스를 주로 관리하는 목적</li><li>Pod, Deployment, Service 등의 리소스 관리</li></ul><p><strong>오퍼레이터</strong></p><ul><li>사용자 정의 리소스를 통해 복잡한 상태 관리 가능</li><li>애플리케이션 배포 및 관리 자동화를 위해 사용</li></ul><h2 id=kubebuilder-프레임워크>kubebuilder 프레임워크<a hidden class=anchor aria-hidden=true href=#kubebuilder-프레임워크>#</a></h2><ul><li>쿠버네티스 컨트롤러 혹은 오퍼레이터를 개발하기 위한 Go 프레임워크</li><li>사용자 리소스 관리 스크립트 및 컨트롤러 기본 코드 제공</li><li>오퍼레이터를 통해 관리하려는 대상에 집중 가능</li><li>client-go 라이브러리를 이용해도 됨 → 하지만 매우 복잡한 작업이 필요</li></ul><p><img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-6.png></p><ul><li>Process : 애플리케이션 설정 및 초기화</li><li>Manager : API 서버와 통신, 이벤트 캐시, 메트릭 노출, &mldr;</li><li>Webhook : 리소스 초기화, 데이터 검증을 진행할 웹 훅 설정</li><li>Controller : 리소스 이벤트를 필터링해 Reconciler 호출</li><li>Reconciler : 사용자 리소스를 관리하는 실질적인 로직 구현</li></ul><p><img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-7.png></p><ul><li>SPEC : 리소스 특징 및 원하는 상태 지정</li><li>Status : 리소스 현재 상태 표현</li></ul><h2 id=컨트롤러-옵션-설정>컨트롤러 옵션 설정<a hidden class=anchor aria-hidden=true href=#컨트롤러-옵션-설정>#</a></h2><ul><li><p>리소스가 변경될 때 호출되는 Reconcile() 함수 관련 설정</p></li><li><p>변경 감지 리소스, 필터, 성능 옵션 등 다양한 설정 변경 가능
<img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-8.png></p></li><li><p>Spec 속성이 변경될 때만 Reconcile() 함수가 호출되도록 Generation 필드를 사용하는 이벤트 필터 설정</p></li><li><p>Reconcile() 함수가 동시에 몇 개까지 실행될 수 있는지 컨트롤러 옵션을 이용해 설정</p></li></ul><h4 id=reconcile-함수가-호출되는-상황>Reconcile() 함수가 호출되는 상황<a hidden class=anchor aria-hidden=true href=#reconcile-함수가-호출되는-상황>#</a></h4><ul><li>처음 오퍼레이터가 실행되는 경우<ul><li>모든 리소스를 순회하면서 Reconcile() 함수 호출</li></ul></li><li>리소스가 변경되는 경우<ul><li>일반적으로 리소스 필드가 변경되면 호출</li><li>Spec 속성이 변경될 때만 호출되도록 설정 가능
<img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-9.png>
<img loading=lazy src=/posts/gopher-con-2024-kubernetes-programing/image-10.png></li></ul></li></ul><h2 id=후기>후기<a hidden class=anchor aria-hidden=true href=#후기>#</a></h2><ul><li>일반적인 케이스에서 CPU 와 메모리를 통한 오토스케일링이 기본적으로 설정되어 있다. 하지만 애플리케이션의 특성에 따라 이를 커스텀하게 변경하는 것도 고려해보면 좋을 것 같다.<ul><li>예를 들어 큐에서 하나의 일을 순차적으로 처리하는 서버일 경우, Queue Size Limit을 검사하여 오토스케일링이 가능할 듯 하다</li></ul></li><li>동시로 배포를 요구하는 상황은 없겠지만 Conflict로 인한 실패를 커스텀 컨트롤러에서는 방지할 수 있을 것이다.</li><li>런덱을 매번 생성해달라 할 필요 없이, daemon set으로 오퍼레이터를 띄워, 자동화를 거칠 수 있지 않을까? (위험 부담이 있긴 할 것같다)</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/tags/go/>Go</a></li><li><a href=https://dingyu.dev/tags/kubernetes/>Kubernetes</a></li><li><a href=https://dingyu.dev/tags/good-practice/>Good Practice</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/posts/gopher-con-2024-go-project-guide/><span class=title>« 이전 페이지</span><br><span>[Go] Gophercon 2024 - 고언어 프로젝트 가이드 A-Z</span>
</a><a class=next href=https://dingyu.dev/posts/worker-pool-async/><span class=title>다음 페이지 »</span><br><span>[Go] Worker Pool과 비동기 작업의 성능 프로파일링</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
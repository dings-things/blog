<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go | Ding's Coding Forge</title>
<meta name=keywords content="go,project guide,good practice"><meta name=description content="불필요한 프레임워크는 이제 그만&mldr; 튜닝의 끝은 순정일세~ 바닐라 Go를 통해 미니멀리스틱 App 개발하는 법"><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.ba0de23ad40e17ca82720b577f8ae6ec11a26fb07407316cff70888e344ad129.css integrity="sha256-ug3iOtQOF8qCcgtXf4rm7BGib7B0BzFs/3CIjjRK0Sk=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-XH8830R9KK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XH8830R9KK")}</script><meta property="og:url" content="https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go"><meta property="og:description" content="불필요한 프레임워크는 이제 그만… 튜닝의 끝은 순정일세~ 바닐라 Go를 통해 미니멀리스틱 App 개발하는 법"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-05T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Project Guide"><meta property="article:tag" content="Good Practice"><meta property="og:image" content="https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/img/go-thumbnail.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/img/go-thumbnail.png"><meta name=twitter:title content="[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go"><meta name=twitter:description content="불필요한 프레임워크는 이제 그만&mldr; 튜닝의 끝은 순정일세~ 바닐라 Go를 통해 미니멀리스틱 App 개발하는 법"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/posts/"},{"@type":"ListItem","position":2,"name":"[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go","item":"https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go","name":"[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go","description":"불필요한 프레임워크는 이제 그만\u0026hellip; 튜닝의 끝은 순정일세~ 바닐라 Go를 통해 미니멀리스틱 App 개발하는 법","keywords":["go","project guide","good practice"],"articleBody":" MSA 에서 Go App의 조건들 설정 읽기, Graceful shutdown… 테스트 가능한 코드 API 명세 로깅 프로파일링, 에러 모니터링, 메트릭, API 트레이스, … 위의 조건들을 만족하는 미니멀리즘 Go의 예시를 나열합니다\nTiny main abstraction 별도의 환경 변수 파일이 아닌, os 환경 변수를 통해 관리하는 예시\n모든 os ARGS를 flag set으로 설정하면 낭비가 심한게 아닌가? Graceful shutdown 테스트 가능한 코드 서버가 뜨기까지 기다리기 위해 long polling 한 뒤에 test 진행 → 클린하진 않다 생각함\n해당 연사자의 메인 포커스는 바닐라 Go 이기에 httptest 패키지 또한 사용하지 않은 것으로 추측\nHealth Check ldflags 옵션을 통해 버전을 지정, 이 부분은 release 단계에서 tag 기반으로 설정하면 좋을 것 같음\nUptime은 Server가 시작된 시간을 남기는 것이 좋다 생각함. (얼마나 서버가 실행중이었는지는 굳이?) Doc is Must 고퍼 가라사대 “GoDoc은 권장이 아닌 필수 사항이다” godoc은 아니고 openapi 에 대한 API 명세 설명이었다\ngo:embed는 Go 코드 내에서 파일을 임베드할 때 컴파일 시점에 해당 파일의 내용을 바이너리 내에 포함시키는 기능입니다.따라서 go build를 수행할 때, 임베드할 파일이 필요하며, 이 파일이 존재하지 않으면 빌드에 실패합니다. swagger용 API endpoint를 열어두어 임베딩 된 openapi를 노출시킨다\nAPI 수정을 하면 필연적으로 swagger 수정도 필요함.. 유지가 가능할지 의문이 듦 (swaggo를 사용하는게 더 직관적이지 않나)\nLogging is a Must 로그머스트 😊 slog를 활용하여 JSON 로그를 채택하고 있다 (모던 애플리케이션에서는 필수인듯)\nStdout으로 충분하다. 12 factor app에서도 소개 되었듯 로그는 스트림으로서 관리하자! FileIO에 드는 리소스도 절감!\n센트리, 예거, ES 여러개의 output을 두어 로그 기반의 후처리는 fluentbit에게 위임한다\n센트리 : 에러 트래킹 예거 : API 트레이싱 ES : elasticsearch 적재 → 키바나 연동하여 로그 확인 Decorate HTTP 상태코드와 Bytes 트래킹 (기존 ResponseWriter를 임베딩하여 확장)\n후기 앞선 프로젝트 구조와 정반대의 성향임을 느꼈다. 클린 아키텍처에 집착하지 않고 Go 만의 색을 입힌 미니멀한 프로젝트 구성에 납득됨 어느정도의 타협은 필요하다. 바닐라 Go는 컨셉이라 느껴졌고 상용화된 프레임웍을 사용하더라도 깔끔하고 간결한 코드를 짤 수 있다. 오히려 코드의 량은 줄어들듯 Fluentbit 도입이 되었으면 좋겠다. 다양한 필터 처리에 따른 Output으로 애플리케이션에서 log에 대한 결합도를 확실히 낮출 수 있다 생각한다. 전사적으로 예거, opentelemetry와 같이 트레이싱을 도입하는 게 좋을 것 같다. 이는 CTO가 있다면 다소 강압적으로라도 전사적으로 도입이 되어야 한다 생각 ++ 실제 프로덕션 코드에 적용하기 // HealthHandler : 서버 상태 확인 핸들러 type HealthHandler struct { version string startTime time.Time } // NewHealthHandler : 서버 상태 확인 핸들러 생성자 func NewHealthHandler(version string) HealthHandler { return HealthHandler{ version: version, startTime: time.Now(), } } // Check : 서버 상태 및 빌드 정보 확인 func (h HealthHandler) Check(ctx *gin.Context) { type responseBody struct { Version string `json:\"version\"` Uptime string `json:\"up_time\"` LastCommitHash string `json:\"last_commit_hash\"` LastCommitTime time.Time `json:\"last_commit_time\"` DirtyBuild bool `json:\"dirty_build\"` } var ( lastCommitHash string lastCommitTime time.Time dirtyBuild bool ) { buildInfo, _ := debug.ReadBuildInfo() for _, kv := range buildInfo.Settings { if kv.Value == \"\" { continue } switch kv.Key { case \"vcs.revision\": lastCommitHash = kv.Value case \"vcs.time\": lastCommitTime, _ = time.Parse(time.RFC3339, kv.Value) case \"vcs.modified\": dirtyBuild = kv.Value == \"true\" } } } up := time.Now() ctx.JSON(http.StatusOK, responseBody{ Version: h.version, Uptime: up.Sub(h.startTime).String(), LastCommitHash: lastCommitHash, LastCommitTime: lastCommitTime, DirtyBuild: dirtyBuild, }) } ","wordCount":"475","inLanguage":"en","image":"https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/img/go-thumbnail.png","datePublished":"2024-11-05T00:00:00Z","dateModified":"2024-11-05T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/posts/gopher-con-2024-minimalistic-go/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dingyu.dev/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/search/ title="🔍 (Alt + /)" accesskey=/><span>🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/>Home</a>&nbsp;»&nbsp;<a href=https://dingyu.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Go] Gophercon 2024 - Building Minimalistic Backend Microservice in Go</h1><div class=post-meta><span title='2024-11-05 00:00:00 +0000 UTC'>November 5, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;475 words&nbsp;·&nbsp;dingyu&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/gopher-con-2024-minimalistic-go/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/go-thumbnail.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#tiny-main-abstraction aria-label="Tiny main abstraction">Tiny main abstraction</a></li><li><a href=#graceful-shutdown aria-label="Graceful shutdown">Graceful shutdown</a></li><li><a href=#%ed%85%8c%ec%8a%a4%ed%8a%b8-%ea%b0%80%eb%8a%a5%ed%95%9c-%ec%bd%94%eb%93%9c aria-label="테스트 가능한 코드">테스트 가능한 코드</a></li><li><a href=#health-check aria-label="Health Check">Health Check</a></li><li><a href=#doc-is-must aria-label="Doc is Must">Doc is Must</a></li><li><a href=#logging-is-a-must aria-label="Logging is a Must">Logging is a Must</a></li><li><a href=#decorate aria-label=Decorate>Decorate</a></li><li><a href=#%ed%9b%84%ea%b8%b0 aria-label=후기>후기</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><ul><li>MSA 에서 Go App의 조건들<ul><li>설정 읽기, Graceful shutdown&mldr;</li><li>테스트 가능한 코드</li><li>API 명세</li><li>로깅</li><li>프로파일링, 에러 모니터링, 메트릭, API 트레이스, &mldr;</li></ul></li></ul><p>위의 조건들을 만족하는 미니멀리즘 Go의 예시를 나열합니다</p><h2 id=tiny-main-abstraction>Tiny main abstraction<a hidden class=anchor aria-hidden=true href=#tiny-main-abstraction>#</a></h2><p><img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image.png></p><p>별도의 환경 변수 파일이 아닌, os 환경 변수를 통해 관리하는 예시</p><ul><li>모든 os ARGS를 flag set으로 설정하면 낭비가 심한게 아닌가?</li></ul><h2 id=graceful-shutdown>Graceful shutdown<a hidden class=anchor aria-hidden=true href=#graceful-shutdown>#</a></h2><p><img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-1.png></p><h2 id=테스트-가능한-코드>테스트 가능한 코드<a hidden class=anchor aria-hidden=true href=#테스트-가능한-코드>#</a></h2><p><img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-2.png>
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-3.png></p><p>서버가 뜨기까지 기다리기 위해 long polling 한 뒤에 test 진행 → 클린하진 않다 생각함</p><p>해당 연사자의 메인 포커스는 바닐라 Go 이기에 httptest 패키지 또한 사용하지 않은 것으로 추측</p><h2 id=health-check>Health Check<a hidden class=anchor aria-hidden=true href=#health-check>#</a></h2><p><img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-4.png>
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-5.png>
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-6.png>
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-7.png></p><p>ldflags 옵션을 통해 버전을 지정, 이 부분은 release 단계에서 tag 기반으로 설정하면 좋을 것 같음</p><ul><li>Uptime은 Server가 시작된 시간을 남기는 것이 좋다 생각함. (얼마나 서버가 실행중이었는지는 굳이?)
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-8.png></li></ul><h2 id=doc-is-must>Doc is Must<a hidden class=anchor aria-hidden=true href=#doc-is-must>#</a></h2><blockquote><p>고퍼 가라사대 &ldquo;GoDoc은 권장이 아닌 필수 사항이다&rdquo; </p></blockquote><p><img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-9.png></p><p>godoc은 아니고 openapi 에 대한 API 명세 설명이었다</p><table><thead><tr><th></th></tr></thead><tbody><tr><td><code>go:embed</code>는 Go 코드 내에서 파일을 임베드할 때 컴파일 시점에 해당 파일의 내용을 바이너리 내에 포함시키는 기능입니다.따라서 <code>go build</code>를 수행할 때, 임베드할 파일이 필요하며, 이 파일이 존재하지 않으면 빌드에 실패합니다.</td></tr></tbody></table><p>swagger용 API endpoint를 열어두어 임베딩 된 openapi를 노출시킨다</p><p>API 수정을 하면 필연적으로 swagger 수정도 필요함.. 유지가 가능할지 의문이 듦 (swaggo를 사용하는게 더 직관적이지 않나)</p><h2 id=logging-is-a-must>Logging is a Must<a hidden class=anchor aria-hidden=true href=#logging-is-a-must>#</a></h2><p>로그머스트 😊
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-10.png></p><p>slog를 활용하여 JSON 로그를 채택하고 있다 (모던 애플리케이션에서는 필수인듯)</p><p>Stdout으로 충분하다. 12 factor app에서도 소개 되었듯 로그는 스트림으로서 관리하자! FileIO에 드는 리소스도 절감!</p><p>센트리, 예거, ES 여러개의 output을 두어 로그 기반의 후처리는 fluentbit에게 위임한다</p><ul><li>센트리 : 에러 트래킹</li><li>예거 : API 트레이싱</li><li>ES : elasticsearch 적재 → 키바나 연동하여 로그 확인</li></ul><h2 id=decorate>Decorate<a hidden class=anchor aria-hidden=true href=#decorate>#</a></h2><p><img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-11.png></p><p>HTTP 상태코드와 Bytes 트래킹 (기존 ResponseWriter를 임베딩하여 확장)</p><h2 id=후기>후기<a hidden class=anchor aria-hidden=true href=#후기>#</a></h2><ul><li>앞선 프로젝트 구조와 정반대의 성향임을 느꼈다. 클린 아키텍처에 집착하지 않고 Go 만의 색을 입힌 미니멀한 프로젝트 구성에 납득됨</li><li>어느정도의 타협은 필요하다. 바닐라 Go는 컨셉이라 느껴졌고 상용화된 프레임웍을 사용하더라도 깔끔하고 간결한 코드를 짤 수 있다. 오히려 코드의 량은 줄어들듯</li><li>Fluentbit 도입이 되었으면 좋겠다. 다양한 필터 처리에 따른 Output으로 애플리케이션에서 log에 대한 결합도를 확실히 낮출 수 있다 생각한다.</li><li>전사적으로 예거, opentelemetry와 같이 트레이싱을 도입하는 게 좋을 것 같다. 이는 CTO가 있다면 다소 강압적으로라도 전사적으로 도입이 되어야 한다 생각</li></ul><p>++ 실제 프로덕션 코드에 적용하기
<img loading=lazy src=/posts/gopher-con-2024-minimalistic-go/image-12.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// HealthHandler : 서버 상태 확인 핸들러</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>HealthHandler</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>version</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>startTime</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NewHealthHandler : 서버 상태 확인 핸들러 생성자</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewHealthHandler</span><span class=p>(</span><span class=nx>version</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>HealthHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>HealthHandler</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>version</span><span class=p>:</span>   <span class=nx>version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>startTime</span><span class=p>:</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Check : 서버 상태 및 빌드 정보 확인</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=nx>HealthHandler</span><span class=p>)</span> <span class=nf>Check</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>type</span> <span class=nx>responseBody</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Version</span>        <span class=kt>string</span>    <span class=s>`json:&#34;version&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>Uptime</span>         <span class=kt>string</span>    <span class=s>`json:&#34;up_time&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>LastCommitHash</span> <span class=kt>string</span>    <span class=s>`json:&#34;last_commit_hash&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>LastCommitTime</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span> <span class=s>`json:&#34;last_commit_time&#34;`</span>
</span></span><span class=line><span class=cl>		<span class=nx>DirtyBuild</span>     <span class=kt>bool</span>      <span class=s>`json:&#34;dirty_build&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>lastCommitHash</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>lastCommitTime</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl>		<span class=nx>dirtyBuild</span>     <span class=kt>bool</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>buildInfo</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>debug</span><span class=p>.</span><span class=nf>ReadBuildInfo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>kv</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>buildInfo</span><span class=p>.</span><span class=nx>Settings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>kv</span><span class=p>.</span><span class=nx>Value</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>continue</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>switch</span> <span class=nx>kv</span><span class=p>.</span><span class=nx>Key</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=s>&#34;vcs.revision&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=nx>lastCommitHash</span> <span class=p>=</span> <span class=nx>kv</span><span class=p>.</span><span class=nx>Value</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=s>&#34;vcs.time&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=nx>lastCommitTime</span><span class=p>,</span> <span class=nx>_</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>RFC3339</span><span class=p>,</span> <span class=nx>kv</span><span class=p>.</span><span class=nx>Value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=s>&#34;vcs.modified&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=nx>dirtyBuild</span> <span class=p>=</span> <span class=nx>kv</span><span class=p>.</span><span class=nx>Value</span> <span class=o>==</span> <span class=s>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>up</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>responseBody</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Version</span><span class=p>:</span>        <span class=nx>h</span><span class=p>.</span><span class=nx>version</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Uptime</span><span class=p>:</span>         <span class=nx>up</span><span class=p>.</span><span class=nf>Sub</span><span class=p>(</span><span class=nx>h</span><span class=p>.</span><span class=nx>startTime</span><span class=p>).</span><span class=nf>String</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>		<span class=nx>LastCommitHash</span><span class=p>:</span> <span class=nx>lastCommitHash</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>LastCommitTime</span><span class=p>:</span> <span class=nx>lastCommitTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>DirtyBuild</span><span class=p>:</span>     <span class=nx>dirtyBuild</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/tags/go/>Go</a></li><li><a href=https://dingyu.dev/tags/project-guide/>Project Guide</a></li><li><a href=https://dingyu.dev/tags/good-practice/>Good Practice</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/posts/flink-dynamic-job/><span class=title>« Prev</span><br><span>[EDA] Flink Dynamic Job Case Study</span>
</a><a class=next href=https://dingyu.dev/posts/gopher-con-2024-go-project-guide/><span class=title>Next »</span><br><span>[Go] Gophercon 2024 - 고언어 프로젝트 가이드 A-Z</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/>Ding's Coding Forge</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
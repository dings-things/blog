<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Third-Party] Sentry ì—°ë™ | Ding's Coding Forge</title>
<meta name=keywords content="go,sentry"><meta name=description content="APMê³¼ ì—ëŸ¬ ìŠ¤í…Œì´ìŠ¤ê°€ ê°€ëŠ¥í•œ íˆ´ì´ ìˆë‹¤?"><meta name=author content="dingyu"><link rel=canonical href=https://dingyu.dev/posts/sentry/><meta name=google-site-verification content="8XY1hI6NVxQIrN7bQbnX-9TG9HHFw5HOQmlb6vcsFdQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.7b7c4bd29f1a2213d4d2861f56642f86c49710dec71344f8114d75afb0a5d6e0.css integrity="sha256-e3xL0p8aIhPU0oYfVmQvhsSXEN7HE0T4EU11r7Cl1uA=" rel="preload stylesheet" as=style><link rel=icon href=https://dingyu.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dingyu.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dingyu.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://dingyu.dev/apple-touch-icon.png><link rel=mask-icon href=https://dingyu.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dingyu.dev/posts/sentry/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://dingyu.dev/posts/sentry/"><meta property="og:site_name" content="Ding's Coding Forge"><meta property="og:title" content="[Third-Party] Sentry ì—°ë™"><meta property="og:description" content="APMê³¼ ì—ëŸ¬ ìŠ¤í…Œì´ìŠ¤ê°€ ê°€ëŠ¥í•œ íˆ´ì´ ìˆë‹¤?"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-11T00:00:00+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Sentry"><meta property="og:image" content="https://dingyu.dev/posts/sentry/img/sentry.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dingyu.dev/posts/sentry/img/sentry.png"><meta name=twitter:title content="[Third-Party] Sentry ì—°ë™"><meta name=twitter:description content="APMê³¼ ì—ëŸ¬ ìŠ¤í…Œì´ìŠ¤ê°€ ê°€ëŠ¥í•œ íˆ´ì´ ìˆë‹¤?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dingyu.dev/posts/"},{"@type":"ListItem","position":2,"name":"[Third-Party] Sentry ì—°ë™","item":"https://dingyu.dev/posts/sentry/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Third-Party] Sentry ì—°ë™","name":"[Third-Party] Sentry ì—°ë™","description":"APMê³¼ ì—ëŸ¬ ìŠ¤í…Œì´ìŠ¤ê°€ ê°€ëŠ¥í•œ íˆ´ì´ ìˆë‹¤?","keywords":["go","sentry"],"articleBody":"ë°°ê²½ ê°œë°œìê°€ ì§ì ‘ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì„ í†µí•˜ì—¬ ì¥ì•  ëŒ€ì‘ ì•„ë˜ì™€ ê°™ì€ ì´ìœ ë¡œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì—ë„ ì œì•½ ì‚¬í•­ì´ ì¡´ì¬ Field Typeì˜ ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ Elasticsearch field mapping Error ë°œìƒ â†’ ë¡œê·¸ ì´ë²¤íŠ¸ì˜ DROP ì‹œìŠ¤í…œ ë¡œê·¸ë¡œ ê¸°ë¡ë˜ëŠ” ê²½ìš°, ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìœ„í•˜ì—¬ ë³„ë„ë¡œ SEì—ê²Œ ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ ìš”êµ¬í•˜ëŠ” ê³µìˆ˜ê°€ í•„ìš” ëª©í‘œ Goë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ê³µí†µì ìœ¼ë¡œ í‘œì¤€ì´ ë  ìˆ˜ ìˆëŠ” ì„¼íŠ¸ë¦¬ êµ¬ì¡° í™•ë¦½ ì„¼íŠ¸ë¦¬ì— ëŒ€í•œ ê¸°ëŠ¥ ëª…ì„¸ / ê°€ì´ë“œë¼ì¸ ì œê³µ ì„¼íŠ¸ë¦¬ ì ìš© ì´í›„, ë¹ ë¥¸ ì¥ì•  ëŒ€ì‘ì„ í†µí•œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ êµ¬ì¶• ë³¸ ê¸€ì€ ì„¼íŠ¸ë¦¬ ê³„ì •ì´ ìˆìœ¼ë©°, ì„¼íŠ¸ë¦¬ í”„ë¡œì íŠ¸ë¥¼ ì´ë¯¸ ìƒì„±í•˜ì˜€ë‹¤ ê°€ì •í•˜ê³  ì§„í–‰ë©ë‹ˆë‹¤.\nSentryì— ëŒ€í•˜ì—¬ Capture Exception ì—ëŸ¬ ì¶”ì (Capture Exception): ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì™€ ì—ëŸ¬ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  ê¸°ë¡í•©ë‹ˆë‹¤. ì„¼íŠ¸ë¦¬ëŠ” ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤(stack trace)ì™€ í•¨ê»˜ ì—ëŸ¬ ë°œìƒ ì‹œì ì˜ í™˜ê²½ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬, ì—ëŸ¬ì˜ ì›ì¸ì„ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.\nTransaction ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§(Transactions): ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ë©°, ì›¹ ìš”ì²­ì´ë‚˜ API í˜¸ì¶œ ë“±ì˜ íŠ¸ëœì­ì…˜ì„ ì¶”ì í•©ë‹ˆë‹¤. ê° íŠ¸ëœì­ì…˜ì˜ ì‘ë‹µ ì‹œê°„, ì„±ê³µ ë° ì‹¤íŒ¨ ë¹„ìœ¨ê³¼ ê°™ì€ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ì„±ëŠ¥ ë³‘ëª© í˜„ìƒì„ ì‹ë³„í•˜ê³  ê°œì„ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.\nTrace íŠ¸ë ˆì´ì‹±(Trace): ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¸ëœì­ì…˜ì„ ì„¸ë¶€ì ìœ¼ë¡œ ì¶”ì í•˜ì—¬, ì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ, ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë“±ì˜ ì‘ì—…ì— ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì˜ ì„±ëŠ¥ì„ ì´í•´í•˜ê³ , ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nAlert ì´ìŠˆ ê´€ë¦¬ ë° ì•Œë¦¼: ì„¼íŠ¸ë¦¬ëŠ” ì—ëŸ¬ì™€ ì„±ëŠ¥ ë¬¸ì œë¥¼ ì´ìŠˆë¡œ ê´€ë¦¬í•˜ë©°, ë°œìƒ ì‹œ ì§€ì •ëœ ì´ë©”ì¼ì´ë‚˜ ìŠ¬ë™(Slack) ë“±ì˜ í†µì§€ ì±„ë„ì„ í†µí•´ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤. ê°œë°œìëŠ” ì´ìŠˆë¥¼ í• ë‹¹ë°›ê³ , ì²˜ë¦¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ë©°, ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ í˜‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nRelease Tracking ë¦´ë¦¬ì¦ˆ ì¶”ì (Release Tracking): ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë²„ì „ì„ ì¶”ì í•˜ì—¬, ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆê°€ ì—ëŸ¬ ë¹„ìœ¨ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìµœê·¼ ë°°í¬ëœ ë³€ê²½ì‚¬í•­ì´ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ê³  ìˆëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nSentry Alerts ì„¼íŠ¸ë¦¬ ì•ŒëŒì„ í†µí•´ í˜‘ì—… íˆ´ê³¼ ì—°ë™í•˜ì—¬ ê°œë°œìê°€ ì‰½ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.\nì„¤ì • STEP BY STEP ëŒ€ì‹œë³´ë“œ - Alert - Create Alert íŠ¸ë¦¬ê±° ì„¤ì •\nIssues : ì—ëŸ¬ì˜ stacktraceë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ìŠˆê°€ ìƒì„±ë˜ëŠ”ë°, ì—ëŸ¬ì˜ ìœ í˜• ë³„ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±° ì—ëŸ¬ ìœ í˜• ë³„ë¡œ ì²˜ë¦¬ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš© ex. APIë¥¼ ê¸°ì¤€ìœ¼ë¡œ HTTP status ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • ex. Serviceì˜ ìœ í˜• ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • Number of Errors : ì—ëŸ¬ì˜ íšŸìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±° ë™ì¼í•œ ìœ í˜•ì˜ ì—ëŸ¬ì´ë©°, íšŸìˆ˜ ê¸°ë°˜ ì²˜ë¦¬ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš© Users Experiencing Errors : ì •ì˜ëœ User ê¸°ë°˜ ì„ê³„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±° íŠ¹ì • Page ë‚´ì—ì„œ ì‚¬ìš©ì ê²½í—˜ ìµœì í™” ë˜ëŠ” ì´ìŠˆ ë°œìƒì„ í™•ì¸ì´ í•„ìš”í•  ë•Œ ì‚¬ìš© ex. 100 ëª…ì˜ ìœ ì €ê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒ ì„¸ë¶€ ì¡°ê±´ ì„¤ì •\nWHEN : ì•ŒëŒì´ íŠ¸ë¦¬ê±° ë˜ëŠ” ì‹œì  ì •ì˜\nany (ì•„ë˜ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•  ê²½ìš°) / all (ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²½ìš°) ì„ íƒ ì´ìŠˆì˜ ìƒíƒœ / ì´ìŠˆì˜ íšŸìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„ ì • IF : ì´ë²¤íŠ¸ì˜ ì„¸ë¶€ ì¡°ê±´\níƒœê·¸ ê¸°ë°˜ / ë°œìƒ ë¹ˆë„ ê¸°ë°˜ / ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ THEN : ì•¡ì…˜ ì„ ì •\në©”ì¼ / ìŠ¬ë™ / íŒ€ì¦ˆ ë“±ìœ¼ë¡œ ì•¡ì…˜ ì§€ì • ê°œë°œí•˜ê¸° Client Options Dsn: _Data Source Name_ì˜ ì•½ìë¡œ, Sentry í”„ë¡œì íŠ¸ë¥¼ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ ë¬¸ìì—´ì…ë‹ˆë‹¤. ì´ ê°’ì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ì—ëŸ¬ì™€ ì´ë²¤íŠ¸ê°€ ë³´ê³ ë  ì •í™•í•œ Sentry í”„ë¡œì íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [Projects - Settings - Client Keys] Environment: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤í–‰ í™˜ê²½(ì˜ˆ: production, staging, development)ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì—ëŸ¬ í•„í„°ë§ê³¼ ë¶„ì„ ì‹œ ì¤‘ìš”í•œ ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ê° ì‹¤í–‰ í™˜ê²½ ë³„ë¡œ í•„í„°ë§í•˜ì—¬ ì•Œë¦¼ ì„¤ì •ì„ í•˜ê±°ë‚˜, ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥ Issue Filtering Release: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ ê°’ì„ í†µí•´ ì—ëŸ¬ê°€ ë°œìƒí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì²´ì ì¸ ë²„ì „ì„ ì¶”ì í•˜ê³ , ë¦´ë¦¬ì¦ˆ ê°„ ì—ëŸ¬ ë¹„ìœ¨ì„ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. SampleRate: 0ì—ì„œ 1 ì‚¬ì´ì˜ ê°’ì„ ì„¤ì •í•˜ì—¬, ë³´ê³ ë  ì´ë²¤íŠ¸ì˜ ìƒ˜í”Œë§ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, 0.1ë¡œ ì„¤ì •í•˜ë©´ 10%ì˜ ì´ë²¤íŠ¸ë§Œì´ ì‹¤ì œë¡œ ë³´ê³ ë©ë‹ˆë‹¤. ì´ëŠ” ëŒ€ëŸ‰ì˜ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API íŠ¸ë˜í”½ ëŸ‰ì´ ë§ì„ ìˆ˜ë¡ 0ì— ê°€ê¹ê²Œ ì§€ì • ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ / ì„±ëŠ¥ ìµœì í™” / ë¹„ìš© ì ˆê°ì„ ìœ„í•´ ì ì ˆíˆ ì§€ì • TracesSampleRate: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì— ì‚¬ìš©ë˜ë©°, SampleRateì™€ ë¹„ìŠ·í•˜ê²Œ íŠ¸ëœì­ì…˜ ë°ì´í„°ì˜ ìƒ˜í”Œë§ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„±ëŠ¥ ë°ì´í„°ì˜ ì–‘ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. BeforeSend: ë³´ê³ ë˜ê¸° ì „ì— ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ í•„í„°ë§í•  ìˆ˜ ìˆëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì´ë²¤íŠ¸ë§Œì„ ë³´ê³ í•˜ê±°ë‚˜, ë¯¼ê°í•œ ì •ë³´ë¥¼ ì œê±°í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AttachStacktrace: ìë™ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ì´ë²¤íŠ¸ì— ì²¨ë¶€í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ í™œì„±í™”í•˜ë©´ ì—ëŸ¬ê°€ ì•„ë‹Œ ë¡œê·¸ ë©”ì‹œì§€ì—ë„ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì •ë³´ê°€ í¬í•¨ë©ë‹ˆë‹¤. ServerName: ì´ë²¤íŠ¸ê°€ ë³´ê³ ë  ë•Œ ì„œë²„ ì´ë¦„ì„ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì—ëŸ¬ ë¶„ì„ ì‹œ ì„œë²„ êµ¬ë¶„ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Integrations: Sentryì™€ í•¨ê»˜ ì‚¬ìš©í•  ì¶”ê°€ì ì¸ í†µí•© ê¸°ëŠ¥ë“¤ì„ ì„¤ì •í•©ë‹ˆë‹¤. SentryëŠ” ë‹¤ì–‘í•œ í”Œë«í¼ê³¼ í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ í†µí•©ì„ ì œê³µí•˜ì—¬, ë³´ë‹¤ ì‰½ê²Œ ì—ëŸ¬ ì¶”ì  ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì„ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤. TransportëŠ” Sentry ì„œë²„ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì •ì˜í•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œìëŠ” ê¸°ë³¸ HTTP ì „ì†¡ ë°©ì‹ ëŒ€ì‹  ì»¤ìŠ¤í…€ ì „ì†¡ ë°©ì‹ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ timeout ê°’ì€ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ë‚˜ ì„œë²„ ì‘ë‹µ ì‹œê°„ì˜ ë³€ë™ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤ Initialize Go-Sentry SDK ì‚¬ìš© ì‹œ, ìµœì´ˆ ì´ˆê¸°í™” ë‹¹ì‹œì— HTTP Clientì˜ TCP ì»¤ë„¥ì…˜ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬ í•©ë‹ˆë‹¤.\nApplicaiton ì˜ main.go ì—ì„œ ìµœì´ˆë¡œ Init() ì„¤ì •í•˜ëŠ” ê²ƒì´ Best Practiceë¡œ ì†Œê°œë©ë‹ˆë‹¤.\nerr := sentry.Init( sentry.ClientOptions{ Dsn: si.conf.Sentry.DSN, SampleRate: si.conf.Sentry.SampleRate, EnableTracing: si.conf.Sentry.EnableTrace, Debug: si.conf.Sentry.Debug, TracesSampleRate: si.conf.Sentry.TracesSampleRate, Environment: si.conf.Sentry.Environment, AttachStacktrace: true, Transport: \u0026sentry.HTTPSyncTransport{ Timeout: si.conf.Sentry.Timeout, }, }, ) Capture Exception ë°œìƒí•œ ì˜ˆì™¸(ì—ëŸ¬)ì™€ ê´€ë ¨ëœ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìº¡ì²˜í•˜ê³  ì¶”ì í•©ë‹ˆë‹¤.\n// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì™€ ì—°ê´€ëœ Hub ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸° hub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì • ctx = sentry.SetHubOnContext(ctx, hub) } // ì—ëŸ¬ ìº¡ì²˜ hub.CaptureException(err) Go Error ì‚¬ìš©ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì°¨ì´ì  ì •í™•í•œ ì—ëŸ¬ì˜ ë°œìƒì²˜ë¥¼ ì•Œê¸° ìœ„í•´ì„œëŠ” pkg/errors ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì!\nerrors íŒ¨í‚¤ì§€: ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—ëŸ¬ëŠ” ë‹¨ìˆœíˆ ë©”ì‹œì§€ë¥¼ í¬í•¨í•˜ëŠ” ê°’ì´ë©°, ë””ë²„ê¹…ì„ ìœ„í•œ ì¶”ê°€ì ì¸ ì»¨í…ìŠ¤íŠ¸ë‚˜ ìœ„ì¹˜ ì •ë³´ëŠ” í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.\ngithub.com/pkg/errors íŒ¨í‚¤ì§€: ì—ëŸ¬ì— ìë™ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—ëŸ¬ê°€ ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€, ì—ëŸ¬ì˜ ì›ì¸ì„ ì¶”ì í•˜ëŠ” ë° í•„ìš”í•œ ìƒì„¸í•œ í˜¸ì¶œ ìŠ¤íƒ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ntest. errors íŒ¨í‚¤ì§€ì™€ pkg/errors ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤\npackage main import ( \"context\" stdErr \"errors\" \"fmt\" \"time\" sentry \"github.com/getsentry/sentry-go\" pkgErr \"github.com/pkg/errors\" ) var ( PkgErr1 = pkgErr.New(\"pkg error 1\") PkgErr2 = pkgErr.New(\"pkg error 2\") StdErr1 = stdErr.New(\"standard error1\") StdErr2 = stdErr.New(\"standard error2\") ) func main() { err := sentry.Init( sentry.ClientOptions{ Dsn: \"\", Debug: true, AttachStacktrace: true, }, ) if err != nil { // sentry ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ, panic ì‹œìŠ¤í…œ os exit panic(err) } ctx := context.Background() hub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì • ctx = sentry.SetHubOnContext(ctx, hub) } err = errPkgNested() go hub.CaptureException(err) fmt.Println(\"Standard error nested\") time.Sleep(5 * time.Second) } func errStdNested() error { return stdErr.Join(PkgErr1, PkgErr2) } func errPkgNested() error { return pkgErr.Wrap(PkgErr1, PkgErr2.Error()) } Scope() Sentryì—ì„œ ScopeëŠ” íŠ¹ì • ì—ëŸ¬ ë˜ëŠ” ì´ë²¤íŠ¸ì— ì¶”ê°€ì ì¸ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì—ëŸ¬ì˜ ì¬í˜„ì„ ìœ„í•´ì„œ ìš”ì²­ íŒŒë¼ë¯¸í„° ë“±ì„ Scopeì— ì €ì¥í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê³ ë„í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nSentry í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” í—ˆë¸ŒëŠ” Context ë‹¨ìœ„ë¡œ ì‹±ê¸€í„´ íŒ¨í„´ì„ ìœ ì§€í•˜ë©°, go context.Context ì™€ í•¨ê»˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ì—¬, ì¶”ì ì— ìš©ì´í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤.\nfunc (rm *sentryScopeMiddleware) Register(originalHandler http.Handler) http.Handler { if !rm.initializer.Enabled() { // sentryê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ê²½ìš°, ì„¼íŠ¸ë¦¬ í™œì„±í™” rm.initializer.Init() } return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { hub := sentry.GetHubFromContext(r.Context()) if hub == nil { hub = sentry.CurrentHub().Clone() r = r.WithContext(sentry.SetHubOnContext(r.Context(), hub)) } hub.Scope().SetRequest(r) }) } Sentry Advancement SentryInitializer í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‹±ê¸€í„´ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì„¤ì •ì„ í†µí•œ ì´ˆê¸°í™” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” í´ë˜ìŠ¤\npackage core import ( \"sync\" \"github.com/getsentry/sentry-go\" ) type ( // SentryInitializer : Sentry ì„¤ì • ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹í•˜ëŠ” êµ¬í˜„ì²´ SentryInitializer struct { conf *Config enabled bool mutex sync.RWMutex // enabled í•„ë“œì— ëŒ€í•œ ì½ê¸°/ì“°ê¸° ë™ê¸°í™”ë¥¼ ìœ„í•œ RWMutex } ) // NewSentryInitializer : SentryInitializer ìƒì„±ì func NewSentryInitializer(conf *Config) SentryInitializer { return SentryInitializer{ conf: conf, } } // Init : SentryInitializer ì´ˆê¸°í™” // // - sentry íŒ¨í‚¤ì§€ ë³€ìˆ˜ë¥¼ í†µí•´ ì‹±ê¸€í„´ ì²˜ë¦¬í•˜ë¯€ë¡œ ìµœì´ˆ ì„¤ì •ë§Œ ìš”êµ¬ë¨ func (si *SentryInitializer) Init() error { si.mutex.Lock() // enabled lock for writing defer si.mutex.Unlock() err := sentry.Init( sentry.ClientOptions{ Dsn: si.conf.Sentry.DSN, SampleRate: si.conf.Sentry.SampleRate, EnableTracing: si.conf.Sentry.EnableTrace, Debug: si.conf.Sentry.Debug, TracesSampleRate: si.conf.Sentry.TracesSampleRate, Environment: si.conf.Sentry.Environment, AttachStacktrace: true, Transport: \u0026sentry.HTTPSyncTransport{ Timeout: si.conf.Sentry.Timeout, }, }, ) if err != nil { // sentry ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ, panic ì‹œìŠ¤í…œ os exit panic(err) } // í™œì„±í™” ìƒíƒœë¡œ ë³€ê²½ si.enabled = true return nil } // Enabled : Sentry í™œì„±í™” ì—¬ë¶€ // // - Init()ì´ í˜¸ì¶œëœ ê²½ìš°, í™œì„±í™” ìƒíƒœë¡œ ë³€ê²½ func (si *SentryInitializer) Enabled() bool { si.mutex.RLock() // read lock defer si.mutex.RUnlock() return si.enabled } ë™ì‹œì„± ë¬¸ì œë¡œ **Enabled()**ì˜ ë™ê¸°í™”ë¥¼ ìœ„í•´ ë½ìœ¼ë¡œ ê´€ë¦¬\nErrorCapturer SentryInitializerë¥¼ ì„ë² ë”©í•˜ì—¬, ì„¼íŠ¸ë¦¬ë¥¼ í†µí•œ ì„¼íŠ¸ë¦¬ í—ˆë¸Œì—ì„œ ì—ëŸ¬ë¥¼ ìº¡ì³ë§í•˜ëŠ” í´ë˜ìŠ¤ package core import ( \"context\" \"github.com/getsentry/sentry-go\" ) type ( // ErrorCapturer : ì—ëŸ¬ ìº¡ì²˜ ì¸í„°í˜ì´ìŠ¤ ErrorCapturer interface { CaptureError(ctx context.Context, err error) } sentryErrorCapturer struct { SentryInitializer } ) // NewSentryErrorCapturer : SentryErrorCapturer ìƒì„±ì func NewSentryErrorCapturer(initializer SentryInitializer) ErrorCapturer { return \u0026sentryErrorCapturer{ initializer: initializer, } } // CaptureError : Sentryë¡œ ì—ëŸ¬ ìº¡ì²˜ func (sec *sentryErrorCapturer) CaptureError(ctx context.Context, err error) { // ì—ëŸ¬ê°€ ì—†ëŠ” ê²½ìš°, ë¬´ì‹œ if err == nil { return } if !sec.SentryInitializer.Enabled() { // sentry ì´ˆê¸°í™”ë¥¼ í†µí•´ í™œì„±í™” sec.SentryInitializer.Init() } // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì™€ ì—°ê´€ëœ Hub ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸° hub := sentry.GetHubFromContext(ctx) if hub == nil { hub = sentry.CurrentHub().Clone() // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì • ctx = sentry.SetHubOnContext(ctx, hub) } // ì—ëŸ¬ ìº¡ì²˜ hub.CaptureException(err) } RecoverMiddleware í•¸ë“¤ëŸ¬ì—ì„œ Panic ë°œìƒ ì‹œ, Recover(), ìš”ì²­ì„ í—ˆë¸Œì˜ ë©”íƒ€ë°ì´í„°ë¡œ ì €ì¥í•˜ëŠ” í´ë˜ìŠ¤ // Register panic() ë°œìƒ ì‹œ ìŠ¤íƒ ìŠ¤ë ˆì´ìŠ¤ë¥¼ ë¡œê¹…í•˜ë©° ì„¼íŠ¸ë¦¬ë¥¼ í†µí•´ ë‚¨ê¸°ëŠ” ë©”ì„œë“œ // // - http handlerì— ë‚´ë¶€ì ìœ¼ë¡œ ë“±ë¡ // - API ê³ ë£¨í‹´ ë‚´ë¶€ì ìœ¼ë¡œ defer()ë¥¼ í†µí•˜ì—¬ panic ìƒí™©ì—ì„œë„ ë¡œê¹…ì´ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤ // // Parameters: // - originalHandler: ì›ë˜ì˜ http handler func (rm *sentryRecoverMiddleware) Register(originalHandler http.Handler) http.Handler { if !rm.initializer.Enabled() { // sentryê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ê²½ìš°, ì„¼íŠ¸ë¦¬ í™œì„±í™” rm.initializer.Init() } return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { hub := sentry.GetHubFromContext(r.Context()) if hub == nil { hub = sentry.CurrentHub().Clone() r = r.WithContext(sentry.SetHubOnContext(r.Context(), hub)) } hub.Scope().SetRequest(r) defer func() { if err := recover(); err != nil { hub.RecoverWithContext(r.Context(), err) stackList := strings.Split(string(debug.Stack()), \"\\n\") rm.Logger.Error(). Any(\"error\", err). Any(\"stack_list\", stackList).Send() resp := dto.ACSErrorResponse{ Code: http.StatusInternalServerError, ErrMessage: \"ì„œë²„ì—ì„œ ì˜ˆê¸°ì¹˜ ëª»í•œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤\", Success: false, } jsonResp := resp.ToJSON() w.Header().Set(\"Content-Type\", \"application/json\") w.WriteHeader(http.StatusInternalServerError) _, err = w.Write(jsonResp) if err != nil { rm.Logger.Error(). Any(\"error\", err).Send() } return } }() originalHandler.ServeHTTP(w, r) }) } ë¹„ìš©ì ì¸ ë¬¸ì œê°€ ìˆì§€ë§Œ APMê³¼ Error Captureì¸¡ë©´ì—ì„œëŠ” ê´€ë¦¬ì ì¸ í¸ì˜ì„±ì„ ì œê³µí•´ì£¼ëŠ” Sentry!\n","wordCount":"1525","inLanguage":"en","image":"https://dingyu.dev/posts/sentry/img/sentry.png","datePublished":"2024-09-11T00:00:00Z","dateModified":"2024-09-11T00:00:00Z","author":{"@type":"Person","name":"dingyu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dingyu.dev/posts/sentry/"},"publisher":{"@type":"Organization","name":"Ding's Coding Forge","logo":{"@type":"ImageObject","url":"https://dingyu.dev/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dingyu.dev/ accesskey=h title="Ding's Coding Forge (Alt + H)"><img src=https://dingyu.dev/apple-touch-icon.png alt aria-label=logo height=35>Ding's Coding Forge</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dingyu.dev/about/ title=About><span>About</span></a></li><li><a href=https://dingyu.dev/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://dingyu.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://dingyu.dev/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://dingyu.dev/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dingyu.dev/>Home</a>&nbsp;Â»&nbsp;<a href=https://dingyu.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[Third-Party] Sentry ì—°ë™</h1><div class=post-meta><span title='2024-09-11 00:00:00 +0000 UTC'>September 11, 2024</span>&nbsp;Â·&nbsp;8 min&nbsp;Â·&nbsp;1525 words&nbsp;Â·&nbsp;dingyu&nbsp;|&nbsp;<a href=https://github.com/dings-things/blog/tree/main/content/posts/sentry/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=eager src=https://dingyu.dev/img/sentry.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%eb%b0%b0%ea%b2%bd aria-label=ë°°ê²½>ë°°ê²½</a></li><li><a href=#%eb%aa%a9%ed%91%9c aria-label=ëª©í‘œ>ëª©í‘œ</a></li><li><a href=#sentry%ec%97%90-%eb%8c%80%ed%95%98%ec%97%ac aria-label="Sentryì— ëŒ€í•˜ì—¬">Sentryì— ëŒ€í•˜ì—¬</a><ul><ul><li><a href=#sentry-alerts aria-label="Sentry Alerts">Sentry Alerts</a><ul><li><a href=#%ec%84%a4%ec%a0%95-step-by-step aria-label="ì„¤ì • STEP BY STEP">ì„¤ì • STEP BY STEP</a></li></ul></li></ul><li><a href=#%ea%b0%9c%eb%b0%9c%ed%95%98%ea%b8%b0 aria-label=ê°œë°œí•˜ê¸°>ê°œë°œí•˜ê¸°</a><ul><li><a href=#client-options aria-label="Client Options">Client Options</a></li><li><a href=#initialize aria-label=Initialize>Initialize</a></li><li><a href=#capture-exception aria-label="Capture Exception">Capture Exception</a><ul><li><a href=#go-error-%ec%82%ac%ec%9a%a9%ec%97%90-%eb%94%b0%eb%a5%b8-%ec%8a%a4%ed%83%9d-%ed%8a%b8%eb%a0%88%ec%9d%b4%ec%8a%a4-%ec%b0%a8%ec%9d%b4%ec%a0%90 aria-label="Go Error ì‚¬ìš©ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì°¨ì´ì ">Go Error ì‚¬ìš©ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì°¨ì´ì </a></li></ul></li><li><a href=#scope aria-label=Scope()>Scope()</a></li></ul></li><li><a href=#sentry-advancement aria-label="Sentry Advancement">Sentry Advancement</a><ul><li><a href=#sentryinitializer aria-label=SentryInitializer>SentryInitializer</a></li><li><a href=#errorcapturer aria-label=ErrorCapturer>ErrorCapturer</a></li><li><a href=#recovermiddleware aria-label=RecoverMiddleware>RecoverMiddleware</a></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=ë°°ê²½>ë°°ê²½<a hidden class=anchor aria-hidden=true href=#ë°°ê²½>#</a></h1><hr><ul><li>ê°œë°œìê°€ ì§ì ‘ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì„ í†µí•˜ì—¬ ì¥ì•  ëŒ€ì‘</li><li>ì•„ë˜ì™€ ê°™ì€ ì´ìœ ë¡œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì—ë„ ì œì•½ ì‚¬í•­ì´ ì¡´ì¬<ul><li><strong>Field Typeì˜ ë¶ˆì¼ì¹˜</strong>ë¡œ ì¸í•œ <strong>Elasticsearch field mapping Error</strong> ë°œìƒ â†’ ë¡œê·¸ ì´ë²¤íŠ¸ì˜ DROP</li><li>ì‹œìŠ¤í…œ ë¡œê·¸ë¡œ ê¸°ë¡ë˜ëŠ” ê²½ìš°, ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìœ„í•˜ì—¬ ë³„ë„ë¡œ SEì—ê²Œ ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ ìš”êµ¬í•˜ëŠ” ê³µìˆ˜ê°€ í•„ìš”</li></ul></li></ul><h1 id=ëª©í‘œ>ëª©í‘œ<a hidden class=anchor aria-hidden=true href=#ëª©í‘œ>#</a></h1><hr><ul><li>Goë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ê³µí†µì ìœ¼ë¡œ í‘œì¤€ì´ ë  ìˆ˜ ìˆëŠ” ì„¼íŠ¸ë¦¬ êµ¬ì¡° í™•ë¦½</li><li>ì„¼íŠ¸ë¦¬ì— ëŒ€í•œ ê¸°ëŠ¥ ëª…ì„¸ / ê°€ì´ë“œë¼ì¸ ì œê³µ</li><li>ì„¼íŠ¸ë¦¬ ì ìš© ì´í›„, ë¹ ë¥¸ ì¥ì•  ëŒ€ì‘ì„ í†µí•œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ êµ¬ì¶•</li></ul><blockquote><p>ë³¸ ê¸€ì€ ì„¼íŠ¸ë¦¬ ê³„ì •ì´ ìˆìœ¼ë©°, ì„¼íŠ¸ë¦¬ í”„ë¡œì íŠ¸ë¥¼ ì´ë¯¸ ìƒì„±í•˜ì˜€ë‹¤ ê°€ì •í•˜ê³  ì§„í–‰ë©ë‹ˆë‹¤.</p></blockquote><h1 id=sentryì—-ëŒ€í•˜ì—¬>Sentryì— ëŒ€í•˜ì—¬<a hidden class=anchor aria-hidden=true href=#sentryì—-ëŒ€í•˜ì—¬>#</a></h1><ol><li>Capture Exception</li></ol><p><code>ì—ëŸ¬ ì¶”ì (Capture Exception)</code>: ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì™€ ì—ëŸ¬ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€í•˜ê³  ê¸°ë¡í•©ë‹ˆë‹¤. ì„¼íŠ¸ë¦¬ëŠ” ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤(stack trace)ì™€ í•¨ê»˜ ì—ëŸ¬ ë°œìƒ ì‹œì ì˜ í™˜ê²½ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬, ì—ëŸ¬ì˜ ì›ì¸ì„ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.</p><ol start=2><li>Transaction</li></ol><p><code>ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§(Transactions)</code>: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ë©°, ì›¹ ìš”ì²­ì´ë‚˜ API í˜¸ì¶œ ë“±ì˜ íŠ¸ëœì­ì…˜ì„ ì¶”ì í•©ë‹ˆë‹¤. ê° íŠ¸ëœì­ì…˜ì˜ ì‘ë‹µ ì‹œê°„, ì„±ê³µ ë° ì‹¤íŒ¨ ë¹„ìœ¨ê³¼ ê°™ì€ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ ì„±ëŠ¥ ë³‘ëª© í˜„ìƒì„ ì‹ë³„í•˜ê³  ê°œì„ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.</p><ol start=3><li>Trace</li></ol><p><code>íŠ¸ë ˆì´ì‹±(Trace)</code>: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ íŠ¸ëœì­ì…˜ì„ ì„¸ë¶€ì ìœ¼ë¡œ ì¶”ì í•˜ì—¬, ì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ, ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë“±ì˜ ì‘ì—…ì— ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ë¶„ì„í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì˜ ì„±ëŠ¥ì„ ì´í•´í•˜ê³ , ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì„ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol start=4><li>Alert</li></ol><p><code>ì´ìŠˆ ê´€ë¦¬ ë° ì•Œë¦¼</code>: ì„¼íŠ¸ë¦¬ëŠ” ì—ëŸ¬ì™€ ì„±ëŠ¥ ë¬¸ì œë¥¼ ì´ìŠˆë¡œ ê´€ë¦¬í•˜ë©°, ë°œìƒ ì‹œ ì§€ì •ëœ ì´ë©”ì¼ì´ë‚˜ ìŠ¬ë™(Slack) ë“±ì˜ í†µì§€ ì±„ë„ì„ í†µí•´ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤. ê°œë°œìëŠ” ì´ìŠˆë¥¼ í• ë‹¹ë°›ê³ , ì²˜ë¦¬ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ë©°, ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ í˜‘ì—…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol start=5><li>Release Tracking</li></ol><p><code>ë¦´ë¦¬ì¦ˆ ì¶”ì (Release Tracking)</code>: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë²„ì „ì„ ì¶”ì í•˜ì—¬, ìƒˆë¡œìš´ ë¦´ë¦¬ì¦ˆê°€ ì—ëŸ¬ ë¹„ìœ¨ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìµœê·¼ ë°°í¬ëœ ë³€ê²½ì‚¬í•­ì´ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ê³  ìˆëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id=sentry-alerts>Sentry Alerts<a hidden class=anchor aria-hidden=true href=#sentry-alerts>#</a></h3><p>ì„¼íŠ¸ë¦¬ ì•ŒëŒì„ í†µí•´ í˜‘ì—… íˆ´ê³¼ ì—°ë™í•˜ì—¬ ê°œë°œìê°€ ì‰½ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</p><h4 id=ì„¤ì •-step-by-step>ì„¤ì • STEP BY STEP<a hidden class=anchor aria-hidden=true href=#ì„¤ì •-step-by-step>#</a></h4><p>ëŒ€ì‹œë³´ë“œ - Alert - Create Alert
<img loading=lazy src=/posts/sentry/1.png></p><p><strong>íŠ¸ë¦¬ê±° ì„¤ì •</strong></p><ul><li>Issues : ì—ëŸ¬ì˜ stacktraceë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ìŠˆê°€ ìƒì„±ë˜ëŠ”ë°, ì—ëŸ¬ì˜ ìœ í˜• ë³„ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±°<ul><li><strong>ì—ëŸ¬ ìœ í˜• ë³„ë¡œ ì²˜ë¦¬ê°€ í•„ìš”</strong>í•  ë•Œ ì‚¬ìš©</li><li>ex. APIë¥¼ ê¸°ì¤€ìœ¼ë¡œ HTTP status ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì •</li><li>ex. Serviceì˜ ìœ í˜• ê¸°ë°˜ìœ¼ë¡œ ì„¤ì •</li></ul></li><li>Number of Errors : ì—ëŸ¬ì˜ íšŸìˆ˜ ê¸°ë°˜ìœ¼ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±°<ul><li>ë™ì¼í•œ ìœ í˜•ì˜ ì—ëŸ¬ì´ë©°, íšŸìˆ˜ ê¸°ë°˜ ì²˜ë¦¬ê°€ í•„ìš”í•  ë•Œ ì‚¬ìš©</li></ul></li><li>Users Experiencing Errors : ì •ì˜ëœ User ê¸°ë°˜ ì„ê³„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì„¼íŠ¸ë¦¬ ì•ŒëŒ íŠ¸ë¦¬ê±°<ul><li>íŠ¹ì • Page ë‚´ì—ì„œ ì‚¬ìš©ì ê²½í—˜ ìµœì í™” ë˜ëŠ” ì´ìŠˆ ë°œìƒì„ í™•ì¸ì´ í•„ìš”í•  ë•Œ ì‚¬ìš©</li><li>ex. 100 ëª…ì˜ ìœ ì €ê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒ</li></ul></li></ul><p><img loading=lazy src=/posts/sentry/2.png></p><p><strong>ì„¸ë¶€ ì¡°ê±´ ì„¤ì •</strong></p><p>WHEN : ì•ŒëŒì´ íŠ¸ë¦¬ê±° ë˜ëŠ” ì‹œì  ì •ì˜</p><ul><li>any (ì•„ë˜ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§Œì¡±í•  ê²½ìš°) / all (ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²½ìš°) ì„ íƒ</li><li>ì´ìŠˆì˜ ìƒíƒœ / ì´ìŠˆì˜ íšŸìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„ ì •
<img loading=lazy src=/posts/sentry/3.png></li></ul><p>IF : ì´ë²¤íŠ¸ì˜ ì„¸ë¶€ ì¡°ê±´</p><ul><li>íƒœê·¸ ê¸°ë°˜ / ë°œìƒ ë¹ˆë„ ê¸°ë°˜ / ì¹´í…Œê³ ë¦¬ ê¸°ë°˜
<img loading=lazy src=/posts/sentry/4.png></li></ul><p>THEN : ì•¡ì…˜ ì„ ì •</p><ul><li>ë©”ì¼ / ìŠ¬ë™ / íŒ€ì¦ˆ ë“±ìœ¼ë¡œ ì•¡ì…˜ ì§€ì •
<img loading=lazy src=/posts/sentry/5.png></li></ul><h2 id=ê°œë°œí•˜ê¸°>ê°œë°œí•˜ê¸°<a hidden class=anchor aria-hidden=true href=#ê°œë°œí•˜ê¸°>#</a></h2><h3 id=client-options>Client Options<a hidden class=anchor aria-hidden=true href=#client-options>#</a></h3><ul><li>Dsn: _Data Source Name_ì˜ ì•½ìë¡œ, Sentry í”„ë¡œì íŠ¸ë¥¼ ì‹ë³„í•˜ëŠ” ê³ ìœ í•œ ë¬¸ìì—´ì…ë‹ˆë‹¤. ì´ ê°’ì„ ì„¤ì •í•¨ìœ¼ë¡œì¨ ì—ëŸ¬ì™€ ì´ë²¤íŠ¸ê°€ ë³´ê³ ë  ì •í™•í•œ Sentry í”„ë¡œì íŠ¸ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul><p>[Projects - Settings - Client Keys]
<img loading=lazy src=/posts/sentry/6.png></p><ul><li>Environment: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤í–‰ í™˜ê²½(ì˜ˆ: production, staging, development)ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì—ëŸ¬ í•„í„°ë§ê³¼ ë¶„ì„ ì‹œ ì¤‘ìš”í•œ ì°¨ì›ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.<ul><li>ê° ì‹¤í–‰ í™˜ê²½ ë³„ë¡œ í•„í„°ë§í•˜ì—¬ ì•Œë¦¼ ì„¤ì •ì„ í•˜ê±°ë‚˜, ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥</li><li>Issue Filtering</li></ul></li><li>Release: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì§€ì •í•©ë‹ˆë‹¤. ì´ ê°’ì„ í†µí•´ ì—ëŸ¬ê°€ ë°œìƒí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì²´ì ì¸ ë²„ì „ì„ ì¶”ì í•˜ê³ , ë¦´ë¦¬ì¦ˆ ê°„ ì—ëŸ¬ ë¹„ìœ¨ì„ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>SampleRate: 0ì—ì„œ 1 ì‚¬ì´ì˜ ê°’ì„ ì„¤ì •í•˜ì—¬, ë³´ê³ ë  ì´ë²¤íŠ¸ì˜ ìƒ˜í”Œë§ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, <strong>0.1</strong>ë¡œ ì„¤ì •í•˜ë©´ 10%ì˜ ì´ë²¤íŠ¸ë§Œì´ ì‹¤ì œë¡œ ë³´ê³ ë©ë‹ˆë‹¤. ì´ëŠ” ëŒ€ëŸ‰ì˜ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<ul><li>API íŠ¸ë˜í”½ ëŸ‰ì´ ë§ì„ ìˆ˜ë¡ 0ì— ê°€ê¹ê²Œ ì§€ì •</li><li>ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ / ì„±ëŠ¥ ìµœì í™” / ë¹„ìš© ì ˆê°ì„ ìœ„í•´ ì ì ˆíˆ ì§€ì •</li></ul></li><li>TracesSampleRate: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì— ì‚¬ìš©ë˜ë©°, <strong>SampleRate</strong>ì™€ ë¹„ìŠ·í•˜ê²Œ íŠ¸ëœì­ì…˜ ë°ì´í„°ì˜ ìƒ˜í”Œë§ ë¹„ìœ¨ì„ ê²°ì •í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„±ëŠ¥ ë°ì´í„°ì˜ ì–‘ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>BeforeSend: ë³´ê³ ë˜ê¸° ì „ì— ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ í•„í„°ë§í•  ìˆ˜ ìˆëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì´ë²¤íŠ¸ë§Œì„ ë³´ê³ í•˜ê±°ë‚˜, ë¯¼ê°í•œ ì •ë³´ë¥¼ ì œê±°í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>AttachStacktrace: ìë™ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ì´ë²¤íŠ¸ì— ì²¨ë¶€í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ í™œì„±í™”í•˜ë©´ ì—ëŸ¬ê°€ ì•„ë‹Œ ë¡œê·¸ ë©”ì‹œì§€ì—ë„ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì •ë³´ê°€ í¬í•¨ë©ë‹ˆë‹¤.</li><li>ServerName: ì´ë²¤íŠ¸ê°€ ë³´ê³ ë  ë•Œ ì„œë²„ ì´ë¦„ì„ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ì—ëŸ¬ ë¶„ì„ ì‹œ ì„œë²„ êµ¬ë¶„ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>Integrations: Sentryì™€ í•¨ê»˜ ì‚¬ìš©í•  ì¶”ê°€ì ì¸ í†µí•© ê¸°ëŠ¥ë“¤ì„ ì„¤ì •í•©ë‹ˆë‹¤. SentryëŠ” ë‹¤ì–‘í•œ í”Œë«í¼ê³¼ í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ í†µí•©ì„ ì œê³µí•˜ì—¬, ë³´ë‹¤ ì‰½ê²Œ ì—ëŸ¬ ì¶”ì  ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì„ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.</li><li>TransportëŠ” Sentry ì„œë²„ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì„ ì •ì˜í•©ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ê°œë°œìëŠ” ê¸°ë³¸ HTTP ì „ì†¡ ë°©ì‹ ëŒ€ì‹  ì»¤ìŠ¤í…€ ì „ì†¡ ë°©ì‹ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤<ul><li>timeout ê°’ì€ ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì´ë‚˜ ì„œë²„ ì‘ë‹µ ì‹œê°„ì˜ ë³€ë™ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤</li></ul></li></ul><h3 id=initialize>Initialize<a hidden class=anchor aria-hidden=true href=#initialize>#</a></h3><p>Go-Sentry SDK ì‚¬ìš© ì‹œ, ìµœì´ˆ ì´ˆê¸°í™” ë‹¹ì‹œì— HTTP Clientì˜ TCP ì»¤ë„¥ì…˜ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬ í•©ë‹ˆë‹¤.</p><p>Applicaiton ì˜ main.go ì—ì„œ ìµœì´ˆë¡œ Init() ì„¤ì •í•˜ëŠ” ê²ƒì´ Best Practiceë¡œ ì†Œê°œë©ë‹ˆë‹¤.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>err</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>Init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>sentry</span><span class=p>.</span><span class=nx>ClientOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Dsn</span><span class=p>:</span>              <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>DSN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>SampleRate</span><span class=p>:</span>       <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>SampleRate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>EnableTracing</span><span class=p>:</span>    <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>EnableTrace</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Debug</span><span class=p>:</span>            <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>TracesSampleRate</span><span class=p>:</span> <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>TracesSampleRate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Environment</span><span class=p>:</span>      <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Environment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>AttachStacktrace</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Transport</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>sentry</span><span class=p>.</span><span class=nx>HTTPSyncTransport</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Timeout</span><span class=p>:</span> <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h3 id=capture-exception>Capture Exception<a hidden class=anchor aria-hidden=true href=#capture-exception>#</a></h3><p>ë°œìƒí•œ ì˜ˆì™¸(ì—ëŸ¬)ì™€ ê´€ë ¨ëœ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìº¡ì²˜í•˜ê³  ì¶”ì í•©ë‹ˆë‹¤.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì™€ ì—°ê´€ëœ Hub ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°</span>
</span></span><span class=line><span class=cl><span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì •</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>hub</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// ì—ëŸ¬ ìº¡ì²˜</span>
</span></span><span class=line><span class=cl><span class=nx>hub</span><span class=p>.</span><span class=nf>CaptureException</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=go-error-ì‚¬ìš©ì—-ë”°ë¥¸-ìŠ¤íƒ-íŠ¸ë ˆì´ìŠ¤-ì°¨ì´ì >Go Error ì‚¬ìš©ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì°¨ì´ì <a hidden class=anchor aria-hidden=true href=#go-error-ì‚¬ìš©ì—-ë”°ë¥¸-ìŠ¤íƒ-íŠ¸ë ˆì´ìŠ¤-ì°¨ì´ì >#</a></h4><blockquote><p>ì •í™•í•œ ì—ëŸ¬ì˜ ë°œìƒì²˜ë¥¼ ì•Œê¸° ìœ„í•´ì„œëŠ” pkg/errors ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì!</p></blockquote><p><strong>errors íŒ¨í‚¤ì§€</strong>: ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—ëŸ¬ëŠ” ë‹¨ìˆœíˆ ë©”ì‹œì§€ë¥¼ í¬í•¨í•˜ëŠ” ê°’ì´ë©°, ë””ë²„ê¹…ì„ ìœ„í•œ ì¶”ê°€ì ì¸ ì»¨í…ìŠ¤íŠ¸ë‚˜ ìœ„ì¹˜ ì •ë³´ëŠ” í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.</p><blockquote></blockquote><p><strong>github.com/pkg/errors íŒ¨í‚¤ì§€</strong>: ì—ëŸ¬ì— ìë™ìœ¼ë¡œ <code>ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤</code>ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì—ëŸ¬ê°€ ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€, ì—ëŸ¬ì˜ ì›ì¸ì„ ì¶”ì í•˜ëŠ” ë° í•„ìš”í•œ ìƒì„¸í•œ í˜¸ì¶œ ìŠ¤íƒ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>test. errors íŒ¨í‚¤ì§€ì™€ pkg/errors ì— ë”°ë¥¸ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>stdErr</span> <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nx>sentry</span> <span class=s>&#34;github.com/getsentry/sentry-go&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>pkgErr</span> <span class=s>&#34;github.com/pkg/errors&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>PkgErr1</span> <span class=p>=</span> <span class=nx>pkgErr</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;pkg error 1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>PkgErr2</span> <span class=p>=</span> <span class=nx>pkgErr</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;pkg error 2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>StdErr1</span> <span class=p>=</span> <span class=nx>stdErr</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;standard error1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>StdErr2</span> <span class=p>=</span> <span class=nx>stdErr</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;standard error2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>Init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>sentry</span><span class=p>.</span><span class=nx>ClientOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Dsn</span><span class=p>:</span>              <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>Debug</span><span class=p>:</span>            <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>AttachStacktrace</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// sentry ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ, panic ì‹œìŠ¤í…œ os exit</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì •</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>hub</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span> <span class=p>=</span> <span class=nf>errPkgNested</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=nx>hub</span><span class=p>.</span><span class=nf>CaptureException</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Standard error nested&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>errStdNested</span><span class=p>()</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>stdErr</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>PkgErr1</span><span class=p>,</span> <span class=nx>PkgErr2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>errPkgNested</span><span class=p>()</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pkgErr</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>PkgErr1</span><span class=p>,</span> <span class=nx>PkgErr2</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=scope>Scope()<a hidden class=anchor aria-hidden=true href=#scope>#</a></h3><p>Sentryì—ì„œ ScopeëŠ” íŠ¹ì • ì—ëŸ¬ ë˜ëŠ” ì´ë²¤íŠ¸ì— ì¶”ê°€ì ì¸ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì—ëŸ¬ì˜ ì¬í˜„ì„ ìœ„í•´ì„œ ìš”ì²­ íŒŒë¼ë¯¸í„° ë“±ì„ Scopeì— ì €ì¥í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê³ ë„í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>Sentry í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” í—ˆë¸ŒëŠ” Context ë‹¨ìœ„ë¡œ ì‹±ê¸€í„´ íŒ¨í„´ì„ ìœ ì§€í•˜ë©°, go context.Context ì™€ í•¨ê»˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ì—¬, ì¶”ì ì— ìš©ì´í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>rm</span> <span class=o>*</span><span class=nx>sentryScopeMiddleware</span><span class=p>)</span> <span class=nf>Register</span><span class=p>(</span><span class=nx>originalHandler</span> <span class=nx>http</span><span class=p>.</span><span class=nx>Handler</span><span class=p>)</span> <span class=nx>http</span><span class=p>.</span><span class=nx>Handler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>rm</span><span class=p>.</span><span class=nx>initializer</span><span class=p>.</span><span class=nf>Enabled</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// sentryê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ê²½ìš°, ì„¼íŠ¸ë¦¬ í™œì„±í™”</span>
</span></span><span class=line><span class=cl>        <span class=nx>rm</span><span class=p>.</span><span class=nx>initializer</span><span class=p>.</span><span class=nf>Init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nf>HandlerFunc</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nx>r</span> <span class=p>=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>WithContext</span><span class=p>(</span><span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>hub</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span><span class=p>.</span><span class=nf>Scope</span><span class=p>().</span><span class=nf>SetRequest</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><hr><h2 id=sentry-advancement>Sentry Advancement<a hidden class=anchor aria-hidden=true href=#sentry-advancement>#</a></h2><h3 id=sentryinitializer>SentryInitializer<a hidden class=anchor aria-hidden=true href=#sentryinitializer>#</a></h3><p>í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‹±ê¸€í„´ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ì„¤ì •ì„ í†µí•œ ì´ˆê¸°í™” ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” í´ë˜ìŠ¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>core</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s>&#34;github.com/getsentry/sentry-go&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// SentryInitializer : Sentry ì„¤ì • ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹í•˜ëŠ” êµ¬í˜„ì²´</span>
</span></span><span class=line><span class=cl>    <span class=nx>SentryInitializer</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>conf</span>    <span class=o>*</span><span class=nx>Config</span>
</span></span><span class=line><span class=cl>        <span class=nx>enabled</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>        <span class=nx>mutex</span>   <span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span> <span class=c1>// enabled í•„ë“œì— ëŒ€í•œ ì½ê¸°/ì“°ê¸° ë™ê¸°í™”ë¥¼ ìœ„í•œ RWMutex</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NewSentryInitializer : SentryInitializer ìƒì„±ì</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewSentryInitializer</span><span class=p>(</span><span class=nx>conf</span> <span class=o>*</span><span class=nx>Config</span><span class=p>)</span> <span class=nx>SentryInitializer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>SentryInitializer</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>conf</span><span class=p>:</span> <span class=nx>conf</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Init : SentryInitializer ì´ˆê¸°í™”</span>
</span></span><span class=line><span class=cl><span class=c1>//</span>
</span></span><span class=line><span class=cl><span class=c1>//   - sentry íŒ¨í‚¤ì§€ ë³€ìˆ˜ë¥¼ í†µí•´ ì‹±ê¸€í„´ ì²˜ë¦¬í•˜ë¯€ë¡œ ìµœì´ˆ ì„¤ì •ë§Œ ìš”êµ¬ë¨</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>si</span> <span class=o>*</span><span class=nx>SentryInitializer</span><span class=p>)</span> <span class=nf>Init</span><span class=p>()</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>si</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span> <span class=c1>// enabled lock for writing</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>si</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>err</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>Init</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>sentry</span><span class=p>.</span><span class=nx>ClientOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>Dsn</span><span class=p>:</span>              <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>DSN</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>SampleRate</span><span class=p>:</span>       <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>SampleRate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>EnableTracing</span><span class=p>:</span>    <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>EnableTrace</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>Debug</span><span class=p>:</span>            <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>TracesSampleRate</span><span class=p>:</span> <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>TracesSampleRate</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>Environment</span><span class=p>:</span>      <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Environment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>AttachStacktrace</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>Transport</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>sentry</span><span class=p>.</span><span class=nx>HTTPSyncTransport</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>Timeout</span><span class=p>:</span> <span class=nx>si</span><span class=p>.</span><span class=nx>conf</span><span class=p>.</span><span class=nx>Sentry</span><span class=p>.</span><span class=nx>Timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// sentry ì´ˆê¸°í™” ì‹¤íŒ¨ ì‹œ, panic ì‹œìŠ¤í…œ os exit</span>
</span></span><span class=line><span class=cl>        <span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// í™œì„±í™” ìƒíƒœë¡œ ë³€ê²½</span>
</span></span><span class=line><span class=cl>    <span class=nx>si</span><span class=p>.</span><span class=nx>enabled</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Enabled : Sentry í™œì„±í™” ì—¬ë¶€</span>
</span></span><span class=line><span class=cl><span class=c1>//</span>
</span></span><span class=line><span class=cl><span class=c1>//   - Init()ì´ í˜¸ì¶œëœ ê²½ìš°, í™œì„±í™” ìƒíƒœë¡œ ë³€ê²½</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>si</span> <span class=o>*</span><span class=nx>SentryInitializer</span><span class=p>)</span> <span class=nf>Enabled</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>si</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>RLock</span><span class=p>()</span> <span class=c1>// read lock</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>si</span><span class=p>.</span><span class=nx>mutex</span><span class=p>.</span><span class=nf>RUnlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>si</span><span class=p>.</span><span class=nx>enabled</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ë™ì‹œì„± ë¬¸ì œë¡œ **Enabled()**ì˜ ë™ê¸°í™”ë¥¼ ìœ„í•´ ë½ìœ¼ë¡œ ê´€ë¦¬</p><h3 id=errorcapturer>ErrorCapturer<a hidden class=anchor aria-hidden=true href=#errorcapturer>#</a></h3><p>SentryInitializerë¥¼ ì„ë² ë”©í•˜ì—¬, ì„¼íŠ¸ë¦¬ë¥¼ í†µí•œ ì„¼íŠ¸ë¦¬ í—ˆë¸Œì—ì„œ ì—ëŸ¬ë¥¼ ìº¡ì³ë§í•˜ëŠ” í´ë˜ìŠ¤
<img loading=lazy src=/posts/sentry/7.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>core</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=s>&#34;github.com/getsentry/sentry-go&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ErrorCapturer : ì—ëŸ¬ ìº¡ì²˜ ì¸í„°í˜ì´ìŠ¤</span>
</span></span><span class=line><span class=cl>    <span class=nx>ErrorCapturer</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>CaptureError</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=nx>sentryErrorCapturer</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>SentryInitializer</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// NewSentryErrorCapturer : SentryErrorCapturer ìƒì„±ì</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewSentryErrorCapturer</span><span class=p>(</span><span class=nx>initializer</span> <span class=nx>SentryInitializer</span><span class=p>)</span> <span class=nx>ErrorCapturer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>sentryErrorCapturer</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>initializer</span><span class=p>:</span> <span class=nx>initializer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>// CaptureError : Sentryë¡œ ì—ëŸ¬ ìº¡ì²˜</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>sec</span> <span class=o>*</span><span class=nx>sentryErrorCapturer</span><span class=p>)</span> <span class=nf>CaptureError</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ì—ëŸ¬ê°€ ì—†ëŠ” ê²½ìš°, ë¬´ì‹œ</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>sec</span><span class=p>.</span><span class=nx>SentryInitializer</span><span class=p>.</span><span class=nf>Enabled</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// sentry ì´ˆê¸°í™”ë¥¼ í†µí•´ í™œì„±í™”</span>
</span></span><span class=line><span class=cl>        <span class=nx>sec</span><span class=p>.</span><span class=nx>SentryInitializer</span><span class=p>.</span><span class=nf>Init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì™€ ì—°ê´€ëœ Hub ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°</span>
</span></span><span class=line><span class=cl>    <span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>// í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ì— Sentry Hubì„ ì„¤ì •</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>hub</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// ì—ëŸ¬ ìº¡ì²˜</span>
</span></span><span class=line><span class=cl>    <span class=nx>hub</span><span class=p>.</span><span class=nf>CaptureException</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=recovermiddleware>RecoverMiddleware<a hidden class=anchor aria-hidden=true href=#recovermiddleware>#</a></h3><p>í•¸ë“¤ëŸ¬ì—ì„œ Panic ë°œìƒ ì‹œ, Recover(), ìš”ì²­ì„ í—ˆë¸Œì˜ ë©”íƒ€ë°ì´í„°ë¡œ ì €ì¥í•˜ëŠ” í´ë˜ìŠ¤
<img loading=lazy src=/posts/sentry/8.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Register panic() ë°œìƒ ì‹œ ìŠ¤íƒ ìŠ¤ë ˆì´ìŠ¤ë¥¼ ë¡œê¹…í•˜ë©° ì„¼íŠ¸ë¦¬ë¥¼ í†µí•´ ë‚¨ê¸°ëŠ” ë©”ì„œë“œ</span>
</span></span><span class=line><span class=cl><span class=c1>//</span>
</span></span><span class=line><span class=cl><span class=c1>//   - http handlerì— ë‚´ë¶€ì ìœ¼ë¡œ ë“±ë¡</span>
</span></span><span class=line><span class=cl><span class=c1>//   - API ê³ ë£¨í‹´ ë‚´ë¶€ì ìœ¼ë¡œ defer()ë¥¼ í†µí•˜ì—¬ panic ìƒí™©ì—ì„œë„ ë¡œê¹…ì´ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤</span>
</span></span><span class=line><span class=cl><span class=c1>//</span>
</span></span><span class=line><span class=cl><span class=c1>// Parameters:</span>
</span></span><span class=line><span class=cl><span class=c1>//   - originalHandler: ì›ë˜ì˜ http handler</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>rm</span> <span class=o>*</span><span class=nx>sentryRecoverMiddleware</span><span class=p>)</span> <span class=nf>Register</span><span class=p>(</span><span class=nx>originalHandler</span> <span class=nx>http</span><span class=p>.</span><span class=nx>Handler</span><span class=p>)</span> <span class=nx>http</span><span class=p>.</span><span class=nx>Handler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>rm</span><span class=p>.</span><span class=nx>initializer</span><span class=p>.</span><span class=nf>Enabled</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// sentryê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆëŠ” ê²½ìš°, ì„¼íŠ¸ë¦¬ í™œì„±í™”</span>
</span></span><span class=line><span class=cl>        <span class=nx>rm</span><span class=p>.</span><span class=nx>initializer</span><span class=p>.</span><span class=nf>Init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>http</span><span class=p>.</span><span class=nf>HandlerFunc</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span> <span class=o>:=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>GetHubFromContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>hub</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>hub</span> <span class=p>=</span> <span class=nx>sentry</span><span class=p>.</span><span class=nf>CurrentHub</span><span class=p>().</span><span class=nf>Clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nx>r</span> <span class=p>=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>WithContext</span><span class=p>(</span><span class=nx>sentry</span><span class=p>.</span><span class=nf>SetHubOnContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>hub</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>hub</span><span class=p>.</span><span class=nf>Scope</span><span class=p>().</span><span class=nf>SetRequest</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nb>recover</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>hub</span><span class=p>.</span><span class=nf>RecoverWithContext</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nf>Context</span><span class=p>(),</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nx>stackList</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nb>string</span><span class=p>(</span><span class=nx>debug</span><span class=p>.</span><span class=nf>Stack</span><span class=p>()),</span> <span class=s>&#34;\n&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nx>rm</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nf>Error</span><span class=p>().</span>
</span></span><span class=line><span class=cl>                    <span class=nf>Any</span><span class=p>(</span><span class=s>&#34;error&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>).</span>
</span></span><span class=line><span class=cl>                    <span class=nf>Any</span><span class=p>(</span><span class=s>&#34;stack_list&#34;</span><span class=p>,</span> <span class=nx>stackList</span><span class=p>).</span><span class=nf>Send</span><span class=p>()</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>                <span class=nx>resp</span> <span class=o>:=</span> <span class=nx>dto</span><span class=p>.</span><span class=nx>ACSErrorResponse</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>Code</span><span class=p>:</span>       <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>ErrMessage</span><span class=p>:</span> <span class=s>&#34;ì„œë²„ì—ì„œ ì˜ˆê¸°ì¹˜ ëª»í•œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=nx>Success</span><span class=p>:</span>    <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>                <span class=nx>jsonResp</span> <span class=o>:=</span> <span class=nx>resp</span><span class=p>.</span><span class=nf>ToJSON</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=nx>w</span><span class=p>.</span><span class=nf>Header</span><span class=p>().</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s>&#34;application/json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>jsonResp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>rm</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nf>Error</span><span class=p>().</span>
</span></span><span class=line><span class=cl>                        <span class=nf>Any</span><span class=p>(</span><span class=s>&#34;error&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>).</span><span class=nf>Send</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}()</span>
</span></span><span class=line><span class=cl>        <span class=nx>originalHandler</span><span class=p>.</span><span class=nf>ServeHTTP</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>ë¹„ìš©ì ì¸ ë¬¸ì œê°€ ìˆì§€ë§Œ <code>APM</code>ê³¼ <code>Error Capture</code>ì¸¡ë©´ì—ì„œëŠ” ê´€ë¦¬ì ì¸ í¸ì˜ì„±ì„ ì œê³µí•´ì£¼ëŠ” Sentry!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dingyu.dev/tags/go/>Go</a></li><li><a href=https://dingyu.dev/tags/sentry/>Sentry</a></li></ul><nav class=paginav><a class=prev href=https://dingyu.dev/posts/coffee-pal/><span class=title>Â« Prev</span><br><span>[DX] ì‚¬ë‚´ ì»¤í”¼ ì±— ìŠ¬ë™ ë´‡ ê°œë°œê¸°</span>
</a><a class=next href=https://dingyu.dev/posts/k8s-zero-downtime/><span class=title>Next Â»</span><br><span>[Infra] ì¿ ë²„ë„¤í‹±ìŠ¤ ë¬´ì¤‘ë‹¨ ë°°í¬ ì„¤ì •í•˜ê¸°</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=dings-things/blog data-repo-id=R_kgDON9IuAw data-category=Announcements data-category-id=DIC_kwDON9IuA84CnTai data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2025 <a href=https://dingyu.dev/>Ding's Coding Forge</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>